"use client";
import { useState, useReducer, useRef, useMemo, useEffect, createContext, useContext } from "react";

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AUREUS SOCIAL PRO ‚Äî Logiciel de Paie Belge Professionnel
//  Modules: ONSS (Dimona/DMFA), Belcotax 281.xx, Formule-cl√©
//  SPF Finances, Documents sociaux (C4, attestations)
//  üåê Multilingue: FR / NL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ I18N ‚Äî Dictionnaire FR / NL / EN / DE ‚îÄ‚îÄ
const LangCtx = createContext({lang:'fr',t:(k)=>k,setLang:()=>{}});
const useLang = () => useContext(LangCtx);

const I18N = {
  // ‚îÄ‚îÄ Navigation principale ‚îÄ‚îÄ
  'nav.dashboard': { fr:'Tableau de bord', nl:"Dashboard", en:"Dashboard", de:"Dashboard" },
  'nav.employees': { fr:'Employ√©s', nl:"Werknemers", en:"Employees", de:"Mitarbeiter" },
  'nav.payslip': { fr:'Fiches de paie', nl:"Loonfiches", en:"Payslips", de:"Gehaltsabrechnungen" },
  'nav.onss': { fr:'ONSS / D√©clarations', nl:"RSZ / Aangiften", en:"Social Security", de:"Sozialversicherung" },
  'nav.fiscal': { fr:'Fiscal', nl:"Fiscaal", en:"Tax", de:"Steuern" },
  'nav.salaires': { fr:'Salaires & Calculs', nl:"Lonen & Berekeningen", en:"Salaries & Calculations", de:"Geh√§lter & Berechnungen" },
  'nav.avantages': { fr:'Avantages & R√©mun√©ration', nl:"Voordelen & Verloning", en:"Benefits & Compensation", de:"Vorteile & Verg√ºtung" },
  'nav.contrats': { fr:'Contrats & Documents', nl:"Contracten & Documenten", en:"Contracts & Documents", de:"Vertr√§ge & Dokumente" },
  'nav.rh': { fr:'RH & Personnel', nl:"HR & Personeel", en:"HR & Personnel", de:"HR & Personal" },
  'nav.social': { fr:'Social & Assurances', nl:"Sociaal & Verzekeringen", en:"Social & Insurance", de:"Soziales & Versicherung" },
  'nav.bienetre': { fr:'Bien-√™tre & Pr√©vention', nl:"Welzijn & Preventie", en:"Wellbeing & Prevention", de:"Wohlbefinden & Pr√§vention" },
  'nav.reporting': { fr:'Reporting & Export', nl:"Rapportage & Export", en:"Reporting & Export", de:"Berichterstattung & Export" },
  'nav.legal': { fr:'Juridique & Veille', nl:"Juridisch & Monitoring", en:"Legal & Monitoring", de:"Recht & √úberwachung" },
  'nav.sprint9': { fr:'Sprint 9 - Modules', nl:'Sprint 9 - Modules', en:'Sprint 9 - Modules', de:'Sprint 9 - Module' },
  'nav.settings': { fr:'Param√®tres', nl:"Instellingen", en:"Settings", de:"Einstellungen" },
  'nav.aureussuite': { fr:'Aureus Suite', nl:"Aureus Suite", en:"Aureus Suite", de:"Aureus Suite" },
  'nav.back': { fr:'‚Üê Tous les dossiers', nl:"‚Üê Alle dossiers", en:"‚Üê All folders", de:"‚Üê Alle Ordner" },
  'nav.search': { fr:'üîç Rechercher un module... (Ctrl+K)', nl:"üîç Module zoeken... (Ctrl+K)", en:"üîç Search module... (Ctrl+K)", de:"üîç Modul suchen... (Ctrl+K)" },
  'nav.noresult': { fr:'Aucun module trouv√©', nl:"Geen module gevonden", en:"No module found", de:"Kein Modul gefunden" },
  
  // ‚îÄ‚îÄ Sous-menus ‚îÄ‚îÄ
  'sub.dimona': { fr:'Dimona', nl:"Dimona" },
  'sub.dmfa': { fr:'DMFA / DRS', nl:"DmfA / DRS" },
  'sub.drs': { fr:'DRS / Documents C', nl:"DRS / C-documenten" },
  'sub.onssapl': { fr:'ONSS-APL (DMFAPPL)', nl:"RSZ-PPL (DmfAPPL)" },
  'sub.belcotax': { fr:'Belcotax 281.xx', nl:"Belcotax 281.xx" },
  'sub.precompte': { fr:'Pr√©compte 274', nl:"Bedrijfsvoorheffing 274" },
  'sub.fiches_ext': { fr:'Fiches sp√©ciales', nl:"Speciale fiches" },
  'sub.co2': { fr:'Calcul CO2 v√©hicules', nl:"CO2-berekening voertuigen" },
  'sub.atn': { fr:'üöó ATN V√©hicules', nl:"üöó VAA Voertuigen" },
  'sub.od': { fr:'O.D. Comptables', nl:"Boekhoudkundige OD" },
  'sub.provisions': { fr:'Provisions', nl:"Voorzieningen" },
  'sub.cumuls': { fr:'Cumuls annuels', nl:"Jaarlijkse cumulatie" },
  'sub.netbrut': { fr:'Net ‚Üí Brut', nl:"Netto ‚Üí Bruto" },
  'sub.simcout': { fr:'üí∞ Simulation co√ªt', nl:"üí∞ Kostensimulatie" },
  'sub.saisies': { fr:'Saisies-Cessions', nl:"Beslagen-Overdrachten" },
  'sub.indexauto': { fr:'Index automatique', nl:"Automatische index" },
  'sub.horsforfait': { fr:'Heures suppl√©mentaires', nl:"Overuren" },
  'sub.totalreward': { fr:'üèÜ Total Reward', nl:"üèÜ Total Reward" },
  'sub.cheques': { fr:'Ch√®ques-Repas', nl:"Maaltijdcheques" },
  'sub.ecocmd': { fr:'√âco-ch√®ques', nl:"Ecocheques" },
  'sub.cafeteria': { fr:'Plan caf√©t√©ria', nl:"Cafetariaplan" },
  'sub.cct90': { fr:'Bonus CCT 90', nl:"Bonus CAO 90" },
  'sub.warrants': { fr:'Warrants', nl:"Warrants" },
  'sub.budgetmob': { fr:'Budget mobilit√©', nl:"Mobiliteitsbudget" },
  'sub.ecocircul': { fr:'Notes de frais', nl:"Onkostennota\'s" },
  'sub.contrats2': { fr:'Contrats de travail', nl:"Arbeidsovereenkomsten" },
  'sub.reglement': { fr:'R√®glement de travail', nl:"Arbeidsreglement" },
  'sub.compteindiv': { fr:'Compte individuel', nl:"Individuele rekening" },
  'sub.preavis': { fr:'Pr√©avis l√©gal', nl:"Wettelijke opzegging" },
  'sub.pecsortie': { fr:'P√©cule de sortie', nl:"Vertrekvakantiegeld" },
  'sub.certpme': { fr:'Certificat PME', nl:"KMO-certificaat" },
  'sub.absences': { fr:'Gestion absences', nl:"Afwezigheidsbeheer" },
  'sub.absenteisme': { fr:'üìä Analyse absent√©isme', nl:"üìä Absente√Øsme-analyse" },
  'sub.credittemps': { fr:'Cr√©dit-temps', nl:"Tijdskrediet" },
  'sub.chomtemp': { fr:'‚ö† Ch√¥mage temporaire', nl:"‚ö† Tijdelijke werkloosheid" },
  'sub.congeduc': { fr:'üéì Cong√©-√©ducation pay√©', nl:"üéì Betaald educatief verlof" },
  'sub.rcc': { fr:'RCC / Pr√©pension', nl:"SWT / Brugpensioen" },
  'sub.outplacement': { fr:'Outplacement', nl:"Outplacement" },
  'sub.pointage': { fr:'‚è± Pointage & Portail', nl:"‚è± Tijdsregistratie & Portaal" },
  'sub.planform': { fr:'Plan de formation', nl:"Opleidingsplan" },
  'sub.medtravail': { fr:'M√©decine du travail', nl:"Arbeidsgeneeskunde" },
  'sub.selfservice': { fr:'üë§ Portail travailleur', nl:"üë§ Werknemersportaal" },
  'sub.assloi': { fr:'Assurance-Loi AT', nl:"Arbeidsongevallenverzekering" },
  'sub.assgroupe': { fr:'Assurance Groupe', nl:"Groepsverzekering" },
  'sub.syndicales': { fr:'Primes syndicales', nl:"Syndicale premies" },
  'sub.allocfam': { fr:'Alloc. familiales', nl:"Kinderbijslag" },
  'sub.caissevac': { fr:'Caisse de vacances', nl:"Vakantiekas" },
  'sub.rentes': { fr:'Rentes', nl:"Renten" },
  'sub.decava': { fr:'DECAVA', nl:"DECAVA" },
  'sub.aidesemploi': { fr:"üéØ Aides √† l'emploi", nl:"üéØ Tewerkstellingssteun" },
  'sub.planglobal': { fr:'Plan global pr√©vention', nl:"Globaal preventieplan" },
  'sub.paa': { fr:'Plan action annuel', nl:"Jaarlijks actieplan" },
  'sub.risquespsycho': { fr:'Risques psychosociaux', nl:"Psychosociale risico\'s" },
  'sub.alcool': { fr:'Politique alcool/drogues', nl:"Alcohol-/drugsbeleid" },
  'sub.elections': { fr:'üó≥ √âlections sociales', nl:"üó≥ Sociale verkiezingen" },
  'sub.organes': { fr:'CE / CPPT / DS', nl:"OR / CPBW / VA" },
  'sub.accounting': { fr:'Accounting Output', nl:"Boekhoudkundige Output" },
  'sub.bilanbnb': { fr:'Bilan Social BNB', nl:"Sociaal Verslag NBB" },
  'sub.bilan': { fr:'Bilan Social', nl:"Sociaal Verslag" },
  'sub.statsins': { fr:'Statistiques INS', nl:"INS Statistieken" },
  'sub.sepa': { fr:'SEPA / Virements', nl:"SEPA / Overschrijvingen" },
  'sub.peppol': { fr:'üîó PEPPOL e-Invoicing', nl:"üîó PEPPOL e-Facturatie" },
  'sub.envoi': { fr:'Envoi documents', nl:"Documenten versturen" },
  'sub.exportimport': { fr:'Export / Import', nl:"Export / Import" },
  'sub.ged': { fr:'üìÅ GED / Archivage', nl:"üìÅ DMS / Archivering" },
  'sub.alertes': { fr:'Alertes l√©gales', nl:"Juridische waarschuwingen" },
  'sub.secteurs': { fr:'Secteurs sp√©cifiques', nl:"Specifieke sectoren" },
  'sub.eta': { fr:'Relev√©s ETA', nl:"ETA-overzichten" },
  'sub.docsjuridiques': { fr:'üìÑ Documents Juridiques', nl:"üìÑ Juridische Documenten" },
  'sub.config': { fr:'Configuration soci√©t√©', nl:"Bedrijfsconfiguratie" },
  'sub.fraisgestion': { fr:'üí∞ Frais de gestion', nl:"üí∞ Beheerskosten" },
  
  // ‚îÄ‚îÄ Headers & Titles ‚îÄ‚îÄ
  'app.title': { fr:'AUREUS SOCIAL', nl:"AUREUS SOCIAL" },
  'app.subtitle': { fr:'Logiciel de Paie Pro', nl:"Professionele Loonsoftware" },
  'app.client': { fr:'Client', nl:"Klant" },
  
  // ‚îÄ‚îÄ Login ‚îÄ‚îÄ
  'login.title': { fr:'Acc√®s s√©curis√©', nl:"Beveiligde toegang" },
  'login.create': { fr:'Cr√©er un code PIN', nl:"PIN-code aanmaken" },
  'login.enter': { fr:'Entrez votre code PIN', nl:"Voer uw PIN-code in" },
  'login.btn': { fr:'Se connecter', nl:"Aanmelden" },
  'login.create_btn': { fr:'Cr√©er', nl:"Aanmaken" },
  
  // ‚îÄ‚îÄ Employees ‚îÄ‚îÄ
  'emp.title': { fr:'Gestion du personnel', nl:"Personeelsbeheer" },
  'emp.add': { fr:'Ajouter un travailleur', nl:"Werknemer toevoegen" },
  'emp.firstname': { fr:'Pr√©nom', nl:"Voornaam" },
  'emp.lastname': { fr:'Nom', nl:"Naam" },
  'emp.niss': { fr:'NISS', nl:"INSZ" },
  'emp.birthdate': { fr:'Date de naissance', nl:"Geboortedatum" },
  'emp.address': { fr:'Adresse', nl:"Adres" },
  'emp.city': { fr:'Ville', nl:"Stad" },
  'emp.zip': { fr:'Code postal', nl:"Postcode" },
  'emp.startdate': { fr:"Date d'entr√©e", nl:"Datum indiensttreding" },
  'emp.enddate': { fr:'Date de sortie', nl:"Datum uitdiensttreding" },
  'emp.function': { fr:'Fonction', nl:"Functie" },
  'emp.department': { fr:'D√©partement', nl:"Afdeling" },
  'emp.contract': { fr:'Type contrat', nl:"Contracttype" },
  'emp.regime': { fr:'R√©gime', nl:"Regime" },
  'emp.salary': { fr:'Salaire mensuel brut', nl:"Bruto maandloon" },
  'emp.iban': { fr:'IBAN', nl:"IBAN" },
  'emp.civil': { fr:'√âtat civil', nl:"Burgerlijke staat" },
  'emp.children': { fr:'Enfants √† charge', nl:"Kinderen ten laste" },
  'emp.status_employe': { fr:'Employ√©', nl:"Bediende" },
  'emp.status_ouvrier': { fr:'Ouvrier', nl:"Arbeider" },
  'emp.status_student': { fr:'√âtudiant', nl:"Student" },
  'emp.status_flexi': { fr:'Flexi-job', nl:"Flexi-job" },
  'emp.sexe': { fr:'Sexe', nl:"Geslacht" },
  'emp.sexe_m': { fr:'Masculin', nl:"Man" },
  'emp.sexe_f': { fr:'F√©minin', nl:"Vrouw" },
  'emp.save': { fr:'Enregistrer', nl:"Opslaan" },
  'emp.delete': { fr:'Supprimer', nl:"Verwijderen" },
  'emp.active': { fr:'Actif', nl:"Actief" },
  'emp.inactive': { fr:'Inactif', nl:"Inactief" },
  
  // ‚îÄ‚îÄ Contract types ‚îÄ‚îÄ
  'ct.cdi': { fr:'CDI', nl:"COT" },
  'ct.cdd': { fr:'CDD', nl:"CBD" },
  'ct.interim': { fr:'Int√©rimaire', nl:"Uitzendkracht" },
  'ct.student': { fr:'√âtudiant (650h)', nl:"Student (650u)" },
  'ct.replacement': { fr:'Remplacement', nl:"Vervanging" },
  'ct.tpartiel': { fr:'Temps partiel', nl:"Deeltijds" },
  'ct.full': { fr:'Temps plein', nl:"Voltijds" },
  
  // ‚îÄ‚îÄ Civil status ‚îÄ‚îÄ
  'civil.single': { fr:'Isol√©', nl:"Alleenstaand" },
  'civil.married1': { fr:'Mari√© ‚Äî 1 revenu', nl:"Gehuwd ‚Äî 1 inkomen" },
  'civil.married2': { fr:'Mari√© ‚Äî 2 revenus', nl:"Gehuwd ‚Äî 2 inkomens" },
  'civil.cohabit': { fr:'Cohabitant', nl:"Samenwonend" },
  'civil.divorced': { fr:'Divorc√©', nl:"Gescheiden" },
  'civil.widow': { fr:'Veuf/Veuve', nl:"Weduwe/Weduwnaar" },
  
  // ‚îÄ‚îÄ Payslip ‚îÄ‚îÄ
  'pay.title': { fr:'Fiche de paie', nl:"Loonfiche" },
  'pay.period': { fr:'P√©riode', nl:"Periode" },
  'pay.month': { fr:'Mois', nl:"Maand" },
  'pay.year': { fr:'Ann√©e', nl:"Jaar" },
  'pay.days': { fr:'Jours prest√©s', nl:"Gewerkte dagen" },
  'pay.gross': { fr:'TOTAL BRUT', nl:"TOTAAL BRUTO" },
  'pay.net': { fr:'NET √Ä PAYER', nl:"NETTO TE BETALEN" },
  'pay.onss': { fr:'Cotisations ONSS', nl:"RSZ-bijdragen" },
  'pay.onss_worker': { fr:'ONSS travailleur', nl:"RSZ werknemer" },
  'pay.onss_employer': { fr:'ONSS employeur', nl:"RSZ werkgever" },
  'pay.pp': { fr:'Pr√©compte professionnel', nl:"Bedrijfsvoorheffing" },
  'pay.css': { fr:'Cotisation sp√©ciale s√©c. soc.', nl:"Bijzondere bijdrage SZ" },
  'pay.base': { fr:'Salaire de base', nl:"Basisloon" },
  'pay.overtime': { fr:'Heures sup. (150%)', nl:"Overuren (150%)" },
  'pay.sunday': { fr:'Heures dimanche (200%)', nl:"Zondaguren (200%)" },
  'pay.night': { fr:'Heures nuit (125%)', nl:"Nachturen (125%)" },
  'pay.bonus': { fr:'Prime', nl:"Premie" },
  'pay.y13': { fr:'13√®me mois', nl:"13de maand" },
  'pay.sick': { fr:'Salaire garanti maladie', nl:"Gewaarborgd loon ziekte" },
  'pay.advance': { fr:'Acompte', nl:"Voorschot" },
  'pay.garnish': { fr:'Saisie', nl:"Beslag" },
  'pay.transport': { fr:'Transport', nl:"Transport" },
  'pay.expense': { fr:'Frais propres employeur', nl:"Eigen kosten werkgever" },
  'pay.mv': { fr:'Ch√®ques-repas', nl:"Maaltijdcheques" },
  'pay.eco': { fr:'√âco-ch√®ques', nl:"Ecocheques" },
  'pay.employer_cost': { fr:'CO√õT EMPLOYEUR', nl:"WERKGEVERSKOST" },
  'pay.bonus_emploi': { fr:"Bonus √† l'emploi", nl:"Werkbonus" },
  'pay.bonus_fisc': { fr:'Bonus emploi fiscal', nl:"Fiscale werkbonus" },
  'pay.red_struct': { fr:'R√©duction structurelle', nl:"Structurele vermindering" },
  'pay.print': { fr:'Imprimer', nl:"Afdrukken" },
  'pay.pdf': { fr:'T√©l√©charger PDF', nl:"PDF downloaden" },
  'pay.calculate': { fr:'Calculer', nl:"Berekenen" },
  
  // ‚îÄ‚îÄ Heures suppl√©mentaires ‚îÄ‚îÄ
  'hs.overtime': { fr:'H. sup.', nl:"Overuren" },
  'hs.sunday': { fr:'H. dimanche', nl:"Zondaguren" },
  'hs.night': { fr:'H. nuit', nl:"Nachturen" },
  'hs.fiscal': { fr:'H.sup fiscales (180h)', nl:"Overuren fiscaal (180u)" },
  'hs.volont': { fr:'HS volont. brut=net (h)', nl:"Vrijw. overuren bruto=netto (u)" },
  'hs.relance': { fr:'HS relance T1 (h)', nl:"Relance-overuren T1 (u)" },
  
  // ‚îÄ‚îÄ Settings ‚îÄ‚îÄ
  'set.company': { fr:'Configuration soci√©t√©', nl:"Bedrijfsconfiguratie" },
  'set.name': { fr:"Nom de l'entreprise", nl:"Bedrijfsnaam" },
  'set.vat': { fr:'Num√©ro TVA', nl:"BTW-nummer" },
  'set.bce': { fr:'Num√©ro BCE', nl:"KBO-nummer" },
  'set.onss_num': { fr:'Num√©ro ONSS', nl:"RSZ-nummer" },
  'set.nace': { fr:'Code NACE', nl:"NACE-code" },
  'set.iban': { fr:'IBAN', nl:"IBAN" },
  'set.bic': { fr:'BIC', nl:"BIC" },
  'set.cp': { fr:'Commission paritaire', nl:"Paritair comit√©" },
  'set.sec_soc': { fr:'Secr√©tariat social', nl:"Sociaal secretariaat" },
  'set.address': { fr:'Adresse', nl:"Adres" },
  
  // ‚îÄ‚îÄ ONSS / Dimona ‚îÄ‚îÄ
  'onss.dimona_in': { fr:'Dimona IN ‚Äî Entr√©e en service', nl:"Dimona IN ‚Äî Indiensttreding" },
  'onss.dimona_out': { fr:'Dimona OUT ‚Äî Sortie de service', nl:"Dimona OUT ‚Äî Uitdiensttreding" },
  'onss.worker_type': { fr:'Type de travailleur', nl:"Type werknemer" },
  'onss.dmfa': { fr:'D√©claration DMFA', nl:"DmfA-aangifte" },
  'onss.trimester': { fr:'Trimestre', nl:"Kwartaal" },
  
  // ‚îÄ‚îÄ SEPA ‚îÄ‚îÄ
  'sepa.title': { fr:'SEPA / Virements bancaires', nl:"SEPA / Bankoverschrijvingen" },
  'sepa.salaries': { fr:'Salaires', nl:"Lonen" },
  'sepa.all': { fr:'TOUT (salaires + ONSS + PP)', nl:"ALLES (lonen + RSZ + BV)" },
  'sepa.sal_only': { fr:'Salaires uniquement', nl:"Alleen lonen" },
  'sepa.onss_only': { fr:'ONSS uniquement', nl:"Alleen RSZ" },
  'sepa.pp_only': { fr:'PP + CSS uniquement', nl:"Alleen BV + BBSZ" },
  'sepa.download': { fr:'üíæ T√©l√©charger .xml', nl:"üíæ .xml downloaden" },
  'sepa.email': { fr:'üìß Ouvrir dans Mail', nl:"üìß Openen in Mail" },
  'sepa.copy': { fr:'üìã Copier le message', nl:"üìã Bericht kopi√´ren" },
  
  // ‚îÄ‚îÄ Reporting ‚îÄ‚îÄ
  'rep.belcotax': { fr:'Belcotax 281.xx', nl:"Belcotax 281.xx" },
  'rep.bilan': { fr:'Bilan Social', nl:"Sociaal Verslag" },
  'rep.export': { fr:'Exporter', nl:"Exporteren" },
  'rep.generate': { fr:'G√©n√©rer', nl:"Genereren" },
  
  // ‚îÄ‚îÄ Contrats ‚îÄ‚îÄ
  'ctr.type_cdi': { fr:'Contrat √† dur√©e ind√©termin√©e', nl:"Arbeidsovereenkomst voor onbepaalde duur" },
  'ctr.type_cdd': { fr:'Contrat √† dur√©e d√©termin√©e', nl:"Arbeidsovereenkomst voor bepaalde duur" },
  'ctr.type_student': { fr:"Convention d'occupation √©tudiant", nl:"Studentenovereenkomst" },
  'ctr.type_flexi': { fr:'Contrat flexi-job', nl:"Flexi-job contract" },
  'ctr.generate': { fr:'G√©n√©rer le contrat', nl:"Contract genereren" },
  'ctr.preview': { fr:'Aper√ßu', nl:"Voorbeeld" },
  
  // ‚îÄ‚îÄ Veille l√©gale ‚îÄ‚îÄ
  'legal.title': { fr:'Veille l√©gale & Calendrier 2026', nl:"Juridische monitoring & Kalender 2026" },
  'legal.filter': { fr:'Filtrer', nl:"Filteren" },
  'legal.all': { fr:'Tout', nl:"Alles" },
  'legal.deadlines': { fr:'üìÖ √âch√©ances', nl:"üìÖ Deadlines" },
  'legal.new2026': { fr:'‚öñÔ∏è Nouveaut√©s 2026', nl:"‚öñÔ∏è Nieuw in 2026" },
  'legal.upcoming': { fr:'üîÆ R√©formes √† venir', nl:"üîÆ Komende hervormingen" },
  'legal.index': { fr:'üìà Indexations', nl:"üìà Indexeringen" },
  'legal.urgent': { fr:'Urgentes', nl:"Dringend" },
  'legal.plan': { fr:'√Ä planifier', nl:"Te plannen" },
  'legal.reminder': { fr:'Rappels', nl:"Herinneringen" },
  'legal.watch': { fr:'Veille', nl:"Monitoring" },
  'legal.institutions': { fr:'üèõ Institutions de r√©f√©rence', nl:"üèõ Referentie-instellingen" },
  'legal.summary': { fr:'R√©sum√©', nl:"Overzicht" },
  'legal.cal_pp': { fr:'üìÖ Calendrier PP (FinProf)', nl:"üìÖ Kalender BV (FinProf)" },
  'legal.cal_onss': { fr:'üìÖ Calendrier ONSS / DmfA', nl:"üìÖ Kalender RSZ / DmfA" },
  
  // ‚îÄ‚îÄ Months ‚îÄ‚îÄ
  'months': {
    fr:['Janvier',"F√©vrier","Mars","Avril","Mai","Juin","Juillet","Ao√ªt","Septembre","Octobre","Novembre","D√©cembre"],
    nl:['Januari',"Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],
  },
  
  // ‚îÄ‚îÄ Buttons & General ‚îÄ‚îÄ
  'btn.save': { fr:'Enregistrer', nl:"Opslaan" },
  'btn.cancel': { fr:'Annuler', nl:"Annuleren" },
  'btn.delete': { fr:'Supprimer', nl:"Verwijderen" },
  'btn.edit': { fr:'Modifier', nl:"Bewerken" },
  'btn.add': { fr:'Ajouter', nl:"Toevoegen" },
  'btn.close': { fr:'Fermer', nl:"Sluiten" },
  'btn.download': { fr:'T√©l√©charger', nl:"Downloaden" },
  'btn.print': { fr:'Imprimer', nl:"Afdrukken" },
  'btn.generate': { fr:'G√©n√©rer', nl:"Genereren" },
  'btn.validate': { fr:'Valider', nl:"Bevestigen" },
  'btn.search': { fr:'Rechercher', nl:"Zoeken" },
  'btn.reset': { fr:'R√©initialiser', nl:"Resetten" },
  'btn.copy': { fr:'Copier', nl:"Kopi√´ren" },
  'btn.export': { fr:'Exporter', nl:"Exporteren" },
  'btn.import': { fr:'Importer', nl:"Importeren" },
  'btn.send': { fr:'Envoyer', nl:"Versturen" },
  'btn.details': { fr:'D√©tail', nl:"Detail" },
  'btn.yes': { fr:'Oui', nl:"Ja" },
  'btn.no': { fr:'Non', nl:"Nee" },
  
  // ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ
  'dash.welcome': { fr:'Bienvenue', nl:"Welkom" },
  'dash.total_emp': { fr:'Travailleurs actifs', nl:"Actieve werknemers" },
  'dash.mass_sal': { fr:'Masse salariale', nl:"Loonmassa" },
  'dash.onss_due': { fr:'ONSS d√ª', nl:"RSZ verschuldigd" },
  'dash.pp_due': { fr:'PP d√ª', nl:"BV verschuldigd" },
  'dash.alerts': { fr:'Alertes', nl:"Waarschuwingen" },
  'dash.next_deadline': { fr:'Prochaine √©ch√©ance', nl:"Volgende deadline" },
  
  // ‚îÄ‚îÄ Clients ‚îÄ‚îÄ
  'cli.title': { fr:'Gestion des dossiers clients', nl:"Beheer klantenbestanden" },
  'cli.add': { fr:'Nouveau dossier', nl:"Nieuw dossier" },
  'cli.name': { fr:'Nom du client', nl:"Klantnaam" },
  'cli.open': { fr:'Ouvrir', nl:"Openen" },
  'cli.emps': { fr:'travailleurs', nl:"werknemers" },
};

// i18n provider wrapper
function LangProvider({children}) {
  const [lang, setLang] = useState('fr');
  const t = (key) => {
    const entry = I18N[key];
    if (!entry) return key;
    return entry[lang] || entry.fr || key;
  };
  const changeLang = (l) => { setLang(l); };
  return <LangCtx.Provider value={{lang, t, setLang: changeLang}}><LangSync/>{children}</LangCtx.Provider>;
}

// Language switcher component
function LangSwitch() {
  const {lang, setLang} = useLang();
  return <div style={{display:'flex',gap:2,background:"rgba(198,163,78,.06)",borderRadius:6,padding:2,border:'1px solid rgba(198,163,78,.1)'}}>
    {['fr',"nl","en","de"].map(l =>
      <button key={l} onClick={()=>setLang(l)} style={{
        padding:'4px 10px',borderRadius:5,border:'none',cursor:'pointer',fontSize:10.5,fontWeight:lang===l?700:400,
        background:lang===l?'rgba(198,163,78,.2)':'transparent',
        color:lang===l?'#c6a34e':'#9e9b93',fontFamily:'inherit',textTransform:'uppercase',letterSpacing:1
      }}>{l}</button>
    )}
  </div>;
}

// LangSync ‚Äî keeps global MN in sync with language
function LangSync() {
  const {lang} = useLang();
  useEffect(() => { MN = lang === 'nl' ? MN_NL : MN_FR; }, [lang]);
  return null;
}

const LEGAL={ONSS_W:.1307,ONSS_E:.25,BONUS_2026:{
    // Bonus √† l'emploi ‚Äî Volet A (bas salaires) + Volet B (tr√®s bas salaires)
    // Source: Partena Professional / Instructions ONSS T1/2026 ‚Äî index√© 01/01/2026
    // Employ√©s (d√©clar√©s √† 100%)
    A_S1:3340.44, A_MAX:132.92, A_COEFF:0.2638,  // Volet A: si S <= S1, R_A = A_MAX - A_COEFF*(S - A_S2)
    A_S2:2833.27,                                  // si S <= A_S2: R_A = A_MAX
    B_S1:2833.27, B_MAX:123.08, B_COEFF:0.2443,   // Volet B: si S <= B_S1, R_B = B_MAX - B_COEFF*(S - B_S2)
    B_S2:2330.10,                                  // si S <= B_S2: R_B = B_MAX
    // Ouvriers (d√©clar√©s √† 108%) ‚Äî m√™mes seuils mais x1.08
    O_A_S1:3609.28, O_A_MAX:143.55, O_A_COEFF:0.2449, 
    O_A_S2:3059.93,
    O_B_S1:3059.93, O_B_MAX:132.93, O_B_COEFF:0.2262,
    O_B_S2:2516.51
  },
  // ‚îÄ‚îÄ R√©duction structurelle ONSS T1/2026 ‚Äî Source: Easypay Group / ONSS 09/01/2026 ‚îÄ‚îÄ
  RED_STRUCT_2026:{
    // Cat 1: Secteur priv√© marchand (25%) ‚Äî F=0, Œ¥=0 ‚Üí seuls bas/tr√®s bas salaires
    CAT1_alpha:0.1400, CAT1_S0:11458.57,  // composante bas salaires: Œ±*(S0-S)
    CAT1_gamma:0.1500, CAT1_S2:9547.20,   // composante tr√®s bas salaires: Œ≥*(S2-S)
    CAT1_F:0, CAT1_delta:0, CAT1_S1:0,
    // Cat 2: Maribel social / non-marchand (¬±32.40%)
    CAT2_F:79.00, CAT2_alpha:0.2300, CAT2_S0:9975.60,
    CAT2_gamma:0.1500, CAT2_S2:9975.60,
    CAT2_delta:0.0600, CAT2_S1:16803.98,
    // Cat 3: Entreprises de travail adapt√©
    CAT3_alpha:0.1400, CAT3_S0:12416.08,
    CAT3_gamma:0.1500, CAT3_S2:9547.20,
    CAT3_F:0, CAT3_delta:0, CAT3_S1:0,
    // Cat 3bis: ETA travailleurs moins valides
    CAT3B_F:495.00, CAT3B_alpha:0.1785, CAT3B_S0:11788.30,
    CAT3B_gamma:0.1500, CAT3B_S2:9547.20,
    // Multiplicateur fixe Ps = R * ¬µ * fraction_prestation (¬µ=0.1400 int√©gr√© dans formule)
    MU:1.0  // ¬µ d√©j√† int√©gr√© dans les coefficients ci-dessus pour simplifier
  },MV:{emax:8.91,wmin:1.09,maxTotal:10,deducFisc:4},ECO:250,WD:21.67,WH:38,WHD:7.6,
  // ‚îÄ‚îÄ Pr√©compte professionnel 2026 ‚Äî Annexe III AR/CIR 92 (Moniteur belge) ‚îÄ‚îÄ
  // Formule-cl√© compl√®te SPF Finances (pas simplifi√©e)
  PP2026:{
    // Frais professionnels forfaitaires (salari√©s)
    FP_PCT:0.30, FP_MAX:5930,
    // Frais professionnels dirigeants d'entreprise
    FP_DIR_PCT:0.03, FP_DIR_MAX:3120,
    // Bar√®me progressif ANNUEL (tranches 2026 index√©es)
    TRANCHES:[
      {lim:16310,rate:0.2675},
      {lim:29940,rate:0.4280},
      {lim:41370,rate:0.4815},
      {lim:Infinity,rate:0.5350}
    ],
    // Quotit√© exempt√©e d'imp√¥t 2026
    EXEMPT:10900,
    // R√©ductions annuelles pour charges de famille
    RED:{
      isolee:144.00,          // personne isol√©e
      veuf_enfant:540.00,     // veuf/veuve non remari√©(e) + enfant
      enfants:[0,612,1620,3672,5928,7116],  // 0,1,2,3,4,5 enfants
      enfantX:7116,           // par enfant suppl√©mentaire > 5
      handicap:612,           // suppl√©ment par enfant handicap√©
      ascendant65:1728,       // parent/grand-parent ‚â•65 ans √† charge
      ascendant65_handi:2100, // idem handicap√©
      conjoint_charge:0,      // quotient conjugal: trait√© s√©par√©ment
    },
    // Quotient conjugal (bar√®me 2): max 30% du revenu, plafonn√© √† 12 520 ‚Ç¨
    QC_PCT:0.30, QC_MAX:12520,
  },
  // ‚îÄ‚îÄ Modulations sectorielles ONSS ‚îÄ‚îÄ
  // Depuis tax-shift 2018: taux facial = 25% secteur marchand priv√© (inclut mod√©ration salariale 7,48%)
  // Non-marchand: ‚âà 32,40% (r√©duction via Maribel social)
  // Ouvriers: cotisations calcul√©es sur brut √ó 108% (compensation p√©cule vacances)
  ONSS_DETAIL_2026:{
    // Ventilation du taux patronal 25% (secteur marchand, employ√©s)
    base:0.1993,           // cotisation de base
    moderation:0.0507,     // mod√©ration salariale (int√©gr√©e dans 25% facial)
    total_marchand:0.25,   // = cotisation globale secteur marchand (tax-shift 2018)
    // Cotisation suppl√©mentaire ‚â• 10 travailleurs
    supp_10trav:0.0169,    // 1,60% + mod√©ration = 1,69% si ‚â• 10 travailleurs
    // Non-marchand
    total_non_marchand:0.3240,
    maribel_social:0.0024, // r√©duction Maribel (d√©duit)
    // Ouvriers
    majoration_ouvrier:1.08, // brut √ó 108%
    vacances_annuelles_ouvrier:0.1027, // 10,27% sur brut √† 108% ann√©e N-1 (pay√© au 30/04)
    // Cotisations sp√©ciales patronales T1/2026
    ffe_petit:0.0032,      // Fonds fermeture < 20 trav.
    ffe_grand:0.0037,      // Fonds fermeture ‚â• 20 trav.
    chomage_temp:0.0009,   // ch√¥mage temporaire T1/2026
    amiante:0.0001,        // Fonds amiante (T1-T3 2026 seulement)
    maladies_prof:0.0017,  // cotisation maladies professionnelles (Fedris)
    // √âtudiants
    etudiant_patronal:0.0542, // cotisation solidarit√© patronale (650h/an)
    etudiant_personnel:0.0271,// cotisation solidarit√© personnelle
    etudiant_total:0.0813,    // total solidarit√© = 8,13%
    // Flexi-jobs
    flexi_patronal:0.28,   // 28% cotisation patronale sp√©ciale
    // CSS annuelle max
    css_max_isole:731.28,  // max annuel isol√©/conjoint sans revenus
    css_max_menage:731.28, // max annuel m√©nage 2 revenus (identique mais retenues mensuelles diff√©rentes)
    // Provisions mensuelles: le 5 de chaque mois
    // Solde trimestriel: dernier jour du mois suivant le trimestre
  },
  ONSS_SECTEUR:{
    'default':{e:0.25,type:"marchand",note:"Taux global standard 25% (secteur marchand priv√©, tax-shift 2018)"},
    '124':{e:0.3838,type:"marchand",note:"Construction: 25% + intemp√©ries 2% + cong√©s 6% + s√©curit√© 0.22% + timbre fid√©lit√©"},
    '302':{e:0.2816,type:"marchand",note:"Horeca: 25% + Fonds social horeca + Fonds fermeture"},
    '140':{e:0.2716,type:"marchand",note:"Transport: 25% + Fonds social + formation"},
    '330':{e:0.3240,type:"non_marchand",note:"Soins sant√© (non-marchand): 32,40% - Maribel social"},
    '331':{e:0.3240,type:"non_marchand",note:"Aide sociale Flandre (non-marchand): 32,40% - Maribel"},
    '332':{e:0.3240,type:"non_marchand",note:"Aide sociale CF/RW (non-marchand): 32,40% - Maribel"},
    '329':{e:0.3240,type:"non_marchand",note:"Socio-culturel (non-marchand): 32,40% - Maribel"},
    '318':{e:0.3240,type:"non_marchand",note:"Aides familiales (non-marchand): 32,40% - Maribel"},
    '319':{e:0.3240,type:"non_marchand",note:"√âducation (non-marchand): 32,40% - Maribel"},
    '322.01':{e:0.2916,type:"marchand",note:"Titres-services: 25% + fonds titres-services 4,16%"},
    '327':{e:0.3240,type:"non_marchand",note:"ETA (non-marchand): 32,40% - Maribel"},
  },
  DIMONA_TYPES:['IN',"OUT","UPDATE","CANCEL","DAILY"],
  DIMONA_WTYPES:['OTH',"STU","FLX","IVT","A17","DWD","TRI","S17","BCW","EXT"],
  DMFA_CODES:{'495':'Employ√© ordinaire',"015":'Ouvrier ordinaire',"487":'Dirigeant',"027":'Apprenti',"840":'√âtudiant',"050":'Int√©rimaire'},
  FICHE_281:{'10':'R√©mun√©rations employ√©s/dirigeants',"13":'Pensions/rentes',"14":'Revenus remplacement',"17":'Rentes alimentaires',"18":'R√©m. non-marchand',"20":'Honoraires/commissions',"30":'Jetons de pr√©sence',"50":'Revenus mobiliers'},
  SOCIAL_DOCS:{C4:'Certificat de ch√¥mage C4',C131A:'Certificat ch√¥mage temporaire',C3_2:'Carte contr√¥le ch√¥mage',VACATION:'Attestation de vacances',WORK_CERT:'Certificat de travail',ACCOUNT:'Compte individuel'},
  CP:{'100':'CP 100 - Auxiliaire ouvriers',"101":'CP 101 - Mines',"102":'CP 102 - Carri√®res',"104":'CP 104 - Sid√©rurgie',"105":'CP 105 - M√©taux non-ferreux',"106":'CP 106 - Ciment',"107":'CP 107 - Ma√Ætres-tailleurs',"109":'CP 109 - Habillement/Confection',"110":'CP 110 - Entretien textile',"111":'CP 111 - M√©tal/M√©canique/√âlectrique',"112":'CP 112 - Garage',"113":'CP 113 - C√©ramique',"114":'CP 114 - Briqueterie',"115":'CP 115 - Verrerie',"116":'CP 116 - Chimie',"117":'CP 117 - P√©trole',"118":'CP 118 - Industrie alimentaire',"119":'CP 119 - Commerce alimentaire',"120":'CP 120 - Textile/Bonneterie',"121":'CP 121 - Nettoyage',"124":'CP 124 - Construction',"125":'CP 125 - Industrie du bois',"126":'CP 126 - Ameublement',"127":'CP 127 - Commerce combustibles',"128":'CP 128 - Cuirs et peaux',"129":'CP 129 - P√¢tes/Papiers/Cartons',"130":'CP 130 - Imprimerie/Arts graphiques',"132":'CP 132 - Travaux techniques agricoles',"133":'CP 133 - Tabacs',"136":'CP 136 - Transformation papier/carton',"139":'CP 139 - Batellerie',"140":'CP 140 - Transport',"142":'CP 142 - R√©cup√©ration mati√®res premi√®res',"143":'CP 143 - P√™che maritime',"144":'CP 144 - Agriculture',"145":'CP 145 - Horticulture',"146":'CP 146 - Entreprises foresti√®res',"147":'CP 147 - Armurerie',"148":'CP 148 - Fourrure/Peau en poil',"149":'CP 149 - Secteurs connexes m√©tal',"149.01":'CP 149.01 - √âlectriciens installation',"149.02":'CP 149.02 - Carrosserie',"149.03":'CP 149.03 - M√©taux pr√©cieux',"149.04":'CP 149.04 - Commerce du m√©tal',"150":'CP 150 - Poterie',"152":'CP 152 - Enseignement libre',"200":'CP 200 - Auxiliaire employ√©s',"201":'CP 201 - Commerce de d√©tail ind√©pendant',"202":'CP 202 - Commerce d√©tail alimentaire',"203":'CP 203 - Carri√®res petit granit (empl.)',"204":'CP 204 - Carri√®res porphyre (empl.)',"205":'CP 205 - Charbonnages (empl.)',"207":'CP 207 - Industrie chimique (empl.)',"209":'CP 209 - Fabrications m√©talliques (empl.)',"210":'CP 210 - Sid√©rurgie (empl.)',"211":'CP 211 - P√©trole (empl.)',"214":'CP 214 - Textile/Bonneterie (empl.)',"215":'CP 215 - Habillement/Confection (empl.)',"216":'CP 216 - Notaires (empl.)',"217":'CP 217 - Casino (empl.)',"218":'CP 218 - CNT auxiliaire employ√©s',"219":'CP 219 - Organismes contr√¥le agr√©√©s',"220":'CP 220 - Industrie alimentaire (empl.)',"221":'CP 221 - Industrie papeti√®re (empl.)',"222":'CP 222 - Transformation papier/carton (empl.)',"223":'CP 223 - Sports',"224":'CP 224 - M√©taux non-ferreux (empl.)',"225":'CP 225 - Enseignement libre (empl.)',"226":'CP 226 - Commerce international/Transport',"227":'CP 227 - Secteur audio-visuel',"301":'CP 301 - Ports',"302":'CP 302 - H√¥tellerie',"303":'CP 303 - Cin√©matographie',"304":'CP 304 - Spectacle',"306":'CP 306 - Assurances',"307":'CP 307 - Courtage assurances',"308":'CP 308 - Pr√™ts hypoth√©caires',"309":'CP 309 - Soci√©t√©s de bourse',"310":'CP 310 - Banques',"311":'CP 311 - Grandes surfaces',"312":'CP 312 - Grands magasins',"313":'CP 313 - Pharmacies',"314":'CP 314 - Coiffure/Soins de beaut√©',"315":'CP 315 - Aviation commerciale',"316":'CP 316 - Marine marchande',"317":'CP 317 - Gardiennage',"318":'CP 318 - Aides familiales/seniors',"319":'CP 319 - √âducation/H√©bergement',"320":'CP 320 - Pompes fun√®bres',"321":'CP 321 - Grossistes m√©dicaments',"322":'CP 322 - Int√©rimaire/Titres-services',"322.01":'CP 322.01 - Titres-services',"323":'CP 323 - Gestion immeubles/Domestiques',"324":'CP 324 - Diamant',"325":'CP 325 - Institutions publiques cr√©dit',"326":'CP 326 - Gaz/√âlectricit√©',"327":'CP 327 - Travail adapt√©/Ateliers sociaux',"328":'CP 328 - Transport urbain/r√©gional',"329":'CP 329 - Socio-culturel',"330":'CP 330 - Sant√©',"331":'CP 331 - Aide sociale (Flandre)',"332":'CP 332 - Aide sociale (francophone)',"333":'CP 333 - Attractions touristiques',"336":'CP 336 - Professions lib√©rales'},
  REDUCTIONS:{base:157.29,married1:258.33,children:[0,52.50,141.67,318.33,514.17,618.33],childX:618.33,handicap:52.50,isolated:52.50},
  // ‚îÄ‚îÄ Cotisation Sp√©ciale S√©curit√© Sociale ‚Äî retenue MENSUELLE (provisions) ‚îÄ‚îÄ
  // Source: socialsecurity.be/employer/instructions/dmfa + Securex montants-socio-juridiques
  // Bas√©e sur la r√©mun√©ration TRIMESTRIELLE, retenue mensuellement = 1/3 du montant trimestriel
  // ISOL√â / conjoint SANS revenus prof. (bar√®me 1)
  CSS_SINGLE:[
    {f:0,t:1945.38,a:0},                              // T <= 5836.14: 0‚Ç¨
    {f:1945.39,t:2190.18,p:.076,b:1945.38},            // 5836.14 < T <= 6570.54: 7,6% tranche, min 0‚Ç¨
    {f:2190.19,t:6038.82,a:18.60,p2:0.011,b2:2190.18,max:60.94}, // 6570.54 < T <= 18116.46: 18.60 + 1,1% tranche, max 60.94‚Ç¨/mois
    {f:6038.83,t:Infinity,a:60.94}                     // T > 18116.46: 60.94‚Ç¨/mois (182.82‚Ç¨/trim)
  ],
  // M√âNAGE 2 REVENUS (conjoint a aussi des revenus prof.) (bar√®me 2)
  CSS_MARRIED:[
    {f:0,t:1945.38,a:0},                              // T <= 5836.14: 0‚Ç¨
    {f:1945.39,t:2190.18,p:.076,b:1945.38,min:9.30},  // 5836.14 < T <= 6570.54: 7,6% tranche, min 9.30‚Ç¨/mois
    {f:2190.19,t:6038.82,a:18.60,p2:0.011,b2:2190.18,max:51.64}, // 6570.54 < T <= 18116.46: 18.60 + 1,1% tranche, max 51.64‚Ç¨/mois
    {f:6038.83,t:Infinity,a:51.64}                     // T > 18116.46: 51.64‚Ç¨/mois (154.92‚Ç¨/trim)
  ],
  // ‚îÄ‚îÄ SOURCES OFFICIELLES √Ä SURVEILLER ‚îÄ‚îÄ
  SOURCES_VEILLE:{
    federal:[
      {nom:"ONSS",url:"onss.be",desc:"Instructions trimestrielles, cotisations, DmfA"},
      {nom:"SPF Finances",url:"finances.belgium.be",desc:"Bar√®mes PP, Annexe III, circulaires fiscales"},
      {nom:"Fisconetplus",url:"eservices.minfin.fgov.be/fisconetplus",desc:"Base de donn√©es fiscales ‚Äî circulaires, rulings, addenda PP"},
      {nom:"SPF Emploi",url:"emploi.belgique.be",desc:"Droit du travail, r√©glementation, CCT"},
      {nom:"Moniteur belge",url:"ejustice.just.fgov.be",desc:"Publication officielle lois, AR, CCT rendues obligatoires"},
      {nom:"CNT",url:"cnt-nar.be",desc:"CCT interprofessionnelles, avis"},
      {nom:"ONEM",url:"onem.be",desc:"Ch√¥mage, cr√©dit-temps, interruption carri√®re"},
      {nom:"INAMI",url:"inami.fgov.be",desc:"Assurance maladie-invalidit√©, incapacit√© de travail"},
      {nom:"SFP/MyPension",url:"sfpd.fgov.be",desc:"Pensions, Wijninckx, DB2P"},
      {nom:"Sigedis/DB2P",url:"sigedis.be",desc:"Pensions compl√©mentaires, base de donn√©es 2√®me pilier"},
      {nom:"Fedris",url:"fedris.be",desc:"Accidents du travail, maladies professionnelles, tarification AT"},
      {nom:"ONVA",url:"onva.be",desc:"Vacances annuelles ouvriers, p√©cules, taux 10,27%"},
      {nom:"BCSS/KSZ",url:"ksz-bcss.fgov.be",desc:"Banque Carrefour SS, flux DRS, formulaires √©lectroniques"},
      {nom:"CAPAC",url:"capac.fgov.be",desc:"Allocations ch√¥mage, formulaires C4, ch√¥mage temporaire"},
      {nom:"INASTI",url:"inasti.be",desc:"Cotisations ind√©pendants, statut mixte dirigeants"},
      {nom:"SPF √âconomie",url:"economie.fgov.be",desc:"Index sant√©, indices prix, index-pivot"},
      {nom:"Statbel",url:"statbel.fgov.be",desc:"Statistiques emploi, enqu√™tes structure salaires"},
      {nom:"BNB",url:"nbb.be",desc:"Bilan social, centrale des bilans, donn√©es macro"},
      {nom:"BCE",url:"kbo-bce-search.economie.fgov.be",desc:"Registre entreprises, NACE, donn√©es soci√©t√©s"},
      {nom:"FLA",url:"federallearningaccount.be",desc:"Federal Learning Account ‚Äî obligation formation employeurs"},
      {nom:"Belcotax",url:"belcotaxonweb.be",desc:"Fiches fiscales 281.xx"},
      {nom:"Chambre/S√©nat",url:"lachambre.be",desc:"Projets de loi EN COURS ‚Äî alertes pr√©coces"},
    ],
    regional:[
      {nom:"Actiris",url:"actiris.brussels",desc:"Bruxelles ‚Äî aides emploi, Activa, r√©ductions groupes-cibles"},
      {nom:"FOREM",url:"forem.be",desc:"Wallonie ‚Äî aides emploi, Impulsion, sesam"},
      {nom:"VDAB",url:"vdab.be",desc:"Flandre ‚Äî aides emploi, doelgroepverminderingen"},
    ],
    secsoc:[
      {nom:"Securex",url:"securex.be",desc:"Alertes l√©gislatives, montants socio-juridiques, analyses"},
      {nom:"Partena",url:"partena-professional.be",desc:"Analyses juridiques, guides pratiques"},
      {nom:"Acerta",url:"acerta.be",desc:"Juricible, publications juridiques, simulations"},
      {nom:"Liantis",url:"liantis.be",desc:"Actualit√©s sociales, guides PME"},
      {nom:"UCM",url:"ucm.be",desc:"Union Classes Moyennes, analyses PME, cotisations"},
      {nom:"Groupe S",url:"groups.be",desc:"Secr√©tariat social, analyses sectorielles"},
    ],
    juridique:[
      {nom:"Droitbelge.be",url:"droitbelge.be",desc:"Jurisprudence, doctrine, fiches pratiques"},
      {nom:"SocialEye (Wolters Kluwer)",url:"wolterskluwer.com/fr-be",desc:"Base juridique sociale compl√®te"},
      {nom:"Socialsecurity.be",url:"socialsecurity.be",desc:"Portail central SS ‚Äî instructions ONSS, manuels admin"},
      {nom:"Salaires minimums",url:"salairesminimums.be",desc:"Bar√®mes sectoriels index√©s par CP"},
    ],
  },
};

const fmt=n=>new Intl.NumberFormat('fr-BE',{style:'currency',currency:'EUR'}).format(n||0);
const fmtP=n=>`${((n||0)*100).toFixed(2)}%`;
const uid=()=>`${Date.now()}-${Math.random().toString(36).substr(2,5)}`;
const MN_FR=['Janvier',"F√©vrier","Mars","Avril","Mai","Juin","Juillet","Ao√ªt","Septembre","Octobre","Novembre","D√©cembre"];
const MN_NL=['Januari',"Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"];
let MN=MN_FR; // Default FR ‚Äî updated by LangSync component

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BAR√àMES OFFICIELS (Source: salairesminimums.be ‚Äî SPF Emploi)
//  En vigueur au 01/01/2026
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const BAREMES={
  '200':{type:"monthly",indexDate:'01/01/2026',indexPct:2.21,regime:38,
    classes:{A:'Fonctions ex√©cutives',B:'Fonctions de support',C:'Fonctions de gestion',D:'Fonctions consultatives'},
    grid:{
      0:{A:2242.80,B:2336.26,C:2369.30,D:2555.72},
      1:{A:2310.29,B:2413.08,C:2433.27,D:2642.08},
      2:{A:2317.18,B:2426.87,C:2488.15,D:2659.15},
      3:{A:2324.15,B:2440.76,C:2536.36,D:2676.54},
      4:{A:2330.81,B:2459.31,C:2584.73,D:2744.49},
      5:{A:2337.59,B:2478.16,C:2632.95,D:2805.17},
      6:{A:2344.48,B:2492.51,C:2681.18,D:2865.76},
      7:{A:2351.28,B:2528.52,C:2729.58,D:2926.21},
      8:{A:2358.64,B:2564.62,C:2778.00,D:2986.87},
      9:{A:2377.79,B:2600.57,C:2826.39,D:3047.16},
      10:{A:2397.02,B:2636.80,C:2874.62,D:3108.07},
      11:{A:2413.36,B:2667.12,C:2923.00,D:3168.37},
      12:{A:2429.54,B:2697.07,C:2971.32,D:3229.13},
      13:{A:2445.96,B:2727.39,C:3009.52,D:3289.61},
      14:{A:2462.02,B:2757.42,C:3047.57,D:3350.23},
      15:{A:2478.16,B:2787.64,C:3085.79,D:3400.63},
      16:{A:2494.21,B:2797.49,C:3123.91,D:3451.03},
      17:{A:2510.32,B:2807.26,C:3162.14,D:3501.43},
      18:{A:2526.43,B:2817.24,C:3173.03,D:3552.00},
      19:{A:2526.43,B:2827.05,C:3183.98,D:3602.52},
      20:{A:2526.43,B:2836.94,C:3194.97,D:3620.36},
      21:{A:2526.43,B:2846.99,C:3206.15,D:3638.33},
      22:{A:2526.43,B:2856.72,C:3217.15,D:3656.27},
      23:{A:2526.43,B:2866.60,C:3228.41,D:3674.05},
      24:{A:2526.43,B:2876.47,C:3239.44,D:3691.77},
      25:{A:2526.43,B:2886.29,C:3250.71,D:3709.53},
      26:{A:2526.43,B:2896.17,C:3261.79,D:3727.33},
    },
    fnClassMap:{
      'Secr√©taire':'A',"R√©ceptionniste":'A',"Aide-comptable":'A',"Assistant(e) administratif":'A',"Encodeur(se)":'A',
      'Comptable junior':'B',"Vendeur(se)":'B',"Service client":'B',"Secr√©taire m√©dicale":'B',"Assistant(e) dentaire":'B',"Pr√©parateur commandes":'B',"Recruteur":'B',"Secr√©taire juridique":'B',"Hygi√©niste dentaire":'B',
      'Comptable':'C',"Comptable senior":'C',"D√©veloppeur junior":'C',"Marketing digital":'C',"Gestionnaire syndic":'C',"Consultant RH":'C',"Juriste":'C',"Gestionnaire sinistres":'C',"UX Designer":'C',"Paralegal":'C',"Web developer":'C',"Sysadmin":'C',"Administratif":'B',
      'D√©veloppeur senior':'D',"Project manager":'D',"Ing√©nieur":'D',"Avocat collaborateur":'D',"Agent immobilier":'D',"Courtier":'D',"Ing√©nieur process":'D',
    },
    primeAnnuelle:330.84,ecoChequesMax:250,primeFinAnnee:'salaire brut d√©cembre',
    transport:{velo:0.27,maxVeloJour:10.80,priveSeuilAnnuel:36688,privePct:0.50},
  },
  '124':{type:"hourly",indexDate:'01/01/2026',indexPct:0.2186,regime:40,weeklyH:40,
    classes:{I:'Man≈ìuvre',IA:'Man≈ìuvre qualifi√© (I+5%)',II:'Ouvrier semi-qualifi√©',IIA:'Ouvrier semi-qualifi√© (II+5%)',III:'Ouvrier qualifi√©',IV:'Ouvrier sp√©cialis√©'},
    grid:{I:18.231,IA:19.138,II:19.436,IIA:20.406,III:20.669,IV:21.940,"Chef III":22.736,"Chef IV":24.134,"Contrem IV":26.328},
    fnClassMap:{
      'Man≈ìuvre':'I',"Aide-ma√ßon":'I',"D√©molisseur":'I',
      'Ma√ßon':'III',"Coffreur":'III',"Ferrailleur":'III',"Plombier":'III',"Chauffagiste":'III',"Peintre":'III',"Plafonneux":'III',"Carreleur":'III',"√âlectricien":'III',
      'Grutier':'IV',"Chef de chantier":'Chef IV',"Apprenti":'I',
    },
    timbreFidelite:0.09,timbreIntemperie:0.02,ecoChequesMax:115,
    mobilite:{parKm:0.1579,maxKm:64},reposComp:12,
  },
  '302':{type:"hourly",indexDate:'01/01/2026',indexPct:2.189,regime:38,weeklyH:38,
    classes:{I:'Cat I',II:'Cat II',III:'Cat III',IV:'Cat IV',V:'Cat V'},
    grid:{
      0:{I:15.2097,II:15.2097,III:15.2977,IV:15.9698,V:16.8849},
      1:{I:15.8915,II:15.8915,III:16.0385,IV:16.7838,V:17.7770},
      4:{I:16.2538,II:16.2538,III:16.4029,IV:17.1645,V:18.1848},
      8:{I:16.6152,II:16.6152,III:16.7673,IV:17.5452,V:18.5926},
    },
    fnClassMap:{
      'Plongeur(se)':'I',"Agent d'entretien":'I',
      'Serveur(se)':'II',"Barman/Barmaid":'II',"Commis de cuisine":'II',"Femme/Valet de chambre":'II',
      'Cuisinier(√®re)':'III',"R√©ceptionniste":'III',"Aide cuisine":'II',"Livreur(se)":'II',
      'Chef cuisinier':'IV',"Concierge":'IV',
    },
    monthlyFactor:164.6666,indemniteNuit:1.6209,indemniteVetements:2.20,
  },
  '330':{type:"monthly",indexDate:'01/01/2026',indexPct:2.0,regime:38,
    // Source: salairesminimums.be CP 330 ‚Äî √©chelles bar√©miques alloc. r√©sidence, index√©es 01/01/2026
    // √âchelles: 1.12(Cat1) 1.26(Cat2) 1.40(Cat3) 1.45(Cat4) 1.59(Cat5) ‚Äî M√©decin hors bar√®me
    classes:{1:'√âch.1.12 (aide logistique)',2:'√âch.1.26 (aide-soignant)',3:'√âch.1.40 (bachelier soins)',4:'√âch.1.45 (sp√©cialis√©)',5:'√âch.1.59 (cadre soignant)',6:'M√©decin salari√© (hors grille)'},
    grid:{
      0:{1:2254.03,2:2463.41,3:2682.04,4:2793.00,5:3033.67,6:5610.00},
      1:{1:2437.49,2:2654.11,3:2881.21,4:2959.36,5:3200.65,6:5610.00},
      2:{1:2449.70,2:2679.05,3:2881.21,4:2959.36,5:3200.65,6:5900.00},
      3:{1:2461.93,2:2703.98,3:2897.01,4:2993.89,5:3249.13,6:5900.00},
      5:{1:2486.35,2:2753.47,3:2946.22,4:3062.22,5:3297.61,6:6190.00},
      7:{1:2510.77,2:2802.96,3:2995.49,4:3130.61,5:3346.08,6:6190.00},
      9:{1:2535.18,2:2852.43,3:3044.75,4:3078.39,5:3395.65,6:6480.00},
      10:{1:2609.90,2:2917.50,3:3122.11,4:3156.63,5:3443.64,6:6480.00},
      15:{1:2685.89,2:3074.76,3:3276.46,4:3433.66,5:3643.60,6:7245.00},
      20:{1:2747.42,2:3232.01,3:3405.15,4:3713.65,5:3843.57,6:7770.00},
      25:{1:2809.15,2:3345.69,3:3600.63,4:3881.12,5:3987.79,6:8150.00},
      27:{1:2836.55,2:3401.54,3:3665.11,4:3959.80,5:4069.43,6:8350.00},
      31:{1:2836.55,2:3401.54,3:3791.26,4:4124.28,5:4234.52,6:8800.00},
    },
    fnClassMap:{
      'Agent d\'entretien':'1',"Agent h√¥telier":'1',"Cuisinier(√®re)":'1',
      'Aide-soignant(e)':'2',"Brancardier":'2',"Secr√©taire m√©dicale":'2',
      'Infirmier(√®re)':'3',"Ergoth√©rapeute":'3',"Kin√©sith√©rapeute":'3',"Technicien(ne) labo":'3',
      'Pharmacien(ne) adjoint':'4',"Sage-femme":'4',
      'Infirmier(√®re) chef':'5',
      'M√©decin':'6',
    },
    primeAttractivite:0.02,primeNuit:0.35,primeWeekendSam:0.56,primeWeekendDim:1.00,
  },
  '140':{type:"hourly",indexDate:'01/01/2026',indexPct:2.18,regime:38,weeklyH:38,
    // Source: salairesminimums.be SCP 140.03 ‚Äî 01/01/2025 bar√®mes index√©s +2,18% pour 2026
    classes:{R1:'Roulant Niv.1',R2:'Roulant Niv.2',R3:'Roulant Niv.3',R4:'Roulant Niv.4',NR1:'Non-roulant Cl.1',NR3:'Non-roulant Cl.3',NR5:'Non-roulant Cl.5',NR6:'Non-roulant Cl.6',GA:'Garage man≈ìuvre A',GB:'Garage sp√©cialis√© B',GC:'Garage sp√©cialis√© C',GD:'Garage sp√©cialis√© D'},
    grid:{R1:14.9254,R2:15.4491,R3:15.6284,R4:15.8078,NR1:15.6463,NR3:16.8015,NR5:17.6623,NR6:18.0261,GA:16.2359,GB:18.6683,GC:20.7119,GD:21.7245},
    monthlyFactor:164.6666,
    fnClassMap:{'Chauffeur C':'R2',"Chauffeur CE":'R4',"Dispatcher":'NR3',"M√©canicien":'GB',"D√©m√©nageur":'R1',"Chef d'√©quipe":'R4'},
  },
  '118':{type:"hourly",indexDate:'01/01/2026',indexPct:2.19,regime:38,weeklyH:38,
    classes:{1:'Classe 1 (man≈ìuvre)',2:'Classe 2',3:'Classe 3 (semi-qualifi√©)',4:'Classe 4',5:'Classe 5 (qualifi√©)',6:'Classe 6',7:'Classe 7',8:'Classe 8 (haut. qualifi√©)'},
    grid:{// Sous-secteur 17 conserves viande ‚Äî SPF salairesminimums.be 01/01/2026
      0:{1:17.59,2:17.85,3:18.16,4:18.44,5:18.69,6:18.93,7:19.39,8:19.79},
      12:{1:17.85,2:18.16,3:18.44,4:18.69,5:18.93,6:19.39,7:19.79,8:20.15},
      24:{1:17.85,2:18.44,3:18.69,4:18.93,5:19.39,6:19.79,7:20.15,8:20.21},
      36:{1:17.85,2:18.44,3:18.69,4:19.39,5:19.79,6:20.15,7:20.21,8:20.26},
      48:{1:17.85,2:18.44,3:18.69,4:19.39,5:19.79,6:20.15,7:20.26,8:20.52},
      60:{1:17.85,2:18.44,3:18.69,4:19.39,5:19.79,6:20.15,7:20.26,8:20.80},
      72:{1:17.85,2:18.44,3:18.69,4:19.39,5:19.79,6:20.15,7:20.26,8:21.06},
    },
    monthlyFactor:164.6666,
    fnClassMap:{'Ouvrier production':'1',"Technicien maintenance":'5',"Chef d'√©quipe":'8',"Contr√¥leur qualit√©":'5',"Op√©rateur machine":'3',"Conducteur de ligne":'6',"Magasinier":'2',"Laborantin":'5'},
  },
  '121':{type:"hourly",indexDate:'01/01/2026',indexPct:0.56,regime:37,weeklyH:37,
    // Source: salairesminimums.be CP 121 ‚Äî 01/01/2026 ‚Äî r√©gime 37h
    classes:{1:'1A Nettoyage habituel',2:'1B Nettoyage sp√©cial',3:'2A Nettoyage mi-lourd',4:'3A Collecte d√©chets',5:'8A Man≈ìuvre industriel',6:'8C 1er op√©rateur',CE:"Chef d'√©quipe (+10%)",BR:'Brigadier (+5%)'},
    grid:{1:16.8180,2:17.3420,3:17.9070,4:19.1185,5:19.6905,6:22.5255,CE:18.4998,BR:17.6589},
    fnClassMap:{'Agent d\'entretien':'1',"Repasseur(se)":'1',"Aide-m√©nager(√®re)":'1',"Chef d'√©quipe":'CE',"Responsable site":'6'},
    monthlyFactor:160.3333,// 37h * 52 / 12
  },
  '209':{n:'Fabrications m√©talliques',idx:2.72,dt:'01/07/2025',regime:38,approx:false,
    // Source: emploi.belgique.be Limosa CP209 (22/07/2025) + CSC Metea idx 2,72% (07/2025)
    // Classification sectorielle 8 classes + appointement min garanti +85‚Ç¨ au 01/01/2025
    fn:{
      'Employ√© ex√©cution':{cls:1},
      'Employ√© sp√©cialis√©':{cls:2},
      'Employ√© qualifi√©':{cls:3},
      'Employ√© haut. qualifi√©':{cls:4},
      'Responsable':{cls:5},
      'Cadre':{cls:6}
    },
    note:"CP 209 emploi.belgique.be. Idx 2,72% au 01/07/2025. Classes sectorielles. Bar√®me national + compl√©ments provinciaux.",
    grille:[
      {exp:0,c1:2443.80,c2:2598.34,c3:2852.67,c4:3148.56,c5:3598.23,c6:4298.45},
      {exp:2,c1:2518.23,c2:2698.67,c3:2978.45,c4:3298.34,c5:3798.56,c6:4548.23},
      {exp:5,c1:2623.56,c2:2848.91,c3:3148.23,c4:3498.67,c5:4048.91,c6:4898.34},
      {exp:10,c1:2758.91,c2:3048.56,c3:3398.67,c4:3798.23,c5:4398.56,c6:5348.91},
      {exp:15,c1:2898.34,c2:3248.23,c3:3648.91,c4:4098.56,c5:4748.23,c6:5798.67},
      {exp:20,c1:3048.67,c2:3448.91,c3:3898.56,c4:4398.23,c5:5098.67,c6:6248.34}
    ]},
  '226':{n:'Commerce international',idx:2.23,dt:'01/01/2026',regime:38,approx:false,
    // Source: CP 200 bar√®mes salairesminimums.be (01/2023) + idx 2,21% (01/2024) + idx 2,23% (01/2026)
    // Applique bar√®mes CP 200 avec indexation propre
    fn:{
      'Employ√© administratif':{cls:1},
      'Commercial jr':{cls:2},
      'Commercial/Qualifi√©':{cls:3},
      'Responsable/Cadre':{cls:4}
    },
    note:"CP 226 applique bar√®mes CP 200. Classes A-D. Idx 2,23% au 01/01/2026.",
    grille:[
      {exp:0,c1:2317.78,c2:2414.35,c3:2448.51,c4:2641.01},
      {exp:5,c1:2352.07,c2:2493.42,c3:2649.05,c4:2822.33},
      {exp:10,c1:2413.33,c2:2653.84,c3:2892.12,c4:3122.70},
      {exp:15,c1:2493.42,c2:2807.25,c3:3104.70,c4:3414.78},
      {exp:20,c1:2542.18,c2:2855.57,c3:3213.47,c4:3635.66},
      {exp:25,c1:2542.18,c2:2905.65,c3:3268.93,c4:3725.71}
    ]},
  '116':{n:'Industrie chimique',idx:2.0,dt:'01/04/2025',regime:38,approx:false,
    fn:{
      'Manoeuvre ordinaire':{cls:1,anc:{0:15.829,12:16.012}},
    },
    note:"Taux horaires ouvriers (38h). Bar√®me simplifi√©: 2 √©chelons anciennet√©. Employ√©s: bar√®mes entreprise (CP 207).",
    grille:[
      {exp:0,c1:2598.81,c2:2598.81},
      {exp:12,c1:2628.85,c2:2628.85}
    ]},
  '149':{n:'√âlectriciens (installation)',idx:2.23,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be SCP 149.01 ‚Äî 01/2025 index√© +2,23% au 01/01/2026
    // Taux horaires Cat A-F, anciennet√© 0-26 ans (prime anc. int√©gr√©e)
    fn:{
      'Ouvrier non-qualifi√©':{cls:1},
      'Ouvrier sp√©cialis√© 2e':{cls:2},
      'Ouvrier sp√©cialis√© 1e':{cls:3},
      'Ouvrier qualifi√© 3e':{cls:4},
      'Ouvrier qualifi√© 2e':{cls:5},
      'Ouvrier qualifi√© 1e':{cls:6}
    },
    note:"SCP 149.01 salairesminimums.be. Horaire 38h. Taux horaires: A:16.88 B:17.89 C:19.41 D:21.10 E:22.28 F:23.63 (01/2026). Mensuel = horaire x 164.67.",
    grille:[
      {exp:0,c1:2780.09,c2:2946.42,c3:3196.91,c4:3474.33,c5:3668.18,c6:3890.49},
      {exp:1,c1:2808.07,c2:2975.99,c3:3228.22,c4:3508.90,c5:3704.39,c6:3930.30},
      {exp:2,c1:2821.25,c2:2989.17,c3:3243.04,c4:3525.47,c5:3721.87,c6:3948.78},
      {exp:3,c1:2834.43,c2:3003.98,c3:3258.80,c4:3542.94,c5:3738.40,c6:3966.31},
      {exp:4,c1:2847.61,c2:3018.80,c3:3274.57,c4:3560.42,c5:3756.87,c6:3985.78},
      {exp:5,c1:2860.79,c2:3033.61,c3:3290.33,c4:3577.89,c5:3774.34,c6:4004.31},
      {exp:10,c1:2927.73,c2:3103.22,c3:3369.00,c4:3663.43,c5:3874.49,c6:4110.02},
      {exp:15,c1:2995.30,c2:3184.28,c3:3455.02,c4:3752.86,c5:3963.70,c6:4204.79},
      {exp:20,c1:3063.50,c2:3254.73,c3:3531.59,c4:3836.39,c5:4058.81,c6:4305.46},
      {exp:25,c1:3131.07,c2:3325.18,c3:3610.11,c4:3921.86,c5:4146.02,c6:4397.71},
      {exp:26,c1:3144.88,c2:3340.80,c3:3627.05,c4:3940.27,c5:4165.43,c6:4418.24}
    ]},
  '201':{n:'Commerce d√©tail ind√©pendant',idx:2.0,dt:'01/04/2025',regime:38,approx:false,
    fn:{
      'Vendeur d√©butant':{cls:1},
      'Vendeur':{cls:2},
      'Premier vendeur':{cls:3},
      'Chef de vente':{cls:4}
    },
    note:"Groupe 1 (<10 vente), personnel de vente, <20 travailleurs. Cat.1 max 10 ans anc.",
    grille:[
      {exp:0,c1:1997.85,c2:2053.89,c3:2084.33,c4:2214.12},
      {exp:2,c1:1997.85,c2:2053.89,c3:2150.44,c4:2274.25},
      {exp:5,c1:1997.85,c2:2135.83,c3:2285.97,c4:2393.86},
      {exp:8,c1:1997.85,c2:2238.45,c3:2420.39,c4:2573.25},
      {exp:10,c1:2011.83,c2:2305.79,c3:2510.30,c4:2693.15},
      {exp:12,c1:2011.83,c2:2305.79,c3:2600.07,c4:2812.87},
      {exp:14,c1:2011.83,c2:2305.79,c3:2600.07,c4:2932.18}
    ]},
  '225':{n:'Enseignement priv√© subventionn√©',idx:2.21,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 225 = CP 200 bar√®mes (institutions enseignement libre)
    fn:{
      'Personnel admin. Cl.A':{cls:1},
      'Personnel p√©dag. Cl.B':{cls:2},
      'Coordinateur Cl.C':{cls:3},
      'Direction Cl.D':{cls:4}
    },
    note:"CP 225 = bar√®mes CP 200 (auxiliaire employ√©s). Idx 2,21% au 01/01/2026.",
    grille:[
      {exp:0,c1:2317.78,c2:2414.35,c3:2448.51,c4:2641.01},
      {exp:5,c1:2352.07,c2:2493.42,c3:2649.05,c4:2822.33},
      {exp:10,c1:2413.33,c2:2653.84,c3:2892.12,c4:3122.70},
      {exp:15,c1:2493.42,c2:2807.25,c3:3104.70,c4:3414.78},
      {exp:20,c1:2542.18,c2:2855.57,c3:3213.47,c4:3635.66}
    ]},
  '304':{n:'Spectacle (artistes)',idx:2.0,dt:'01/02/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 304.0001 ‚Äî en vigueur 01/02/2026 ‚Äî idx x1,3728
    // Bar√®mes mensuels min. par groupe de fonctions (spectacles d'art dramatique FR/DE)
    fn:{
      'Groupe 6 (d√©butant)':{cls:6},"Groupe 5":{cls:5},"Groupe 4":{cls:4},
      'Groupe 3b':{cls:'3b'},"Groupe 3a":{cls:'3a'},
      'Groupe 2b':{cls:'2b'},"Groupe 2a":{cls:'2a'},
      'Groupe 1b (direction)':{cls:'1b'},"Groupe 1a (direction)":{cls:'1a'}
    },
    note:"CP 304 salairesminimums.be 01/02/2026. Bar√®me plat sans anciennet√©. Groupes 1a-6 selon classification fonctions.",
    grille:[
      {exp:0,c6:2087.10,c5:2241.70,c4:2396.29,c3b:2550.90,c3a:2705.49,c2b:2860.09,c2a:2705.49,c1b:3376.43,c1a:2859.94}
    ]},
  '307':{n:'Courtage & assurances',idx:2.21,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 307 + emploi.belgique.be Limosa fiche
    // Bar√®mes sectoriels propres, proches CP 200 + compl√©ments
    fn:{
      'Employ√© admin. Cl.A':{cls:1},
      'Gestionnaire Cl.B':{cls:2},
      'Souscripteur Cl.C':{cls:3},
      'Inspecteur/Cadre Cl.D':{cls:4}
    },
    note:"CP 307 salairesminimums.be. Classification proche CP 200 avec compl√©ments sectoriels assurances.",
    grille:[
      {exp:0,c1:2317.78,c2:2500.00,c3:2780.00,c4:3150.00},
      {exp:5,c1:2450.00,c2:2660.00,c3:2950.00,c4:3350.00},
      {exp:10,c1:2600.00,c2:2830.00,c3:3120.00,c4:3550.00},
      {exp:15,c1:2750.00,c2:2990.00,c3:3290.00,c4:3750.00},
      {exp:20,c1:2900.00,c2:3150.00,c3:3460.00,c4:3950.00}
    ]},
  '313':{n:'Pharmacies',idx:2.0,dt:'01/03/2025',regime:38,approx:false,
    fn:{
      'Personnel Cat I':{cls:1},
      'Personnel Cat II':{cls:2},
      'Assistant pharma Cat III':{cls:3},
      'Personnel Cat IV':{cls:4},
      'Pharmacien adjoint':{cls:5},
      'Pharmacien g√©rant':{cls:6}
    },
    note:"Personnel non-pharmacien: Cat I-IV par exp√©rience 0-42 ans. Pharmaciens: adjoints/g√©rants.",
    grille:[
      {exp:0,c1:2114.25,c2:2152.00,c3:2227.51,c4:2303.03,c5:3462.31,c6:3834.57},
      {exp:3,c1:2231.32,c2:2275.96,c3:2342.94,c4:2499.26,c5:3938.02,c6:4351.66},
      {exp:5,c1:2263.81,c2:2309.00,c3:2376.77,c4:2534.94,c5:4041.40,c6:4455.09},
      {exp:10,c1:2326.93,c2:2373.44,c3:2443.23,c4:2606.02,c5:4248.29,c6:4661.90},
      {exp:15,c1:2390.07,c2:2437.95,c3:2509.71,c4:2677.13},
      {exp:20,c1:2453.21,c2:2502.36,c3:2576.12,c4:2748.24},
      {exp:25,c1:2516.28,c2:2566.84,c3:2642.54,c4:2819.31},
      {exp:30,c1:2579.48,c2:2631.31,c3:2709.05,c4:2890.47},
      {exp:35,c1:2642.54,c2:2695.76,c3:2775.47,c4:2962.30},
      {exp:40,c1:2705.74,c2:2760.19,c3:2841.89,c4:3032.37},
      {exp:42,c1:2730.99,c2:2786.06,c3:2868.52,c4:3060.61}
    ]},
  '319':{n:'√âtablissements √©ducatifs',idx:2.0,dt:'01/02/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 319/326 ‚Äî secteur non-marchand
    // Bar√®mes align√©s sur CP 326 (√©ducation/h√©bergement). Idx 2% au 01/02/2026.
    fn:{
      'Accompagnateur Cl.9-10':{cls:1},
      '√âducateur Cl.12-13':{cls:2},
      '√âducateur chef Cl.14-15':{cls:3},
      'Coordinateur Cl.16-17':{cls:4}
    },
    note:"CP 319 salairesminimums.be. Non-marchand, bar√®mes CP 326 align√©s. Classes/plages salariales.",
    grille:[
      {exp:0,c1:2513.26,c2:2666.59,c3:2829.24,c4:3100.00},
      {exp:2,c1:2614.80,c2:2774.31,c3:2943.54,c4:3220.00},
      {exp:5,c1:2774.86,c2:2944.12,c3:3123.71,c4:3420.00},
      {exp:10,c1:2945.28,c2:3124.93,c3:3315.54,c4:3640.00},
      {exp:15,c1:3095.48,c2:3284.33,c3:3484.65,c4:3830.00},
      {exp:20,c1:3141.58,c2:3333.23,c3:3536.54,c4:3900.00}
    ]},
  '322.01':{n:'Titres-services',idx:2.0,dt:'01/03/2025',regime:38,approx:false,
    // Source: ACCG/FGTB tract officiel CP 322.01 (01/07/2025)
    // Horaire: 1e an:14,67‚Ç¨ 2e:15,20‚Ç¨ 3e:15,37‚Ç¨ 4e+:15,53‚Ç¨/h. Mensuel x164,67.
    fn:{
      'Aide-m√©nager(√®re) 1e an':{cls:1},
      'Aide-m√©nager(√®re) 2e an':{cls:2},
      'Aide-m√©nager(√®re) 3e an':{cls:3},
      'Aide-m√©nager(√®re) 4e an+':{cls:4}
    },
    note:"SCP 322.01 ACCG/FGTB 07/2025. Horaire: 14,67/15,20/15,37/15,53 ‚Ç¨/h. Idx 2% 03/2025.",
    grille:[
      {exp:0,c1:2415.69},
      {exp:1,c1:2502.98},
      {exp:2,c1:2530.98},
      {exp:3,c1:2557.33}
    ]},
  '323':{n:'Gestion immeubles / Syndics',idx:2.21,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 323 = CP 200 bar√®mes applicables
    fn:{
      'Employ√© admin. Cl.A':{cls:1},
      'Gestionnaire Cl.B':{cls:2},
      'Syndic/Expert Cl.C':{cls:3},
      'Responsable Cl.D':{cls:4}
    },
    note:"CP 323 = bar√®mes CP 200. Gestion immobili√®re, syndics. Idx 2,21% au 01/01/2026.",
    grille:[
      {exp:0,c1:2317.78,c2:2414.35,c3:2448.51,c4:2641.01},
      {exp:5,c1:2352.07,c2:2493.42,c3:2649.05,c4:2822.33},
      {exp:10,c1:2413.33,c2:2653.84,c3:2892.12,c4:3122.70},
      {exp:15,c1:2493.42,c2:2807.25,c3:3104.70,c4:3414.78},
      {exp:20,c1:2542.18,c2:2855.57,c3:3213.47,c4:3635.66}
    ]},
  '327':{n:'Entreprises de travail adapt√© (ETA)',idx:2.0,dt:'01/02/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 327/326 ‚Äî bar√®mes travailleurs adapt√©s + encadrement
    fn:{
      'Trav. adapt√© Cl.HA1':{cls:1},
      'Trav. adapt√© Cl.HB1':{cls:2},
      'Moniteur Cl.G1':{cls:3},
      'Encadrant Cl.F1':{cls:4}
    },
    note:"CP 327 salairesminimums.be (sous CP 326). ETA/ateliers prot√©g√©s. Idx 2% au 01/02/2026.",
    grille:[
      {exp:0,c1:2513.26,c2:2563.54,c3:2666.59,c4:2829.24},
      {exp:2,c1:2614.80,c2:2667.10,c3:2774.31,c4:2943.54},
      {exp:4,c1:2720.45,c2:2774.86,c3:2886.39,c4:3062.46},
      {exp:8,c1:2887.24,c2:2944.98,c3:3063.36,c4:3250.21},
      {exp:12,c1:3004.46,c2:3064.55,c3:3187.74,c4:3382.19},
      {exp:16,c1:3126.44,c2:3188.99,c3:3317.16,c4:3519.52},
      {exp:20,c1:3141.58,c2:3204.41,c3:3333.23,c4:3536.54}
    ]},
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // NOUVELLES CPs AJOUT√âES ‚Äî F√©vrier 2026
  // Sources: salairesminimums.be, emploi.belgique.be,
  // CGSLB, CSC, FGTB, Agoria, Metallos FGTB
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  '111':{n:'Constructions m√©tallique, m√©canique & √©lectrique (ouvriers)',idx:2.72,dt:'01/07/2025',regime:38,approx:false,
    // Source: salairesminimums.be CP 111 + Metallos FGTB + Agoria (idx 2,72% au 01/07/2025, +0.26‚Ç¨ nat. au 01/01/2026)
    // Bar√®mes nationaux horaires ‚Äî r√©gime 38h/sem
    fn:{
      'Ouvrier Cat.1':{cls:1},"Ouvrier Cat.2":{cls:2},"Ouvrier Cat.3":{cls:3},
      'Ouvrier Cat.4':{cls:4},"Ouvrier Cat.5":{cls:5},"Ouvrier Cat.6":{cls:6},"Ouvrier Cat.7":{cls:7}
    },
    note:"CP 111 national. Bar√®mes provinciaux souvent sup√©rieurs (Agoria). Idx 2,72% au 01/07/2025 + hausse CCT 0,26‚Ç¨ au 01/01/2026.",
    grille:[
      {exp:0,c1:2628.43,c2:2704.10,c3:2793.90,c4:2915.51,c5:3049.26,c6:3200.42,c7:3369.22},
      {exp:5,c1:2691.22,c2:2769.73,c3:2862.63,c4:2988.89,c5:3127.48,c6:3283.50,c7:3457.24},
      {exp:10,c1:2755.52,c2:2836.85,c3:2933.03,c4:3064.20,c5:3207.76,c6:3368.80,c7:3547.08}
    ]},

  '202':{n:'Commerce de d√©tail alimentaire (employ√©s)',idx:1.0,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be + CGSLB. Idx 1% au 01/01/2026 (syst√®me sp√©cifique).
    // Grandes surfaces: Colruyt, Delhaize, Aldi, Lidl...
    fn:{
      'Employ√© Cat.1':{cls:1},"Employ√© Cat.2":{cls:2},"Employ√© Cat.3":{cls:3},
      'Employ√© Cat.4':{cls:4},"Employ√© Cat.5":{cls:5}
    },
    note:"CP 202 Commerce d√©tail alimentaire. Grandes surfaces, supermarch√©s. Idx 1% au 01/01/2026.",
    grille:[
      {exp:0,c1:2141.05,c2:2198.00,c3:2320.81,c4:2458.79,c5:2719.10},
      {exp:2,c1:2179.76,c2:2237.73,c3:2362.77,c4:2503.26,c5:2768.33},
      {exp:4,c1:2218.82,c2:2277.83,c3:2405.11,c4:2548.12,c5:2817.96},
      {exp:6,c1:2258.24,c2:2318.30,c3:2447.82,c4:2593.39,c5:2868.02},
      {exp:10,c1:2338.01,c2:2400.18,c3:2534.17,c4:2684.86,c5:2969.97},
      {exp:15,c1:2438.89,c2:2503.60,c3:2643.26,c4:2800.33,c5:3098.03},
      {exp:20,c1:2540.70,c2:2607.99,c3:2753.33,c4:2917.02,c5:3227.32}
    ]},

  '220':{n:'Industrie alimentaire (employ√©s)',idx:2.19,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be + CGSLB CP 118-220. Idx 2,19% au 01/01/2026.
    // Employ√©s des entreprises alimentaires (boulangeries industrielles, brasseries, etc.)
    fn:{
      'Employ√© Cat.1':{cls:1},"Employ√© Cat.2":{cls:2},"Employ√© Cat.3":{cls:3},
      'Employ√© Cat.4':{cls:4},"Employ√© Cat.5":{cls:5},"Employ√© Cat.6":{cls:6}
    },
    note:"CP 220 Industrie alimentaire employ√©s. Pendant employ√© de CP 118. Idx 2,19% au 01/01/2026.",
    grille:[
      {exp:0,c1:2265.35,c2:2367.83,c3:2560.15,c4:2796.04,c5:3104.63,c6:3549.47},
      {exp:2,c1:2315.41,c2:2420.12,c3:2616.68,c4:2857.78,c5:3173.14,c6:3627.70},
      {exp:5,c1:2390.58,c2:2498.56,c3:2701.54,c4:2950.51,c5:3276.01,c6:3745.27},
      {exp:10,c1:2541.44,c2:2656.28,c3:2872.10,c4:3136.73,c5:3482.75,c6:3981.71},
      {exp:15,c1:2693.21,c2:2814.92,c3:3043.60,c4:3324.01,c5:3690.87,c6:4219.53},
      {exp:20,c1:2845.91,c2:2974.49,c3:3216.07,c4:3512.27,c5:3899.88,c6:4458.25}
    ]},

  '311':{n:'Grandes entreprises de vente au d√©tail',idx:2.21,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be + emploi.belgique.be Limosa CP 311
    // Mediamarkt, IKEA, H&M, Primark, Action, Fnac...
    fn:{
      'Vendeur Cat.1':{cls:1},"Vendeur Cat.2":{cls:2},"Caissier Cat.3":{cls:3},
      'Chef rayon Cat.4':{cls:4},"Responsable Cat.5":{cls:5}
    },
    note:"CP 311 Grandes entreprises vente d√©tail. IKEA, H&M, Mediamarkt, etc. Idx 2,21% au 01/01/2026.",
    grille:[
      {exp:0,c1:2141.28,c2:2222.87,c3:2336.26,c4:2555.72,c5:2874.62},
      {exp:2,c1:2181.14,c2:2264.25,c3:2379.83,c4:2603.68,c5:2928.55},
      {exp:5,c1:2241.64,c2:2327.10,c3:2445.82,c4:2676.54,c5:3008.87},
      {exp:10,c1:2363.82,c2:2454.06,c3:2579.38,c4:2822.83,c5:3173.24},
      {exp:15,c1:2488.00,c2:2583.34,c3:2715.05,c4:2971.32,c5:3339.90},
      {exp:20,c1:2614.62,c2:2714.48,c3:2852.99,c4:3122.12,c5:3509.70}
    ]},

  '329':{n:'Secteur socio-culturel',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 329 + CSC non-marchand. Idx 2% au 01/01/2026 (indice pivot).
    // SCP 329.01 (Flandre), 329.02 (CF/RW/CG), 329.03 (f√©d√©ral/bicom.)
    fn:{
      'Bar√®me 1':{cls:1},"Bar√®me 2":{cls:2},"Bar√®me 3":{cls:3},
      'Bar√®me 4':{cls:4},"Bar√®me 4.1":{cls:5}
    },
    note:"CP 329 Socio-culturel (IFIC non-marchand). Associations, ONG, centres culturels. Idx 2% au 01/01/2026.",
    grille:[
      {exp:0,c1:2297.43,c2:2441.08,c3:2634.50,c4:2897.93,c5:3161.40},
      {exp:2,c1:2358.67,c2:2506.14,c3:2704.68,c4:2975.16,c5:3245.68},
      {exp:4,c1:2421.05,c2:2572.38,c3:2776.07,c4:3053.67,c5:3331.28},
      {exp:8,c1:2548.97,c2:2708.06,c3:2922.10,c4:3214.00,c5:3506.39},
      {exp:12,c1:2680.81,c2:2847.86,c3:3072.42,c4:3378.99,c5:3686.47},
      {exp:16,c1:2816.97,c2:2992.25,c3:3227.56,c4:3549.18,c5:3872.10},
      {exp:20,c1:2957.78,c2:3141.73,c3:3388.01,c4:3724.98,c5:4063.93}
    ]},

  '332':{n:'Aide sociale & Soins de sant√© (francophone/germanophone)',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 332 (ex-CP 305.02) + CGSLB non-marchand
    // Bar√®mes IFIC non-marchand. Cr√®ches, CPAS, planning familial, aide jeunesse...
    fn:{
      'Cat.1 (aide)':{cls:1},"Cat.2 (qualifi√©)":{cls:2},"Cat.3 (bachelier)":{cls:3},
      'Cat.4 (master)':{cls:4},"Cat.5 (direction)":{cls:5}
    },
    note:"CP 332 Aide sociale francophone. Cr√®ches, CPAS, planning, aide jeunesse. Idx 2% au 01/01/2026.",
    grille:[
      {exp:0,c1:2297.43,c2:2513.26,c3:2666.59,c4:2943.54,c5:3250.21},
      {exp:2,c1:2358.67,c2:2614.80,c3:2774.31,c4:3062.46,c5:3382.19},
      {exp:5,c1:2453.38,c2:2769.11,c3:2940.88,c4:3244.05,c5:3583.53},
      {exp:10,c1:2612.64,c2:2954.10,c3:3132.94,c4:3456.69,c5:3819.01},
      {exp:15,c1:2775.95,c2:3143.32,c3:3329.41,c4:3674.05,c5:4060.02},
      {exp:20,c1:2943.54,c2:3337.23,c3:3531.41,c4:3897.28,c5:4307.36}
    ]},

  '331':{n:'Aide sociale & Soins de sant√© (Flandre)',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 331 ‚Äî bar√®mes IFIC flamands. M√™me structure que CP 332.
    fn:{
      'Cat.1 (aide)':{cls:1},"Cat.2 (qualifi√©)":{cls:2},"Cat.3 (bachelier)":{cls:3},
      'Cat.4 (master)':{cls:4},"Cat.5 (direction)":{cls:5}
    },
    note:"CP 331 Aide sociale Flandre. M√™mes bar√®mes IFIC que CP 332. Idx 2% au 01/01/2026.",
    grille:[
      {exp:0,c1:2297.43,c2:2513.26,c3:2666.59,c4:2943.54,c5:3250.21},
      {exp:2,c1:2358.67,c2:2614.80,c3:2774.31,c4:3062.46,c5:3382.19},
      {exp:5,c1:2453.38,c2:2769.11,c3:2940.88,c4:3244.05,c5:3583.53},
      {exp:10,c1:2612.64,c2:2954.10,c3:3132.94,c4:3456.69,c5:3819.01},
      {exp:15,c1:2775.95,c2:3143.32,c3:3329.41,c4:3674.05,c5:4060.02},
      {exp:20,c1:2943.54,c2:3337.23,c3:3531.41,c4:3897.28,c5:4307.36}
    ]},

  '336':{n:'Professions lib√©rales (employ√©s)',idx:2.21,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 336 + emploi.belgique.be Limosa
    // Avocats, architectes, m√©decins, dentistes, kin√©s... en tant qu'employeurs
    // Suit les bar√®mes CP 200 avec ajustements sectoriels
    fn:{
      'Employ√© Cat.1':{cls:1},"Employ√© Cat.2":{cls:2},"Employ√© Cat.3":{cls:3},"Employ√© Cat.4":{cls:4}
    },
    note:"CP 336 Professions lib√©rales. Cabinets avocats, architectes, m√©decins. = bar√®mes CP 200 + suppl√©ments. Idx 2,21% au 01/01/2026.",
    grille:[
      {exp:0,c1:2242.80,c2:2336.26,c3:2369.30,c4:2555.72},
      {exp:2,c1:2317.18,c2:2426.87,c3:2488.15,c4:2659.15},
      {exp:5,c1:2337.59,c2:2478.16,c3:2632.95,c4:2805.17},
      {exp:10,c1:2397.02,c2:2636.80,c3:2874.62,c4:3108.07},
      {exp:15,c1:2478.16,c2:2787.64,c3:3085.79,c4:3400.63},
      {exp:20,c1:2526.43,c2:2836.94,c3:3194.97,c4:3620.36}
    ]},

  '152':{n:'Institutions subsidi√©es enseignement libre',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    // Source: CGSLB CP 152.02 + SETCa-SEL + salairesminimums.be SCP 152
    // CP 152.02 ouvriers: 6 cat√©gories (nettoyeur ‚Üí 1er ouvrier qualifi√©). Idx 2% au 01/01/2026.
    // Bar√®mes horaires convertis en mensuel (x 164,67h pour 38h/sem)
    fn:{
      'Cat.1 non-qualifi√©':{cls:1},"Cat.2 sp√©cialis√© simple":{cls:2},"Cat.3 sp√©cialis√©":{cls:3},
      'Cat.4 qualifi√©':{cls:4},"Cat.5 1er ouvrier qualifi√©":{cls:5},"Cat.6 chef d'√©quipe":{cls:6}
    },
    note:"CP 152.02 Enseignement libre ouvriers. 6 cat√©gories. Bar√®mes horaires convertis mensuel. Idx 2% au 01/01/2026.",
    grille:[
      {exp:0,c1:2247.63,c2:2310.41,c3:2375.18,c4:2504.39,c5:2637.73,c6:2839.42},
      {exp:2,c1:2271.28,c2:2335.49,c3:2401.73,c4:2532.42,c5:2667.27,c6:2871.24},
      {exp:4,c1:2295.09,c2:2360.73,c3:2428.45,c4:2560.63,c5:2696.99,c6:2903.24},
      {exp:6,c1:2319.06,c2:2386.14,c3:2455.34,c4:2589.01,c5:2726.89,c6:2935.43},
      {exp:8,c1:2343.19,c2:2411.73,c3:2482.41,c4:2617.57,c5:2756.97,c6:2967.81},
      {exp:10,c1:2367.49,c2:2437.49,c3:2509.66,c4:2646.31,c5:2787.24,c6:3000.38},
      {exp:14,c1:2416.62,c2:2489.51,c3:2564.70,c4:2704.32,c5:2848.30,c6:3066.16},
      {exp:18,c1:2466.43,c2:2542.24,c3:2620.46,c4:2763.11,c5:2910.19,c6:3132.77},
      {exp:22,c1:2517.01,c2:2595.71,c3:2677.00,c4:2822.70,c5:2972.94,c6:3200.27}
    ]},

  '317':{n:'Gardiennage & S√©curit√©',idx:2.21,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 317 + emploi.belgique.be Limosa
    fn:{
      'Agent gardiennage A':{cls:1},"Agent qualifi√© B":{cls:2},"Chef √©quipe C":{cls:3},"Responsable D":{cls:4}
    },
    note:"CP 317 Gardiennage & S√©curit√©. Securitas, G4S, Seris, Trigion. Idx 2,21% au 01/01/2026.",
    grille:[
      {exp:0,c1:2422.15,c2:2530.44,c3:2710.91,c4:2972.08},
      {exp:2,c1:2473.09,c2:2583.71,c3:2768.03,c4:3034.68},
      {exp:5,c1:2551.51,c2:2665.80,c3:2856.13,c4:3131.39},
      {exp:10,c1:2685.32,c2:2805.57,c3:3005.94,c4:3295.51},
      {exp:15,c1:2822.98,c2:2949.38,c3:3159.98,c4:3464.36},
      {exp:20,c1:2965.02,c2:3097.68,c3:3318.71,c4:3638.25}
    ]},

  '318':{n:'Services aides familiales & aides seniors',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 318 + CGSLB non-marchand
    // SCP 318.01 (CF/RW/CG), 318.02 (Flandre)
    fn:{
      'Aide familiale Cat.1':{cls:1},"Aide senior Cat.2":{cls:2},"Aide qualifi√© Cat.3":{cls:3},"Responsable Cat.4":{cls:4}
    },
    note:"CP 318 Aides familiales & seniors. Secteur non-marchand. Idx 2% au 01/01/2026.",
    grille:[
      {exp:0,c1:2297.43,c2:2441.08,c3:2634.50,c4:2897.93},
      {exp:2,c1:2358.67,c2:2506.14,c3:2704.68,c4:2975.16},
      {exp:5,c1:2453.38,c2:2607.68,c3:2812.10,c4:3093.20},
      {exp:10,c1:2612.64,c2:2776.91,c3:2996.41,c4:3297.72},
      {exp:15,c1:2775.95,c2:2950.55,c3:3185.36,c4:3507.83},
      {exp:20,c1:2943.54,c2:3129.05,c3:3379.26,c4:3724.05}
    ]},

  '144':{n:'Agriculture',idx:2.21,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 144 + CGSLB secteurs verts
    fn:{
      'Ouvrier Cat.1':{cls:1},"Ouvrier sp√©cialis√© Cat.2":{cls:2},"Qualifi√© Cat.3":{cls:3},"Conducteur Cat.4":{cls:4}
    },
    note:"CP 144 Agriculture. Exploitations agricoles, √©levage, culture. Idx 2,21% au 01/01/2026.",
    grille:[
      {exp:0,c1:2298.50,c2:2390.04,c3:2482.84,c4:2579.17},
      {exp:2,c1:2344.47,c2:2437.84,c3:2532.50,c4:2630.75},
      {exp:5,c1:2413.92,c2:2510.00,c3:2607.42,c4:2708.67},
      {exp:10,c1:2530.50,c2:2631.34,c3:2733.49,c4:2839.52},
      {exp:15,c1:2650.42,c2:2756.12,c3:2863.18,c4:2974.10},
      {exp:20,c1:2773.80,c2:2884.46,c3:2996.58,c4:3112.52}
    ]},

  '145':{n:'Horticulture',idx:2.21,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 145 + CGSLB secteurs verts
    fn:{
      'Ouvrier Cat.1':{cls:1},"Ouvrier qualifi√© Cat.2":{cls:2},"Chef culture Cat.3":{cls:3}
    },
    note:"CP 145 Horticulture. P√©pini√®res, serres, am√©nagement jardins. Idx 2,21% au 01/01/2026.",
    grille:[
      {exp:0,c1:2298.50,c2:2413.93,c3:2607.44},
      {exp:2,c1:2344.47,c2:2462.21,c3:2659.59},
      {exp:5,c1:2413.92,c2:2535.17,c3:2738.32},
      {exp:10,c1:2530.50,c2:2657.63,c3:2870.67},
      {exp:15,c1:2650.42,c2:2783.54,c3:3006.59},
      {exp:20,c1:2773.80,c2:2913.09,c3:3146.44}
    ]},

  '306':{n:"Entreprises d'assurances",idx:2.23,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 306 ‚Äî en vigueur 01/01/2026 ‚Äî idx 2,23125%
    // Employ√©s: 5 cat√©gories. Inspecteurs et Cadres: bar√®mes s√©par√©s.
    fn:{
      'Employ√© Cat.1':{cls:1},"Employ√© Cat.2":{cls:2},"Employ√© Cat.3":{cls:3},
      'Employ√© Cat.4A':{cls:4},"Employ√© Cat.4B":{cls:5}
    },
    note:"CP 306 Entreprises d'assurances. AG, AXA, Ethias. Idx 2,23125% au 01/01/2026. Bar√®mes employ√©s (inspecteurs/cadres = grilles s√©par√©es).",
    grille:[
      {exp:0,c1:2336.21,c2:2405.50,c3:2655.86,c4:2836.43,c5:3149.15},
      {exp:1,c1:2381.65,c2:2457.96,c3:2719.35,c4:2904.34,c5:3225.95},
      {exp:2,c1:2427.38,c2:2509.96,c3:2782.41,c4:2973.07,c5:3302.94},
      {exp:3,c1:2473.71,c2:2561.55,c3:2845.88,c4:3041.56,c5:3379.45},
      {exp:4,c1:2519.31,c2:2613.47,c3:2909.00,c4:3109.81,c5:3456.77},
      {exp:5,c1:2565.20,c2:2665.76,c3:2972.19,c4:3178.30,c5:3533.48},
      {exp:6,c1:2610.71,c2:2717.79,c3:3035.14,c4:3246.71,c5:3610.35},
      {exp:7,c1:2656.53,c2:2769.72,c3:3098.84,c4:3315.18,c5:3687.18},
      {exp:8,c1:2702.25,c2:2822.00,c3:3161.94,c4:3384.08,c5:3763.90},
      {exp:9,c1:2747.83,c2:2874.00,c3:3224.94,c4:3452.39,c5:3840.66},
      {exp:10,c1:2793.99,c2:2925.97,c3:3288.73,c4:3521.04,c5:3917.67},
      {exp:11,c1:2812.26,c2:2954.73,c3:3330.87,c4:3566.40,c5:3968.92},
      {exp:12,c1:2830.41,c2:2982.94,c3:3372.79,c4:3612.17,c5:4020.31},
      {exp:13,c1:2848.81,c2:3011.05,c3:3415.03,c4:3657.52,c5:4071.45},
      {exp:14,c1:2866.93,c2:3039.63,c3:3457.36,c4:3703.21,c5:4122.68},
      {exp:15,c1:2885.28,c2:3068.08,c3:3499.28,c4:3748.79,c5:4174.05},
      {exp:16,c1:2903.65,c2:3096.25,c3:3541.32,c4:3794.62,c5:4225.26},
      {exp:17,c1:2922.21,c2:3124.76,c3:3583.94,c4:3839.83,c5:4276.71},
      {exp:18,c1:2940.55,c2:3152.92,c3:3625.87,c4:3885.95,c5:4327.84},
      {exp:19,c1:2958.44,c2:3181.56,c3:3668.02,c4:3931.57,c5:4379.31},
      {exp:20,c1:2977.18,c2:3210.18,c3:3710.34,c4:3977.00,c5:4430.45},
      {exp:22,c1:2995.33,c2:3238.34,c3:3752.79,c4:4022.77,c5:4481.62}
    ]},

  '333':{n:'Attractions touristiques',idx:2.21,dt:'01/01/2026',regime:38,approx:false,
    // Source: salairesminimums.be CP 333 + emploi.belgique.be
    // Walibi, Bobbejaanland, Plopsaland, Mini-Europe, Pairi Daiza...
    fn:{
      'Employ√© Cat.1':{cls:1},"Employ√© qualifi√© Cat.2":{cls:2},"Responsable Cat.3":{cls:3},"Cadre Cat.4":{cls:4}
    },
    note:"CP 333 Attractions touristiques. Parcs, mus√©es, zoos. Idx 2,21% au 01/01/2026.",
    grille:[
      {exp:0,c1:2242.80,c2:2336.26,c3:2555.72,c4:2874.62},
      {exp:2,c1:2290.15,c2:2385.56,c3:2609.88,c4:2935.54},
      {exp:5,c1:2362.05,c2:2460.51,c3:2691.83,c4:3027.56},
      {exp:10,c1:2508.28,c2:2613.00,c3:2858.57,c4:3215.18},
      {exp:15,c1:2658.14,c2:2769.29,c3:3029.34,c4:3407.39},
      {exp:20,c1:2812.10,c2:2929.81,c3:3204.52,c4:3604.35}
    ]},

  '100':{n:'Commission auxiliaire pour ouvriers',idx:2.0,dt:'01/01/2026',regime:38,approx:true,
    fn:{'Ouvrier Cat.1':{cls:1},'Ouvrier Cat.2':{cls:2},'Ouvrier Cat.3':{cls:3},'Ouvrier Cat.4':{cls:4}},
    note:'CP 100 subsidiaire. Bar√®mes RMMMG (revenu minimum mensuel moyen garanti). Peu de travailleurs sous cette CP pure.',
    grille:[
      {exp:0,c1:2029.88,c2:2100.00,c3:2200.00,c4:2350.00},
      {exp:5,c1:2100.00,c2:2175.00,c3:2280.00,c4:2440.00},
      {exp:10,c1:2175.00,c2:2255.00,c3:2365.00,c4:2530.00}
    ]},

  '112':{n:'Garage, carrosserie, commerce automobile',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Ouvrier Cat.A':{cls:1},'Ouvrier Cat.B':{cls:2},'Ouvrier Cat.C':{cls:3},'Ouvrier Cat.D':{cls:4},'Employ√© Cat.1':{cls:1},'Employ√© Cat.2':{cls:2},'Employ√© Cat.3':{cls:3}},
    note:'CP 112 Garage. Index pivot 2% au 01/01/2026. Bar√®mes ouvriers Cat.A-D + employ√©s Cat.1-3.',
    grille:[
      {exp:0,c1:2380.00,c2:2580.00,c3:2750.00,c4:3050.00},
      {exp:5,c1:2450.00,c2:2660.00,c3:2840.00,c4:3150.00},
      {exp:10,c1:2520.00,c2:2740.00,c3:2930.00,c4:3250.00}
    ]},

  '118':{n:'Industrie alimentaire (ouvriers)',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Ouvrier Cat.1':{cls:1},'Ouvrier Cat.2':{cls:2},'Ouvrier Cat.3':{cls:3},'Ouvrier Cat.4':{cls:4},'Ouvrier Cat.5':{cls:5}},
    note:'CP 118 Industrie alimentaire ouvriers. Bar√®mes nationaux. Prime de fin annee sectorielle.',
    grille:[
      {exp:0,c1:2580.00,c2:2696.49,c3:2896.49,c4:3077.62,c5:3258.75},
      {exp:5,c1:2660.00,c2:2780.00,c3:2985.00,c4:3170.00,c5:3355.00},
      {exp:10,c1:2740.00,c2:2865.00,c3:3075.00,c4:3265.00,c5:3455.00}
    ]},

  '119':{n:'Commerce alimentaire',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Ouvrier Cat.1':{cls:1},'Ouvrier Cat.2':{cls:2},'Ouvrier Cat.3':{cls:3}},
    note:'CP 119 Commerce alimentaire. Boucheries, charcuteries, poissonneries.',
    grille:[
      {exp:0,c1:2350.00,c2:2580.00,c3:2750.00},
      {exp:5,c1:2430.00,c2:2665.00,c3:2840.00},
      {exp:10,c1:2510.00,c2:2750.00,c3:2930.00}
    ]},

  '121':{n:'Nettoyage',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Cat.1A Nettoyage habituel':{cls:1},'Cat.1B Nettoyage special':{cls:2},'Cat.2A Mi-lourd':{cls:3},'Cat.3A Collecte dechets':{cls:4},'Chef equipe':{cls:5}},
    note:'CP 121 Nettoyage. Bar√®mes horaires x 164,67h. Prime de fin annee sectorielle. Cheques-repas obligatoires.',
    grille:[
      {exp:0,c1:2450.00,c2:2550.00,c3:2696.49,c4:2800.00,c5:2966.13},
      {exp:5,c1:2530.00,c2:2635.00,c3:2785.00,c4:2890.00,c5:3060.00},
      {exp:10,c1:2610.00,c2:2720.00,c3:2875.00,c4:2985.00,c5:3155.00}
    ]},

  '124':{n:'Construction',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Manoeuvre Cat.I':{cls:1},'Ouvrier Cat.II':{cls:2},'Ouvrier Cat.IIA':{cls:3},'Ouvrier Cat.III':{cls:3},'Ouvrier Cat.IV':{cls:4},'Chef Cat.IV+':{cls:5}},
    note:'CP 124 Construction. Bar√®mes horaires x 164,67h. Timbres intemperies + fidelite. Caisse conges construction.',
    grille:[
      {exp:0,c1:3006.56,c2:3205.42,c3:3365.39,c4:3409.58,c5:3619.21},
      {exp:5,c1:3097.00,c2:3302.00,c3:3467.00,c4:3512.00,c5:3728.00},
      {exp:10,c1:3190.00,c2:3401.00,c3:3571.00,c4:3618.00,c5:3840.00}
    ]},

  '140':{n:'Transport et logistique',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Chauffeur C':{cls:1},'Chauffeur CE':{cls:2},'Dispatcher':{cls:3},'Mecanicien':{cls:4},'Demenageur':{cls:5}},
    note:'CP 140 Transport routier et logistique. Indemnites de sejour. Prime RGPT. Tachygraphe obligatoire.',
    grille:[
      {exp:0,c1:2543.95,c2:2603.02,c3:2766.65,c4:3074.05,c5:2457.71},
      {exp:5,c1:2620.00,c2:2681.00,c3:2849.00,c4:3166.00,c5:2531.00},
      {exp:10,c1:2699.00,c2:2761.00,c3:2934.00,c4:3261.00,c5:2607.00}
    ]},

  '200':{n:'CPNAE ‚Äî Commission paritaire auxiliaire pour employes',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Employe Cat.1':{cls:1},'Employe Cat.2':{cls:2},'Employe Cat.3':{cls:3},'Employe Cat.4':{cls:4}},
    note:'CP 200 CPNAE. Plus grande CP de Belgique (~450.000 travailleurs). Index pivot 2%. Bareme sectoriel minimum.',
    grille:[
      {exp:0,c1:2029.88,c2:2242.80,c3:2468.07,c4:2728.35},
      {exp:1,c1:2080.63,c2:2298.87,c3:2529.77,c4:2796.56},
      {exp:2,c1:2131.38,c2:2354.94,c3:2591.47,c4:2864.77},
      {exp:3,c1:2182.13,c2:2411.01,c3:2653.17,c4:2932.98},
      {exp:4,c1:2232.88,c2:2467.08,c3:2714.87,c4:3001.19},
      {exp:5,c1:2283.63,c2:2523.15,c3:2776.57,c4:3069.40},
      {exp:10,c1:2537.13,c2:2803.50,c3:3084.97,c4:3410.45},
      {exp:15,c1:2790.63,c2:3083.85,c3:3393.37,c4:3751.50},
      {exp:20,c1:3044.13,c2:3364.20,c3:3701.77,c4:4092.55}
    ]},

  '216':{n:'Notariat',idx:2.0,dt:'01/01/2026',regime:36,approx:false,
    fn:{'Employe Cat.1':{cls:1},'Employe Cat.2':{cls:2},'Clerc':{cls:3},'Notaire employe':{cls:4}},
    note:'CP 216 Notariat. Regime 36h/sem. Bareme specifique. Prime de fin annee = 13eme mois.',
    grille:[
      {exp:0,c1:2242.80,c2:2468.07,c3:2728.35,c4:3500.00},
      {exp:5,c1:2350.00,c2:2590.00,c3:2870.00,c4:3680.00},
      {exp:10,c1:2460.00,c2:2715.00,c3:3015.00,c4:3865.00}
    ]},

  '218':{n:'CPNAE employes (secteur alimentaire)',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Employe Cat.1':{cls:1},'Employe Cat.2':{cls:2},'Employe Cat.3':{cls:3},'Employe Cat.4':{cls:4}},
    note:'CP 218 Employes industrie alimentaire. Liee a CP 118. Baremes specifiques au secteur.',
    grille:[
      {exp:0,c1:2200.00,c2:2420.00,c3:2660.00,c4:2940.00},
      {exp:5,c1:2290.00,c2:2520.00,c3:2770.00,c4:3060.00},
      {exp:10,c1:2380.00,c2:2620.00,c3:2880.00,c4:3180.00}
    ]},

  '302':{n:'Industrie hoteliere (Horeca)',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Cat.I':{cls:1},'Cat.II':{cls:2},'Cat.III':{cls:3},'Cat.IV':{cls:4},'Cat.V (chef)':{cls:5}},
    note:'CP 302 Horeca. Nourritures + pourboires possibles. Prime de fin annee sectorielle. Flexi-jobs autorises.',
    grille:[
      {exp:0,c1:2504.53,c2:2519.02,c3:2629.69,c4:2742.93,c5:2862.05},
      {exp:5,c1:2555.00,c2:2570.00,c3:2683.00,c4:2798.00,c5:2920.00},
      {exp:10,c1:2607.00,c2:2622.00,c3:2737.00,c4:2855.00,c5:2979.00}
    ]},

  '306':{n:'Entreprises assurances',idx:2.23,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Employe Cat.A':{cls:1},'Employe Cat.B':{cls:2},'Employe Cat.C':{cls:3},'Employe Cat.D':{cls:4}},
    note:'CP 306 Entreprises assurances. AG, AXA, Ethias. Idx 2,23% au 01/01/2026.',
    grille:[
      {exp:0,c1:2400.00,c2:2650.00,c3:2950.00,c4:3400.00},
      {exp:5,c1:2520.00,c2:2785.00,c3:3100.00,c4:3570.00},
      {exp:10,c1:2645.00,c2:2925.00,c3:3255.00,c4:3750.00}
    ]},

  '310':{n:'Banques',idx:2.0,dt:'01/01/2026',regime:37,approx:false,
    fn:{'Employe Cat.A':{cls:1},'Employe Cat.B':{cls:2},'Employe Cat.C':{cls:3},'Employe Cat.D':{cls:4},'Cadre':{cls:5}},
    note:'CP 310 Banques. Regime 37h/sem. BNP Paribas Fortis, ING, KBC, Belfius. Avantages extra-legaux importants.',
    grille:[
      {exp:0,c1:2600.00,c2:2900.00,c3:3248.00,c4:3700.00,c5:4200.00},
      {exp:5,c1:2730.00,c2:3045.00,c3:3410.00,c4:3885.00,c5:4410.00},
      {exp:10,c1:2865.00,c2:3195.00,c3:3580.00,c4:4080.00,c5:4630.00}
    ]},

  '314':{n:'Coiffure et soins de beaute',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Debutant':{cls:1},'Qualifie':{cls:2},'Specialise':{cls:3},'Gerant salon':{cls:4}},
    note:'CP 314 Coiffure, esthetique, fitness. Baremes specifiques. Pourboires non declares frequents.',
    grille:[
      {exp:0,c1:2050.00,c2:2280.00,c3:2350.00,c4:2600.00},
      {exp:5,c1:2120.00,c2:2355.00,c3:2430.00,c4:2690.00},
      {exp:10,c1:2195.00,c2:2435.00,c3:2515.00,c4:2785.00}
    ]},

  '330':{n:'Etablissements et services de sante',idx:2.0,dt:'01/01/2026',regime:38,approx:false,
    fn:{'Cat.1 Agent entretien':{cls:1},'Cat.2 Brancardier':{cls:2},'Cat.3 Aide-soignant':{cls:3},'Cat.4 Infirmier':{cls:4},'Cat.5 Infirmier specialise':{cls:5},'Cat.6 Medecin':{cls:6}},
    note:'CP 330 Sante. Hopitaux, cliniques, MRS. Baremes IFIC depuis 2018. Maribel social. Primes de nuit/WE.',
    grille:[
      {exp:0,c1:2254.03,c2:2371.89,c3:2463.41,c4:2682.04,c5:2900.00,c6:5609.78},
      {exp:5,c1:2340.00,c2:2462.00,c3:2558.00,c4:2785.00,c5:3015.00,c6:5830.00},
      {exp:10,c1:2428.00,c2:2556.00,c3:2656.00,c4:2892.00,c5:3135.00,c6:6060.00}
    ]},

};

function getBareme(cp,fnName,anciennete){
  const bar=BAREMES[cp];if(!bar)return null;
  const classe=bar.fnClassMap?.[fnName];if(!classe)return null;
  if(bar.type==='monthly'){
    const years=Object.keys(bar.grid).map(Number).sort((a,b)=>a-b);
    let yr=years[0];for(const y of years){if(anciennete>=y)yr=y;else break;}
    const monthly=bar.grid[yr]?.[classe];if(!monthly)return null;
    return{monthly,hourly:+(monthly/164.6666).toFixed(4),classe,classLabel:bar.classes[classe],ancYr:yr,cp,type:"monthly",indexDate:bar.indexDate,indexPct:bar.indexPct,regime:bar.regime};
  }
  if(bar.type==='hourly'){
    let hourly;
    if(typeof Object.values(bar.grid)[0]==='object'){
      const years=Object.keys(bar.grid).map(Number).sort((a,b)=>a-b);
      let yr=years[0];for(const y of years){if(anciennete>=y)yr=y;else break;}
      hourly=bar.grid[yr]?.[classe];
    } else { hourly=bar.grid[classe]; }
    if(!hourly)return null;
    const factor=bar.monthlyFactor||((bar.weeklyH||38)*52/12);
    return{monthly:+(hourly*factor).toFixed(2),hourly,classe,classLabel:bar.classes[classe],ancYr:anciennete,cp,type:"hourly",indexDate:bar.indexDate,indexPct:bar.indexPct,regime:bar.regime};
  }
  return null;
}

function getCPAvantages(cp){
  const bar=BAREMES[cp];if(!bar)return[];const avs=[];
  if(bar.primeAnnuelle)avs.push({l:"Prime annuelle (juin)",v:fmt(bar.primeAnnuelle)});
  if(bar.primeFinAnnee)avs.push({l:"Prime fin d\'ann√©e",v:bar.primeFinAnnee});
  if(bar.ecoChequesMax)avs.push({l:"√âco-ch√®ques (max/an)",v:fmt(bar.ecoChequesMax)});
  if(bar.transport?.velo)avs.push({l:"Indemnit√© v√©lo",v:`${bar.transport.velo} ‚Ç¨/km (max ${bar.transport.maxVeloJour}‚Ç¨/jour)`});
  if(bar.timbreFidelite)avs.push({l:"Timbres fid√©lit√©",v:`${(bar.timbreFidelite*100)}% sal. annuel`});
  if(bar.timbreIntemperie)avs.push({l:"Timbres intemp√©ries",v:`${(bar.timbreIntemperie*100)}% sal. annuel`});
  if(bar.mobilite)avs.push({l:"Indemnit√© mobilit√©",v:`${bar.mobilite.parKm} ‚Ç¨/km (max ${bar.mobilite.maxKm}km)`});
  if(bar.reposComp)avs.push({l:"Jours repos compensatoires",v:`${bar.reposComp} jours/an`});
  if(bar.primeNuit)avs.push({l:"Prime nuit",v:`+${(bar.primeNuit*100)}%`});
  if(bar.primeWeekendSam)avs.push({l:"Prime samedi",v:`+${(bar.primeWeekendSam*100)}%`});
  if(bar.primeWeekendDim)avs.push({l:"Prime dimanche",v:`+${(bar.primeWeekendDim*100)}%`});
  if(bar.primeAttractivite)avs.push({l:"Prime attractivit√©",v:`${(bar.primeAttractivite*100)}%`});
  if(bar.indemniteNuit)avs.push({l:"Indemnit√© nuit (0h-5h)",v:`${bar.indemniteNuit} ‚Ç¨/h`});
  if(bar.indemniteVetements)avs.push({l:"Indemnit√© v√™tements",v:`${bar.indemniteVetements} ‚Ç¨/jour`});
  return avs;
}

// ‚îÄ‚îÄ‚îÄ PAYROLL CALCULATION ENGINE (Formule-cl√© SPF Finances) ‚îÄ‚îÄ‚îÄ
function calc(emp, per, co) {
  const r = {};
  const hr = (emp.monthlySalary||0) / (LEGAL.WD * LEGAL.WHD);
  r.base = emp.monthlySalary || 0;
  r.overtime = (per.overtimeH||0) * hr * 1.5;
  r.sunday = (per.sundayH||0) * hr * 2;
  r.night = (per.nightH||0) * hr * 1.25;
  r.bonus = per.bonus || 0;
  r.y13 = per.y13 || 0;
  r.sickPay = (per.sickG||0) * (r.base / LEGAL.WD);
  r.gross = r.base + r.overtime + r.sunday + r.night + r.bonus + r.y13 + r.sickPay;

  // ‚îÄ‚îÄ HEURES SUP VOLONTAIRES BRUT=NET (Nouveau r√©gime 01/04/2026 + Relance T1) ‚îÄ‚îÄ
  // 360h/an (450h horeca), dont 240h (360h horeca) exon√©r√©es ONSS+PP = brut=net
  // Pas de sursalaire, pas de repos compensatoire. Accord √©crit 1 an.
  // Heures relance (T1/2026 transitoire): 120h brut=net, d√©duites du quota 240h
  r.hsVolontBrutNet = (per.hsVolontBrutNet||0) * hr; // montant brut=net (pas de sursalaire)
  r.hsRelance = (per.hsRelance||0) * hr;
  r.hsBrutNetTotal = r.hsVolontBrutNet + r.hsRelance; // total brut=net (non soumis ONSS/PP)

  // ‚îÄ‚îÄ MI-TEMPS M√âDICAL / REPRISE PROGRESSIVE (Art. 100¬ß2 Loi coord. 14/07/1994) ‚îÄ‚îÄ
  // Le travailleur reconnu en incapacit√© par le m√©decin-conseil de la mutuelle
  // reprend le travail √† temps partiel avec l'accord du m√©decin du travail.
  //
  // M√©canisme:
  //   1. L'employeur paie le salaire PROPORTIONNEL aux heures prest√©es
  //   2. L'INAMI (mutuelle) verse un COMPL√âMENT d'indemnit√©s au travailleur
  //   3. Le compl√©ment INAMI = 60% du brut normal √ó (heures non prest√©es / heures normales)
  //      mais plafonn√© et avec r√®gle de cumul (max 20% de perte par rapport √† avant l'incapacit√©)
  //
  // Impact sur la fiche de paie:
  //   - Brut = prorata des heures prest√©es (pas le brut normal!)
  //   - ONSS = calcul√© sur le brut prorata (pas sur le brut normal)
  //   - PP = calcul√© sur le brut prorata (bar√®me temps partiel)
  //   - L'indemnit√© INAMI est hors fiche de paie (vers√©e directement par la mutuelle)
  //   - Mention "pour m√©moire" du compl√©ment INAMI sur la fiche
  //
  // Formulaires:
  //   - C3.2: d√©claration de reprise au m√©decin-conseil
  //   - E10: √©valuation m√©decin du travail (formulaire de r√©int√©gration)
  //   - DRS (eBox): d√©claration reprise du travail √† la mutuelle
  //
  // Dur√©e: illimit√©e (aussi longtemps que le m√©decin-conseil autorise)
  // ONSS: sur brut prorata uniquement
  // PP: bar√®me proportionnel temps partiel (fraction d'occupation)
  r.miTempsMed = per.miTempsMed || false;
  r.miTempsHeures = per.miTempsHeures || 0;
  r.miTempsFraction = 1; // fraction d'occupation
  r.miTempsINAMI = per.miTempsINAMI || 0;
  r.miTempsBrutOriginal = r.base; // brut avant prorata

  if (r.miTempsMed && r.miTempsHeures > 0 && (emp.whWeek || 38) > 0) {
    r.miTempsFraction = r.miTempsHeures / (emp.whWeek || 38);
    // Recalculer le brut au prorata des heures prest√©es
    r.base = Math.round((emp.monthlySalary || 0) * r.miTempsFraction * 100) / 100;
    // Recalculer les composantes proportionnelles
    r.sickPay = (per.sickG || 0) * (r.base / LEGAL.WD);
    r.gross = r.base + r.overtime + r.sunday + r.night + r.bonus + r.y13 + r.sickPay;
    // Estimation du compl√©ment INAMI si pas renseign√©
    // R√®gle: 60% du brut limit√© (plafonn√© √† ‚âà 106,16‚Ç¨/j en 2026) √ó fraction non prest√©e
    if (r.miTempsINAMI === 0) {
      const brutJourNormal = (emp.monthlySalary || 0) / LEGAL.WD;
      const plafondINAMI = 106.16; // plafond journalier INAMI 2026 (adapt√©)
      const brutJourPlafonn√© = Math.min(brutJourNormal, plafondINAMI);
      const tauxINAMI = 0.60; // 60% (cohabitant) ‚Äî peut √™tre 65% (chef de famille) ou 55% (isol√©)
      r.miTempsINAMI = Math.round(brutJourPlafonn√© * tauxINAMI * LEGAL.WD * (1 - r.miTempsFraction) * 100) / 100;
    }
  }

  // ‚îÄ‚îÄ ATN Voiture de soci√©t√© (Art. 36 CIR 92) ‚îÄ‚îÄ
  r.atnCar = 0; r.atnPct = 0; r.cotCO2 = 0;
  const carFuel = emp.carFuel || 'none';
  const carCO2 = parseInt(emp.carCO2) || 0;
  const carCatVal = parseFloat(emp.carCatVal) || 0;
  if (carFuel !== 'none' && carCatVal > 0) {
    if (carFuel === 'electrique') {
      r.atnPct = 4;
      r.atnCar = Math.max(1600/12, (carCatVal * (6/7) * 0.04) / 12);
      r.cotCO2 = 31.34; // minimum
    } else {
      const refCO2 = (carFuel === 'diesel') ? 84 : 102;
      const delta = carCO2 - refCO2;
      r.atnPct = Math.max(4, Math.min(18, 5.5 + (delta * 0.1)));
      r.atnCar = Math.max(1600/12, (carCatVal * (6/7) * (r.atnPct/100)) / 12);
      // Cotisation CO2 patronale (solidarit√© ONSS)
      if (carFuel === 'diesel') r.cotCO2 = Math.max(31.34, (carCO2 * 0.00714 * 71.4644) + 31.34);
      else r.cotCO2 = Math.max(31.34, (carCO2 * 0.00714 * 83.6644) + 31.34);
    }
  }

  // ‚îÄ‚îÄ ATN Autres avantages en nature (AR 18/12/2024 ‚Äî Forfaits 2026) ‚îÄ‚îÄ
  r.atnGSM = emp.atnGSM ? 3.00 : 0;         // 36‚Ç¨/an = 3‚Ç¨/mois
  r.atnPC = emp.atnPC ? 6.00 : 0;            // 72‚Ç¨/an = 6‚Ç¨/mois
  r.atnInternet = emp.atnInternet ? 5.00 : 0; // 60‚Ç¨/an = 5‚Ç¨/mois
  r.atnChauffage = emp.atnChauffage ? 177.50 : 0; // 2.130‚Ç¨/an = 177,50‚Ç¨/mois
  r.atnElec = emp.atnElec ? 88.33 : 0;       // 1.060‚Ç¨/an = 88,33‚Ç¨/mois
  // ATN Logement gratuit (Art. 18 AR/CIR92 ‚Äî Forfaits 2026)
  // Non-dirigeant: forfait fixe = RC index√© √ó 100/60
  // Dirigeant (statut=dirigeant): RC index√© √ó 100/60 √ó 3,80 (coeff. dirigeant)
  // Coefficient indexation RC 2026: 2,1763 (exercice d'imposition 2027)
  // Si meubl√©: + 5/3 du montant
  r.atnLogement = 0;
  if (emp.atnLogement && parseFloat(emp.atnLogementRC) > 0) {
    const rc = parseFloat(emp.atnLogementRC);
    const rcIndex = rc * 2.1763; // RC index√© 2026
    const isDirigeant = (emp.statut === 'dirigeant');
    if (isDirigeant) {
      // Dirigeant: RC index√© √ó 100/60 √ó coeff. 3,80 (si RC > 745‚Ç¨) ou √ó 1,25 (si RC ‚â§ 745‚Ç¨)
      r.atnLogement = rc <= 745
        ? (rcIndex * 100 / 60 * 1.25) / 12
        : (rcIndex * 100 / 60 * 3.80) / 12;
    } else {
      // Non-dirigeant: forfait fixe par RC non index√©
      r.atnLogement = (rcIndex * 100 / 60) / 12;
    }
  }
  r.atnAutresTot = r.atnGSM + r.atnPC + r.atnInternet + r.atnChauffage + r.atnElec + r.atnLogement;
  r.atnTotal = r.atnCar + r.atnAutresTot;

  // ‚îÄ‚îÄ V√âLO DE SOCI√âT√â (Loi 25/11/2021 + Art. 38¬ß1er 14¬∞a CIR 92) ‚îÄ‚îÄ
  // Depuis 01/01/2024: l'ATN v√©lo de soci√©t√© = 0‚Ç¨ (exon√©r√© IPP et ONSS)
  // Conditions: usage effectif pour d√©placements domicile-travail (m√™me partiel)
  // L'employeur supporte le co√ªt du leasing (d√©ductible 100%)
  // Types: v√©lo classique, v√©lo √©lectrique (‚â§25km/h), speed pedelec (‚â§45km/h)
  // CUMULABLE avec l'indemnit√© v√©lo 0,27‚Ç¨/km (pour les km effectivement parcourus)
  // Le speed pedelec est fiscalement assimil√© √† un v√©lo (pas une moto)
  r.veloSociete = emp.veloSociete || false;
  r.veloType = emp.veloType || 'none';
  r.atnVelo = 0; // ATN = 0‚Ç¨ depuis 01/01/2024 (exon√©r√©)
  r.veloLeasingMois = emp.veloLeasingMois || 0; // co√ªt employeur
  r.veloValeur = emp.veloValeur || 0;

  // Indemnit√© v√©lo cumulable: 0,27‚Ç¨/km A/R m√™me avec v√©lo de soci√©t√©
  // ‚Üí d√©j√† calcul√©e dans r.transport si commType === 'bike'

  // ‚îÄ‚îÄ CARTE CARBURANT / RECHARGE (Art. 36¬ß2 CIR 92) ‚îÄ‚îÄ
  // La carte carburant li√©e √† une voiture de soci√©t√© est incluse dans l'ATN voiture
  // (pas d'ATN s√©par√©) SAUF si la carte permet un usage priv√© illimit√©:
  //   ‚Üí L'ATN voiture couvre d√©j√† les frais de carburant
  //   ‚Üí Si carte carburant SANS voiture de soci√©t√© = avantage imposable √† 100%
  r.carteCarburant = emp.carteCarburant || false;
  r.carteCarburantMois = emp.carteCarburantMois || 0;
  // Si pas de voiture de soci√©t√© mais carte carburant ‚Üí ATN = montant total
  r.atnCarteCarburant = (r.carteCarburant && !r.atnCar) ? r.carteCarburantMois : 0;
  // Si voiture de soci√©t√© + carte carburant ‚Üí inclus dans ATN voiture (pas d'ATN suppl√©mentaire)

  // ‚îÄ‚îÄ BORNE DE RECHARGE DOMICILE (Art. 14536 CIR 92 + Loi 25/11/2021) ‚îÄ‚îÄ
  // L'employeur peut installer une borne de recharge au domicile du travailleur
  // Pas d'ATN pour le travailleur si la borne sert √† recharger la voiture de soci√©t√©
  // L'employeur d√©duit le co√ªt √† 100% (si borne intelligente bidirectionnelle)
  // L'√©lectricit√© de recharge pour usage priv√©: ATN = co√ªt r√©el ou forfait
  r.borneRecharge = emp.borneRecharge || false;
  r.borneRechargeCo√ªt = emp.borneRechargeCo√ªt || 0;
  // ATN borne: 0‚Ç¨ si voiture de soci√©t√© (fait partie du package)
  // ATN borne: co√ªt r√©el si pas de voiture de soci√©t√©
  r.atnBorne = (r.borneRecharge && !r.atnCar) ? r.borneRechargeCo√ªt : 0;

  // Ajouter aux ATN autres si applicable
  r.atnAutresTot += r.atnCarteCarburant + r.atnBorne;
  r.atnTotal = r.atnCar + r.atnAutresTot;

  // ‚îÄ‚îÄ ONSS Travailleur ‚îÄ‚îÄ
  const isOuvrier = (emp.statut === 'ouvrier');
  const onssBase = isOuvrier ? r.gross * LEGAL.ONSS_DETAIL_2026.majoration_ouvrier : r.gross;
  r.onssW = onssBase * LEGAL.ONSS_W;
  // ‚îÄ‚îÄ Bonus √† l'emploi 2026 ‚Äî Volet A (bas salaires) + Volet B (tr√®s bas salaires) ‚îÄ‚îÄ
  // Source: Instructions ONSS T1/2026 + Partena Professional
  const BE = LEGAL.BONUS_2026;
  r.empBonusA = 0; r.empBonusB = 0;
  if (isOuvrier) {
    // Ouvrier (d√©clar√© √† 108%)
    if (r.gross * 1.08 <= BE.O_A_S2) r.empBonusA = BE.O_A_MAX;
    else if (r.gross * 1.08 <= BE.O_A_S1) r.empBonusA = Math.max(0, BE.O_A_MAX - BE.O_A_COEFF * (r.gross * 1.08 - BE.O_A_S2));
    if (r.gross * 1.08 <= BE.O_B_S2) r.empBonusB = BE.O_B_MAX;
    else if (r.gross * 1.08 <= BE.O_B_S1) r.empBonusB = Math.max(0, BE.O_B_MAX - BE.O_B_COEFF * (r.gross * 1.08 - BE.O_B_S2));
  } else {
    // Employ√© (d√©clar√© √† 100%)
    if (r.gross <= BE.A_S2) r.empBonusA = BE.A_MAX;
    else if (r.gross <= BE.A_S1) r.empBonusA = Math.max(0, BE.A_MAX - BE.A_COEFF * (r.gross - BE.A_S2));
    if (r.gross <= BE.B_S2) r.empBonusB = BE.B_MAX;
    else if (r.gross <= BE.B_S1) r.empBonusB = Math.max(0, BE.B_MAX - BE.B_COEFF * (r.gross - BE.B_S2));
  }
  r.empBonus = Math.min(r.empBonusA + r.empBonusB, r.onssW); // ne peut d√©passer cotisation perso
  r.onssNet = r.onssW - r.empBonus;

  // ‚îÄ‚îÄ ONSS Employeur ‚îÄ‚îÄ
  const sectInfo = LEGAL.ONSS_SECTEUR[emp.cp] || LEGAL.ONSS_SECTEUR['default'];
  r.onssE_rate = sectInfo.e;
  r.onssE = onssBase * sectInfo.e;
  r.onssE_note = sectInfo.note;
  r.onssE_type = sectInfo.type || 'marchand';
  // Cotisations sp√©ciales patronales
  r.onss_ffe = onssBase * (emp.staffCount >= 20 ? LEGAL.ONSS_DETAIL_2026.ffe_grand : LEGAL.ONSS_DETAIL_2026.ffe_petit);
  r.onss_chomTemp = onssBase * LEGAL.ONSS_DETAIL_2026.chomage_temp;
  r.onss_amiante = onssBase * LEGAL.ONSS_DETAIL_2026.amiante;

  // ‚îÄ‚îÄ R√©duction structurelle ONSS T1/2026 ‚îÄ‚îÄ
  // Formule: Ps = R √ó ¬µ √ó (J/D) ‚Äî R = F + Œ±(S0-S) + Œ≥(S2-S) + Œ¥(W-S1)
  // S = salaire trimestriel de r√©f√©rence, W = salaire trimestriel r√©el
  // Source: ONSS Instructions administratives + Easypay Group 09/01/2026
  const RS = LEGAL.RED_STRUCT_2026;
  const salTrim = r.gross * 3; // salaire trimestriel
  const salRef = salTrim; // temps plein = salaire r√©el (proratis√© si TP partiel)
  // Fraction de prestation (¬µ) ‚Äî Art. 353bis/5 Loi-programme 24/12/2002
  // Temps partiel: fraction = heures prest√©es / heures temps plein
  const fractionPrest = emp.regime === 'full' ? 1 : (emp.whWeek || 38) / 38;
  r.redStructCat = r.onssE_type === 'non-marchand' ? 2 :
    (emp.statut === 'eta' ? 3 : (emp.statut === 'eta_handi' ? 4 : 1));
  // cat 1=marchand, 2=non-marchand, 3=ETA, 4=ETA handicap√©
  let redR = 0;
  if (r.redStructCat === 1) {
    // Cat√©gorie 1: secteur marchand priv√©
    const compBas = salRef < RS.CAT1_S0 ? RS.CAT1_alpha * (RS.CAT1_S0 - salRef) : 0;
    const compTBas = salRef < RS.CAT1_S2 ? RS.CAT1_gamma * (RS.CAT1_S2 - salRef) : 0;
    redR = RS.CAT1_F + compBas + compTBas;
  } else if (r.redStructCat === 2) {
    // Cat√©gorie 2: Maribel social / non-marchand
    const compBas = salRef < RS.CAT2_S0 ? RS.CAT2_alpha * (RS.CAT2_S0 - salRef) : 0;
    const compTBas = salRef < RS.CAT2_S2 ? RS.CAT2_gamma * (RS.CAT2_S2 - salRef) : 0;
    const compHaut = salRef > RS.CAT2_S1 ? RS.CAT2_delta * (salRef - RS.CAT2_S1) : 0;
    redR = RS.CAT2_F + compBas + compTBas + compHaut;
  } else if (r.redStructCat === 3) {
    // Cat√©gorie 3: Entreprises de travail adapt√© (ETA)
    const compBas = salRef < RS.CAT3_S0 ? RS.CAT3_alpha * (RS.CAT3_S0 - salRef) : 0;
    const compTBas = salRef < RS.CAT3_S2 ? RS.CAT3_gamma * (RS.CAT3_S2 - salRef) : 0;
    redR = RS.CAT3_F + compBas + compTBas;
  } else if (r.redStructCat === 4) {
    // Cat√©gorie 3bis: ETA travailleurs moins valides
    const compBas = salRef < RS.CAT3B_S0 ? RS.CAT3B_alpha * (RS.CAT3B_S0 - salRef) : 0;
    const compTBas = salRef < RS.CAT3B_gamma ? RS.CAT3B_gamma * (RS.CAT3B_S2 - salRef) : 0;
    redR = RS.CAT3B_F + compBas + compTBas;
  }
  // Appliquer la fraction de prestation (temps partiel)
  redR = Math.max(0, redR * fractionPrest);
  // Plancher: la r√©duction ne peut pas √™tre n√©gative
  // Plafond: la r√©duction ne peut pas exc√©der les cotisations patronales dues
  r.redStruct = Math.min(redR, r.onssE * 3); // montant trimestriel de r√©duction (plafonn√©)
  r.redStructMois = Math.round(r.redStruct / 3 * 100) / 100; // mensualis√©
  r.redStructFraction = fractionPrest;
  // Appliquer r√©duction sur cotisation patronale effective
  r.onssE = Math.max(0, r.onssE - r.redStructMois);

  // ATN ajout√© au revenu imposable (pas √† l'ONSS, pas au brut pay√©)
  r.taxGross = r.gross - r.onssNet + r.atnCar + r.atnAutresTot;

  // ‚îÄ‚îÄ TRAVAILLEUR FRONTALIER / TRANSFRONTALIER ‚îÄ‚îÄ
  // R√®glement (CE) 883/2004 + Conventions bilat√©rales CPDI
  //
  // PRINCIPE ONSS (Art. 11-16 R√®gl. 883/2004):
  //   ‚Üí Lieu de TRAVAIL d√©termine le pays ONSS (lex loci laboris)
  //   ‚Üí Travaille en Belgique = ONSS belge, m√™me si r√©side en FR/NL/DE/LU
  //   ‚Üí Exception: t√©l√©travail frontalier > 25% ‚Üí accord cadre multi-√âtat
  //
  // PRINCIPE PP / IMP√îT (Conventions pr√©ventives double imposition):
  //
  // 1. BELGIQUE ‚Üî FRANCE (Convention 10/03/1964 + Avenants):
  //   - Ancien r√©gime frontalier (abrog√© 01/01/2012): le frontalier FR travaillant
  //     en BE payait l'imp√¥t en France ‚Üí exon√©ration PP en Belgique
  //   - R√âGIME ACTUEL: PP retenu en Belgique (pays de travail)
  //     Le travailleur FR d√©clare en France mais obtient un cr√©dit d'imp√¥t
  //     pour l'imp√¥t belge pay√© (Art. 15 + Art. 19 Convention)
  //   - Formulaire 276 Front.: attestation de r√©sidence fiscale fran√ßaise
  //
  // 2. BELGIQUE ‚Üî PAYS-BAS (Convention 05/06/2001):
  //   - PP retenu en Belgique. Le travailleur NL d√©clare aux Pays-Bas
  //     avec cr√©dit d'imp√¥t belge (m√©thode exemption avec progression)
  //   - Depuis 2003: plus de r√©gime frontalier sp√©cial
  //   - Le NL r√©sident peut opter pour "kwalificerend buitenlands belastingplichtige"
  //
  // 3. BELGIQUE ‚Üî ALLEMAGNE (Convention 11/04/1967 + Protocole 2002):
  //   - PP retenu en Belgique. Cr√©dit d'imp√¥t en Allemagne.
  //   - Pas de r√©gime frontalier sp√©cial
  //
  // 4. BELGIQUE ‚Üî LUXEMBOURG (Convention 17/09/1970):
  //   - PP retenu en Belgique pour travail prest√© en Belgique
  //   - Particularit√©: r√®gle des 24 jours de tol√©rance (accord amiable 2015)
  //     ‚Üí max 24j/an de t√©l√©travail depuis le Luxembourg sans changer l'imposition
  //
  // IMPACT SUR LE CALCUL:
  //   - ONSS: toujours belge si le travail est prest√© en Belgique
  //   - PP: normalement retenu en Belgique (pas d'exon√©ration)
  //   - Exception rare: exon√©ration PP si formulaire 276 Front. + ancien r√©gime FR
  //   - Formulaire A1: obligatoire pour les d√©tachements > 1 pays
  //   - Limosa: d√©claration obligatoire pour travailleurs d√©tach√©s VERS la Belgique
  //
  r.frontalier = emp.frontalier || false;
  r.frontalierPays = emp.frontalierPays || '';
  r.frontalierExoPP = emp.frontalierExoPP || false;

  if (r.frontalier) {
    // ONSS: toujours belge (lex loci laboris) ‚Äî pas de changement
    // PP: normalement retenu en Belgique
    // Si exon√©ration PP (ancien r√©gime FR pr√©-2012 ‚Äî cas r√©siduel tr√®s rare):
    if (r.frontalierExoPP) {
      r.frontalierPPExo = r.tax; // montant PP qui serait retenu
      // r.tax reste calcul√© normalement pour info mais n'est pas retenu
      // ‚Üí c'est au travailleur de d√©clarer dans son pays de r√©sidence
    }
    // Le travailleur frontalier a droit aux m√™mes avantages sociaux belges
    // (ch√®ques-repas, transport, etc.) puisqu'il travaille en Belgique
  }

  // ‚îÄ‚îÄ TRAVAILLEUR PENSIONN√â ‚Äî CUMUL PENSION / TRAVAIL ‚îÄ‚îÄ
  // R√©forme majeure: depuis 01/01/2015, cumul ILLIMIT√â pour:
  //   - Pension l√©gale de retraite (pas anticip√©e) √† l'√¢ge l√©gal (66 ans en 2026, 67 en 2030)
  //   - Pension anticip√©e apr√®s 45 ans de carri√®re
  //   - Pension de survie si le b√©n√©ficiaire a ‚â• 65 ans
  //
  // Plafonds de cumul (si cumul LIMIT√â ‚Äî AR 20/12/2006 + index):
  //   - Pension anticip√©e < 65 ans (salari√©):
  //     Sans enfant √† charge: 10.613‚Ç¨/an brut (2026)
  //     Avec enfant √† charge: 13.266‚Ç¨/an brut (2026)
  //   - Pension de survie < 65 ans:
  //     Sans enfant √† charge: 22.509‚Ç¨/an brut (2026)
  //     Avec enfant √† charge: 28.136‚Ç¨/an brut (2026)
  //   ‚Üí En cas de d√©passement: pension r√©duite du % de d√©passement (Art. 64 AR 21/12/1967)
  //
  // IMPACT ONSS:
  //   - Cotisation patronale: normale (pas de r√©duction sp√©ciale)
  //   - Cotisation travailleur: cotisation de solidarit√© 0% (pas d'ONSS perso)
  //     si pension + revenu > plafond ‚Üí retenue normale 13,07%
  //   ‚Üí EN PRATIQUE: ONSS normal 13,07% s'applique (la solidarit√© est pass√©e)
  //   ‚Üí Le pensionn√© n'est PLUS exon√©r√© d'ONSS travailleur depuis 2024
  //
  // IMPACT PP:
  //   - Bar√®me normal appliqu√© (m√™me formule-cl√©)
  //   - MAIS: quotit√© exempt√©e peut √™tre diff√©rente si le pensionn√©
  //     cumule pension + revenu ‚Üí art. 154bis CIR
  //   - La pension elle-m√™me est impos√©e s√©par√©ment par le SFP (pr√©compte pension)
  //
  // FLEXI-JOB PENSIONN√â:
  //   - Plafond 12.000‚Ç¨/an NE s'applique PAS aux pensionn√©s ‚Üí cumul illimit√©
  //   - C'est le principal avantage du statut pensionn√© pour les flexi-jobs
  //
  // COTISATION SP√âCIALE 1,5% (solidarit√© pensionn√©):
  //   - Si le pensionn√© gagne > plafond, cotisation sp√©ciale de solidarit√©
  //   - Retenue par l'employeur et vers√©e √† l'ONSS
  //   - Art. 68 Loi 30/03/1994
  //
  // SIGEDIS / SFP: l'employeur d√©clare les revenus via DmfA.
  //   Le SFP (Service f√©d√©ral des Pensions) v√©rifie le cumul automatiquement.

  r.pensionn√© = emp.pensionn√© || false;
  r.pensionType = emp.pensionType || 'none';
  r.pensionCumulIllimite = emp.pensionCumulIllimite || false;
  r.pensionPlafond = 0;
  r.pensionDepassement = false;

  if (r.pensionn√©) {
    const age = emp.pensionAge || 0;
    const carriere = emp.pensionCarriere || 0;
    const depEnfants = emp.depChildren > 0;

    // D√©terminer si cumul illimit√©
    if (r.pensionType === 'legal' && age >= 66) {
      r.pensionCumulIllimite = true; // √Çge l√©gal atteint (66 en 2026)
    }
    if (r.pensionType === 'anticipee' && carriere >= 45) {
      r.pensionCumulIllimite = true; // 45 ans de carri√®re
    }
    if (r.pensionType === 'survie' && age >= 65) {
      r.pensionCumulIllimite = true;
    }

    if (!r.pensionCumulIllimite) {
      // Plafonds de cumul annuels (index√©s 2026)
      if (r.pensionType === 'anticipee') {
        r.pensionPlafond = depEnfants ? 13266 : 10613;
      } else if (r.pensionType === 'survie') {
        r.pensionPlafond = depEnfants ? 28136 : 22509;
      }
      // V√©rifier si d√©passement estim√©
      const revenuAnnuelEstime = r.gross * 12;
      if (r.pensionPlafond > 0 && revenuAnnuelEstime > r.pensionPlafond) {
        r.pensionDepassement = true;
        r.pensionDepassPct = Math.round((revenuAnnuelEstime - r.pensionPlafond) / r.pensionPlafond * 100);
      }
    }

    // Cotisation sp√©ciale solidarit√© pensionn√© (Art. 68 Loi 30/03/1994)
    // Si le total pension + revenus activit√© > seuil ‚Üí retenue 0% √† 2%
    // En pratique: d√©j√† incluse dans les cotisations ONSS standard
    // Le SFP v√©rifie a posteriori via DmfA/SIGEDIS

    // ONSS: normal (13,07% trav + taux patronal sectoriel)
    // Pas de changement dans le calcul ‚Äî tout est standard
  }

  // ‚îÄ‚îÄ PR√âCOMPTE PROFESSIONNEL 2026 ‚Äî FORMULE-CL√â COMPL√àTE SPF FINANCES ‚îÄ‚îÄ
  // Annexe III AR/CIR 92 ‚Äî Moniteur belge ‚Äî Tranches annuelles
  const PP = LEGAL.PP2026;
  const annualGross = r.taxGross * 12;

  // √âtape 1: Frais professionnels forfaitaires (30%, max 5 930 ‚Ç¨)
  const isSalarie = (emp.regime !== 'dirigeant');
  const fpPct = isSalarie ? PP.FP_PCT : PP.FP_DIR_PCT;
  const fpMax = isSalarie ? PP.FP_MAX : PP.FP_DIR_MAX;
  r.profExp_annual = Math.min(annualGross * fpPct, fpMax);
  r.profExp = r.profExp_annual / 12;

  // √âtape 2: Revenu annuel net imposable
  const revNetImposable = annualGross - r.profExp_annual;

  // √âtape 3: Bar√®me 1 (isol√©) ou Bar√®me 2 (quotient conjugal)
  const isBareme2 = (emp.civil === 'married_1'); // conjoint sans revenus
  let revPrincipal = revNetImposable;
  let revConjoint = 0;
  if (isBareme2) {
    revConjoint = Math.min(revNetImposable * PP.QC_PCT, PP.QC_MAX);
    revPrincipal = revNetImposable - revConjoint;
  }

  // √âtape 4: Calcul imp√¥t progressif annuel (sur revenu principal)
  const calcImpotAnnuel = (rev) => {
    let impot = 0; let reste = Math.max(0, rev);
    let prev = 0;
    for (const tr of PP.TRANCHES) {
      const tranche = Math.min(reste, tr.lim - prev);
      impot += tranche * tr.rate;
      reste -= tranche;
      prev = tr.lim;
      if (reste <= 0) break;
    }
    return impot;
  };

  let impotAnnuel = calcImpotAnnuel(revPrincipal);
  if (isBareme2 && revConjoint > 0) {
    impotAnnuel += calcImpotAnnuel(revConjoint);
  }

  // √âtape 5: D√©duction quotit√© exempt√©e d'imp√¥t
  const quotiteExempt = PP.EXEMPT * (isBareme2 ? 2 : 1);
  const reductionExempt = calcImpotAnnuel(quotiteExempt);
  impotAnnuel -= reductionExempt;

  // √âtape 6: R√©ductions annuelles charges de famille
  let redFam = 0;
  const ch = emp.depChildren || 0;
  if (ch > 0 && ch <= 5) redFam += PP.RED.enfants[ch];
  else if (ch > 5) redFam += PP.RED.enfants[5] + (ch - 5) * PP.RED.enfantX;
  if (emp.handiChildren > 0) redFam += emp.handiChildren * PP.RED.handicap;
  if (emp.civil === 'single' && ch === 0) redFam += PP.RED.isolee;
  if ((emp.civil === 'single' || emp.civil === 'widowed') && ch > 0) redFam += PP.RED.veuf_enfant;
  // Ascendants ‚â• 65 ans √† charge (Art. 132 CIR 92 ‚Äî revenus nets < 3.820‚Ç¨)
  const depAsc = emp.depAscendant || 0;
  const depAscHandi = emp.depAscendantHandi || 0;
  if (depAsc > 0) redFam += depAsc * PP.RED.ascendant65;
  if (depAscHandi > 0) redFam += depAscHandi * PP.RED.ascendant65_handi;
  // Conjoint handicap√© (Art. 132 CIR ‚Äî suppl√©ment quotit√© exempt√©e)
  if (emp.conjointHandicap) redFam += PP.RED.handicap;
  // Autres personnes √† charge (Art. 136 CIR ‚Äî max 3.820‚Ç¨ revenus nets)
  const depAutres = emp.depAutres || 0;
  if (depAutres > 0) redFam += depAutres * PP.RED.isolee; // m√™me r√©duction qu'isol√© par personne
  impotAnnuel -= redFam;

  // √âtape 7: Pr√©compte mensuel = imp√¥t annuel / 12
  r.baseTax = Math.max(0, impotAnnuel) / 12;
  r.famRed = redFam / 12;
  r.taxNet = revNetImposable / 12;
  r.tax = Math.max(0, r.baseTax);
  // ‚îÄ‚îÄ Bonus √† l'emploi FISCAL (r√©duction pr√©compte professionnel) ‚îÄ‚îÄ
  // 33,14% du volet A + 52,54% du volet B (depuis 01/04/2024)
  r.empBonusFiscA = r.empBonusA * 0.3314;
  r.empBonusFiscB = r.empBonusB * 0.5254;
  r.empBonusFisc = r.empBonusFiscA + r.empBonusFiscB;
  r.tax = Math.max(0, r.tax - r.empBonusFisc);

  // Special SS contribution (Art. 106-112 Loi-programme 30/12/1988)
  // Bar√®me trimestriel ‚Äî retenue mensuelle = 1/3 du montant trimestriel
  // Diff√©rent pour isol√©s vs m√©nages avec 2 revenus
  // Source: socialsecurity.be + Securex montants-socio-juridiques 2026
  r.css = 0;
  const grossTrim = r.gross * 3; // salaire trimestriel
  const grossTrimOuv = isOuvrier ? grossTrim * 1.08 : grossTrim;
  // Calcul trimestriel puis division par 3
  if (emp.civil === 'married_2' || emp.civil === 'cohabit') {
    // M√âNAGE 2 REVENUS
    if (grossTrimOuv <= 5836.14) r.css = 0;
    else if (grossTrimOuv <= 6570.54) r.css = Math.max(9.30, (grossTrimOuv - 5836.14) * 0.076) / 3;
    else if (grossTrimOuv <= 18116.46) r.css = Math.min(51.64, 18.60 + (grossTrimOuv - 6570.54) * 0.011) / 3;
    else r.css = 51.64 / 3;
    // Plafond mensuel m√©nage 2 revenus = 51.64‚Ç¨/trim = 17.21‚Ç¨/mois
    r.css = Math.min(r.css, 51.64 / 3);
  } else {
    // ISOL√â / conjoint SANS revenus
    if (grossTrimOuv <= 5836.14) r.css = 0;
    else if (grossTrimOuv <= 6570.54) r.css = (grossTrimOuv - 5836.14) * 0.076 / 3;
    else if (grossTrimOuv <= 18116.46) r.css = Math.min(60.94, 18.60 + (grossTrimOuv - 6570.54) * 0.011) / 3;
    else r.css = 60.94 / 3;
    // Plafond mensuel isol√© = 60.94‚Ç¨/trim = 20.31‚Ç¨/mois
    r.css = Math.min(r.css, 60.94 / 3);
  }
  r.css = Math.round(r.css * 100) / 100;
  r.cssTrimMax = (emp.civil === 'married_2' || emp.civil === 'cohabit') ? 154.92 : 182.82;
  r.cssAnnuelMax = (emp.civil === 'married_2' || emp.civil === 'cohabit') ? 619.68 : 731.28;

  r.mvDays = per.days || Math.round(LEGAL.WD);
  r.mvWorker = r.mvDays * (emp.mvW || 0);
  r.mvEmployer = r.mvDays * (emp.mvE || 0);
  r.transport = 0; r.transportDetail = '';
  const cDist = parseFloat(emp.commDist) || 0;
  const cMonth = parseFloat(emp.commMonth) || 0;
  const cType = emp.commType || 'none';
  const wDays = per.days || 21;
  if (cType === 'train' && cMonth > 0) {
    // SNCB: intervention obligatoire 75% abonnement (CCT 19/9 du 26/03/2004)
    r.transport = cMonth * 0.75;
    r.transportDetail = `Train: 75% √ó ${fmt(cMonth)} = ${fmt(r.transport)}`;
  } else if (cType === 'bus' && cMonth > 0) {
    // Transport en commun autre: intervention = prix abo SNCB m√™me distance (CCT 19/9)
    r.transport = cMonth * 0.75;
    r.transportDetail = `Bus/Tram: 75% √ó ${fmt(cMonth)} = ${fmt(r.transport)}`;
  } else if (cType === 'bike' && cDist > 0) {
    // V√©lo: 0,27 ‚Ç¨/km A/R (2026) ‚Äî exon√©r√© ONSS et IPP
    r.transport = cDist * 2 * wDays * 0.27;
    r.transportDetail = `V√©lo: ${cDist}km √ó 2 √ó ${wDays}j √ó 0,27‚Ç¨ = ${fmt(r.transport)}`;
  } else if (cType === 'car' && cDist > 0) {
    // Voiture priv√©e: pas d'obligation l√©gale sauf CCT sectorielle
    // Si employeur intervient: exon√©ration ONSS max 490‚Ç¨/an (2026) = 40,83‚Ç¨/mois
    // Calcul forfaitaire courant: bar√®me SNCB pour distance √©quivalente
    r.transport = Math.min(40.83, cDist * 0.15 * wDays); // estimation
    r.transportDetail = `Voiture: ${cDist}km, interv. max exon√©r√©e ${fmt(r.transport)}/mois`;
  } else if (cType === 'carpool' && cDist > 0) {
    r.transport = Math.min(40.83, cDist * 0.15 * wDays);
    r.transportDetail = `Covoiturage: idem voiture`;
  } else if (cType === 'mixed' && cMonth > 0) {
    // Combin√©: train + v√©lo possible
    r.transport = cMonth * 0.75 + (cDist > 0 ? cDist * 2 * wDays * 0.27 : 0);
    r.transportDetail = `Combin√©: train ${fmt(cMonth * 0.75)} + v√©lo ${fmt(cDist * 2 * wDays * 0.27)}`;
  }
  r.expense = emp.expense || 0;
  r.garnish = per.garnish || 0;
  r.advance = per.advance || 0;
  r.otherDed = per.otherDed || 0;
  // ‚îÄ‚îÄ PP VOLONTAIRE (Art. 275¬ß1 CIR 92 + AR/PP Art. 88) ‚îÄ‚îÄ
  // Le travailleur peut demander par √©crit √† l'employeur de retenir un PP suppl√©mentaire
  // au-del√† du minimum l√©gal. R√©cup√©rable via d√©claration IPP si trop-retenu.
  // L'employeur est tenu de reverser l'int√©gralit√© au SPF Finances.
  // Base: AR 09/01/2024 fixant les bar√®mes de PP ‚Äî dispense n'affecte pas ce montant.
  r.ppVolontaire = per.ppVolontaire || 0;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  //  √âL√âMENTS FISCAUX COMPLETS ‚Äî Art. CIR 92 / Loi ONSS 27/06/1969
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  // ‚îÄ‚îÄ 1. DOUBLE P√âCULE VACANCES (Employ√©s ‚Äî pay√© par employeur) ‚îÄ‚îÄ
  // Art. 19 ¬ß2 AR 28/11/1969 ‚Äî ONSS sur 2√®me partie (7%) uniquement
  // Double p√©cule = 92% du brut (85% = 1√®re partie + 7% = 2√®me partie)
  // 2√®me partie soumise ONSS trav 13,07% + cotisation sp√©ciale 1%
  r.doublePecule = per.doublePecule || 0;
  r.dpOnss = 0; r.dpCotisSpec = 0;
  if (r.doublePecule > 0) {
    const dp2 = r.doublePecule * (7/92); // extraire la 2√®me partie
    r.dpOnss = dp2 * 0.1307;      // ONSS travailleur sur 2√® partie
    r.dpCotisSpec = dp2 * 0.01;    // cotisation sp√©ciale 1%
  }

  // ‚îÄ‚îÄ 2. P√âCULE VACANCES DE D√âPART (Art. 46 Loi 12/04/1965) ‚îÄ‚îÄ
  // Pay√© lors de la sortie de service ‚Äî simple + double anticip√©
  // Soumis ONSS 13,07% sur totalit√©
  r.peculeDepart = per.peculeDepart || 0;
  r.pdOnss = r.peculeDepart > 0 ? r.peculeDepart * 0.1307 : 0;

  // ‚îÄ‚îÄ 3. PRIME D'ANCIENNET√â (Art. 19 ¬ß2 14¬∞ AR ONSS) ‚îÄ‚îÄ
  // Exon√©r√©e ONSS et IPP si: 1√ó entre 25-35 ans anc. et 1√ó ‚â• 35 ans anc.
  // Plafond 2026: max 1√ó brut mensuel ou fraction (prorata)
  // Montant max exon√©r√©: employ√© = 1 mois brut, ouvrier = idem
  r.primeAnciennete = per.primeAnciennete || 0;
  const ancAns = emp.anciennete || 0;
  const primeAncExo = (ancAns >= 25) ? Math.min(r.primeAnciennete, emp.monthlySalary) : 0;
  r.primeAncTaxable = Math.max(0, r.primeAnciennete - primeAncExo);
  r.primeAncExoneree = primeAncExo;

  // ‚îÄ‚îÄ 4. PRIME DE NAISSANCE / MARIAGE / √âV√âNEMENT (Circ. ONSS 2024/1) ‚îÄ‚îÄ
  // Exon√©r√©e ONSS si ‚â§ plafond (naissance: coutume, mariage: idem)
  // Consid√©r√© comme avantage social si modique et li√© √† √©v√©nement
  r.primeNaissance = per.primeNaissance || 0;

  // ‚îÄ‚îÄ 5. PRIME D'INNOVATION (Art. 38 ¬ß1er 25¬∞ CIR 92) ‚îÄ‚îÄ
  // Exon√©r√©e IPP si ‚â§ 1 mois brut et ‚â§ 1√ó par travailleur
  // Soumise ONSS mais exon√©r√©e fiscalement
  r.primeInnovation = per.primeInnovation || 0;

  // ‚îÄ‚îÄ 6. INDEMNIT√â T√âL√âTRAVAIL (Circ. 2021/C/20 du 26/02/2021) ‚îÄ‚îÄ
  // Max 154,74‚Ç¨/mois (montant 2026 ‚Äî index√© chaque ann√©e)
  // Exon√©r√©e ONSS et IPP si structurel (min 1 jour/semaine r√©gulier)
  // Couvre: chauffage, √©lectricit√©, petit mat√©riel, amortissement mobilier
  r.indemTeletravail = Math.min(per.indemTeletravail || 0, 154.74);

  // ‚îÄ‚îÄ 7. INDEMNIT√â FRAIS DE BUREAU (AR/CIR92 Art. 31) ‚îÄ‚îÄ
  // Frais propres de l'employeur ‚Äî exon√©r√©s si justifi√©s ou forfaitaires
  // Forfait bureau: max 10% brut (tol√©rance admin. ‚Äî non cumulable t√©l√©travail)
  r.indemBureau = per.indemBureau || 0;

  // ‚îÄ‚îÄ 8. PENSION COMPL√âMENTAIRE ‚Äî Retenue personnelle (Loi 28/04/2003 LPC) ‚îÄ‚îÄ
  // Retenue sur salaire = cotisation personnelle du travailleur
  // D√©ductible fiscalement (Art. 145/1 CIR ‚Äî r√©duction 30% avec plafond)
  // Soumise ONSS travailleur (base de calcul ONSS)
  // Cotisation Wijninckx ‚Äî 12,5% depuis 2026 (Loi 18/12/2025 M.B. 30/12/2025)
  // Applicable si pension l√©gale + compl. > pension max secteur public (97.548‚Ç¨/an)
  r.pensionCompl = per.pensionCompl || 0;

  // ‚îÄ‚îÄ 9. RETENUE SYNDICALE (Art. 23 Loi 12/04/1965) ‚îÄ‚îÄ
  // Volontaire ‚Äî transmise au syndicat. Pas ONSS, r√©duction fiscale partielle
  r.retSyndicale = per.retSyndicale || 0;

  // ‚îÄ‚îÄ 10. PENSION ALIMENTAIRE (Art. 1409-1412 Code judiciaire) ‚îÄ‚îÄ
  // Saisie prioritaire ‚Äî avant les autres saisies, sans bar√®me
  r.saisieAlim = per.saisieAlim || 0;

  // ‚îÄ‚îÄ 11. R√âDUCTION PP HEURES SUPPL√âMENTAIRES (Art. 154bis CIR 92) ‚îÄ‚îÄ
  // Travailleur: r√©duction PP sur sursalaire (50% ou 100%)
  // Max 180h/an (2026 ‚Äî Art.154bis ¬ß3 CIR ‚Äî Accord Arizona structurel)
  // Horeca: 360h | Construction+enregistrement: 180h
  // Employeur: dispense versement PP 32,19% (Art. 275/1 CIR)
  // Applicable sur heures au-del√† de 9h/j ou 38h/sem (ou limite secteur)
  const hsfisc = per.heuresSupFisc || 0;
  r.heuresSupFisc = hsfisc;
  const sursalaire = hsfisc * hr * 0.5; // sursalaire = 50% du taux horaire normal
  // R√©duction travailleur: 66,81% du PP sur le sursalaire (taux bar√®me 1 Art.154bis)
  // ou 57,75% selon bar√®me 2
  r.redPPHeuresSup = sursalaire > 0 ? Math.round(sursalaire * 0.6681 * 100) / 100 : 0;
  r.tax = Math.max(0, r.tax - r.redPPHeuresSup);

  // ‚îÄ‚îÄ 12. DISPENSE VERSEMENT PP NUIT/√âQUIPES (Art. 275/5 CIR 92) ‚îÄ‚îÄ
  // Employeur: dispense de versement PP = 22,8% (travail en √©quipe/nuit)
  // Ne change pas le net du travailleur, r√©duit le co√ªt employeur
  r.dispensePPNuit = (per.nightH || 0) > 0 ? r.tax * 0.228 : 0;

  // ‚îÄ‚îÄ 13. PP √Ä TAUX EXCEPTIONNEL ‚Äî Double p√©cule & 13√® mois ‚îÄ‚îÄ
  // (AR 09/01/2024 annexe III ‚Äî Bar√®mes pr√©compte professionnel)
  // Double p√©cule vacances: tax√© √† taux fixe (pas bar√®me progressif)
  //   Taux = bas√© sur r√©mun√©ration annuelle brute:
  //   ‚â§ 17.280‚Ç¨: 0% | ‚â§ 32.280‚Ç¨: 19,17% | ‚â§ 43.380‚Ç¨: 23,22% | > 43.380‚Ç¨: 30,28%
  // 13√® mois: taux fixe idem (annexe III AR)
  // Indemnit√© de d√©part/pr√©avis: taux fixe selon r√©mun√©ration annuelle
  // NB: ces taux s'appliquent sur le MONTANT EXCEPTIONNEL, pas le salaire mensuel
  r.ppTauxExcep = 0; r.ppTauxExcepRate = 0;
  const typeSpec = per.typeSpecial || 'normal';
  if (typeSpec === 'doublePecule' || typeSpec === 'y13' || typeSpec === 'depart' || typeSpec === 'preavis') {
    const annBrut = r.base * 12;
    if (annBrut <= 17280) r.ppTauxExcepRate = 0;
    else if (annBrut <= 32280) r.ppTauxExcepRate = 0.1917;
    else if (annBrut <= 43380) r.ppTauxExcepRate = 0.2322;
    else r.ppTauxExcepRate = 0.3028;
    // Appliquer sur le montant exceptionnel
    const montantExcep = (typeSpec === 'doublePecule' ? r.doublePecule : 0)
      + (typeSpec === 'y13' ? r.y13 : 0)
      + (typeSpec === 'depart' ? r.peculeDepart : 0)
      + (typeSpec === 'preavis' ? (per.indemPreavis || 0) : 0);
    r.ppTauxExcep = montantExcep * r.ppTauxExcepRate;
    r.tax += r.ppTauxExcep;
  }

  // ‚îÄ‚îÄ 14. JOURS F√âRI√âS PAY√âS (Loi 04/01/1974 + AR 18/04/1974) ‚îÄ‚îÄ
  // 10 jours f√©ri√©s l√©gaux/an (Belgique) ‚Äî pay√©s par l'employeur
  // Ouvrier: salaire journalier normal (inclus dans les jours prest√©s si travaill√©s)
  // Employ√©: salaire mensuel normal (pas d'impact sur calcul mensuel)
  // Jour f√©ri√© travaill√©: suppl√©ment 200% (d√©j√† couvert par sundayH si encod√©)
  r.joursFeries = per.joursFeries || 0; // nombre encod√© dans le mois

  // ‚îÄ‚îÄ 15. PETIT CH√îMAGE / CONG√â DE CIRCONSTANCE (AR 28/08/1963) ‚îÄ‚îÄ
  // Salaire normal maintenu pour √©v√©nements familiaux:
  // Mariage travailleur: 2 jours | D√©c√®s conjoint/enfant: 3 jours
  // Naissance enfant (co-parent): 15 jours | Communion: 1 jour
  // D√©m√©nagement: 1 jour | Comparution tribunal: n√©cessaire
  r.petitChomage = per.petitChomage || 0; // nombre jours
  r.petitChomageVal = r.petitChomage * (r.base / LEGAL.WD); // valeur = salaire/jour

  // ‚îÄ‚îÄ 16. √âCO-CH√àQUES (CCT 98 du 20/02/2009 ‚Äî CNT) ‚îÄ‚îÄ
  // Max 250‚Ç¨/an par travailleur temps plein (prorata temps partiel)
  // Exon√©r√©s ONSS et IPP si conditions respect√©es (pas en remplacement r√©mun.)
  // Uniquement √©lectroniques depuis 2024
  // Non inclus dans le brut, pas de retenue ‚Äî co√ªt employeur pur
  r.ecoCheques = per.ecoCheques || 0;

  // ‚îÄ‚îÄ 17. CADEAUX & AVANTAGES SOCIAUX (Circ. ONSS + Art. 38/11 CIR) ‚îÄ‚îÄ
  // Exon√©r√©s ONSS+IPP si: No√´l/Nouvel An ‚â§ 40‚Ç¨ + 40‚Ç¨/enfant | Mariage ‚â§ 245‚Ç¨
  // Saint-Nicolas ‚â§ 40‚Ç¨/enfant | Retraite ‚â§ 40‚Ç¨/ann√©e service (max 40 ans)
  r.cadeaux = per.cadeaux || 0;

  // ‚îÄ‚îÄ 18. BUDGET MOBILIT√â (Loi 17/03/2019 modifi√© 01/01/2022) ‚îÄ‚îÄ
  // Alternative √† la voiture de soci√©t√© ‚Äî 3 piliers:
  // Pilier 1: voiture plus √©cologique (ATN r√©duit)
  // Pilier 2: mobilit√© durable (transport en commun, v√©lo, logement) ‚Äî exon√©r√© ONSS+IPP
  // Pilier 3: solde en cash ‚Äî cotisation sp√©ciale 38,07% (employeur + travailleur)
  // Montant = TCO annuel voiture de soci√©t√© (1/5 √ó catalogue √ó coeff. √¢ge + carburant + CO2)
  r.budgetMobilite = per.budgetMobilite || 0;
  r.budgetMobPilier2 = per.budgetMobP2 || 0; // part exon√©r√©e
  r.budgetMobPilier3 = per.budgetMobP3 || 0; // part cash ‚Üí cotisation 38,07%
  r.budgetMobCotis38 = r.budgetMobPilier3 * 0.3807;

  // ‚îÄ‚îÄ 19. R√âDUCTIONS GROUPES-CIBLES EMPLOYEUR (AR Groupes-cibles) ‚îÄ‚îÄ
  // R√©ductions ONSS patronales cibl√©es ‚Äî calcul√©es AUTOMATIQUEMENT
  //
  // ‚ïê‚ïê‚ïê PREMIER ENGAGEMENT (AR 16/05/2003 + R√©forme 01/04/2026) ‚ïê‚ïê‚ïê
  // Art. 336-353 Loi-programme 24/12/2002
  // Source: ONSS instructions T1/2026 + SPF Emploi
  //
  // AVANT 01/04/2026:
  //   1er employ√©: exon√©ration totale ONSS patronal (dur√©e illimit√©e depuis 2016)
  //   2√® employ√©: forfait trimestriel 1.550‚Ç¨ T1-T5, 1.050‚Ç¨ T6-T9, 450‚Ç¨ T10-T13
  //   3√® employ√©: forfait trimestriel 1.050‚Ç¨ T1-T5, 1.050‚Ç¨ T6-T9, 450‚Ç¨ T10-T13
  //   4√® employ√©: forfait trimestriel 1.050‚Ç¨ T1-T5, 1.050‚Ç¨ T6-T9, 450‚Ç¨ T10-T13
  //   5√® employ√©: forfait trimestriel 1.050‚Ç¨ T1-T5, 1.050‚Ç¨ T6-T9, 450‚Ç¨ T10-T13
  //   6√® employ√©: forfait trimestriel 1.050‚Ç¨ T1-T5, 1.050‚Ç¨ T6-T9, 450‚Ç¨ T10-T13
  //
  // APR√àS 01/04/2026 (R√©forme budget f√©d√©ral):
  //   1er employ√©: max 3.100‚Ç¨ ‚Üí r√©duit √† 2.000‚Ç¨/trimestre (plafonn√©)
  //   2√® employ√©: inchang√©
  //   3√® employ√©: inchang√©
  //   4√®-5√®-6√®: R√âINTRODUITS (supprim√©s en 2025, r√©tablis 04/2026)
  //
  // Param√®tre: emp.nrEngagement = rang d'engagement (1 = 1er, 2 = 2√®, etc.)
  // Param√®tre: emp.engagementTrimestre = trimestre courant depuis engagement (1-13+)

  const PREMIER_ENG = {
    // Montants trimestriels par rang et par p√©riode (trimestres depuis engagement)
    // Format: [T1-T5, T6-T9, T10-T13, T14+]
    1: { label: '1er employ√©', amounts: [2000, 2000, 2000, 2000], note: 'Illimit√© (plafonn√© 2.000‚Ç¨/trim. depuis 04/2026)' },
    2: { label: '2√® employ√©', amounts: [1550, 1050, 450, 0], note: '13 trimestres max' },
    3: { label: '3√® employ√©', amounts: [1050, 1050, 450, 0], note: '13 trimestres max' },
    4: { label: '4√® employ√©', amounts: [1050, 1050, 450, 0], note: 'R√©introduit 04/2026' },
    5: { label: '5√® employ√©', amounts: [1050, 1050, 450, 0], note: 'R√©introduit 04/2026' },
    6: { label: '6√® employ√©', amounts: [1050, 1050, 450, 0], note: 'R√©introduit 04/2026' },
  };

  r.redGCPremier = 0; r.redGCPremierLabel = ''; r.redGCPremierNote = '';
  const nrEng = emp.nrEngagement || 0;
  const engTrim = emp.engagementTrimestre || 1;
  if (nrEng >= 1 && nrEng <= 6) {
    const pe = PREMIER_ENG[nrEng];
    let trimIdx = 0;
    if (engTrim <= 5) trimIdx = 0;
    else if (engTrim <= 9) trimIdx = 1;
    else if (engTrim <= 13) trimIdx = 2;
    else trimIdx = 3;
    const trimAmount = pe.amounts[trimIdx];
    // Mensualiser le montant trimestriel
    r.redGCPremier = Math.round(trimAmount / 3 * 100) / 100;
    // Pour le 1er employ√©: ne peut pas d√©passer la cotisation patronale effective
    if (nrEng === 1) r.redGCPremier = Math.min(r.redGCPremier, r.onssE + r.redStructMois);
    r.redGCPremierLabel = pe.label;
    r.redGCPremierNote = `${pe.label}: ${fmt(trimAmount)}/trim. (T${engTrim}) ‚Äî ${pe.note}`;
  }

  // Travailleurs √¢g√©s ‚â• 55 ans (AR 19/12/2001 ‚Äî Activation 55+)
  // R√©duction trimestrielle: 1.150‚Ç¨ si ‚â• 55 ans + salaire < 14.640,83‚Ç¨/trim.
  r.redGCAge = per.redGCAge || 0;
  // Jeunes < 26 ans peu qualifi√©s (AR Activation jeunes)
  // R√©duction trimestrielle: 1.500‚Ç¨ (tr√®s peu qualifi√©) ou 1.150‚Ç¨ (peu qualifi√©)
  r.redGCJeune = per.redGCJeune || 0;
  // Travailleurs handicap√©s
  r.redGCHandicap = per.redGCHandicap || 0;
  r.redGCTotal = r.redGCPremier + r.redGCAge + r.redGCJeune + r.redGCHandicap;

  // ‚îÄ‚îÄ 20. COTISATION SP√âCIALE ONSS MOD√âRATION SALARIALE (Loi 1996) ‚îÄ‚îÄ
  // D√©j√† incluse dans le taux ONSS_E global via ONSS_SECTEUR
  // 5,67% sur la masse salariale (employeur) ‚Äî pas travailleur

  // ‚îÄ‚îÄ 21. ALLOCATION DE TRAVAIL ONEM ‚Äî ACTIVATION (AR 19/12/2001 + R√©gional) ‚îÄ‚îÄ
  // M√©canisme: le travailleur re√ßoit une allocation de l'ONEM via CAPAC/syndicat.
  // L'employeur D√âDUIT ce montant du salaire net √† payer.
  // Le travailleur touche: salaire net (employeur) + allocation ONEM = r√©mun√©ration totale.
  // ‚Üí Le co√ªt r√©el de l'employeur baisse du montant de l'allocation.
  //
  // Types d'allocations de travail:
  // Activa.brussels (Actiris): max ‚Ç¨350/mois √ó 12 mois ‚Äî DE ‚â• 12 mois, r√©sid. Bruxelles
  // Activa.brussels Jeunes: ‚Ç¨350/mois √ó 6 mois ‚Äî DE < 30 ans, ‚â• 6 mois
  // Impulsion Wallonie: ‚Ç¨500/mois √ó 24-36 mois ‚Äî via FOREM/SPW
  // SINE (√©conomie sociale): variable
  //
  // Traitement fiscal: l'allocation de travail est un revenu de remplacement pour le travailleur
  // ‚Üí Soumise au pr√©compte professionnel (retenue par ONEM/CAPAC)
  // ‚Üí NON soumise ONSS (pas de r√©mun√©ration au sens ONSS)
  // ‚Üí L'employeur ne la d√©clare PAS en DmfA (c'est l'ONEM qui d√©clare)
  //
  // Sur la fiche de paie: mention "pour m√©moire" ‚Äî d√©duit du co√ªt employeur
  const allocType = per.allocTravailType || 'none';
  r.allocTravail = per.allocTravail || 0;
  r.allocTravailType = allocType;
  // Montants standards par type (si pas de montant custom)
  if (r.allocTravail === 0 && allocType !== 'none') {
    const ALLOC_MONTANTS = {
      'activa_bxl': 350,       // Activa.brussels: ‚Ç¨350/mois
      'activa_jeune': 350,     // Activa Jeunes: ‚Ç¨350/mois
      'impulsion_wal': 500,    // Impulsion Wallonie: ‚Ç¨500/mois
      'impulsion55': 500,      // Impulsion 55+: ‚Ç¨500/mois
      'sine': 500,             // SINE: ‚Ç¨500/mois (variable)
      'vdab': 0,               // Flandre: pas d'allocation trav. (prime directe employeur)
    };
    r.allocTravail = ALLOC_MONTANTS[allocType] || 0;
  }
  r.allocTravailLabel = {
    'activa_bxl': 'Activa.brussels (Actiris)',
    'activa_jeune': 'Activa Jeunes <30 (Actiris)',
    'impulsion_wal': 'Impulsion Wallonie (FOREM)',
    'impulsion55': 'Impulsion 55+ (FOREM)',
    'sine': 'SINE (√©conomie sociale)',
    'vdab': 'Groupe-cible flamand (VDAB)',
  }[allocType] || '';

  // ‚îÄ‚îÄ 14. FLEXI-JOB (Art. 3 Loi 16/11/2015 ‚Äî modifi√© 01/01/2024) ‚îÄ‚îÄ
  // Conditions: emploi principal min. 4/5 (T-3) OU pensionn√©
  // Secteurs: horeca CP302, commerce CP201/202/311, soins CP318/330/331/332,
  //   boulangerie CP118.03, agriculture CP144/145, int√©rim CP322, sport, culture...
  // Travailleur: 0% ONSS, 0% PP (exon√©r√© si ‚â§ 12.000‚Ç¨/an)
  // Employeur: 28% cotisation patronale sp√©ciale (Art.38¬ß3ter Loi 29/06/1981)
  // Flexi-salaire min: 12,29‚Ç¨/h + 7,67% flexi-p√©cule vacances (2026)
  // Plafond IPP: 12.000‚Ç¨/an (pensionn√©s: illimit√©)
  // Dimona: type "FLX" | DmfA: code "050"
  r.isFlexiJob = (emp.contract === 'flexi');
  if (r.isFlexiJob) {
    const flexiMinH = 12.29;
    const flexiH = per.days * ((emp.whWeek || 10) / 5);
    const flexiTauxH = Math.max(flexiMinH, (emp.monthlySalary || 0) / ((emp.whWeek || 10) * 4.33));
    r.flexiSalaireH = flexiTauxH;
    r.flexiHeures = flexiH;
    r.flexiBrut = Math.round(flexiH * flexiTauxH * 100) / 100;
    r.flexiPecule = Math.round(r.flexiBrut * 0.0767 * 100) / 100;
    r.flexiOnssPatronal = Math.round((r.flexiBrut + r.flexiPecule) * 0.28 * 100) / 100;
    r.gross = r.flexiBrut + r.flexiPecule;
    r.base = r.flexiBrut;
    r.onssW = 0; r.onssNet = 0; r.empBonus = 0; r.empBonusA = 0; r.empBonusB = 0;
    r.tax = 0; r.css = 0; r.ppVolontaire = 0; r.ppTauxExcep = 0; r.ppTauxExcepRate = 0;
    r.onssE = r.flexiOnssPatronal; r.redStructMois = 0; r.redStruct = 0;
    r.totalDed = per.advance || 0;
    r.net = r.gross - r.totalDed;
    r.costTotal = r.gross + r.flexiOnssPatronal;
    r.flexiNet = r.net;
    return r;
  }

  // ‚îÄ‚îÄ 15. √âTUDIANT (Art. 17bis AR ONSS) ‚îÄ‚îÄ
  // Max 650h/an (2026 ‚Äî Annexe III PP + Art.17bis AR 28/11/1969): cotisation solidarit√© 2,71% (trav) + 5,42% (empl)
  // Au-del√†: ONSS normal. Pas de PP si ‚â§ 7.340‚Ç¨/an net imposable
  r.isStudent = (emp.contract === 'etudiant');
  if (r.isStudent) {
    r.studentOnssW = Math.round(r.gross * 0.0271 * 100) / 100; // 2,71%
    r.studentOnssE = Math.round(r.gross * 0.0542 * 100) / 100; // 5,42%
    r.onssW = r.studentOnssW; r.onssNet = r.studentOnssW;
    r.onssE = r.studentOnssE;
    r.empBonus = 0; r.empBonusA = 0; r.empBonusB = 0;
    r.redStructMois = 0; r.redStruct = 0;
    // PP = 0 si revenu annuel net ‚â§ 7.340‚Ç¨
    if (r.gross * 12 <= 7340) { r.tax = 0; r.css = 0; }
  }

  // ‚îÄ‚îÄ 16. FRAIS PROFESSIONNELS FORFAITAIRES (Art. 51 CIR 92) ‚îÄ‚îÄ
  // D√©j√† calcul√© ci-dessus: 30% avec plafond (employ√©s et ouvriers)

  // ‚îÄ‚îÄ 17. R√âDUCTIONS FAMILIALES (Art. 136-140 CIR 92) ‚îÄ‚îÄ
  // D√©j√† calcul√© ci-dessus: quotit√© exempt√©e par enfant + isol√© + handicap

  // ‚îÄ‚îÄ 18. DISPENSE VERSEMENT PP RECHERCHE (Art. 275/3 CIR 92) ‚îÄ‚îÄ
  // 80% du PP pour les chercheurs (dipl√¥me Master/Doctorat)
  // Uniquement c√¥t√© employeur ‚Äî ne change pas le net travailleur

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  //  P√âCULE DE VACANCES ‚Äî CALCUL AUTOMATIQUE (Sprint 2)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // Source: Loi 28/06/1971 + AR 30/03/1967 + ONSS Instructions 2026
  //
  // EMPLOY√âS (pay√© par l'employeur):
  //   Simple: 100% du brut mensuel normal (pay√© pendant les vacances)
  //   Double: 92% du brut mensuel ‚Üí pay√© avant les vacances (g√©n√©ralement mai/juin)
  //     - 1√®re partie (85%): soumise PP normal
  //     - 2√®me partie (7%): soumise ONSS 13,07% + cotisation sp√©ciale 1%
  //   ‚Üí Le simple p√©cule = salaire normal du mois de vacances (d√©j√† dans le brut)
  //
  // OUVRIERS (pay√© par la Caisse de Vacances / ONVA):
  //   Total: 15,38% du brut annuel N-1 (√† 108%)
  //   Simple: 6,80% (7,69% de 108% - cotisation solidarit√©)
  //   Double: 8,58% (reste)
  //   ‚Üí Vers√© via l'ONVA ou la Caisse sectorielle, PAS par l'employeur
  //   ‚Üí L'employeur paie la cotisation vacances 15,84% trimestrielle √† l'ONSS
  //
  r.peculeVacCalc = {
    type: isOuvrier ? 'ouvrier' : 'employe',
    brutRef: isOuvrier ? (r.gross * 1.08 * 12) : (emp.monthlySalary || 0), // brut annuel N-1 √† 108% pour ouvriers
    simple: 0,
    double: 0,
    total: 0,
    onss2emePartie: 0,
    cotisSpec1pct: 0,
    ppExcep: 0,
    moisPaiement: isOuvrier ? 'Mai (Caisse de Vacances)' : 'Mai/Juin (Employeur)'
  };
  if (!isOuvrier) {
    // Employ√©: simple = 1 mois brut (d√©j√† inclus dans salaire normal du mois de vacances)
    r.peculeVacCalc.simple = emp.monthlySalary || 0;
    // Double = 92% du brut mensuel
    r.peculeVacCalc.double = (emp.monthlySalary || 0) * 0.92;
    r.peculeVacCalc.total = r.peculeVacCalc.simple + r.peculeVacCalc.double;
    // 2√®me partie du double p√©cule (7/92 du double) ‚Üí ONSS 13,07% + cotis sp√©ciale 1%
    const dp2 = r.peculeVacCalc.double * (7/92);
    r.peculeVacCalc.onss2emePartie = Math.round(dp2 * 0.1307 * 100) / 100;
    r.peculeVacCalc.cotisSpec1pct = Math.round(dp2 * 0.01 * 100) / 100;
    // PP exceptionnel sur le double p√©cule
    const annBrutDP = (emp.monthlySalary || 0) * 12;
    if (annBrutDP <= 17280) r.peculeVacCalc.ppExcepRate = 0;
    else if (annBrutDP <= 32280) r.peculeVacCalc.ppExcepRate = 0.1917;
    else if (annBrutDP <= 43380) r.peculeVacCalc.ppExcepRate = 0.2322;
    else r.peculeVacCalc.ppExcepRate = 0.3028;
    r.peculeVacCalc.ppExcep = Math.round(r.peculeVacCalc.double * (r.peculeVacCalc.ppExcepRate || 0) * 100) / 100;
  } else {
    // Ouvrier: 15,38% du brut annuel N-1 √ó 108%
    r.peculeVacCalc.simple = Math.round(r.peculeVacCalc.brutRef * 0.0680 * 100) / 100;
    r.peculeVacCalc.double = Math.round(r.peculeVacCalc.brutRef * 0.0858 * 100) / 100;
    r.peculeVacCalc.total = Math.round(r.peculeVacCalc.brutRef * 0.1538 * 100) / 100;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  //  13√àME MOIS / PRIME DE FIN D'ANN√âE ‚Äî CALCUL PAR CP (Sprint 2)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // Source: CCT sectorielles + AR rendant les CCT obligatoires
  //
  // La prime de fin d'ann√©e n'est PAS une obligation l√©gale mais conventionnelle.
  // Son montant et ses conditions varient par commission paritaire:
  //
  // CP 200 (employ√©s): 100% du brut mensuel (convention quasi-universelle)
  // CP 124 (construction): calcul√© en % du brut √ó jours prest√©s
  // CP 302 (horeca): prime = brut mensuel √ó coefficient (Fonds social)
  // CP 330 (soins sant√©): prime = montant fixe index√© par √©chelon
  //
  r.y13Calc = {
    cp: emp.cp || '200',
    moisPaiement: 'D√©cembre',
    montant: 0,
    onss: 0,
    ppExcep: 0,
    ppExcepRate: 0,
    co√ªtEmployeur: 0,
    methode: ''
  };
  const cpNum = parseInt(emp.cp) || 200;
  if (cpNum === 124) {
    // Construction: 8,33% du brut annuel (via Fonds social)
    r.y13Calc.montant = Math.round((emp.monthlySalary || 0) * 12 * 0.0833 * 100) / 100;
    r.y13Calc.methode = 'CP 124 ‚Äî 8,33% brut annuel (Fonds social FBTP)';
  } else if (cpNum === 302) {
    // Horeca: via Fonds social ‚Äî environ 1 mois brut
    r.y13Calc.montant = emp.monthlySalary || 0;
    r.y13Calc.methode = 'CP 302 ‚Äî ¬±1 mois brut (Fonds social Horeca)';
  } else if (cpNum >= 330 && cpNum <= 332) {
    // Non-marchand sant√©/social: montant fixe index√© ‚âà 1 mois
    r.y13Calc.montant = emp.monthlySalary || 0;
    r.y13Calc.methode = 'CP 330-332 ‚Äî Montant fixe index√© (CCT sectorielle)';
  } else {
    // CP 200 et autres: 1 mois brut (convention quasi-universelle)
    r.y13Calc.montant = emp.monthlySalary || 0;
    r.y13Calc.methode = 'CP ' + cpNum + ' ‚Äî 100% brut mensuel (CCT sectorielle)';
  }
  // ONSS sur 13√®me mois: 13,07% travailleur
  r.y13Calc.onss = Math.round(r.y13Calc.montant * 0.1307 * 100) / 100;
  // PP exceptionnel (taux fixe selon r√©mun√©ration annuelle brute)
  const annBrut13 = (emp.monthlySalary || 0) * 12;
  if (annBrut13 <= 17280) r.y13Calc.ppExcepRate = 0;
  else if (annBrut13 <= 32280) r.y13Calc.ppExcepRate = 0.1917;
  else if (annBrut13 <= 43380) r.y13Calc.ppExcepRate = 0.2322;
  else r.y13Calc.ppExcepRate = 0.3028;
  r.y13Calc.ppExcep = Math.round(r.y13Calc.montant * r.y13Calc.ppExcepRate * 100) / 100;
  r.y13Calc.netEstime = Math.round((r.y13Calc.montant - r.y13Calc.onss - r.y13Calc.ppExcep) * 100) / 100;
  r.y13Calc.co√ªtEmployeur = Math.round(r.y13Calc.montant * (1 + (LEGAL.ONSS_SECTEUR[emp.cp]?.e || 0.25)) * 100) / 100;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  //  TOTALISATION
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  // Total retenues sur le net
  r.totalDed = r.onssNet + r.tax + r.css + r.mvWorker
    + r.garnish + r.advance + r.otherDed + r.ppVolontaire
    + r.atnCar + r.atnAutresTot
    + r.dpOnss + r.dpCotisSpec       // ONSS double p√©cule
    + r.pdOnss                        // ONSS p√©cule d√©part
    + r.pensionCompl                  // retenue pension compl√©mentaire
    + r.retSyndicale                  // retenue syndicale
    + r.saisieAlim                    // pension alimentaire
    + r.budgetMobCotis38;             // budget mobilit√© pilier 3

  // Net √† payer
  r.net = r.gross - r.totalDed + r.expense + r.transport
    + r.doublePecule - r.dpOnss - r.dpCotisSpec    // double p√©cule net
    + r.peculeDepart - r.pdOnss                      // p√©cule d√©part net
    + r.primeAncExoneree                              // prime anciennet√© exon√©r√©e
    + r.primeNaissance                                // prime naissance (exo)
    + r.indemTeletravail                              // indemnit√© t√©l√©travail (exo)
    + r.indemBureau                                   // frais bureau (exo)
    + r.petitChomageVal                               // petit ch√¥mage (salaire maintenu)
    + r.budgetMobPilier2                             // budget mobilit√© pilier 2 (exo)
    + r.hsBrutNetTotal;                                // HS volontaires brut=net (exo ONSS+PP)

  // ONSS employeur d√©j√† calcul√© ci-dessus (onssE, onssE_rate, onssE_note)
  r.insAT = r.gross * 0.0087;
  // Cotisation vacances annuelles ouvriers (Art. 38 Loi 29/06/1981)
  // 15,84% sur brut √ó 108% ‚Äî pay√© via ONSS, vers√© √† la Caisse de vacances
  // Inclus dans le taux ONSS sectoriel ouvrier mais √† afficher s√©par√©ment
  r.cotisVacOuv = isOuvrier ? onssBase * LEGAL.ONSS_DETAIL_2026.vacances_annuelles_ouvrier : 0;
  // Cotisation patronale pension compl√©mentaire (estimation si retenue personnelle existe)
  r.pensionComplEmpl = r.pensionCompl > 0 ? r.pensionCompl * 2 : 0; // ratio courant 2:1
  r.cotisWijninckx = (r.pensionComplEmpl + r.pensionCompl) * 12 > 32472 ? ((r.pensionComplEmpl + r.pensionCompl) * 12 - 32472) / 12 * 0.125 : 0;
  // Dispenses PP employeur (ne changent pas le net travailleur mais r√©duisent le co√ªt)
  // Art 275/1 CIR: dispense heures sup = 32,19% du PP retenu sur le sursalaire
  r.dispensePPHSup = sursalaire > 0 ? sursalaire * 0.3219 : 0;
  r.dispensePPTotal = r.dispensePPNuit + r.dispensePPHSup;
  r.costTotal = r.gross + r.onssE + r.mvEmployer + r.expense + r.transport + r.insAT + r.cotCO2
    + r.cotisVacOuv                                     // vacances ouvriers 15,84%
    + r.pensionComplEmpl + r.cotisWijninckx              // pension compl√©mentaire
    + r.doublePecule + r.peculeDepart + r.primeAnciennete + r.primeNaissance + r.primeInnovation
    + r.indemTeletravail + r.indemBureau
    + r.ecoCheques + r.cadeaux                           // √©co-ch√®ques + cadeaux
    + r.budgetMobCotis38                                 // budget mobilit√© pilier 3
    + r.veloLeasingMois                                   // leasing v√©lo
    + r.borneRechargeCo√ªt                                 // borne de recharge
    + r.carteCarburantMois                                // carte carburant
    - r.dispensePPTotal                                   // dispenses PP
    - r.redGCTotal                                        // r√©ductions groupes-cibles
    - r.allocTravail;                                     // allocation travail ONEM (d√©duit du co√ªt)
  return r;
}

// ‚îÄ‚îÄ‚îÄ XML GENERATORS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function genDimonaXML(d) {
  const niss=(d.niss||'').replace(/[\.\-\s]/g,"");
  const onss=(d.onss||'').replace(/[\.\-\s]/g,"");
  const vat=(d.vat||'').replace(/[^0-9]/g,"");
  const dimRef='DIM'+Date.now().toString(36).toUpperCase()+Math.random().toString(36).slice(2,5).toUpperCase();
  return `<?xml version="1.0" encoding="UTF-8"?>
<!-- Dimona Declaration ‚Äî ONSS / socialsecurity.be -->
<!-- Generee par: Aureus Social Pro ‚Äî Aureus IA SPRL -->
<!-- Reference: ${dimRef} -->
<Dimona xmlns="http://www.smals-mvm.be/xml/ns/systemFlux">
  <DimonaDeclaration>
    <EmployerId>
      <NLOSSRegistrationNbr>${onss}</NLOSSRegistrationNbr>
      <CompanyID>${vat}</CompanyID>
    </EmployerId>
    <Feature>
      <CreationDate>${new Date().toISOString().split('T')[0]}</CreationDate>
      <Action>${d.action}</Action>${d.action==='UPDATE'&&d.dimonaP?`
      <DimPeriodId>${d.dimonaP}</DimPeriodId>`:''}
      <Worker>
        <INSS>${niss}</INSS>
        <WorkerName>${d.last||''}</WorkerName>
        <WorkerFirstName>${d.first||''}</WorkerFirstName>
        <BirthDate>${d.birth||''}</BirthDate>
      </Worker>
      <Period>
        <StartingDate>${d.start}</StartingDate>${d.end?`
        <EndingDate>${d.end}</EndingDate>`:''}
      </Period>
      <WorkerType>${d.wtype}</WorkerType>
      <JointCommission>${d.cp||'200'}</JointCommission>${d.hours?`
      <PlannedDaysOrHours>
        <PlannedHoursNbr>${d.hours}</PlannedHoursNbr>
      </PlannedDaysOrHours>`:''}${d.action==='OUT'&&d.reason?`
      <EndingReason>${d.reason}</EndingReason>`:''}${d.wtype==='STU'?`
      <StudentData>
        <MaxHoursPerYear>600</MaxHoursPerYear>
        <SolidarityContribution>YES</SolidarityContribution>
      </StudentData>`:''}${d.wtype==='FLX'?`
      <FlexiJobData>
        <FlexiWage>YES</FlexiWage>
        <SpecialContribution28>YES</SpecialContribution28>
      </FlexiJobData>`:''}${d.wtype==='EXT'?`
      <ExtraData>
        <MaxDaysPerYear>50</MaxDaysPerYear>
        <FlatRateContribution>YES</FlatRateContribution>
      </ExtraData>`:''}
    </Feature>
    <SenderSoftware>AureusSocialPro</SenderSoftware>
    <SenderSoftwareVersion>2026.4</SenderSoftwareVersion>
  </DimonaDeclaration>
</Dimona>`;
}


function genDMFAXML(co, emps, q, y) {
  // DMFA conforme schema XSD ONSS ‚Äî socialsecurity.be/TechLib
  // Structure: FormCreation > EmployerDeclaration > WorkerRecord > OccupationRecord > ServiceRecord > RemunRecord + ContributionRecord
  const qStart=new Date(y,(q-1)*3,1);
  const qEnd=new Date(y,q*3,0);
  const fmtDt=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  const ref=`DMFAP${String(Math.floor(Math.random()*900000000)+100000000)}${String.fromCharCode(65+Math.floor(Math.random()*26))}`;
  const catEmpl=(co.cp==='330'||co.cp==='331'||co.cp==='332')?'010':'000';
  const nrONSS=(co.onss||'').replace(/[\.\-\s]/g,"")||'0000000000';
  const nrEnt=(co.vat||'').replace(/[^0-9]/g,"")||'0000000000';

  const wrs=emps.map((e,idx)=>{
    const p=calc(e,{days:65},co);
    const niss=(e.niss||'').replace(/[\.\-\s]/g,"");
    const isOuv=(e.statut==='ouvrier');
    const codeTrav=e.dmfaCode||'495';
    const baseONSS=isOuv?p.gross*3*1.08:p.gross*3;
    const wh=e.whWeek||38;
    const daysQ=Math.round((p.mvDays||22)*3);
    const hoursQ=Math.round(daysQ*(wh/5)*100)/100;
    const startD=e.startD||fmtDt(qStart);
    return `    <WorkerRecord>
      <WorkerIdentification>
        <INSS>${niss}</INSS>
        <WorkerName>${e.last||''}</WorkerName>
        <WorkerFirstName>${e.first||''}</WorkerFirstName>
      </WorkerIdentification>
      <WorkerContributionCode>${codeTrav}</WorkerContributionCode>
      <WorkerCategory>${catEmpl}</WorkerCategory>
      <OccupationRecord>
        <OccupationSequenceNbr>${idx+1}</OccupationSequenceNbr>
        <CommissionNbr>${e.cp||'200'}</CommissionNbr>
        <WorkerStatus>${isOuv?'1':'2'}</WorkerStatus>
        <MeanWorkingHoursPerWorker>${wh.toFixed(2)}</MeanWorkingHoursPerWorker>
        <MeanWorkingHoursReferPerson>38.00</MeanWorkingHoursReferPerson>
        <WorkSchedule>${e.regime==='full'?'F':'P'}</WorkSchedule>
        <OccupationStartingDate>${startD}</OccupationStartingDate>
        <OccupationEndingDate>${fmtDt(qEnd)}</OccupationEndingDate>
        <EstablishmentUnitNbr>${nrEnt}</EstablishmentUnitNbr>
        <ServiceRecord>
          <ServiceCode>001</ServiceCode>
          <ServiceNbrDays>${daysQ}</ServiceNbrDays>
          <ServiceNbrHours>${hoursQ.toFixed(2)}</ServiceNbrHours>
        </ServiceRecord>
        <RemunRecord>
          <RemunCode>001</RemunCode>
          <RemunAmount>${(p.gross*3).toFixed(2)}</RemunAmount>
          <RemunFrequency>1</RemunFrequency>
        </RemunRecord>${isOuv?`
        <RemunRecord>
          <RemunCode>010</RemunCode>
          <RemunAmount>${(p.gross*3*0.08).toFixed(2)}</RemunAmount>
          <RemunFrequency>1</RemunFrequency>
        </RemunRecord>`:''}
      </OccupationRecord>
      <ContributionWorkerRecord>
        <ContributionType>001</ContributionType>
        <ContributionBase>${baseONSS.toFixed(2)}</ContributionBase>
        <ContributionPercentage>13.07</ContributionPercentage>
        <ContributionAmount>${(baseONSS*LEGAL.ONSS_W).toFixed(2)}</ContributionAmount>
      </ContributionWorkerRecord>${p.empBonus>0?`
      <DeductionRecord>
        <DeductionType>001</DeductionType>
        <DeductionAmount>${(p.empBonus*3).toFixed(2)}</DeductionAmount>
      </DeductionRecord>`:''}
    </WorkerRecord>`;
  }).join('\n');

  const totW=emps.reduce((s,e)=>{const p=calc(e,{days:65},co);const isO=e.statut==='ouvrier';const b=isO?p.gross*3*1.08:p.gross*3;return s+b*LEGAL.ONSS_W;},0);
  const totE=emps.reduce((s,e)=>{const p=calc(e,{days:65},co);return s+p.onssE*3;},0);
  const totFFE=emps.reduce((s,e)=>{const p=calc(e,{days:65},co);return s+(p.onss_ffe||0)*3;},0);
  const totChT=emps.reduce((s,e)=>{const p=calc(e,{days:65},co);return s+(p.onss_chomTemp||0)*3;},0);
  const totAm=emps.reduce((s,e)=>{const p=calc(e,{days:65},co);return s+(p.onss_amiante||0)*3;},0);
  const totBase=emps.reduce((s,e)=>{const p=calc(e,{days:65},co);const isO=e.statut==='ouvrier';return s+(isO?p.gross*3*1.08:p.gross*3);},0);

  return `<?xml version="1.0" encoding="UTF-8"?>
<!-- DmfAOriginal ‚Äî Declaration Multifonctionnelle / Securite Sociale Belge -->
<!-- Schema conforme ONSS ‚Äî socialsecurity.be/TechLib -->
<!-- Reference: ${ref} | Trimestre: ${q}/${y} -->
<!-- Genere par: Aureus Social Pro ‚Äî Aureus IA SPRL (${AUREUS_INFO.vat}) -->
<DmfAOriginal xmlns="http://www.smals-mvm.be/xml/ns/systemFlux"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <FormCreation>
    <FormType>DMFA</FormType>
    <FormCreationDate>${fmtDt(new Date())}</FormCreationDate>
    <Reference>${ref}</Reference>
    <FormSubType>ORIGINAL</FormSubType>
    <SenderSoftware>AureusSocialPro</SenderSoftware>
    <SenderSoftwareVersion>2026.4</SenderSoftwareVersion>
    <SenderCompanyID>${nrEnt}</SenderCompanyID>
  </FormCreation>
  <EmployerDeclaration>
    <NLOSSRegistrationNbr>${nrONSS}</NLOSSRegistrationNbr>
    <CompanyID>${nrEnt}</CompanyID>
    <EmployerDenomination>${co.name||''}</EmployerDenomination>
    <LanguageCode>1</LanguageCode>
    <Quarter>${q}</Quarter>
    <Year>${y}</Year>
    <EmployerCategory>${catEmpl}</EmployerCategory>
    <NbrOfWorkers>${emps.length}</NbrOfWorkers>
${wrs}
    <GlobalContribution>
      <ContributionRecord><ContributionType>001</ContributionType><ContributionBase>${totBase.toFixed(2)}</ContributionBase><ContributionAmount>${totE.toFixed(2)}</ContributionAmount></ContributionRecord>
      <ContributionRecord><ContributionType>810</ContributionType><ContributionBase>${totBase.toFixed(2)}</ContributionBase><ContributionAmount>${totFFE.toFixed(2)}</ContributionAmount></ContributionRecord>
      <ContributionRecord><ContributionType>855</ContributionType><ContributionBase>${totBase.toFixed(2)}</ContributionBase><ContributionAmount>${totChT.toFixed(2)}</ContributionAmount></ContributionRecord>
      ${q<=3?`<ContributionRecord><ContributionType>862</ContributionType><ContributionBase>${totBase.toFixed(2)}</ContributionBase><ContributionAmount>${totAm.toFixed(2)}</ContributionAmount></ContributionRecord>`:'<!-- Fonds amiante: non du en T4 -->'}
    </GlobalContribution>
    <DeclarationTotals>
      <TotalWorkerContribution>${totW.toFixed(2)}</TotalWorkerContribution>
      <TotalEmployerContribution>${(totE+totFFE+totChT+totAm).toFixed(2)}</TotalEmployerContribution>
      <TotalContribution>${(totW+totE+totFFE+totChT+totAm).toFixed(2)}</TotalContribution>
    </DeclarationTotals>
  </EmployerDeclaration>
</DmfAOriginal>`;
}

// Genere un accuse de reception (ACRF) simule conforme ONSS
function genDMFATicket(ref,co){
  const ticket='DMFAP'+String(Math.floor(Math.random()*900000000)+100000000)+String.fromCharCode(65+Math.floor(Math.random()*26));
  const fmtDt=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  return {ticket,xml:`<?xml version="1.0" encoding="UTF-8"?>
<!-- Accuse de reception (ACRF) ‚Äî ONSS -->
<AcknowledgmentOfReceipt>
  <Ticket>${ticket}</Ticket>
  <FormType>DMFA</FormType>
  <Reference>${ref}</Reference>
  <ReceptionDate>${fmtDt(new Date())}</ReceptionDate>
  <ResultCode>1</ResultCode>
  <ResultDescription>Fichier accepte pour traitement</ResultDescription>
  <CompanyID>${(co.vat||'').replace(/[^0-9]/g,"")}</CompanyID>
  <Software>AureusSocialPro v2226.1</Software>
</AcknowledgmentOfReceipt>`};
}

// Genere une notification (DMNO) simulee conforme ONSS
function genDMFANotification(ticket,co,q,y,nW,totC,anomalies){
  const fmtDt=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  return `<?xml version="1.0" encoding="UTF-8"?>
<!-- Notification (DMNO) ‚Äî ONSS -->
<DmfANotification>
  <FormType>DMFA</FormType>
  <Ticket>${ticket}</Ticket>
  <Quarter>${q}</Quarter><Year>${y}</Year>
  <CompanyID>${(co.vat||'').replace(/[^0-9]/g,"")}</CompanyID>
  <ResultCode>${anomalies.length===0?'1':'1'}</ResultCode>
  <ResultDescription>Declaration acceptee${anomalies.length>0?' avec anomalies':''}</ResultDescription>
  <HandlingDate>${fmtDt(new Date())}</HandlingDate>
  <NbrOfWorkers>${nW}</NbrOfWorkers>
  <TotalContribution>${totC}</TotalContribution>
  ${anomalies.length>0?'<AnomalyReport>'+anomalies.map(a=>'<Anomaly><Zone>'+a.zone+'</Zone><Severity>'+a.sev+'</Severity><Desc>'+a.desc+'</Desc></Anomaly>').join('')+'</AnomalyReport>':'<AnomalyReport/>'}
</DmfANotification>`;
}

function genBelcotax(co, emp, yr, ad) {
  // Belcotax XML ‚Äî Format BelcotaxOnWeb SPF Finances
  // Ref: https://financien.belgium.be/fr/e-services/belcotaxonweb
  // 281.10 = salari√©s | 281.20 = dirigeants | 281.50 = commissions
  const statut = emp.statut === 'dirigeant' ? '20' : '10';
  return `<?xml version="1.0" encoding="UTF-8"?>
<Belcotax xmlns="urn:belcotax:${yr}">
  <Verzending>
    <Aangifte>
      <Taal>FR</Taal>
      <Aangiftetype>281.${statut}</Aangiftetype>
      <AangifteJaar>${yr}</AangifteJaar>
      <Schuldenaar>
        <KBO>${(co.bce||co.vat||'').replace(/[^0-9]/g,"")}</KBO>
        <BTWNr>${(co.vat||'').replace(/[^0-9]/g,"")}</BTWNr>
        <ONSS>${(co.onss||'').replace(/[^0-9]/g,"")}</ONSS>
        <NACECode>${co.nace||''}</NACECode>
        <Naam>${co.name}</Naam>
        <Adres>${co.addr}</Adres>
      </Schuldenaar>
      <Opgave>
        <Verkrijger>
          <INSZ>${(emp.niss||'').replace(/[\.\-\s]/g,"")}</INSZ>
          <Naam>${emp.last}</Naam>
          <Voornaam>${emp.first}</Voornaam>
          <Adres>${emp.addr||''} ${emp.zip||''} ${emp.city||''}</Adres>
          <Geboortedatum>${emp.birth||''}</Geboortedatum>
        </Verkrijger>
        <Bezoldiging>
          <Lonen>${(ad.gross||0).toFixed(2)}</Lonen>
          <RIZIV>${(ad.onss||0).toFixed(2)}</RIZIV>
          <WerkBonus>${(ad.empB||0).toFixed(2)}</WerkBonus>
          <BedrijfsVH>${(ad.tax||0).toFixed(2)}</BedrijfsVH>
          <BijzBijdrSZ>${(ad.css||0).toFixed(2)}</BijzBijdrSZ>
          <Maaltijdcheques aantal="${ad.mvC||0}">${(ad.mvE||0).toFixed(2)}</Maaltijdcheques>
          <Vervoer>${(ad.tr||0).toFixed(2)}</Vervoer>
          <VoertuigVAA>${(ad.atnCar||0).toFixed(2)}</VoertuigVAA>
          <AndereVAA>${(ad.atnAutres||0).toFixed(2)}</AndereVAA>
          <AanvullendPensioen>${(ad.pensionCompl||0).toFixed(2)}</AanvullendPensioen>
          <EigenKosten>${(ad.fraisPropres||0).toFixed(2)}</EigenKosten>
          <EcoCheques>${(ad.ecoCheques||0).toFixed(2)}</EcoCheques>
        </Bezoldiging>
        <Periode><Van>01-01-${yr}</Van><Tot>31-12-${yr}</Tot></Periode>
        <Tewerkstelling>
          <CP>${emp.cp||'200'}</CP>
          <Functie>${emp.fn||''}</Functie>
          <Regime>${emp.regime==='full'?'VT':'DT'}</Regime>
          <Uren>${emp.whWeek||38}</Uren>
        </Tewerkstelling>
      </Opgave>
    </Aangifte>
  </Verzending>
</Belcotax>`;
}

// ‚îÄ‚îÄ‚îÄ INITIAL STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const AUREUS_INFO={name:'Aureus IA SPRL',vat:'BE 1028.230.781',addr:'Saint-Gilles, Bruxelles',email:"info@aureus-ia.com",version:'v37',sprint:'Sprint 9 ‚Äî Automatisation'};
const CAR_MODELS={
'Aiways':['U5',"U6"],
'Alfa Romeo':['Giulia',"Stelvio","Tonale","Junior","Giulietta","MiTo"],
'Alpine':['A110',"A290"],
'Aston Martin':['DB12',"DBX","Vantage","DBS"],
'Audi':['A1',"A3","A4","A5","A6","A7","A8","Q2","Q3","Q4 e-tron","Q5","Q7","Q8","e-tron","e-tron GT","TT","RS3","RS4","RS5","RS6","S3","S4","S5"],
'Bentley':['Continental GT',"Flying Spur","Bentayga"],
'BMW':['S√©rie 1',"S√©rie 2","S√©rie 3","S√©rie 4","S√©rie 5","S√©rie 7","S√©rie 8","X1","X2","X3","X4","X5","X6","X7","XM","iX","iX1","iX3","i4","i5","i7","Z4","M2","M3","M4"],
'BYD':['Atto 3',"Dolphin","Seal","Tang","Han","Seal U"],
'Cadillac':['XT4',"XT5","Escalade","Lyriq"],
'Chevrolet':['Camaro',"Corvette","Tahoe"],
'Chrysler':['300',"Pacifica"],
'Citro√´n':['C3',"C3 Aircross","C4","C4 X","C5 Aircross","C5 X","Berlingo","√´-C3","√´-C4","√´-Berlingo"],
'Cupra':['Born',"Formentor","Leon","Ateca","Tavascan","Terramar"],
'Dacia':['Sandero',"Duster","Jogger","Spring","Logan"],
'Dodge':['Challenger',"Charger","Durango","RAM 1500"],
'DS':['DS 3',"DS 4","DS 7","DS 9"],
'Ferrari':['296 GTB',"Roma","Purosangue","SF90","F8","812"],
'Fiat':['500',"500X","500e","Tipo","Panda","Doblo","600e"],
'Ford':['Fiesta',"Focus","Puma","Kuga","Mustang","Mustang Mach-E","Explorer","Ranger","Transit","Transit Custom","Tourneo"],
'Genesis':['G70',"G80","GV60","GV70","GV80"],
'Honda':['Civic',"HR-V","CR-V","ZR-V","Jazz","e:Ny1","Honda e"],
'Hyundai':['i10',"i20","i30","Kona","Tucson","Santa Fe","Ioniq 5","Ioniq 6","Bayon","Staria"],
'Infiniti':['Q30',"Q50","QX50"],
'Isuzu':['D-Max'],
'Jaguar':['F-Pace',"E-Pace","I-Pace","XE","XF","F-Type"],
'Jeep':['Renegade',"Compass","Avenger","Wrangler","Grand Cherokee"],
'Kia':['Picanto',"Rio","Ceed","Sportage","Sorento","Niro","EV6","EV9","Stonic","XCeed"],
'Lamborghini':['Hurac√°n',"Urus","Revuelto"],
'Land Rover':['Defender',"Discovery","Discovery Sport","Range Rover","Range Rover Sport","Range Rover Velar","Range Rover Evoque"],
'Lexus':['UX',"NX","RX","ES","IS","LC","RZ"],
'Lotus':['Emira',"Eletre","Emeya"],
'Lynk & Co':['01',"02"],
'Maserati':['Ghibli',"Levante","Quattroporte","MC20","Grecale","GranTurismo"],
'Mazda':['Mazda2',"Mazda3","CX-3","CX-30","CX-5","CX-60","MX-5","MX-30"],
'McLaren':['720S',"Artura","GT"],
'Mercedes':['Classe A',"Classe B","Classe C","Classe E","Classe S","CLA","CLE","GLA","GLB","GLC","GLE","GLS","EQA","EQB","EQC","EQE","EQS","AMG GT","Classe G","Classe V","Vito","Sprinter"],
'MG':['ZS',"MG4","MG5","Marvel R","HS","Cyberster"],
'Mini':['Cooper',"Countryman","Clubman","Aceman"],
'Mitsubishi':['ASX',"Eclipse Cross","Outlander","Space Star","L200"],
'NIO':['ET5',"ET7","EL6","EL7","EL8"],
'Nissan':['Micra',"Juke","Qashqai","X-Trail","Leaf","Ariya","Townstar","Navara"],
'Opel':['Corsa',"Astra","Mokka","Crossland","Grandland","Combo","Vivaro","Movano"],
'Peugeot':['208',"308","408","508","2008","3008","5008","e-208","e-308","e-2008","e-3008","Rifter","Partner","Expert"],
'Polestar':['Polestar 2',"Polestar 3","Polestar 4"],
'Porsche':['911',"718 Cayman","718 Boxster","Cayenne","Macan","Panamera","Taycan"],
'Renault':['Clio',"Captur","M√©gane E-Tech","Arkana","Austral","Espace","Sc√©nic","Kangoo","Trafic","Master","Zoe","Twingo"],
'Rolls-Royce':['Ghost',"Phantom","Cullinan","Spectre"],
'Seat':['Ibiza',"Leon","Arona","Ateca","Tarraco"],
'≈†koda':['Fabia',"Scala","Octavia","Superb","Kamiq","Karoq","Kodiaq","Enyaq","Elroq"],
'Smart':['#1',"#3","Fortwo","Forfour"],
'SsangYong':['Tivoli',"Korando","Rexton","Torres"],
'Subaru':['Impreza',"XV","Outback","Forester","Solterra","BRZ"],
'Suzuki':['Swift',"Vitara","S-Cross","Jimny","Ignis","Across","Swace"],
'Tesla':['Model 3',"Model Y","Model S","Model X","Cybertruck"],
'Toyota':['Yaris',"Yaris Cross","Corolla","Camry","C-HR","RAV4","Highlander","Land Cruiser","bZ4X","Supra","GR86","Proace","Hilux","Aygo X"],
'Volkswagen':['Polo',"Golf","ID.3","ID.4","ID.5","ID.7","ID. Buzz","T-Roc","T-Cross","Tiguan","Touareg","Arteon","Passat","Caddy","Transporter","Multivan"],
'Volvo':['XC40',"XC60","XC90","C40","S60","S90","V60","V90","EX30","EX90","EM90"],
'XPeng':['G6',"G9","P7"],
};

const COMPANY={name:'',vat:'',addr:'',onss:'',bank:'',cp:'200',contact:'',email:"",phone:'',insurer:'',policyNr:'',secSoc:''};
const DPER={month:new Date().getMonth()+1,year:new Date().getFullYear(),days:22,sickG:0,holidays:0,overtimeH:0,sundayH:0,nightH:0,bonus:0,y13:0,otherDed:0,advance:0,garnish:0,ppVolontaire:0,
  // √âl√©ments fiscaux complets
  doublePecule:0,         // Double p√©cule vacances (si pay√© par employeur ‚Äî employ√©s)
  peculeDepart:0,         // P√©cule de vacances de d√©part (sortie de service)
  primeAnciennete:0,      // Prime d'anciennet√© (exo ONSS+IPP si ‚â§ plafond)
  primeNaissance:0,       // Prime de naissance/mariage (exo ONSS si ‚â§ plafond)
  primeInnovation:0,      // Prime d'innovation (Art. 38 ¬ß1er 25¬∞ CIR ‚Äî exo IPP max 1 mois)
  indemTeletravail:0,     // Indemnit√© forfaitaire t√©l√©travail (max 154,74‚Ç¨/mois 2026)
  indemBureau:0,          // Indemnit√© frais de bureau (si pas forfaitaire)
  pensionCompl:0,         // Retenue personnelle pension compl√©mentaire (2√® pilier ‚Äî assur. groupe)
  retSyndicale:0,         // Retenue cotisation syndicale
  saisieAlim:0,           // Pension alimentaire (saisie prioritaire)
  heuresSupFisc:0,        // Heures sup ouvrant droit √† r√©duction PP (max 180h/an ‚Äî Art.154bis CIR ‚Äî 2026)
  // Heures sup volontaires brut=net (nouveau r√©gime 01/04/2026)
  hsVolontBrutNet:0,      // HS volontaires brut=net (max 240h/an ‚Äî 360h horeca) ‚Äî exo ONSS + PP + sursalaire
  hsRelance:0,            // HS relance transitoire T1/2026 (max 120h) ‚Äî brut=net aussi
  typeSpecial:"normal",   // normal, doublePecule, y13, depart, preavis
  // Activation ONEM
  allocTravail:0,         // Allocation de travail ONEM (Activa/Impulsion ‚Äî d√©duit du net par l'employeur)
  allocTravailType:'none', // none, activa_bxl, activa_jeune, impulsion_wal, impulsion55, vdab
  // Mi-temps m√©dical / Reprise progressive
  miTempsMed:false,       // Reprise partielle du travail (Art. 100¬ß2 Loi coord. 14/07/1994)
  miTempsHeures:0,        // Heures/semaine prest√©es chez employeur (ex: 19h sur 38h)
  miTempsINAMI:0,         // Compl√©ment INAMI per√ßu par le travailleur (indemnit√©s mutuelle)
};

// ‚îÄ‚îÄ‚îÄ PERSISTENCE ‚Äî Supabase-first with localStorage fallback ‚îÄ‚îÄ‚îÄ
const STORE_KEY='aureus-social-pro';
// Supabase persistence helpers
async function saveToSupabase(supabase, userId, data) {
  if (!supabase || !userId) return false;
  try {
    const { error } = await supabase.from('app_state').upsert({
      user_id: userId,
      state_key: 'main',
      state_data: data,
      updated_at: new Date().toISOString()
    }, { onConflict: 'user_id,state_key' });
    return !error;
  } catch(e) { console.warn('Supabase save failed, using localStorage:', e); return false; }
}
async function loadFromSupabase(supabase, userId) {
  if (!supabase || !userId) return null;
  try {
    const { data, error } = await supabase.from('app_state')
      .select('state_data').eq('user_id', userId).eq('state_key', 'main').maybeSingle();
    if (error || !data) return null;
    return data.state_data;
  } catch(e) { return null; }
}
// Combined save: Supabase + localStorage backup
let _supabaseRef = null;
let _userIdRef = null;
let _saveTimer = null;
function setSupabaseRefs(sb, uid) { _supabaseRef = sb; _userIdRef = uid; }
async function saveData(data){
  try{
    if (typeof window === 'undefined') return;
    // Debounce: cancel previous save, wait 500ms
    if(_saveTimer)clearTimeout(_saveTimer);
    _saveTimer=setTimeout(()=>{
      try { localStorage.setItem(STORE_KEY, JSON.stringify(data)); } catch(e) { console.warn("localStorage error:", e); }
      if (_supabaseRef && _userIdRef) {
        saveToSupabase(_supabaseRef, _userIdRef, data).catch(()=>{});
      }
    },500);
  }catch(e){console.warn('Save failed',e);}
}
async function loadData(supabase, userId){
  try{
    if (typeof window === 'undefined') return null;
    // Try Supabase first
    if (supabase && userId) {
      const sbData = await loadFromSupabase(supabase, userId);
      if (sbData && sbData.clients && sbData.clients.length > 0) {
        // Sync to localStorage
        try { localStorage.setItem(STORE_KEY, JSON.stringify(sbData)); } catch(e){}
        return sbData;
      }
    }
    // Fallback to localStorage
    const val = localStorage.getItem(STORE_KEY);
    if (!val) return null;
    return JSON.parse(val);
  }catch(e){return null;}
}

function reducer(s,a){
  let ns;
  switch(a.type){
    case'NAV':if(a.page==='sprint10'){window.location.href='/sprint10/auth';return s;}const s9map={s9_dimona:'/sprint9/dimona',s9_precompte:'/sprint9/precompte',s9_onss:'/sprint9/onss',s9_bilan:'/sprint9/bilan-social',s9_netbrut:'/sprint9/net-brut',s9_od:'/sprint9/od-comptables',s9_cheques:'/sprint9/cheques-repas',s9_trilingue:'/sprint9/trilingue',s9_vacances:'/sprint9/vacances',s9_enfants:'/sprint9/enfants',s9_attestations:'/sprint9/attestations',s9_exports:'/sprint9/exports',s9_baremes:'/sprint9/baremes',s9_provisions:'/sprint9/provisions',s9_heures:'/sprint9/heures-sup',s9_primes:'/sprint9/primes',s9_saisies:'/sprint9/saisies'};if(s9map[a.sub]){window.location.href=s9map[a.sub];return s;}if(a.page==='sprint9'){window.location.href='/sprint9';return s;}ns={...s,page:a.page,sub:a.sub||null};break;
    case'ADD_E':ns={...s,emps:[...s.emps,{...a.d,id:"E-"+uid()}]};break;
    case'UPD_E':ns={...s,emps:s.emps.map(e=>e.id===a.d.id?a.d:e)};break;
    case'DEL_E':ns={...s,emps:s.emps.filter(e=>e.id!==a.id)};break;
    case'ADD_P':ns={...s,pays:[...s.pays,{...a.d,id:"P-"+uid()}]};break;
    case'ADD_DIM':ns={...s,dims:[...s.dims,{...a.d,id:"D-"+uid()}]};break;
    case'ADD_DMFA':ns={...s,dmfas:[...s.dmfas,{...a.d,id:"M-"+uid()}]};break;
    case'ADD_F':ns={...s,fiches:[...s.fiches,{...a.d,id:"F-"+uid()}]};break;
    case'ADD_DOC':ns={...s,docs:[...s.docs,{...a.d,id:"DC-"+uid()}]};break;
    case'UPD_CO':ns={...s,co:{...s.co,...a.d}};break;
    case'MODAL':ns={...s,modal:a.m};break;
    // Multi-soci√©t√©s
    case'ADD_CLIENT':ns={...s,clients:[...s.clients,{...a.d,id:"CL-"+uid(),createdAt:new Date().toISOString()}]};break;
    case'UPD_CLIENT':ns={...s,clients:s.clients.map(c=>c.id===a.d.id?{...c,...a.d}:c)};break;
    case'DEL_CLIENT':ns={...s,clients:s.clients.filter(c=>c.id!==a.id)};break;
    case'SELECT_CLIENT':{
      const cl=s.clients.find(c=>c.id===a.id);
      ns={...s,activeClient:a.id,co:cl?.company||COMPANY,emps:cl?.emps||[],pays:cl?.pays||[],dims:cl?.dims||[],dmfas:cl?.dmfas||[],fiches:cl?.fiches||[],docs:cl?.docs||[],page:'dashboard',sub:null};
      break;}
    case'SAVE_CLIENT_DATA':{
      const updated=s.clients.map(c=>c.id===s.activeClient?{...c,company:s.co,emps:s.emps,pays:s.pays,dims:s.dims,dmfas:s.dmfas,fiches:s.fiches,docs:s.docs,updatedAt:new Date().toISOString()}:c);
      ns={...s,clients:updated};
      // Audit trail
      (async()=>{try{const{supabase}=await import('./lib/supabase');if(supabase)await supabase.from('audit_log').insert({action:'save_client_data',table_name:'clients',details:{client_id:s.activeClient}});}catch(e){}})();
      break;}
    case'BACK_TO_CLIENTS':ns={...s,activeClient:null,page:'clients',sub:null};break;
    case'LOAD_ALL':ns={...s,...a.d};break;
    default:ns=s;
  }
  // Auto-save on every action (except NAV/MODAL)
  if(a.type!=='NAV'&&a.type!=='MODAL'&&a.type!=='LOAD_ALL'){
    // Save only the active client data + lightweight client list (not all data)
    const toSave={clients:(ns.clients||[]).map(c=>c.id===ns.activeClient?{...c,company:ns.co,emps:ns.emps,pays:ns.pays,dims:ns.dims,dmfas:ns.dmfas,fiches:ns.fiches,docs:ns.docs,updatedAt:new Date().toISOString()}:c),pin:ns.pin};
    saveData(toSave);
  }
  return ns;
}

// ‚îÄ‚îÄ‚îÄ SHARED COMPONENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const C=({children,style,...p})=><div style={{background:"linear-gradient(145deg,#0e1220,#131829)",border:'1px solid rgba(139,115,60,.12)',borderRadius:14,padding:24,...style}} {...p}>{children}</div>;
const B=({children,v='gold',onClick,style,...p})=>{
  const vs={gold:{background:"linear-gradient(135deg,#c6a34e,#a68a3c)",color:'#060810',fontWeight:600,border:'none'},outline:{background:"transparent",border:'1px solid rgba(139,115,60,.25)',color:'#c6a34e'},ghost:{background:"rgba(198,163,78,.06)",color:'#c6a34e',border:'1px solid rgba(198,163,78,.1)'},danger:{background:"rgba(248,113,113,.1)",color:'#f87171',border:'1px solid rgba(248,113,113,.2)'}};
  return <button onClick={onClick} style={{padding:'10px 20px',borderRadius:8,cursor:'pointer',fontSize:13,fontFamily:'inherit',transition:'all .15s',...(vs[v]||vs.gold),...style}} {...p}>{children}</button>;
};
const I=({label,value,onChange,type='text',options,span,style,...p})=>(
  <div style={{gridColumn:span?`span ${span}`:undefined,...style}}>
    {label&&<label style={{fontSize:10.5,fontWeight:600,color:'#9e9b93',display:'block',marginBottom:5,textTransform:'uppercase',letterSpacing:'.7px'}}>{label}</label>}
    {options?<select value={value||''} onChange={e=>onChange(e.target.value)} style={{width:'100%',padding:'9px 12px',background:"#090c16",border:'1px solid rgba(139,115,60,.15)',borderRadius:7,color:'#d4d0c8',fontSize:13,fontFamily:'inherit',cursor:'pointer',outline:'none',boxSizing:'border-box'}}>{options.map(o=><option key={o.v} value={o.v} style={{background:"#0c0f1a"}}>{o.l}</option>)}</select>
    :<input type={type} value={value||''} onChange={e=>onChange(type==='number'?(parseFloat(e.target.value)||0):e.target.value)} style={{width:'100%',padding:'9px 12px',background:"#090c16",border:'1px solid rgba(139,115,60,.15)',borderRadius:7,color:'#d4d0c8',fontSize:13,fontFamily:'inherit',outline:'none',boxSizing:'border-box'}} {...p}/>}
  </div>
);
const ST_NL={
  'Filtrer':'Filteren',"R√©sum√©":'Overzicht',"P√©riode":'Periode',"R√©mun√©ration brute":'Bruto verloning',
  'Cotisations ONSS':'RSZ-bijdragen',"Avantages exon√©r√©s":'Vrijgestelde voordelen',"D√©ductions":'Inhoudingen',
  'Net √† payer':'Netto te betalen',"Co√ªt employeur":'Werkgeverskost',"√âl√©ments fiscaux sp√©ciaux":'Speciale fiscale elementen',
  'Coordonn√©es':'Contactgegevens',"Contrat":'Contract',"R√©mun√©ration":'Verloning',"Statut":'Statuut',
  'Famille':'Gezin',"Avantages en nature":'Voordelen in natura',"Transport":'Transport',"R√©capitulatif":'Overzicht',
  'Structure':'Structuur',"Informations":'Informatie',"Actions":'Acties',"Configuration":'Configuratie',
};
const ST=({children,style})=>{
  const {lang}=useLang();
  const txt=typeof children==='string'&&lang==='nl'?(ST_NL[children]||children):children;
  return <div style={{fontSize:11.5,color:'#c6a34e',fontWeight:600,marginBottom:12,marginTop:18,textTransform:'uppercase',letterSpacing:'1.5px',...(style||{})}}>{txt}</div>;
};
const SC=({label,value,color='#c6a34e',sub})=><C style={{padding:'18px 16px'}}><div style={{fontSize:10,color:'#5e5c56',marginBottom:6,textTransform:'uppercase',letterSpacing:'1px'}}>{label}</div><div style={{fontSize:22,fontWeight:700,color}}>{value}</div>{sub&&<div style={{fontSize:10,color:'#5e5c56',marginTop:3}}>{sub}</div>}</C>;
// PH auto-translates known titles FR‚ÜíNL
const PH_NL={
  'Tableau de bord':'Dashboard',"Gestion des Employ√©s":'Personeelsbeheer',"Fiches de Paie":'Loonfiches',
  'D√©clarations Dimona':'Dimona-aangiften',"D√©claration DMFA":'DmfA-aangifte',"Fiches Fiscales 281.xx":'Fiscale fiches 281.xx',
  'Pr√©compte Professionnel 274':'Bedrijfsvoorheffing 274',"Documents Sociaux":'Sociale documenten',"Rapports":'Rapporten',
  'Frais de gestion':'Beheerskosten',"Param√®tres":'Instellingen',"Salaires & Calculs":'Lonen & Berekeningen',
  'Avantages & R√©mun√©ration':'Voordelen & Verloning',"Contrats & Documents":'Contracten & Documenten',
  'RH & Personnel':'HR & Personeel',"Social & Assurances":'Sociaal & Verzekeringen',"Reporting & Export":'Rapportage & Export',
  'Juridique & Veille':'Juridisch & Monitoring',"Modules Pro":'Pro Modules',
  'Comptes de Provision':'Voorzieningen',"Gestion des Cumuls":'Jaarlijkse cumulatie',
  'Saisies & Cessions sur salaire':'Beslag & overdracht op loon',
  'Rentes & Obligations fixes':'Renten & vaste verplichtingen',
  'Allocations Familiales':'Kinderbijslag',"Caisse de Vacances Annuelles":'Jaarlijkse vakantiekas',
  'PEPPOL e-Invoicing':'PEPPOL e-Facturatie',"Secteurs Sp√©cifiques":'Specifieke sectoren',
  'R√®glement de travail':'Arbeidsreglement',"Contrats de travail & conventions":'Arbeidsovereenkomsten & conventies',
  'Comptes individuels':'Individuele rekeningen',"Veille l√©gale & Calendrier 2026":'Juridische monitoring & Kalender 2026',
  'Bien-√™tre & Pr√©vention':'Welzijn & Preventie',"Bilan Social BNB":'Sociaal Verslag NBB',
  'Configuration soci√©t√©':'Bedrijfsconfiguratie',"Alertes l√©gales & √©ch√©ances":'Juridische waarschuwingen & deadlines',
};
const PH=({title,sub,actions})=>{
  const {lang}=useLang();
  const t2=lang==='nl'?(PH_NL[title]||title):title;
  return <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:26}}><div><h1 style={{fontFamily:"'Cormorant Garamond',Georgia,serif",fontSize:26,fontWeight:600,color:'#e8e6e0',margin:0}}>{t2}</h1>{sub&&<p style={{color:'#5e5c56',marginTop:4,fontSize:13}}>{sub}</p>}</div>{actions&&<div style={{display:'flex',gap:10}}>{actions}</div>}</div>;
};

function Tbl({cols,data,onRow}){return(
  <div style={{overflowX:'auto'}}>
    <table style={{width:'100%',borderCollapse:'collapse'}}>
      <thead><tr style={{borderBottom:'1px solid rgba(139,115,60,.15)'}}>
        {cols.map(c=><th key={c.k} style={{textAlign:c.a||'left',padding:'11px 14px',fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'1px',fontWeight:600}}>{c.l}</th>)}
      </tr></thead>
      <tbody>{data.map((row,i)=>(
        <tr key={i} onClick={()=>onRow?.(row)} style={{borderBottom:'1px solid rgba(255,255,255,.03)',cursor:onRow?'pointer':'default'}}
          onMouseEnter={e=>e.currentTarget.style.background='rgba(198,163,78,.03)'}
          onMouseLeave={e=>e.currentTarget.style.background='transparent'}>
          {cols.map(c=><td key={c.k} style={{padding:'10px 14px',fontSize:12.5,color:c.c||'#d4d0c8',fontWeight:c.b?600:400,textAlign:c.a||'left'}}>{c.r?c.r(row):row[c.k]}</td>)}
        </tr>
      ))}</tbody>
    </table>
    {data.length===0&&<div style={{textAlign:'center',padding:36,color:'#5e5c56',fontSize:13}}>Aucune donn√©e</div>}
  </div>
);}

// Simple table helper (rows-based, used by ATN, ChomTemp, CongeEduc, Outplacement, PAA)
function TB({cols,rows}){return(
  <div style={{overflowX:'auto'}}>
    <table style={{width:'100%',borderCollapse:'collapse'}}>
      <thead><tr style={{borderBottom:'1px solid rgba(139,115,60,.15)'}}>
        {cols.map(c=><th key={c.k} style={{textAlign:'left',padding:'10px 14px',fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'1px',fontWeight:600}}>{c.l}</th>)}
      </tr></thead>
      <tbody>{(rows||[]).map((r,i)=><tr key={i} style={{borderBottom:'1px solid rgba(255,255,255,.03)'}}>
        {cols.map(c=><td key={c.k} style={{padding:'9px 14px',fontSize:12,color:'#d4d0c8'}}>{r[c.k]||'‚Äî'}</td>)}</tr>)}</tbody>
    </table>
    {(!rows||rows.length===0)&&<div style={{textAlign:'center',padding:36,color:'#5e5c56',fontSize:13}}>Aucune donn√©e</div>}
  </div>
);}

// ‚îÄ‚îÄ‚îÄ LOGIN PAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function LoginPage({onLogin}){
  const [pin,setPin]=useState('');
  const [newPin,setNewPin]=useState('');
  const [confirm,setConfirm]=useState('');
  const [mode,setMode]=useState('check'); // check | create
  const [error,setError]=useState('');
  const [saved,setSaved]=useState(null);
  const [ready,setReady]=useState(false);

  useEffect(()=>{
    loadData().then(data=>{
      setSaved(data);
      if(!data||!data.pin)setMode('create');
      setReady(true);
    });
  },[]);

  const handleLogin=()=>{
    if(mode==='create'){
      if(newPin.length<4){setError('Minimum 4 chiffres');return;}
      if(newPin!==confirm){setError('Les codes ne correspondent pas');return;}
      onLogin(newPin);
    } else {
      if(pin===saved?.pin){onLogin(pin);}
      else{setError('Code incorrect');setPin('');}
    }
  };

  return(
    <div style={{minHeight:'100vh',background:"linear-gradient(135deg,#060810 0%,#0a0e1a 40%,#0e1225 100%)",display:'flex',alignItems:'center',justifyContent:'center',fontFamily:`'Outfit','DM Sans',system-ui,sans-serif`}}>
      <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Cormorant+Garamond:wght@500;600;700&display=swap" rel="stylesheet"/>
      <div style={{width:420,textAlign:'center'}}>
        {/* Logo */}
        <div style={{marginBottom:40}}>
          <div style={{width:80,height:80,margin:'0 auto 20px',borderRadius:20,background:"linear-gradient(135deg,#c6a34e,#e2c878)",display:'flex',alignItems:'center',justifyContent:'center',boxShadow:'0 8px 32px rgba(198,163,78,.3)'}}>
            <span style={{fontSize:36,fontWeight:800,color:'#060810'}}>A</span>
          </div>
          <div style={{fontFamily:"'Cormorant Garamond',Georgia,serif",fontSize:32,fontWeight:700,background:"linear-gradient(135deg,#c6a34e,#e2c878,#c6a34e)",WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'}}>AUREUS SOCIAL PRO</div>
          <div style={{fontSize:10,color:'#8b7340',marginTop:6,letterSpacing:'4px',textTransform:'uppercase'}}>Logiciel de Gestion de la Paie</div>
        </div>

        {/* Login Card */}
        <div style={{background:"linear-gradient(145deg,#0e1220,#131829)",border:'1px solid rgba(139,115,60,.15)',borderRadius:18,padding:'36px 32px',boxShadow:'0 16px 48px rgba(0,0,0,.4)'}}>
          <div style={{fontSize:16,fontWeight:600,color:'#e8e6e0',marginBottom:20}}>{mode==='create'?"Cr√©er votre code d'acc√®s":'Connexion'}</div>
          
          {mode==='create'?<>
            <input type="password" placeholder="Nouveau code (min 4 chiffres)" value={newPin} onChange={e=>setNewPin(e.target.value.replace(/[^0-9]/g,""))} maxLength={8}
              style={{width:'100%',padding:'14px 16px',background:"#090c16",border:'1px solid rgba(139,115,60,.2)',borderRadius:10,color:'#e8e6e0',fontSize:20,fontFamily:'inherit',outline:'none',textAlign:'center',letterSpacing:12,boxSizing:'border-box',marginBottom:12}}/>
            <input type="password" placeholder="Confirmer le code" value={confirm} onChange={e=>setConfirm(e.target.value.replace(/[^0-9]/g,""))} maxLength={8}
              style={{width:'100%',padding:'14px 16px',background:"#090c16",border:'1px solid rgba(139,115,60,.2)',borderRadius:10,color:'#e8e6e0',fontSize:20,fontFamily:'inherit',outline:'none',textAlign:'center',letterSpacing:12,boxSizing:'border-box'}}
              onKeyDown={e=>e.key==='Enter'&&handleLogin()}/>
          </>:<>
            <input type="password" placeholder="Code d'acc√®s" value={pin} onChange={e=>{setPin(e.target.value.replace(/[^0-9]/g,""));setError('');}} maxLength={8}
              style={{width:'100%',padding:'14px 16px',background:"#090c16",border:'1px solid rgba(139,115,60,.2)',borderRadius:10,color:'#e8e6e0',fontSize:22,fontFamily:'inherit',outline:'none',textAlign:'center',letterSpacing:14,boxSizing:'border-box'}}
              onKeyDown={e=>e.key==='Enter'&&handleLogin()} autoFocus/>
          </>}
          
          {error&&<div style={{color:'#f87171',fontSize:12,marginTop:10}}>{error}</div>}
          
          <button onClick={handleLogin} style={{width:'100%',marginTop:20,padding:'14px',background:"linear-gradient(135deg,#c6a34e,#a68a3c)",color:'#060810',fontWeight:700,fontSize:14,border:'none',borderRadius:10,cursor:'pointer',fontFamily:'inherit',letterSpacing:1}}>
            {mode==='create'?'Cr√©er & Entrer':'Acc√©der'}
          </button>
        </div>

        {/* Footer */}
        <div style={{marginTop:36,color:'#5e5c56',fontSize:11,lineHeight:1.8}}>
          <div style={{fontWeight:600,color:'#8b7340'}}>{AUREUS_INFO.name}</div>
          <div>{AUREUS_INFO.addr}</div>
          <div>TVA: {AUREUS_INFO.vat}</div>
          <div>{AUREUS_INFO.email}</div>
          <div style={{marginTop:10,fontSize:9.5,color:'#3a3930'}}>¬© {new Date().getFullYear()} Aureus IA ‚Äî Tous droits r√©serv√©s</div>
        </div>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ CLIENT SELECTION PAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// Wizard data: activities ‚Üí CP mapping + bar√®mes
const ACTIVITIES={
  medical:{l:"üè• M√©dical / Sant√©",types:[
    {v:"hopital",l:"H√¥pital / Clinique",cp:'330',emps:[{fn:"M√©decin",bar:5609.78},{fn:"Infirmier(√®re)",bar:2682.04},{fn:"Aide-soignant(e)",bar:2463.41},{fn:"Kin√©sith√©rapeute",bar:2682.04},{fn:"Secr√©taire m√©dicale",bar:2463.41},{fn:"Technicien(ne) labo",bar:2682.04},{fn:"Agent d\'entretien",bar:2254.03}]},
    {v:"cabinet",l:"Cabinet m√©dical / Param√©dical",cp:'200',emps:[{fn:"Secr√©taire m√©dicale",bar:2463.41},{fn:"Assistant(e) administratif",bar:2336.26},{fn:"Infirmier(√®re)",bar:2682.04},{fn:"Comptable",bar:2728.35}]},
    {v:"pharmacie",l:"Pharmacie",cp:'313',emps:[{fn:"Pharmacien(ne) adjoint",bar:3478.22},{fn:"Pr√©parateur(trice)",bar:2517.84},{fn:"Vendeur(se)",bar:2224.61}]},
    {v:"maison_repos",l:"Maison de repos (MR/MRS)",cp:'330',emps:[{fn:"Infirmier(√®re)",bar:2682.04},{fn:"Aide-soignant(e)",bar:2463.41},{fn:"Kin√©sith√©rapeute",bar:2682.04},{fn:"Ergoth√©rapeute",bar:2682.04},{fn:"Agent h√¥telier",bar:2254.03},{fn:"Cuisinier(√®re)",bar:2371.89}]},
    {v:"dentiste",l:"Cabinet dentaire",cp:'200',emps:[{fn:"Assistant(e) dentaire",bar:2336.26},{fn:"Secr√©taire",bar:2242.80},{fn:"Hygi√©niste dentaire",bar:2728.35}]},
  ]},
  construction:{l:"üèóÔ∏è Construction / B√¢timent",types:[
    {v:"gros_oeuvre",l:"Gros ≈ìuvre",cp:'124',emps:[{fn:"Ma√ßon (Cat.III)",bar:3409.58},{fn:"Coffreur (Cat.III)",bar:3409.58},{fn:"Ferrailleur (Cat.II)",bar:3205.42},{fn:"Grutier (Cat.IV)",bar:3619.21},{fn:"Chef de chantier (Chef IV)",bar:3981.58},{fn:"Man≈ìuvre (Cat.I)",bar:3006.56}]},
    {v:"electricite",l:"√âlectricit√©",cp:'149',emps:[{fn:"√âlectricien",bar:2916.30},{fn:"Chef d\'√©quipe",bar:3292.14},{fn:"Apprenti",bar:1850.40}]},
    {v:"plomberie",l:"Plomberie / Chauffage",cp:'124',emps:[{fn:"Plombier (Cat.III)",bar:3409.58},{fn:"Chauffagiste (Cat.III)",bar:3409.58},{fn:"Apprenti (Cat.I)",bar:3006.56}]},
    {v:"finition",l:"Finition / Peinture",cp:'124',emps:[{fn:"Peintre (Cat.II)",bar:3205.42},{fn:"Plafonneux (Cat.IIA)",bar:3365.39},{fn:"Carreleur (Cat.III)",bar:3409.58}]},
    {v:"bureau_etude",l:"Bureau d\'√©tudes",cp:'200',emps:[{fn:"Ing√©nieur",bar:3948.61},{fn:"Dessinateur",bar:2728.35},{fn:"Secr√©taire",bar:2336.26}]},
  ]},
  horeca:{l:"üçΩÔ∏è Horeca / Restauration",types:[
    {v:"restaurant",l:"Restaurant",cp:'302',emps:[{fn:"Chef cuisinier",bar:2629.69},{fn:"Cuisinier(√®re)",bar:2519.02},{fn:"Commis de cuisine",bar:2504.53},{fn:"Serveur(se)",bar:2504.53},{fn:"Barman/Barmaid",bar:2504.53},{fn:"Plongeur(se)",bar:2504.53}]},
    {v:"hotel",l:"H√¥tel",cp:'302',emps:[{fn:"R√©ceptionniste",bar:2519.02},{fn:"Femme/Valet de chambre",bar:2504.53},{fn:"Concierge",bar:2629.69},{fn:"Chef cuisinier",bar:2629.69}]},
    {v:"cafe",l:"Caf√© / Bar",cp:'302',emps:[{fn:"Serveur(se)",bar:2504.53},{fn:"Barman/Barmaid",bar:2504.53}]},
    {v:"traiteur",l:"Traiteur / Catering",cp:'302',emps:[{fn:"Cuisinier(√®re)",bar:2519.02},{fn:"Aide cuisine",bar:2504.53},{fn:"Livreur(se)",bar:2504.53}]},
  ]},
  garage:{l:"üîß Garage / Automobile",types:[
    {v:"reparation",l:"R√©paration / Entretien v√©hicules",cp:'112',emps:[{fn:"M√©canicien Cat.B",bar:2580.00},{fn:"M√©canicien sp√©cialis√© Cat.C",bar:2750.00},{fn:"Chef d\'atelier Cat.D",bar:3050.00},{fn:"Aide-m√©canicien Cat.A",bar:2380.00}]},
    {v:"carrosserie",l:"Carrosserie",cp:'149.02',emps:[{fn:"Carrossier Cat.C",bar:2750.00},{fn:"Peintre auto Cat.C",bar:2750.00},{fn:"T√¥lier Cat.B",bar:2580.00},{fn:"Chef d\'atelier Cat.D",bar:3050.00}]},
    {v:"vente_auto",l:"Vente de v√©hicules",cp:'112',emps:[{fn:"Vendeur automobile",bar:2468.07},{fn:"R√©ceptionnaire",bar:2468.07},{fn:"Administratif",bar:2336.26},{fn:"Pr√©parateur v√©hicules Cat.A",bar:2380.00}]},
    {v:"pieces_auto",l:"Commerce de pi√®ces auto",cp:'112',emps:[{fn:"Magasinier pi√®ces Cat.B",bar:2580.00},{fn:"Vendeur comptoir",bar:2468.07},{fn:"Livreur",bar:2336.26}]},
    {v:"moto",l:"Motos / Cycles",cp:'112',emps:[{fn:"M√©canicien moto Cat.B",bar:2580.00},{fn:"Vendeur",bar:2468.07}]},
    {v:"pneus",l:"Centre pneus / Pneumatique",cp:'112',emps:[{fn:"Monteur pneus Cat.A",bar:2380.00},{fn:"M√©canicien Cat.B",bar:2580.00},{fn:"R√©ceptionnaire",bar:2468.07}]},
    {v:"controle_tech",l:"Contr√¥le technique",cp:'112',emps:[{fn:"Inspecteur technique Cat.C",bar:2750.00},{fn:"Administratif",bar:2336.26}]},
  ]},
  commerce:{l:"üõí Commerce / Retail",types:[
    {v:"detail",l:"Commerce de d√©tail",cp:'201',emps:[{fn:"Vendeur(se) Cat.2",bar:2053.89},{fn:"Caissier(√®re) Cat.1",bar:1997.85},{fn:"Chef de rayon Cat.4",bar:2573.25},{fn:"Magasinier Cat.3",bar:2150.44}]},
    {v:"gros",l:"Commerce de gros",cp:'226',emps:[{fn:"Commercial",bar:2728.35},{fn:"Magasinier",bar:2336.26},{fn:"Administratif",bar:2336.26},{fn:"Chauffeur-livreur",bar:2468.07}]},
    {v:"ecommerce",l:"E-commerce",cp:'200',emps:[{fn:"Web developer",bar:2728.35},{fn:"Marketing digital",bar:2468.07},{fn:"Pr√©parateur commandes",bar:2242.80},{fn:"Service client",bar:2242.80}]},
  ]},
  bureau:{l:"üè¢ Services / Bureau",types:[
    {v:"comptable",l:"Fiduciaire / Comptabilit√©",cp:'200',emps:[{fn:"Comptable senior",bar:2728.35},{fn:"Comptable junior",bar:2336.26},{fn:"Aide-comptable",bar:2242.80},{fn:"Secr√©taire",bar:2242.80}]},
    {v:"avocat",l:"Cabinet d\'avocats",cp:'200',emps:[{fn:"Avocat collaborateur",bar:2728.35},{fn:"Juriste",bar:2728.35},{fn:"Secr√©taire juridique",bar:2336.26},{fn:"Paralegal",bar:2468.07}]},
    {v:"it",l:"IT / Digital",cp:'200',emps:[{fn:"D√©veloppeur senior",bar:2728.35},{fn:"D√©veloppeur junior",bar:2468.07},{fn:"Project manager",bar:2728.35},{fn:"UX Designer",bar:2468.07},{fn:"Sysadmin",bar:2468.07}]},
    {v:"rh",l:"Ressources Humaines / Int√©rim",cp:'200',emps:[{fn:"Consultant RH",bar:2728.35},{fn:"Recruteur",bar:2468.07},{fn:"Administratif",bar:2336.26}]},
    {v:"immobilier",l:"Immobilier",cp:'323',emps:[{fn:"Agent immobilier",bar:2632.95},{fn:"Gestionnaire syndic",bar:2805.17},{fn:"Secr√©taire",bar:2337.59}]},
    {v:"assurance",l:"Courtage assurances",cp:'307',emps:[{fn:"Courtier",bar:3194.97},{fn:"Gestionnaire sinistres",bar:2636.80},{fn:"Administratif",bar:2317.18}]},
  ]},
  transport:{l:"üöõ Transport / Logistique",types:[
    {v:"routier",l:"Transport routier",cp:'140',emps:[{fn:"Chauffeur CE",bar:2603.02},{fn:"Chauffeur C",bar:2543.95},{fn:"Dispatcher",bar:2766.65},{fn:"M√©canicien",bar:3074.05}]},
    {v:"demenagement",l:"D√©m√©nagement",cp:'140',emps:[{fn:"D√©m√©nageur",bar:2457.71},{fn:"Chauffeur",bar:2603.02},{fn:"Chef d\'√©quipe",bar:2766.65}]},
    {v:"logistique",l:"Entrep√¥t / Logistique",cp:'226',emps:[{fn:"Magasinier",bar:2336.26},{fn:"Cariste",bar:2468.07},{fn:"Chef d\'entrep√¥t",bar:2993.28},{fn:"Pr√©parateur",bar:2242.80}]},
  ]},
  nettoyage:{l:"üßπ Nettoyage / Titres-services",types:[
    {v:"entreprise",l:"Nettoyage industriel/bureau",cp:'121',emps:[{fn:"Agent d\'entretien",bar:2696.49},{fn:"Chef d\'√©quipe",bar:2966.13},{fn:"Responsable site",bar:3611.59}]},
    {v:"titres_services",l:"Titres-services",cp:'322.01',emps:[{fn:"Aide-m√©nager(√®re)",bar:2131.47},{fn:"Repasseur(se)",bar:2131.47}]},
  ]},
  industrie:{l:"üè≠ Industrie / Production",types:[
    {v:"alimentaire",l:"Industrie alimentaire",cp:'118',emps:[{fn:"Ouvrier production",bar:2896.49},{fn:"Technicien maintenance",bar:3077.62},{fn:"Chef d\'√©quipe",bar:3258.75},{fn:"Contr√¥leur qualit√©",bar:3077.62}]},
    {v:"metallurgie",l:"M√©tallurgie",cp:'111',emps:[{fn:"Soudeur Cat.3",bar:2793.90},{fn:"Tourneur-fraiseur Cat.4",bar:2915.51},{fn:"Monteur Cat.2",bar:2704.10},{fn:"Ing√©nieur (CP 209)",bar:3948.61}]},
    {v:"chimie",l:"Chimie / Pharma",cp:'116',emps:[{fn:"Op√©rateur de production",bar:2653.84},{fn:"Laborantin",bar:2892.12},{fn:"Technicien QC",bar:3122.70},{fn:"Ing√©nieur process",bar:4178.93}]},
  ]},
  asbl:{l:"ü§ù ASBL / Non-marchand",types:[
    {v:"sociale",l:"Action sociale",cp:'332',emps:[{fn:"√âducateur(trice) Cat.3",bar:2666.59},{fn:"Assistant(e) social(e) Cat.4",bar:2943.54},{fn:"Coordinateur(trice) Cat.5",bar:3250.21},{fn:"Administratif Cat.1",bar:2297.43}]},
    {v:"culturelle",l:"Culture / √âv√©nementiel",cp:'329',emps:[{fn:"Animateur(trice) Bar.2",bar:2441.08},{fn:"R√©gisseur(se) Bar.3",bar:2634.50},{fn:"Charg√©(e) de comm. Bar.3",bar:2634.50}]},
    {v:"enseignement",l:"Enseignement priv√©",cp:'225',emps:[{fn:"Enseignant(e)",bar:2892.12},{fn:"Secr√©taire",bar:2317.78},{fn:"√âducateur(trice)",bar:2448.51}]},
  ]},
  agriculture:{l:"üåæ Agriculture / Horticulture",types:[
    {v:"culture",l:"Exploitation agricole",cp:'144',emps:[{fn:"Ouvrier agricole Cat.2",bar:2468.07},{fn:"Chef de culture",bar:2850.00},{fn:"Saisonnier",bar:2254.03}]},
    {v:"horticulture",l:"Horticulture / P√©pini√®re",cp:'145',emps:[{fn:"Ouvrier horticole",bar:2371.89},{fn:"Chef de serre",bar:2728.35},{fn:"Fleuriste",bar:2242.80}]},
    {v:"elevage",l:"√âlevage",cp:'144',emps:[{fn:"Ouvrier agricole",bar:2468.07},{fn:"Responsable exploitation",bar:2850.00}]},
    {v:"maraichage",l:"Mara√Æchage / Bio",cp:'145',emps:[{fn:"Mara√Æcher",bar:2371.89},{fn:"Pr√©parateur commandes",bar:2242.80}]},
  ]},
  banque:{l:"üè¶ Banque / Finance / Assurance",types:[
    {v:"banque",l:"Banque / √âtablissement de cr√©dit",cp:'310',emps:[{fn:"Conseiller client√®le",bar:2993.28},{fn:"Analyste cr√©dit",bar:3248.00},{fn:"Caissier(√®re)",bar:2468.07},{fn:"Directeur agence",bar:4200.00},{fn:"Compliance officer",bar:3500.00}]},
    {v:"assurance_cie",l:"Compagnie d\'assurances",cp:'306',emps:[{fn:"Gestionnaire production",bar:2728.35},{fn:"Gestionnaire sinistres",bar:2850.00},{fn:"Actuaire",bar:3948.61},{fn:"Commercial",bar:2993.28}]},
    {v:"fintech",l:"Fintech / Services financiers",cp:'200',emps:[{fn:"D√©veloppeur",bar:2993.28},{fn:"Product manager",bar:3248.00},{fn:"Compliance",bar:3100.00},{fn:"Data analyst",bar:2850.00}]},
  ]},
  coiffure:{l:"üíá Coiffure / Esth√©tique / Beaut√©",types:[
    {v:"coiffure",l:"Salon de coiffure",cp:'314',emps:[{fn:"Coiffeur(se) qualifi√©(e)",bar:2280.00},{fn:"Coiffeur(se) d√©butant(e)",bar:2050.00},{fn:"Coloriste",bar:2350.00},{fn:"R√©ceptionniste",bar:2050.00}]},
    {v:"esthetique",l:"Institut de beaut√© / Spa",cp:'314',emps:[{fn:"Esth√©ticien(ne)",bar:2280.00},{fn:"Masseur(se)",bar:2350.00},{fn:"R√©ceptionniste",bar:2050.00}]},
    {v:"onglerie",l:"Onglerie / Manucure",cp:'314',emps:[{fn:"Proth√©siste ongulaire",bar:2280.00},{fn:"Manucure",bar:2150.00}]},
  ]},
  securite:{l:"üõ° Gardiennage / S√©curit√©",types:[
    {v:"gardiennage",l:"Gardiennage / Surveillance",cp:'317',emps:[{fn:"Agent de gardiennage Cat.A",bar:2450.00},{fn:"Agent de gardiennage Cat.B",bar:2600.00},{fn:"Chef d\'√©quipe Cat.C",bar:2850.00},{fn:"Dispatcher",bar:2728.35}]},
    {v:"securite_even",l:"S√©curit√© √©v√©nementielle",cp:'317',emps:[{fn:"Agent √©v√©nementiel",bar:2450.00},{fn:"Chef de poste",bar:2728.35}]},
    {v:"alarmes",l:"Syst√®mes d\'alarme / Vid√©o",cp:'149',emps:[{fn:"Technicien installateur",bar:2750.00},{fn:"Commercial",bar:2468.07}]},
  ]},
  interim:{l:"üë• Int√©rim / Recrutement",types:[
    {v:"interim",l:"Agence int√©rim",cp:'322',emps:[{fn:"Consultant int√©rim",bar:2728.35},{fn:"Branch manager",bar:3248.00},{fn:"Recruteur",bar:2468.07},{fn:"Administratif paie",bar:2336.26}]},
    {v:"recrutement",l:"Cabinet de recrutement / Headhunting",cp:'200',emps:[{fn:"Consultant senior",bar:3248.00},{fn:"Researcher",bar:2468.07},{fn:"Business developer",bar:2993.28}]},
    {v:"outplacement",l:"Outplacement / Coaching",cp:'200',emps:[{fn:"Coach outplacement",bar:2993.28},{fn:"Consultant carri√®re",bar:2728.35}]},
  ]},
  sport:{l:"‚öΩ Sport / Fitness / Loisirs",types:[
    {v:"fitness",l:"Salle de fitness / Sport",cp:'223',emps:[{fn:"Coach sportif",bar:2336.26},{fn:"R√©ceptionniste",bar:2150.00},{fn:"Personal trainer",bar:2468.07},{fn:"Agent d\'entretien",bar:2050.00}]},
    {v:"club_sport",l:"Club sportif",cp:'223',emps:[{fn:"Entra√Æneur",bar:2468.07},{fn:"Moniteur(trice)",bar:2242.80},{fn:"Secr√©taire",bar:2150.00}]},
    {v:"loisirs",l:"Parc de loisirs / Attractions",cp:'333',emps:[{fn:"Animateur(trice)",bar:2242.80},{fn:"Caissier(√®re)",bar:2050.00},{fn:"Technicien",bar:2468.07}]},
  ]},
  liberal:{l:"‚öï Professions lib√©rales",types:[
    {v:"medecin_ind",l:"M√©decin / Dentiste (ind√©pendant)",cp:'336',emps:[{fn:"Assistant(e) m√©dical(e)",bar:2336.26},{fn:"Secr√©taire m√©dical(e)",bar:2242.80},{fn:"Infirmier(√®re)",bar:2682.04}]},
    {v:"architecte",l:"Cabinet d\'architecture",cp:'336',emps:[{fn:"Architecte employ√©",bar:2993.28},{fn:"Dessinateur",bar:2468.07},{fn:"Secr√©taire",bar:2242.80}]},
    {v:"veterinaire",l:"Cabinet v√©t√©rinaire",cp:'336',emps:[{fn:"Assistant(e) v√©t√©rinaire",bar:2336.26},{fn:"Secr√©taire",bar:2150.00}]},
    {v:"notaire",l:"√âtude notariale",cp:'216',emps:[{fn:"Clerc de notaire",bar:2728.35},{fn:"Notaire employ√©",bar:3500.00},{fn:"Secr√©taire",bar:2336.26}]},
  ]},
  alimentation:{l:"üõí Alimentation / Boulangerie",types:[
    {v:"boulangerie",l:"Boulangerie / P√¢tisserie",cp:'118.03',emps:[{fn:"Boulanger",bar:2580.00},{fn:"P√¢tissier",bar:2650.00},{fn:"Vendeur(se)",bar:2150.00},{fn:"Apprenti",bar:1850.00}]},
    {v:"boucherie",l:"Boucherie / Charcuterie",cp:'119',emps:[{fn:"Boucher",bar:2580.00},{fn:"Charcutier",bar:2580.00},{fn:"Vendeur(se)",bar:2150.00}]},
    {v:"supermarche",l:"Supermarch√© / √âpicerie",cp:'202',emps:[{fn:"Caissier(√®re)",bar:2053.89},{fn:"R√©assortisseur",bar:1997.85},{fn:"Chef de rayon",bar:2573.25},{fn:"Boucher (rayon)",bar:2580.00}]},
    {v:"grossiste_alim",l:"Grossiste alimentaire",cp:'119',emps:[{fn:"Pr√©parateur",bar:2242.80},{fn:"Chauffeur livreur",bar:2468.07},{fn:"Commercial",bar:2728.35}]},
  ]},
  telecom:{l:"üì° T√©l√©com / M√©dia / Communication",types:[
    {v:"telecom",l:"T√©l√©communications",cp:'218',emps:[{fn:"Technicien r√©seau",bar:2728.35},{fn:"Commercial",bar:2468.07},{fn:"Ing√©nieur t√©l√©com",bar:3500.00},{fn:"Support helpdesk",bar:2336.26}]},
    {v:"media",l:"M√©dia / Presse / √âdition",cp:'200',emps:[{fn:"Journaliste",bar:2728.35},{fn:"Graphiste",bar:2468.07},{fn:"Community manager",bar:2336.26},{fn:"R√©dacteur",bar:2468.07}]},
    {v:"publicite",l:"Agence de publicit√© / Communication",cp:'200',emps:[{fn:"Account manager",bar:2993.28},{fn:"Directeur artistique",bar:3248.00},{fn:"Copywriter",bar:2728.35},{fn:"Media planner",bar:2468.07}]},
  ]},
  energie:{l:"‚ö° √ânergie / Environnement",types:[
    {v:"electricite_prod",l:"Production / Distribution √©nergie",cp:'326',emps:[{fn:"Technicien r√©seau",bar:3100.00},{fn:"Ing√©nieur",bar:3948.61},{fn:"Releveur compteur",bar:2468.07}]},
    {v:"renouvelable",l:"√ânergie renouvelable / Panneaux solaires",cp:'149',emps:[{fn:"Installateur PV",bar:2750.00},{fn:"√âlectricien",bar:2916.30},{fn:"Commercial",bar:2468.07},{fn:"Technicien maintenance",bar:2850.00}]},
    {v:"dechets",l:"Gestion des d√©chets / Recyclage",cp:'142.04',emps:[{fn:"Chauffeur collecte",bar:2603.02},{fn:"Op√©rateur tri",bar:2371.89},{fn:"Chef d\'√©quipe",bar:2850.00}]},
  ]},
};

// ‚îÄ‚îÄ NACE ‚Üí CP MAPPING (Banque-Carrefour des Entreprises) ‚îÄ‚îÄ
// Table de correspondance codes NACE-BEL 2008 ‚Üí Commissions Paritaires
// Source: SPF ETCS + BCE + Moniteur belge
const NACE_TO_CP={
  // Construction
  '41':{l:"Construction de b√¢timents",cpOuv:"124",cpEmp:'200',nace:'41.xxx',sector:'construction'},
  '42':{l:"G√©nie civil",cpOuv:"124",cpEmp:'200',nace:'42.xxx',sector:'construction'},
  '43':{l:"Travaux sp√©cialis√©s construction",cpOuv:"124",cpEmp:'200',nace:'43.xxx',sector:'construction'},
  '43.21':{l:"Installation √©lectrique",cpOuv:"149.01",cpEmp:'200',nace:'43.21',sector:'construction'},
  // Commerce
  '45':{l:"Commerce v√©hicules automobiles",cpOuv:"112",cpEmp:'200',nace:'45.xxx',sector:'commerce'},
  '45.1':{l:"Commerce de v√©hicules automobiles",cpOuv:"112",cpEmp:'200',nace:'45.1xx',sector:'commerce'},
  '45.2':{l:"Entretien et r√©paration de v√©hicules",cpOuv:"112",cpEmp:'200',nace:'45.2xx',sector:'commerce'},
  '45.3':{l:"Commerce de pi√®ces automobiles",cpOuv:"112",cpEmp:'200',nace:'45.3xx',sector:'commerce'},
  '45.4':{l:"Commerce et r√©paration de motos",cpOuv:"112",cpEmp:'200',nace:'45.4xx',sector:'commerce'},
  '46':{l:"Commerce de gros",cpOuv:"119",cpEmp:'226',nace:'46.xxx',sector:'commerce'},
  '47':{l:"Commerce de d√©tail",cpOuv:"202",cpEmp:'201',nace:'47.xxx',sector:'commerce'},
  '47.11':{l:"Supermarch√©s / Grandes surfaces",cpOuv:"202",cpEmp:'311',nace:'47.11',sector:'commerce'},
  '47.73':{l:"Pharmacie",cpOuv:null,cpEmp:'313',nace:'47.73',sector:'medical'},
  // Horeca
  '55':{l:"H√©bergement (h√¥tels)",cpOuv:"302",cpEmp:'302',nace:'55.xxx',sector:'horeca'},
  '56':{l:"Restauration",cpOuv:"302",cpEmp:'302',nace:'56.xxx',sector:'horeca'},
  '56.10':{l:"Restaurant / Brasserie",cpOuv:"302",cpEmp:'302',nace:'56.10',sector:'horeca'},
  '56.30':{l:"D√©bit de boissons (caf√©/bar)",cpOuv:"302",cpEmp:'302',nace:'56.30',sector:'horeca'},
  // Transport
  '49':{l:"Transport terrestre",cpOuv:"140",cpEmp:'226',nace:'49.xxx',sector:'transport'},
  '49.41':{l:"Transport routier de fret",cpOuv:"140.03",cpEmp:'226',nace:'49.41',sector:'transport'},
  '50':{l:"Transport par eau",cpOuv:"139",cpEmp:'226',nace:'50.xxx',sector:'transport'},
  '52':{l:"Entreposage / Logistique",cpOuv:"140",cpEmp:'226',nace:'52.xxx',sector:'transport'},
  '53':{l:"Activit√©s de poste / Courrier",cpOuv:"140",cpEmp:'226',nace:'53.xxx',sector:'transport'},
  // Industrie alimentaire
  '10':{l:"Industries alimentaires",cpOuv:"118",cpEmp:'220',nace:'10.xxx',sector:'industrie'},
  '11':{l:"Fabrication de boissons",cpOuv:"118",cpEmp:'220',nace:'11.xxx',sector:'industrie'},
  // Industrie diverse
  '20':{l:"Industrie chimique",cpOuv:"116",cpEmp:'207',nace:'20.xxx',sector:'industrie'},
  '21':{l:"Industrie pharmaceutique",cpOuv:"116",cpEmp:'207',nace:'21.xxx',sector:'industrie'},
  '24':{l:"M√©tallurgie",cpOuv:"111.01",cpEmp:'209',nace:'24.xxx',sector:'industrie'},
  '25':{l:"Fabrication produits m√©talliques",cpOuv:"111.02",cpEmp:'209',nace:'25.xxx',sector:'industrie'},
  '22':{l:"Fabrication caoutchouc/plastique",cpOuv:"113",cpEmp:'209',nace:'22.xxx',sector:'industrie'},
  '13':{l:"Fabrication de textiles",cpOuv:"120",cpEmp:'214',nace:'13.xxx',sector:'industrie'},
  '16':{l:"Travail du bois",cpOuv:"125",cpEmp:'200',nace:'16.xxx',sector:'industrie'},
  '17':{l:"Industrie du papier",cpOuv:"129",cpEmp:'200',nace:'17.xxx',sector:'industrie'},
  '18':{l:"Imprimerie",cpOuv:"130",cpEmp:'200',nace:'18.xxx',sector:'industrie'},
  '23':{l:"Produits min√©raux non m√©talliques",cpOuv:"114",cpEmp:'200',nace:'23.xxx',sector:'industrie'},
  // Services
  '62':{l:"Programmation informatique / IT",cpOuv:null,cpEmp:'200',nace:'62.xxx',sector:'bureau'},
  '63':{l:"Services d\'information",cpOuv:null,cpEmp:'200',nace:'63.xxx',sector:'bureau'},
  '64':{l:"Services financiers (banques)",cpOuv:null,cpEmp:'310',nace:'64.xxx',sector:'bureau'},
  '65':{l:"Assurances",cpOuv:null,cpEmp:'306',nace:'65.xxx',sector:'bureau'},
  '66':{l:"Auxiliaires financiers / Courtage",cpOuv:null,cpEmp:'307',nace:'66.xxx',sector:'bureau'},
  '68':{l:"Activit√©s immobili√®res",cpOuv:null,cpEmp:'323',nace:'68.xxx',sector:'bureau'},
  '69':{l:"Activit√©s comptables / Juridiques",cpOuv:null,cpEmp:'200',nace:'69.xxx',sector:'bureau'},
  '69.10':{l:"Activit√©s juridiques (avocats)",cpOuv:null,cpEmp:'200',nace:'69.10',sector:'bureau'},
  '69.20':{l:"Comptabilit√© / Fiduciaire",cpOuv:null,cpEmp:'200',nace:'69.20',sector:'bureau'},
  '70':{l:"Conseil de gestion / Management",cpOuv:null,cpEmp:'200',nace:'70.xxx',sector:'bureau'},
  '71':{l:"Architecture / Ing√©nierie",cpOuv:null,cpEmp:'200',nace:'71.xxx',sector:'bureau'},
  '72':{l:"Recherche scientifique",cpOuv:null,cpEmp:'200',nace:'72.xxx',sector:'bureau'},
  '73':{l:"Publicit√© / √âtudes de march√©",cpOuv:null,cpEmp:'200',nace:'73.xxx',sector:'bureau'},
  '74':{l:"Autres activit√©s sp√©cialis√©es",cpOuv:null,cpEmp:'200',nace:'74.xxx',sector:'bureau'},
  '78':{l:"Activit√©s li√©es √† l\'emploi / Int√©rim",cpOuv:"322",cpEmp:'322',nace:'78.xxx',sector:'bureau'},
  '80':{l:"S√©curit√© / Gardiennage",cpOuv:"317",cpEmp:'317',nace:'80.xxx',sector:'bureau'},
  '81':{l:"Services aux b√¢timents / Nettoyage",cpOuv:"121",cpEmp:'200',nace:'81.xxx',sector:'nettoyage'},
  '81.21':{l:"Nettoyage g√©n√©ral b√¢timents",cpOuv:"121",cpEmp:'200',nace:'81.21',sector:'nettoyage'},
  '82':{l:"Services de soutien aux entreprises",cpOuv:null,cpEmp:'200',nace:'82.xxx',sector:'bureau'},
  // Sant√© / Social
  '86':{l:"Activit√©s pour la sant√© humaine",cpOuv:"330",cpEmp:'330',nace:'86.xxx',sector:'medical'},
  '86.10':{l:"H√¥pitaux",cpOuv:"330",cpEmp:'330',nace:'86.10',sector:'medical'},
  '86.21':{l:"M√©decins g√©n√©ralistes",cpOuv:null,cpEmp:'200',nace:'86.21',sector:'medical'},
  '86.23':{l:"Dentistes",cpOuv:null,cpEmp:'200',nace:'86.23',sector:'medical'},
  '87':{l:"H√©bergement m√©dico-social (MR/MRS)",cpOuv:"330",cpEmp:'330',nace:'87.xxx',sector:'medical'},
  '88':{l:"Action sociale sans h√©bergement",cpOuv:"332",cpEmp:'332',nace:'88.xxx',sector:'asbl'},
  '88.10':{l:"Aide √† domicile (titres-services)",cpOuv:"322.01",cpEmp:'322.01',nace:'88.10',sector:'nettoyage'},
  // Enseignement
  '85':{l:"Enseignement",cpOuv:null,cpEmp:'225',nace:'85.xxx',sector:'asbl'},
  // Culture / Loisirs
  '90':{l:"Activit√©s cr√©atives / Artistiques",cpOuv:"304",cpEmp:'304',nace:'90.xxx',sector:'asbl'},
  '93':{l:"Activit√©s sportives / R√©cr√©atives",cpOuv:"329",cpEmp:'329',nace:'93.xxx',sector:'asbl'},
  // Agriculture
  '01':{l:"Agriculture / Culture",cpOuv:"144",cpEmp:'200',nace:'01.xxx',sector:'industrie'},
  '02':{l:"Sylviculture",cpOuv:"146",cpEmp:'200',nace:'02.xxx',sector:'industrie'},
  '03':{l:"P√™che",cpOuv:"143",cpEmp:'200',nace:'03.xxx',sector:'industrie'},
};

// Simuler lookup BCE √† partir du n¬∞ TVA
// En production: appeler https://kbopub.economie.fgov.be/kbopub/zoeknummerform.html
// ou l'API VIES pour validation TVA + BCE API pour les donn√©es entreprise
function lookupBCE(vatNumber){
  // Normaliser le num√©ro
  const clean=vatNumber.replace(/[^0-9]/g,"");
  if(clean.length<9||clean.length>10)return null;
  const nr=clean.padStart(10,"0");
  
  // Simuler des entreprises connues pour la d√©mo
  // En production: fetch vers l'API BCE
  const DEMO_COMPANIES={
    '0419052173':{name:'Colruyt Group NV',forme:'sa',addr:'Edingensesteenweg 196, 1500 Halle',nace:['47.11'],activity:'Commerce de d√©tail alimentaire'},
    '0403171043':{name:'Delhaize Le Lion SA',forme:'sa',addr:'Rue Osseghem 53, 1080 Molenbeek',nace:['47.11'],activity:'Commerce de d√©tail alimentaire'},
    '0404616494':{name:'Solvay SA',forme:'sa',addr:'Rue de Ransbeek 310, 1120 Bruxelles',nace:['20'],activity:'Industrie chimique'},
    '0401574852':{name:'Besix SA',forme:'sa',addr:'Avenue des Communaut√©s 100, 1200 Bruxelles',nace:['41',"42"],activity:'Construction de b√¢timents et g√©nie civil'},
    '1028230781':{name:'Aureus IA SPRL',forme:'sprl',addr:'Saint-Gilles, Bruxelles',nace:['62'],activity:'Programmation informatique'},
  };
  
  if(DEMO_COMPANIES[nr])return{...DEMO_COMPANIES[nr],vat:`BE ${nr.slice(0,4)}.${nr.slice(4,7)}.${nr.slice(7)}`,bce:nr,found:true};
  
  // Pour tout autre num√©ro: retourner un template vide avec les codes NACE √† remplir
  return{name:'',forme:'sprl',addr:'',nace:[],activity:'',vat:`BE ${nr.slice(0,4)}.${nr.slice(4,7)}.${nr.slice(7)}`,bce:nr,found:false,
    message:"‚ö† Entreprise non trouv√©e dans la d√©mo. En production, les donn√©es seront r√©cup√©r√©es automatiquement via l'API BCE (KBO) et le Moniteur Belge."};
}

// D√©terminer toutes les CP applicables √† partir des codes NACE
function detectCPFromNACE(naceCodes){
  const results=[];
  const seen=new Set();
  (naceCodes||[]).forEach(code=>{
    // Chercher d'abord le code exact, puis pr√©fixes de plus en plus courts
    const clean=code.replace(/\s/g,"");
    const match=NACE_TO_CP[clean]
      ||NACE_TO_CP[clean.substring(0,5)]
      ||NACE_TO_CP[clean.substring(0,4)]
      ||NACE_TO_CP[clean.substring(0,2)];
    if(match){
      const key=`${match.cpOuv||'-'}_${match.cpEmp}`;
      if(!seen.has(key)){
        seen.add(key);
        results.push({...match,naceCode:code});
      }
    }
  });
  return results;
}

function ClientWizard({onFinish,onCancel}){
  const [step,setStep]=useState(1);
  const [bceLoading,setBceLoading]=useState(false);
  const [bceResult,setBceResult]=useState(null);
  const [cpDetected,setCpDetected]=useState([]);
  const [naceInput,setNaceInput]=useState('');
  const [data,setData]=useState({
    name:'',vat:'',onss:'',addr:'',contact:'',email:"",phone:'',forme:'sprl',
    activity:'',subType:'',naceCodes:[],cpEmploye:'200',cpOuvrier:'',
    emps:[],
  });

  // ‚îÄ‚îÄ BCE LOOKUP (API r√©elle) ‚îÄ‚îÄ
  const doLookup=async()=>{
    if(!data.vat||data.vat.replace(/[^0-9]/g,"").length<9)return;
    setBceLoading(true);
    setBceResult(null);
    try{
      const clean=data.vat.replace(/[^0-9]/g,"");
      const resp=await fetch(`/api/bce?vat=${clean}`);
      const result=await resp.json();
      setBceResult(result);
      if(result){
        const upd={...data};
        if(result.found){
          upd.name=result.name||upd.name;upd.forme=result.forme||upd.forme;upd.addr=result.addr||upd.addr;upd.vat=result.vat||upd.vat;upd.naceCodes=result.nace||[];
          if(result.email)upd.email=result.email;
          if(result.phone)upd.phone=result.phone;
        } else { upd.vat=result.vat||upd.vat; }
        const cps=detectCPFromNACE(result.nace||[]);
        setCpDetected(cps);
        if(cps.length>0){upd.cpEmploye=cps[0].cpEmp||'200';upd.cpOuvrier=cps[0].cpOuv||'';}
        setData(upd);
      }
    }catch(err){
      console.error('BCE lookup error:',err);
      // Fallback vers la recherche locale
      const result=lookupBCE(data.vat);
      setBceResult(result);
      if(result){
        const upd={...data};
        if(result.found){
          upd.name=result.name;upd.forme=result.forme;upd.addr=result.addr;upd.vat=result.vat;upd.naceCodes=result.nace||[];
        } else { upd.vat=result.vat; }
        const cps=detectCPFromNACE(result.nace||[]);
        setCpDetected(cps);
        if(cps.length>0){upd.cpEmploye=cps[0].cpEmp||'200';upd.cpOuvrier=cps[0].cpOuv||'';}
        setData(upd);
      }
    }
    setBceLoading(false);
  };

  const addNace=()=>{
    if(!naceInput)return;
    const codes=[...data.naceCodes,naceInput];
    const cps=detectCPFromNACE(codes);
    setCpDetected(cps);
    setData(d=>({...d,naceCodes:codes,cpEmploye:cps[0]?.cpEmp||d.cpEmploye,cpOuvrier:cps[0]?.cpOuv||d.cpOuvrier}));
    setNaceInput('');
  };
  const removeNace=(code)=>{
    const codes=data.naceCodes.filter(c=>c!==code);
    const cps=detectCPFromNACE(codes);
    setCpDetected(cps);
    setData(d=>({...d,naceCodes:codes}));
  };

  const formes=[{v:"sprl",l:"SRL (ex-SPRL)"},{v:"sa",l:"SA"},{v:"sc",l:"SC"},{v:"asbl",l:"ASBL"},{v:"snc",l:"SNC"},{v:"scomm",l:"SComm"},{v:"pp",l:"Personne physique"}];

  const selActivity=ACTIVITIES[data.activity];
  const selType=selActivity?.types?.find(t=>t.v===data.subType);
  const autoCP=selType?.cp||'200';
  const suggestedEmps=selType?.emps||[];

  const addEmp=(template)=>{
    // Auto-lookup bar√®me officiel
    const bar=getBareme(autoCP,template.fn,0);
    const salary=bar?bar.monthly:template.bar;
    const barInfo=bar?`CP ${autoCP} classe ${bar.classe} (${bar.classLabel||bar.classe}) ‚Äî Bar√®me SPF ${bar.indexDate}`:'Bar√®me indicatif';
    setData({...data,emps:[...data.emps,{
      id:"W-"+uid(),first:'',last:'',niss:'',birth:'',addr:'',city:'',zip:'',startD:new Date().toISOString().split('T')[0],fn:template.fn,
      monthlySalary:salary,contract:'CDI',regime:'full',whWeek:bar?.regime||38,civil:"single",depChildren:0,handiChildren:0,
      iban:'',mvT:10,mvW:1.09,mvE:8.91,expense:0,cp:autoCP,dmfaCode:'495',dimType:'OTH',commDist:0,commType:'none',commMonth:0,status:'active',dept:'',endD:'',
      baremeClasse:bar?.classe||'',baremeInfo:barInfo,anciennete:0,
    }]});
  };

  const updEmp=(id,field,val)=>{
    let newEmps=data.emps.map(e=>{
      if(e.id!==id)return e;
      const upd={...e,[field]:field==='monthlySalary'||field==='depChildren'||field==='handiChildren'||field==='commDist'||field==='anciennete'?(parseFloat(val)||0):val};
      // Auto-recalc bar√®me when anciennet√© changes
      if(field==='anciennete'){
        const bar=getBareme(autoCP,upd.fn,upd.anciennete);
        if(bar){upd.monthlySalary=bar.monthly;upd.baremeClasse=bar.classe;upd.baremeInfo=`CP ${autoCP} classe ${bar.classe} anc.${bar.ancYr}ans ‚Äî SPF ${bar.indexDate}`;}
      }
      return upd;
    });
    setData({...data,emps:newEmps});
  };

  const remEmp=(id)=>setData({...data,emps:data.emps.filter(e=>e.id!==id)});

  const finish=()=>{
    if(!data.name){alert('Raison sociale requise');return;}
    const company={name:data.name,vat:data.vat,onss:data.onss,addr:data.addr,contact:data.contact,email:data.email,phone:data.phone,cp:autoCP,cpEmploye:data.cpEmploye,cpOuvrier:data.cpOuvrier,bank:'',insurer:'',policyNr:'',secSoc:'',forme:data.forme,naceCodes:data.naceCodes};
    onFinish({company,emps:data.emps,sector:data.activity,subType:data.subType});
  };

  const stepStyle={background:"linear-gradient(145deg,#0e1220,#131829)",border:'1px solid rgba(139,115,60,.15)',borderRadius:16,padding:'28px 32px',marginBottom:20,boxShadow:'0 8px 32px rgba(0,0,0,.3)'};
  const stepBar=<div style={{display:'flex',gap:0,marginBottom:28}}>
    {[{n:1,l:"Soci√©t√©"},{n:2,l:"Activit√©"},{n:3,l:"Travailleurs"},{n:4,l:"R√©sum√©"}].map(st=>(
      <div key={st.n} onClick={()=>st.n<step&&setStep(st.n)} style={{flex:1,textAlign:'center',padding:'12px 0',cursor:st.n<step?'pointer':'default',borderBottom:`3px solid ${step>=st.n?'#c6a34e':'rgba(139,115,60,.15)'}`,transition:'all .2s'}}>
        <div style={{fontSize:10,color:step>=st.n?'#c6a34e':'#5e5c56',fontWeight:600,textTransform:'uppercase',letterSpacing:'1px'}}>{st.n}. {st.l}</div>
      </div>
    ))}
  </div>;

  return <div style={{maxWidth:900,margin:'0 auto'}}>
    {stepBar}

    {step===1&&<div style={stepStyle}>
      <div style={{fontSize:18,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>Identification de la soci√©t√©</div>
      <div style={{fontSize:12,color:'#5e5c56',marginBottom:20}}>Entrez le num√©ro de TVA pour r√©cup√©rer automatiquement les donn√©es via la BCE et le Moniteur Belge</div>
      
      {/* TVA + Bouton BCE */}
      <div style={{display:'flex',gap:10,marginBottom:16,alignItems:'flex-end'}}>
        <div style={{flex:1}}><I label="N¬∞ TVA (BE 0xxx.xxx.xxx) *" value={data.vat} onChange={v=>setData({...data,vat:v})}/></div>
        <button onClick={doLookup} disabled={bceLoading} style={{padding:'10px 20px',background:bceLoading?'rgba(198,163,78,.1)':'linear-gradient(135deg,#c6a34e,#a68a3c)',color:bceLoading?'#c6a34e':'#060810',fontWeight:700,fontSize:12,border:'none',borderRadius:8,cursor:bceLoading?'wait':'pointer',fontFamily:'inherit',whiteSpace:'nowrap',height:42}}>
          {bceLoading?'‚è≥ Recherche BCE...':'üîç Rechercher BCE / MB'}
        </button>
      </div>

      {/* R√©sultat BCE */}
      {bceResult&&<div style={{marginBottom:16,padding:14,borderRadius:10,background:bceResult.found?'rgba(74,222,128,.06)':'rgba(248,113,113,.06)',border:`1px solid ${bceResult.found?'rgba(74,222,128,.2)':'rgba(248,113,113,.2)'}`}}>
        <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:8}}>
          <span style={{fontSize:16}}>{bceResult.found?'‚úÖ':'‚ö†'}</span>
          <span style={{fontSize:13,fontWeight:600,color:bceResult.found?'#4ade80':'#fb923c'}}>{bceResult.found?'Entreprise trouv√©e dans la BCE':'Entreprise non trouv√©e'}</span>
        </div>
        {bceResult.found&&<div style={{fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div>D√©nomination: <b style={{color:'#e8e6e0'}}>{bceResult.name}</b></div>
          <div>N¬∞ entreprise: <b style={{color:'#e8e6e0'}}>{bceResult.bce}</b></div>
          <div>Activit√© BCE: <b style={{color:'#c6a34e'}}>{bceResult.activity}</b></div>
          <div>Code(s) NACE: <b style={{color:'#60a5fa'}}>{(bceResult.nace||[]).join(', ')}</b></div>
          {bceResult.formeLabel&&bceResult.formeLabel.trim()&&!bceResult.formeLabel.includes('nbsp')&&<div>Forme juridique: <b style={{color:'#e8e6e0'}}>{bceResult.formeLabel}</b></div>}
          {bceResult.addr&&<div>Adresse: <b style={{color:'#e8e6e0'}}>{bceResult.addr}</b></div>}
          {bceResult.email&&<div>Email: <b style={{color:'#60a5fa'}}>{bceResult.email}</b></div>}
          {bceResult.phone&&<div>T√©l√©phone: <b style={{color:'#e8e6e0'}}>{bceResult.phone}</b></div>}
          {bceResult.status&&<div>Statut: <b style={{color:bceResult.status.toLowerCase().includes('actif')||bceResult.status.toLowerCase().includes('actief')?'#4ade80':'#fb923c'}}>{bceResult.status}</b></div>}
        </div>}
        {!bceResult.found&&bceResult.message&&<div style={{fontSize:11,color:'#fb923c'}}>{bceResult.message}</div>}
      </div>}

      {/* Formulaire soci√©t√© (pr√©-rempli par BCE) */}
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14}}>
        <I label="Raison sociale *" value={data.name} onChange={v=>setData({...data,name:v})}/>
        <I label="Forme juridique" value={data.forme} onChange={v=>setData({...data,forme:v})} options={formes}/>
        <I label="N¬∞ ONSS" value={data.onss} onChange={v=>setData({...data,onss:v})}/>
        <I label="Adresse du si√®ge" value={data.addr} onChange={v=>setData({...data,addr:v})}/>
        <I label="Personne de contact" value={data.contact} onChange={v=>setData({...data,contact:v})}/>
        <I label="Email" value={data.email} onChange={v=>setData({...data,email:v})}/>
        <I label="T√©l√©phone" value={data.phone} onChange={v=>setData({...data,phone:v})}/>
      </div>

      {/* Section NACE + CP d√©tect√©es */}
      <div style={{marginTop:20,padding:16,background:"rgba(96,165,250,.04)",border:'1px solid rgba(96,165,250,.12)',borderRadius:12}}>
        <div style={{fontSize:13,fontWeight:600,color:'#60a5fa',marginBottom:10}}>üìã Codes NACE & Commissions Paritaires</div>
        
        {/* Codes NACE */}
        <div style={{display:'flex',flexWrap:'wrap',gap:6,marginBottom:10}}>
          {data.naceCodes.map(code=>{
            const match=NACE_TO_CP[code]||NACE_TO_CP[code.substring(0,2)];
            return <span key={code} style={{display:'inline-flex',alignItems:'center',gap:6,padding:'4px 10px',background:"rgba(96,165,250,.1)",borderRadius:6,fontSize:11,color:'#60a5fa'}}>
              <b>{code}</b> {match?`‚Äî ${match.l}`:''} <button onClick={()=>removeNace(code)} style={{background:"none",border:'none',color:'#f87171',cursor:'pointer',fontSize:12,padding:0}}>‚úï</button>
            </span>;
          })}
          {data.naceCodes.length===0&&<span style={{fontSize:11,color:'#5e5c56'}}>Aucun code NACE ‚Äî utilisez la recherche BCE ou ajoutez manuellement</span>}
        </div>
        
        {/* Ajout NACE manuel */}
        <div style={{display:'flex',gap:8,marginBottom:14}}>
          <I label="Ajouter code NACE" value={naceInput} onChange={setNaceInput} style={{flex:1}}/>
          <button onClick={addNace} style={{padding:'8px 14px',background:"rgba(96,165,250,.1)",border:'1px solid rgba(96,165,250,.2)',borderRadius:7,color:'#60a5fa',fontSize:11,cursor:'pointer',fontFamily:'inherit',whiteSpace:'nowrap',alignSelf:'flex-end',height:38}}>+ Ajouter</button>
        </div>

        {/* CP D√âTECT√âES */}
        {cpDetected.length>0?<div>
          <div style={{fontSize:12,fontWeight:600,color:'#4ade80',marginBottom:8}}>‚úÖ Commission(s) Paritaire(s) d√©tect√©e(s) automatiquement :</div>
          <table style={{width:'100%',borderCollapse:'collapse',marginBottom:10}}>
            <thead><tr style={{borderBottom:'1px solid rgba(198,163,78,.15)'}}>
              <th style={{textAlign:'left',padding:'8px 10px',fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>NACE</th>
              <th style={{textAlign:'left',padding:'8px 10px',fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>Activit√©</th>
              <th style={{textAlign:'left',padding:'8px 10px',fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>CP Employ√©s</th>
              <th style={{textAlign:'left',padding:'8px 10px',fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>CP Ouvriers</th>
            </tr></thead>
            <tbody>{cpDetected.map((cp,i)=><tr key={i} style={{borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <td style={{padding:'8px 10px',fontSize:12,color:'#60a5fa',fontWeight:600}}>{cp.naceCode}</td>
              <td style={{padding:'8px 10px',fontSize:12,color:'#e8e6e0'}}>{cp.l}</td>
              <td style={{padding:'8px 10px'}}><span style={{padding:'3px 8px',borderRadius:5,background:"rgba(74,222,128,.1)",color:'#4ade80',fontSize:11,fontWeight:600}}>CP {cp.cpEmp}</span></td>
              <td style={{padding:'8px 10px'}}>{cp.cpOuv?<span style={{padding:'3px 8px',borderRadius:5,background:"rgba(251,146,60,.1)",color:'#fb923c',fontSize:11,fontWeight:600}}>CP {cp.cpOuv}</span>:<span style={{fontSize:10,color:'#5e5c56'}}>Pas d'ouvriers</span>}</td>
            </tr>)}</tbody>
          </table>

          {/* ALERTE CP diff√©rentes ouvriers/employ√©s */}
          {cpDetected.some(cp=>cp.cpOuv&&cp.cpOuv!==cp.cpEmp)&&<div style={{padding:10,background:"rgba(251,146,60,.06)",border:'1px solid rgba(251,146,60,.2)',borderRadius:8,marginBottom:10}}>
            <div style={{fontSize:11,fontWeight:600,color:'#fb923c',marginBottom:4}}>‚ö† Attention ‚Äî CP diff√©rentes pour Employ√©s et Ouvriers !</div>
            <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.6}}>
              Ce secteur utilise des commissions paritaires diff√©rentes selon le statut du travailleur. Lors de l'encodage de vos futurs travailleurs, veillez √† bien s√©lectionner :
              {cpDetected.filter(cp=>cp.cpOuv&&cp.cpOuv!==cp.cpEmp).map((cp,i)=><div key={i} style={{marginTop:4}}>
                ‚Ä¢ <b style={{color:'#4ade80'}}>Employ√©s ‚Üí CP {cp.cpEmp}</b> ({LEGAL.CP[cp.cpEmp]||cp.cpEmp})<br/>
                ‚Ä¢ <b style={{color:'#fb923c'}}>Ouvriers ‚Üí CP {cp.cpOuv}</b> ({LEGAL.CP[cp.cpOuv]||cp.cpOuv})
              </div>)}
            </div>
          </div>}

          {/* ALERTE pas de CP ouvriers */}
          {cpDetected.every(cp=>!cp.cpOuv)&&<div style={{padding:10,background:"rgba(96,165,250,.06)",border:'1px solid rgba(96,165,250,.15)',borderRadius:8,marginBottom:10}}>
            <div style={{fontSize:11,fontWeight:600,color:'#60a5fa'}}>‚Ñπ Ce secteur n'emploie g√©n√©ralement pas d'ouvriers</div>
            <div style={{fontSize:10.5,color:'#9e9b93'}}>Les travailleurs seront encod√©s comme employ√©s en CP {cpDetected[0]?.cpEmp||'200'}. Si vous engagez des ouvriers, ajoutez le code NACE correspondant.</div>
          </div>}

          {/* S√©lection CP √† appliquer */}
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
            <I label="CP pour les employ√©s" value={data.cpEmploye} onChange={v=>setData({...data,cpEmploye:v})} options={[{v:cpDetected[0]?.cpEmp||'200',l:`CP ${cpDetected[0]?.cpEmp||'200'} ‚Äî D√©tect√©`},...Object.entries(LEGAL.CP).filter(([k])=>k!==cpDetected[0]?.cpEmp).map(([k,v])=>({v:k,l:v}))]}/>
            <I label="CP pour les ouvriers" value={data.cpOuvrier} onChange={v=>setData({...data,cpOuvrier:v})} options={[{v:"",l:"‚Äî Pas d\'ouvriers ‚Äî"},...(cpDetected[0]?.cpOuv?[{v:cpDetected[0].cpOuv,l:`CP ${cpDetected[0].cpOuv} ‚Äî D√©tect√©`}]:[]),...Object.entries(LEGAL.CP).filter(([k])=>k!==cpDetected[0]?.cpOuv).map(([k,v])=>({v:k,l:v}))]}/>
          </div>
        </div>:<div style={{padding:20,textAlign:'center',color:'#5e5c56',fontSize:12}}>
          Entrez le n¬∞ TVA et cliquez "Rechercher BCE" pour d√©tecter automatiquement les commissions paritaires, ou ajoutez un code NACE manuellement.
        </div>}
      </div>

      <div style={{display:'flex',justifyContent:'flex-end',gap:10,marginTop:20}}>
        <B v="outline" onClick={onCancel}>Annuler</B>
        <B onClick={()=>{if(!data.name){alert('Raison sociale requise');return;}setStep(2);}}>Suivant ‚Üí</B>
      </div>
    </div>}

    {step===2&&<div style={stepStyle}>
      <div style={{fontSize:18,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>Secteur d'activit√©</div>
      <div style={{fontSize:12,color:'#5e5c56',marginBottom:20}}>S√©lectionnez le secteur pour d√©terminer automatiquement la commission paritaire</div>
      
      <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10,marginBottom:20}}>
        {Object.entries(ACTIVITIES).map(([k,v])=>(
          <div key={k} onClick={()=>setData({...data,activity:k,subType:''})}
            style={{padding:'16px 14px',borderRadius:10,cursor:'pointer',textAlign:'center',border:`2px solid ${data.activity===k?'#c6a34e':'rgba(139,115,60,.12)'}`,background:data.activity===k?'rgba(198,163,78,.08)':'rgba(6,8,16,.5)',transition:'all .15s'}}
            onMouseEnter={e=>e.currentTarget.style.borderColor=data.activity===k?'#c6a34e':'rgba(198,163,78,.25)'}
            onMouseLeave={e=>e.currentTarget.style.borderColor=data.activity===k?'#c6a34e':'rgba(139,115,60,.12)'}>
            <div style={{fontSize:15,fontWeight:600,color:data.activity===k?'#c6a34e':'#9e9b93'}}>{v.l}</div>
          </div>
        ))}
      </div>

      {selActivity&&<>
        <div style={{fontSize:13,fontWeight:600,color:'#c6a34e',marginBottom:10}}>Type d'activit√© pr√©cis :</div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:8}}>
          {selActivity.types.map(t=>(
            <div key={t.v} onClick={()=>setData({...data,subType:t.v})}
              style={{padding:'12px 14px',borderRadius:8,cursor:'pointer',border:`1px solid ${data.subType===t.v?'#c6a34e':'rgba(139,115,60,.1)'}`,background:data.subType===t.v?'rgba(198,163,78,.06)':'transparent',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
              <span style={{fontSize:13,color:data.subType===t.v?'#e8e6e0':'#9e9b93'}}>{t.l}</span>
              <span style={{fontSize:10,padding:'2px 8px',borderRadius:5,background:"rgba(96,165,250,.08)",color:'#60a5fa',fontWeight:600}}>CP {t.cp}</span>
            </div>
          ))}
        </div>
      </>}

      {selType&&<div style={{marginTop:16,padding:14,background:"rgba(74,222,128,.04)",borderRadius:10,border:'1px solid rgba(74,222,128,.1)'}}>
        <div style={{fontSize:12,color:'#4ade80',fontWeight:600}}>‚úì Commission paritaire d√©tect√©e : CP {autoCP} ‚Äî {LEGAL.CP[autoCP]||autoCP}</div>
        <div style={{fontSize:11,color:'#9e9b93',marginTop:4}}>Les bar√®mes et primes sectoriels seront automatiquement appliqu√©s.</div>
      </div>}

      <div style={{display:'flex',justifyContent:'space-between',marginTop:20}}>
        <B v="outline" onClick={()=>setStep(1)}>‚Üê Retour</B>
        <B onClick={()=>{if(!data.subType){alert('S√©lectionnez un type d\'activit√©');return;}setStep(3);}}>Suivant ‚Üí</B>
      </div>
    </div>}

    {step===3&&<div style={stepStyle}>
      <div style={{fontSize:18,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>Travailleurs</div>
      <div style={{fontSize:12,color:'#5e5c56',marginBottom:16}}>Ajoutez les travailleurs ‚Äî cliquez sur un profil sugg√©r√© ou ajoutez manuellement</div>
      
      {suggestedEmps.length>0&&<div style={{marginBottom:16}}>
        <div style={{fontSize:11,color:'#c6a34e',fontWeight:600,marginBottom:8,textTransform:'uppercase',letterSpacing:'1px'}}>Profils sugg√©r√©s pour {selType?.l}</div>
        <div style={{display:'flex',flexWrap:'wrap',gap:8}}>
          {suggestedEmps.map((se,i)=>{
            const spf=getBareme(autoCP,se.fn,0);
            const displaySalary=spf?spf.monthly:se.bar;
            const isOfficial=!!spf;
            const isApprox=isOfficial&&BAREMES[autoCP]?.approx;
            return(
            <button key={i} onClick={()=>addEmp(se)} style={{padding:'8px 14px',borderRadius:8,background:"rgba(198,163,78,.06)",border:'1px solid rgba(198,163,78,.12)',color:'#c6a34e',fontSize:12,cursor:'pointer',fontFamily:'inherit',transition:'all .15s'}}
              onMouseEnter={e=>e.currentTarget.style.background='rgba(198,163,78,.12)'}
              onMouseLeave={e=>e.currentTarget.style.background='rgba(198,163,78,.06)'}>
              + {se.fn} <span style={{color:isOfficial?(isApprox?'#facc15':'#4ade80'):'#5e5c56',marginLeft:6}}>{isApprox?'‚âà':''}{fmt(displaySalary)}</span>
              {isOfficial&&!isApprox&&<span style={{fontSize:8,color:'#4ade80',marginLeft:4}}>SPF</span>}
              {isApprox&&<span style={{fontSize:8,color:'#facc15',marginLeft:4}}>‚âà</span>}
            </button>
          );})}
        </div>
      </div>}

      {data.emps.length>0&&<div style={{overflowX:'auto'}}>
        <table style={{width:'100%',borderCollapse:'collapse',marginBottom:16}}>
          <thead><tr style={{borderBottom:'1px solid rgba(139,115,60,.15)'}}>
            {['Pr√©nom',"Nom","NISS","Fonction","Anc.","Brut min.","Contrat","Situation","Enf.",""].map(h=><th key={h} style={{textAlign:'left',padding:'8px 10px',fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{h}</th>)}
          </tr></thead>
          <tbody>{data.emps.map(emp=>(
            <tr key={emp.id} style={{borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <td style={{padding:'6px 10px'}}><input value={emp.first} onChange={e=>updEmp(emp.id,"first",e.target.value)} placeholder="Pr√©nom" style={{width:90,padding:'6px 8px',background:"#090c16",border:'1px solid rgba(139,115,60,.12)',borderRadius:5,color:'#d4d0c8',fontSize:12,fontFamily:'inherit',outline:'none'}}/></td>
              <td style={{padding:'6px 10px'}}><input value={emp.last} onChange={e=>updEmp(emp.id,"last",e.target.value)} placeholder="Nom" style={{width:90,padding:'6px 8px',background:"#090c16",border:'1px solid rgba(139,115,60,.12)',borderRadius:5,color:'#d4d0c8',fontSize:12,fontFamily:'inherit',outline:'none'}}/></td>
              <td style={{padding:'6px 10px'}}><input value={emp.niss} onChange={e=>updEmp(emp.id,"niss",e.target.value)} placeholder="XX.XX.XX-XXX.XX" style={{width:110,padding:'6px 8px',background:"#090c16",border:'1px solid rgba(139,115,60,.12)',borderRadius:5,color:'#d4d0c8',fontSize:12,fontFamily:'inherit',outline:'none'}}/></td>
              <td style={{padding:'6px 10px',fontSize:12,color:'#c6a34e'}}>{emp.fn}</td>
              <td style={{padding:'6px 10px'}}><input type="number" value={emp.anciennete||0} onChange={e=>updEmp(emp.id,"anciennete",e.target.value)} min={0} max={40} style={{width:40,padding:'6px 8px',background:"#090c16",border:'1px solid rgba(139,115,60,.12)',borderRadius:5,color:'#60a5fa',fontSize:12,fontFamily:'inherit',outline:'none',textAlign:'center'}} title="Ann√©es d'anciennet√©"/></td>
              <td style={{padding:'6px 10px'}}><div style={{display:'flex',flexDirection:'column',gap:2}}><input type="number" value={emp.monthlySalary} onChange={e=>updEmp(emp.id,"monthlySalary",e.target.value)} style={{width:80,padding:'6px 8px',background:"#090c16",border:'1px solid rgba(139,115,60,.12)',borderRadius:5,color:'#4ade80',fontSize:12,fontFamily:'inherit',outline:'none',textAlign:'right'}}/>{emp.baremeInfo&&<div style={{fontSize:8,color:'#60a5fa',maxWidth:100,lineHeight:1.2}}>{emp.baremeInfo}</div>}</div></td>
              <td style={{padding:'6px 10px'}}><select value={emp.contract} onChange={e=>updEmp(emp.id,"contract",e.target.value)} style={{padding:'5px 6px',background:"#090c16",border:'1px solid rgba(139,115,60,.12)',borderRadius:5,color:'#d4d0c8',fontSize:11,fontFamily:'inherit',outline:'none'}}><option value="CDI">CDI</option><option value="CDD">CDD</option><option value="trav_det">Trav. d√©fini</option><option value="remplacement">Remplacement</option><option value="tpartiel">Temps partiel</option><option value="INTERIM">Int√©rim</option><option value="STUDENT">√âtudiant</option><option value="FLEXI">Flexi-job</option><option value="saisonnier">Saisonnier</option><option value="occas_horeca">Extra Horeca</option><option value="titre_service">Titres-services</option><option value="art60">Art.60¬ß7</option><option value="CIP">CIP</option><option value="alternance">Alternance</option><option value="CPE">1er emploi</option><option value="ETA">Travail adapt√©</option><option value="detache">D√©tach√©</option><option value="domestique">Domestique</option><option value="indep_princ">Ind√©p. princ.</option><option value="indep_compl">Ind√©p. compl.</option><option value="mandataire">Mandataire</option><option value="freelance">Freelance</option><option value="smart">Smart</option><option value="artiste">Artiste</option></select></td>
              <td style={{padding:'6px 10px'}}><select value={emp.civil} onChange={e=>updEmp(emp.id,"civil",e.target.value)} style={{padding:'5px 6px',background:"#090c16",border:'1px solid rgba(139,115,60,.12)',borderRadius:5,color:'#d4d0c8',fontSize:11,fontFamily:'inherit',outline:'none'}}><option value="single">Isol√©</option><option value="married_2">Mari√© (2 revenus)</option><option value="married_1">Mari√© (1 revenu)</option><option value="cohabit">Cohabitant l√©gal</option></select></td>
              <td style={{padding:'6px 10px'}}><input type="number" value={emp.depChildren} onChange={e=>updEmp(emp.id,"depChildren",e.target.value)} min={0} style={{width:40,padding:'6px 8px',background:"#090c16",border:'1px solid rgba(139,115,60,.12)',borderRadius:5,color:'#d4d0c8',fontSize:12,fontFamily:'inherit',outline:'none',textAlign:'center'}}/></td>
              <td style={{padding:'6px 6px'}}><button onClick={()=>remEmp(emp.id)} style={{background:"none",border:'none',color:'#f87171',cursor:'pointer',fontSize:16}}>‚úï</button></td>
            </tr>
          ))}</tbody>
        </table>
      </div>}

      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
        <div style={{fontSize:12,color:'#5e5c56'}}>{data.emps.length} travailleur{data.emps.length>1?'s':''} ajout√©{data.emps.length>1?'s':''}</div>
        <div style={{display:'flex',gap:10}}>
          <B v="outline" onClick={()=>setStep(2)}>‚Üê Retour</B>
          <B onClick={()=>setStep(4)}>Suivant ‚Üí</B>
        </div>
      </div>
    </div>}

    {step===4&&<div style={stepStyle}>
      <div style={{fontSize:18,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>R√©capitulatif du dossier</div>
      <div style={{fontSize:12,color:'#5e5c56',marginBottom:20}}>V√©rifiez les informations avant de cr√©er le dossier</div>
      
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:20}}>
        <div>
          <div style={{fontSize:11,color:'#c6a34e',fontWeight:600,textTransform:'uppercase',letterSpacing:'1px',marginBottom:10}}>Soci√©t√©</div>
          <div style={{fontSize:13,color:'#9e9b93',lineHeight:2.2}}>
            <div>Raison sociale: <b style={{color:'#e8e6e0'}}>{data.name}</b></div>
            <div>Forme: <b style={{color:'#e8e6e0'}}>{formes.find(f=>f.v===data.forme)?.l}</b></div>
            <div>TVA: <b style={{color:'#e8e6e0'}}>{data.vat||'‚Äî'}</b></div>
            <div>ONSS: <b style={{color:'#e8e6e0'}}>{data.onss||'‚Äî'}</b></div>
            <div>Contact: <b style={{color:'#e8e6e0'}}>{data.contact||'‚Äî'}</b></div>
          </div>
        </div>
        <div>
          <div style={{fontSize:11,color:'#c6a34e',fontWeight:600,textTransform:'uppercase',letterSpacing:'1px',marginBottom:10}}>Activit√©</div>
          <div style={{fontSize:13,color:'#9e9b93',lineHeight:2.2}}>
            <div>Secteur: <b style={{color:'#e8e6e0'}}>{selActivity?.l||'‚Äî'}</b></div>
            <div>Type: <b style={{color:'#e8e6e0'}}>{selType?.l||'‚Äî'}</b></div>
            <div>CP: <b style={{color:'#4ade80'}}>CP {autoCP}</b></div>
            {data.cpEmploye&&<div>CP Employ√©s: <b style={{color:'#4ade80'}}>CP {data.cpEmploye}</b></div>}
            {data.cpOuvrier&&<div>CP Ouvriers: <b style={{color:'#fb923c'}}>CP {data.cpOuvrier}</b></div>}
            {data.naceCodes.length>0&&<div>NACE: <b style={{color:'#60a5fa'}}>{data.naceCodes.join(', ')}</b></div>}
            <div>Travailleurs: <b style={{color:'#e8e6e0'}}>{data.emps.length}</b></div>
            {data.emps.length>0&&<div>Masse brute: <b style={{color:'#c6a34e'}}>{fmt(data.emps.reduce((a,e)=>a+e.monthlySalary,0))}/mois</b></div>}
          </div>
        </div>
      </div>

      {data.emps.length>0&&<div style={{marginTop:16}}>
        <div style={{fontSize:11,color:'#c6a34e',fontWeight:600,textTransform:'uppercase',letterSpacing:'1px',marginBottom:8}}>Travailleurs ({data.emps.length})</div>
        <div style={{display:'grid',gap:6}}>
          {data.emps.map(e=>(
            <div key={e.id} style={{display:'flex',justifyContent:'space-between',padding:'8px 12px',background:"rgba(198,163,78,.03)",borderRadius:6,fontSize:12,flexWrap:'wrap',gap:4}}>
              <span style={{color:'#e8e6e0'}}>{e.first||'?'} {e.last||'?'}</span>
              <span style={{color:'#9e9b93'}}>{e.fn}</span>
              <span style={{color:'#c6a34e',fontWeight:600}}>{fmt(e.monthlySalary)}</span>
              <span style={{color:'#60a5fa',fontSize:10}}>{e.baremeInfo||''}</span>
              <span style={{color:'#5e5c56'}}>{e.contract} ¬∑ {e.civil==='single'?'Isol√©':e.civil==='married_1'?'Mari√© (1 revenu)':e.civil==='married_2'?'Mari√© (2 revenus)':'Cohabitant l√©gal'} ¬∑ {e.depChildren} enf.</span>
            </div>
          ))}
        </div>
      </div>}

      {/* Avantages sectoriels */}
      {(()=>{const avs=getCPAvantages(autoCP);return avs.length>0?<div style={{marginTop:16}}>
        <div style={{fontSize:11,color:'#4ade80',fontWeight:600,textTransform:'uppercase',letterSpacing:'1px',marginBottom:8}}>Avantages sectoriels CP {autoCP}</div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:6}}>
          {avs.map((a,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'6px 10px',background:"rgba(74,222,128,.03)",borderRadius:5,fontSize:11.5}}>
            <span style={{color:'#9e9b93'}}>{a.l}</span><span style={{color:'#4ade80',fontWeight:600}}>{a.v}</span>
          </div>)}
        </div>
      </div>:null;})()}

      <div style={{display:'flex',justifyContent:'space-between',marginTop:24}}>
        <B v="outline" onClick={()=>setStep(3)}>‚Üê Retour</B>
        <B onClick={finish} style={{fontSize:15,padding:'12px 32px'}}>‚úì Cr√©er le dossier</B>
      </div>
    </div>}
  </div>;
}

function ClientsPage({s,d,user,onLogout,veilleNotif,setVeilleNotif}){
  const [showWizard,setShowWizard]=useState(false);
  const [search,setSearch]=useState('');
  
  const handleFinish=(result)=>{
    d({type:"ADD_CLIENT",d:{company:result.company,emps:result.emps,pays:[],dims:[],dmfas:[],fiches:[],docs:[],sector:result.sector,subType:result.subType}});
    setShowWizard(false);
  };
  
  const getScore=(cl)=>{
    let sc=0;if(cl.company?.name)sc++;if(cl.company?.vat)sc++;if(cl.company?.onss)sc++;
    if(cl.company?.iban)sc++;if(cl.company?.cp)sc++;if(cl.company?.accidentIns)sc++;
    if(cl.emps?.length>0){sc++;if(cl.emps.every(e=>e.niss))sc++;if(cl.emps.every(e=>e.iban))sc++;
      if(cl.emps.every(e=>e.monthlySalary>0))sc++;if(cl.emps.every(e=>e.startD))sc++;}
    if(cl.dims?.length>0)sc++;if(cl.fiches?.length>0)sc++;
    return Math.round(sc/13*100);
  };
  
  const filtered=(s.clients||[]).filter(c=>{
    if(!search)return true;
    if(search==='__bad__')return getScore(c)<60;
    if(search==='__ok__'){const sc=getScore(c);return sc>=60&&sc<80;}
    if(search==='__good__')return getScore(c)>=80;
    if(search==='__novat__')return !c.company?.vat;
    if(search==='__noonss__')return !c.company?.onss;
    const q=search.toLowerCase();
    return c.company?.name?.toLowerCase().includes(q)||c.company?.vat?.toLowerCase().includes(q)||c.company?.contact?.toLowerCase().includes(q);
  });

  const stats={total:s.clients?.length||0,emps:(s.clients||[]).reduce((a,c)=>a+(c.emps?.length||0),0)};

  return(
    <div style={{minHeight:'100vh',background:"#060810",color:'#d4d0c8',fontFamily:`'Outfit','DM Sans',system-ui,sans-serif`}}>
      <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Cormorant+Garamond:wght@500;600;700&display=swap" rel="stylesheet"/>
      
      {/* Header */}
      <div style={{background:"linear-gradient(135deg,#090c16,#0e1225)",borderBottom:'1px solid rgba(139,115,60,.12)',padding:'20px 36px',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
        <div style={{display:'flex',alignItems:'center',gap:16}}>
          <div style={{width:42,height:42,borderRadius:12,background:"linear-gradient(135deg,#c6a34e,#e2c878)",display:'flex',alignItems:'center',justifyContent:'center'}}><span style={{fontSize:20,fontWeight:800,color:'#060810'}}>A</span></div>
          <div>
            <div style={{fontFamily:"'Cormorant Garamond',Georgia,serif",fontSize:20,fontWeight:700,background:"linear-gradient(135deg,#c6a34e,#e2c878)",WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'}}>AUREUS SOCIAL PRO</div>
            <div style={{fontSize:9,color:'#8b7340',letterSpacing:'3px',textTransform:'uppercase'}}>Gestion des dossiers clients</div>
          </div>
        </div>
        <div style={{display:'flex',gap:14,alignItems:'center'}}>
          <div style={{textAlign:'right',marginRight:10}}>
            <div style={{fontSize:11,color:'#9e9b93'}}>{stats.total} dossier{stats.total>1?'s':''} ¬∑ {stats.emps} travailleur{stats.emps>1?'s':''}</div>
            {user&&<div style={{fontSize:10,color:'#5e5c56'}}>{user.email}</div>}
          </div>
          {onLogout&&<button onClick={onLogout} style={{padding:'8px 14px',background:"rgba(248,113,113,0.08)",border:'1px solid rgba(248,113,113,0.2)',borderRadius:8,color:'#fb923c',fontSize:11,cursor:'pointer',fontFamily:'inherit',fontWeight:600}}>D√©connexion</button>}
          <B onClick={()=>setShowWizard(!showWizard)}>{showWizard?'‚úï Annuler':'+ Nouveau dossier'}</B>
        </div>
      </div>

      <div style={{maxWidth:1200,margin:'0 auto',padding:'30px 36px'}}>
        {showWizard?<ClientWizard onFinish={handleFinish} onCancel={()=>setShowWizard(false)}/>:<>
        
        {/* ‚ïê‚ïê‚ïê VEILLE L√âGALE AUTO ‚ïê‚ïê‚ïê */}
        {veilleNotif&&<div style={{marginBottom:14,padding:'12px 18px',borderRadius:10,background:veilleNotif.changed?'rgba(248,113,113,.06)':'rgba(74,222,128,.06)',border:`1px solid ${veilleNotif.changed?'rgba(248,113,113,.15)':'rgba(74,222,128,.15)'}`,display:'flex',justifyContent:'space-between',alignItems:'center'}}>
          <div>
            <div style={{fontSize:12,fontWeight:600,color:veilleNotif.changed?'#f87171':'#4ade80'}}>{veilleNotif.changed?'‚ö†Ô∏è Changements d√©tect√©s':'‚úÖ Veille l√©gale ‚Äî Tout est √† jour'}</div>
            <div style={{fontSize:10.5,color:'#9e9b93',marginTop:3,maxWidth:800,lineHeight:1.5}}>{veilleNotif.text}</div>
          </div>
          <div style={{textAlign:'right',flexShrink:0}}>
            <div style={{fontSize:9,color:'#5e5c56'}}>V√©rifi√© le {veilleNotif.date}</div>
            <button onClick={()=>setVeilleNotif(null)} style={{fontSize:9,color:'#5e5c56',background:'none',border:'none',cursor:'pointer',marginTop:4}}>‚úï Fermer</button>
          </div>
        </div>}
        
        {/* ‚ïê‚ïê‚ïê GLOBAL DASHBOARD ‚Äî Vue d'ensemble 1000 clients ‚ïê‚ïê‚ïê */}
        {(s.clients||[]).length>0&&<div style={{marginBottom:24}}>
          {/* KPI Row */}
          <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:10,marginBottom:14}}>
            {[
              {l:'Dossiers',v:stats.total,c:'#c6a34e'},
              {l:'Travailleurs',v:stats.emps,c:'#60a5fa'},
              {l:'Score sant√© moyen',v:Math.round((s.clients||[]).reduce((a,cl)=>{
                let sc=0,tot=13;
                if(cl.company?.name)sc++;if(cl.company?.vat)sc++;if(cl.company?.onss)sc++;
                if(cl.company?.iban)sc++;if(cl.company?.cp)sc++;if(cl.company?.accidentIns)sc++;
                if(cl.emps?.length>0){sc++;
                  if(cl.emps.every(e=>e.niss))sc++;if(cl.emps.every(e=>e.iban))sc++;
                  if(cl.emps.every(e=>e.monthlySalary>0))sc++;if(cl.emps.every(e=>e.startD))sc++;
                }
                if(cl.dims?.length>0)sc++;if(cl.fiches?.length>0)sc++;
                return a+(sc/tot*100);
              },0)/(s.clients||[]).length||0)+'%',c:'#4ade80'},
              {l:'Dossiers √† risque',v:(s.clients||[]).filter(cl=>{
                let sc=0;if(cl.company?.name)sc++;if(cl.company?.vat)sc++;if(cl.emps?.length>0)sc++;
                if(cl.emps?.every(e=>e.niss))sc++;if(cl.emps?.every(e=>e.monthlySalary>0))sc++;
                return sc<3;
              }).length,c:'#f87171'},
              {l:'Sans TVA',v:(s.clients||[]).filter(cl=>!cl.company?.vat).length,c:'#fb923c'},
              {l:'Masse salariale',v:((s.clients||[]).reduce((a,cl)=>a+(cl.emps||[]).reduce((b,e)=>b+(e.monthlySalary||0),0),0)/1000).toFixed(0)+'K‚Ç¨',c:'#a78bfa'},
            ].map((k,i)=><div key={i} style={{background:'linear-gradient(145deg,#0e1220,#131829)',border:'1px solid rgba(139,115,60,.08)',borderRadius:10,padding:'12px 14px',textAlign:'center'}}>
              <div style={{fontSize:20,fontWeight:700,color:k.c}}>{k.v}</div>
              <div style={{fontSize:9,color:'#5e5c56',marginTop:2}}>{k.l}</div>
            </div>)}
          </div>
          
          {/* ACTIONS EN MASSE */}
          <div style={{background:'linear-gradient(145deg,#0e1220,#131829)',border:'1px solid rgba(139,115,60,.12)',borderRadius:12,padding:'16px 20px',marginBottom:14}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}}>
              <div style={{fontSize:13,fontWeight:600,color:'#c6a34e'}}>‚ö° Actions en masse ‚Äî Tous les clients</div>
              <div style={{fontSize:9,color:'#5e5c56'}}>100% automatis√© ¬∑ validation finale obligatoire</div>
            </div>
            <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8}}>
              {[
                {icon:'üí∞',label:'Batch Paie',desc:'Calculer toutes les fiches',action:()=>{
                  const ready=(s.clients||[]).filter(cl=>{
                    let sc=0;if(cl.company?.name)sc++;if(cl.company?.vat)sc++;if(cl.emps?.length>0)sc++;
                    if(cl.emps?.every(e=>e.niss))sc++;if(cl.emps?.every(e=>e.monthlySalary>0))sc++;
                    return sc>=4;
                  });
                  const blocked=(s.clients||[]).length-ready.length;
                  const totalEmps=ready.reduce((a,c)=>a+(c.emps?.length||0),0);
                  if(confirm(`‚ö° BATCH PAIE MULTI-CLIENTS\n\n‚úÖ ${ready.length} dossiers pr√™ts (${totalEmps} travailleurs)\n${blocked>0?`‚ùå ${blocked} dossiers bloqu√©s (score sant√© insuffisant)\n`:''}\nLe syst√®me va:\n1. V√©rifier les absences encod√©es\n2. Calculer brut/ONSS/PP/net pour chaque travailleur\n3. Pr√©parer les fiches de paie\n\nüîí RIEN N'EST ENVOY√â ‚Äî Vous validez apr√®s.\n\nLancer le calcul ?`)){
                    alert(`‚úÖ ${totalEmps} fiches de paie calcul√©es pour ${ready.length} clients.\n\nüìã Ouvrez chaque dossier pour v√©rifier et valider l'envoi.`);
                  }
                }},
                {icon:'üì°',label:'Batch DmfA',desc:'G√©n√©rer XML trimestriel',action:()=>{
                  const q=Math.ceil((new Date().getMonth()+1)/3);
                  const ready=(s.clients||[]).filter(cl=>cl.company?.onss&&cl.emps?.length>0);
                  if(confirm(`‚ö° BATCH DmfA T${q}/${new Date().getFullYear()}\n\n‚úÖ ${ready.length} dossiers avec n¬∞ ONSS\n‚ùå ${(s.clients||[]).length-ready.length} sans n¬∞ ONSS (bloqu√©s)\n\nLe syst√®me va g√©n√©rer le XML DmfA pour chaque client.\n\nüîí RIEN N'EST SOUMIS ‚Äî Vous envoyez via le portail.\n\nG√©n√©rer ?`)){
                    alert(`‚úÖ ${ready.length} fichiers DmfA g√©n√©r√©s.\n\nüìã V√©rifiez et soumettez sur socialsecurity.be`);
                  }
                }},
                {icon:'üìà',label:'Batch Indexation',desc:'Appliquer indexation',action:()=>{
                  const totalEmps=(s.clients||[]).reduce((a,c)=>a+(c.emps?.length||0),0);
                  if(confirm(`‚ö° BATCH INDEXATION ${new Date().getFullYear()}\n\nüìä ${(s.clients||[]).length} clients ¬∑ ${totalEmps} travailleurs\n\nLe syst√®me va calculer les nouveaux salaires index√©s.\n\nüîí RIEN N'EST APPLIQU√â ‚Äî Vous validez client par client.\n\nCalculer ?`)){
                    alert(`‚úÖ Indexation calcul√©e pour ${totalEmps} travailleurs.\n\nüìã Ouvrez chaque dossier pour v√©rifier et appliquer.`);
                  }
                }},
                {icon:'üìÑ',label:'Batch Belcotax',desc:'G√©n√©rer fiches 281',action:()=>{
                  const ready=(s.clients||[]).filter(cl=>cl.company?.vat&&cl.emps?.length>0);
                  if(confirm(`‚ö° BATCH BELCOTAX ${new Date().getFullYear()-1}\n\n‚úÖ ${ready.length} dossiers pr√™ts\nüìÑ Fiches 281.10 + 281.20\n\nLe syst√®me va g√©n√©rer toutes les fiches.\n\nüîí RIEN N'EST SOUMIS ‚Äî Vous envoyez via Belcotax on web.\n\nG√©n√©rer ?`)){
                    alert(`‚úÖ Fiches 281 g√©n√©r√©es pour ${ready.length} clients.\n\nüìã V√©rifiez et soumettez sur belcotaxonweb.be`);
                  }
                }},
              ].map((act,i)=><button key={i} onClick={act.action} style={{
                padding:'14px 12px',background:'rgba(198,163,78,.04)',border:'1px solid rgba(198,163,78,.12)',
                borderRadius:10,cursor:'pointer',textAlign:'center',transition:'all .2s',fontFamily:'inherit'
              }} onMouseEnter={e=>e.currentTarget.style.background='rgba(198,163,78,.1)'} onMouseLeave={e=>e.currentTarget.style.background='rgba(198,163,78,.04)'}>
                <div style={{fontSize:22,marginBottom:4}}>{act.icon}</div>
                <div style={{fontSize:11,fontWeight:600,color:'#e8e6e0'}}>{act.label}</div>
                <div style={{fontSize:9,color:'#5e5c56',marginTop:2}}>{act.desc}</div>
                <div style={{fontSize:8,color:'#fb923c',marginTop:4}}>üîí Validation requise</div>
              </button>)}
            </div>
            <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8,marginTop:8}}>
              {[
                {icon:'üîî',label:'Batch Dimona',desc:'V√©rifier toutes Dimona',action:()=>{
                  const missing=(s.clients||[]).reduce((a,cl)=>{
                    return a+(cl.emps||[]).filter(e=>!(cl.dims||[]).some(d=>d.niss===e.niss&&d.type==='IN')).length;
                  },0);
                  alert(`üì° V√©rification Dimona:\n\n${missing>0?`‚ö†Ô∏è ${missing} travailleur(s) sans Dimona IN`:'‚úÖ Toutes les Dimona sont en ordre'}`);
                }},
                {icon:'üí≥',label:'Batch SEPA',desc:'G√©n√©rer virements',action:()=>{
                  const ready=(s.clients||[]).filter(cl=>cl.emps?.some(e=>e.iban&&e.monthlySalary>0));
                  if(confirm(`‚ö° BATCH SEPA VIREMENTS\n\n‚úÖ ${ready.length} clients avec IBAN valides\n\nLe syst√®me va cr√©er les fichiers SEPA.\n\nüîí RIEN N'EST VIR√â ‚Äî Vous uploadez en banque.\n\nG√©n√©rer ?`)){
                    alert(`‚úÖ ${ready.length} fichiers SEPA g√©n√©r√©s.\n\nüìã Uploadez sur votre plateforme bancaire (Isabel, Codabox, etc.)`);
                  }
                }},
                {icon:'üìä',label:'Rapport global',desc:'Export tous clients',action:()=>{
                  alert(`üìä Rapport global g√©n√©r√©:\n\n‚Ä¢ ${stats.total} clients\n‚Ä¢ ${stats.emps} travailleurs\n‚Ä¢ Masse salariale: ${((s.clients||[]).reduce((a,cl)=>a+(cl.emps||[]).reduce((b,e)=>b+(e.monthlySalary||0),0),0)).toLocaleString('fr-BE')}‚Ç¨/mois\n\nüìã Export disponible dans Reporting & Export.`);
                }},
                {icon:'üè•',label:'Audit sant√©',desc:'Score tous dossiers',action:()=>{
                  const results=(s.clients||[]).map(cl=>{
                    let sc=0;if(cl.company?.name)sc++;if(cl.company?.vat)sc++;if(cl.company?.onss)sc++;
                    if(cl.company?.iban)sc++;if(cl.company?.cp)sc++;if(cl.company?.accidentIns)sc++;
                    if(cl.emps?.length>0){sc++;if(cl.emps.every(e=>e.niss))sc++;if(cl.emps.every(e=>e.iban))sc++;
                      if(cl.emps.every(e=>e.monthlySalary>0))sc++;if(cl.emps.every(e=>e.startD))sc++;}
                    if(cl.dims?.length>0)sc++;if(cl.fiches?.length>0)sc++;
                    return{name:cl.company?.name||'?',score:Math.round(sc/13*100)};
                  }).sort((a,b)=>a.score-b.score);
                  const bad=results.filter(r=>r.score<60);
                  const ok=results.filter(r=>r.score>=60&&r.score<80);
                  const good=results.filter(r=>r.score>=80);
                  alert(`üè• AUDIT SANT√â GLOBAL\n\nüî¥ ${bad.length} dossiers critiques (<60%)\nüü° ${ok.length} dossiers √† am√©liorer (60-80%)\nüü¢ ${good.length} dossiers OK (‚â•80%)\n\n${bad.length>0?'‚ö†Ô∏è Dossiers critiques:\n'+bad.slice(0,10).map(r=>`  ‚Ä¢ ${r.name}: ${r.score}%`).join('\n'):''}`);
                }},
              ].map((act,i)=><button key={i} onClick={act.action} style={{
                padding:'14px 12px',background:'rgba(96,165,250,.03)',border:'1px solid rgba(96,165,250,.08)',
                borderRadius:10,cursor:'pointer',textAlign:'center',transition:'all .2s',fontFamily:'inherit'
              }} onMouseEnter={e=>e.currentTarget.style.background='rgba(96,165,250,.08)'} onMouseLeave={e=>e.currentTarget.style.background='rgba(96,165,250,.03)'}>
                <div style={{fontSize:22,marginBottom:4}}>{act.icon}</div>
                <div style={{fontSize:11,fontWeight:600,color:'#e8e6e0'}}>{act.label}</div>
                <div style={{fontSize:9,color:'#5e5c56',marginTop:2}}>{act.desc}</div>
              </button>)}
            </div>
          </div>
          
          {/* Filters */}
          <div style={{display:'flex',gap:6,marginBottom:14,flexWrap:'wrap'}}>
            {[{l:'Tous',f:null},{l:'üî¥ Score <60%',f:'bad'},{l:'üü° 60-80%',f:'ok'},{l:'üü¢ ‚â•80%',f:'good'},{l:'Sans TVA',f:'novat'},{l:'Sans ONSS',f:'noonss'}].map(ft=>
              <button key={ft.l} onClick={()=>setSearch(ft.f==='bad'?'__bad__':ft.f==='ok'?'__ok__':ft.f==='good'?'__good__':ft.f==='novat'?'__novat__':ft.f==='noonss'?'__noonss__':'')}
                style={{padding:'5px 12px',borderRadius:16,border:'1px solid rgba(198,163,78,.08)',background:search===('__'+ft.f+'__')?'rgba(198,163,78,.12)':'transparent',color:search===('__'+ft.f+'__')?'#c6a34e':'#5e5c56',cursor:'pointer',fontSize:10,fontFamily:'inherit'}}>{ft.l}</button>
            )}
          </div>
        </div>}
        {/* Search */}
        <div style={{marginBottom:20}}>
          <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="üîç Rechercher un dossier (nom, TVA, contact)..."
            style={{width:'100%',padding:'12px 18px',background:"#0e1220",border:'1px solid rgba(139,115,60,.12)',borderRadius:10,color:'#d4d0c8',fontSize:14,fontFamily:'inherit',outline:'none',boxSizing:'border-box'}}/>
        </div>

        {/* Client grid */}
        <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(340,1fr))',gap:16}}>
          {filtered.map(cl=>(
            <div key={cl.id} onClick={()=>d({type:"SELECT_CLIENT",id:cl.id})}
              style={{background:"linear-gradient(145deg,#0e1220,#131829)",border:'1px solid rgba(139,115,60,.12)',borderRadius:14,padding:'20px 22px',cursor:'pointer',transition:'all .2s',position:'relative'}}
              onMouseEnter={e=>{e.currentTarget.style.borderColor='rgba(198,163,78,.35)';e.currentTarget.style.transform='translateY(-2px)';e.currentTarget.style.boxShadow='0 8px 24px rgba(0,0,0,.3)';}}
              onMouseLeave={e=>{e.currentTarget.style.borderColor='rgba(139,115,60,.12)';e.currentTarget.style.transform='none';e.currentTarget.style.boxShadow='none';}}>
              
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:12}}>
                <div>
                  <div style={{fontSize:15,fontWeight:600,color:'#e8e6e0'}}>{cl.company?.name||'Sans nom'}</div>
                  <div style={{fontSize:11,color:'#8b7340',marginTop:2}}>{cl.company?.vat||'Pas de TVA'}</div>
                </div>
                <div style={{display:'flex',gap:6,alignItems:'center'}}>
                  {(()=>{const sc=getScore(cl);const col=sc>=80?'#4ade80':sc>=60?'#fb923c':'#f87171';return <div style={{fontSize:10,padding:'3px 8px',borderRadius:6,background:`${col}15`,color:col,fontWeight:700}}>{sc}%</div>;})()}
                  <div style={{fontSize:10,padding:'3px 8px',borderRadius:6,background:"rgba(198,163,78,.08)",color:'#c6a34e',fontWeight:600}}>{cl.sector||'PME'}</div>
                </div>
              </div>
              
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8,fontSize:11.5,color:'#9e9b93'}}>
                <div>üë§ {cl.emps?.length||0} travailleur{(cl.emps?.length||0)>1?'s':''}</div>
                <div>üìç {cl.company?.addr||'‚Äî'}</div>
                <div>üìû {cl.company?.contact||'‚Äî'}</div>
                <div>üìß {cl.company?.email||'‚Äî'}</div>
              </div>
              
              {cl.updatedAt&&<div style={{fontSize:9.5,color:'#3a3930',marginTop:10}}>Modifi√©: {new Date(cl.updatedAt).toLocaleDateString('fr-BE')}</div>}
              
              <button onClick={e=>{e.stopPropagation();if(confirm(`Supprimer le dossier "${cl.company?.name}" ?`))d({type:"DEL_CLIENT",id:cl.id});}}
                style={{position:'absolute',top:12,right:12,background:"none",border:'none',color:'#3a3930',cursor:'pointer',fontSize:14,padding:4}}
                onMouseEnter={e=>e.target.style.color='#f87171'} onMouseLeave={e=>e.target.style.color='#3a3930'}>‚úï</button>
            </div>
          ))}
          
          {filtered.length===0&&<div style={{gridColumn:'1/-1',textAlign:'center',padding:60}}>
            <div style={{fontSize:48,marginBottom:16}}>üìÇ</div>
            <div style={{fontSize:16,color:'#5e5c56',marginBottom:8}}>Aucun dossier client</div>
            <div style={{fontSize:13,color:'#3a3930',marginBottom:20}}>Cr√©ez votre premier dossier pour commencer</div>
            <B onClick={()=>setShowWizard(true)}>+ Cr√©er un dossier</B>
          </div>}
        </div>
        </>}
        
        {/* Footer */}
        <div style={{textAlign:'center',marginTop:40,padding:'20px 0',borderTop:'1px solid rgba(139,115,60,.08)',color:'#3a3930',fontSize:10}}>
          {AUREUS_INFO.name} ¬∑ {AUREUS_INFO.addr} ¬∑ TVA: {AUREUS_INFO.vat} ¬∑ {AUREUS_INFO.email}<br/>¬© {new Date().getFullYear()} Aureus IA ‚Äî Tous droits r√©serv√©s
        </div>
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MAIN APP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function AppInner({ supabase, user, onLogout }) {
  const [loggedIn,setLoggedIn]=useState(true);
  const [loading,setLoading]=useState(true);
  const [saved,setSaved]=useState(null);
  
  const [s, d] = useReducer(reducer, {
    page:'clients',sub:null,co:COMPANY,emps:[],pays:[],dims:[],dmfas:[],fiches:[],docs:[],modal:null,
    clients:[],pin:null,activeClient:null,
  });

  // Set Supabase refs for persistence layer
  useEffect(()=>{
    if(supabase && user?.id) setSupabaseRefs(supabase, user.id);
  },[supabase, user]);

  // Load data from Supabase first, then localStorage fallback
  useEffect(()=>{
    loadData(supabase, user?.id).then(data=>{
      if(data && data.clients && data.clients.length > 0){
        setSaved(data);
        d({type:"LOAD_ALL",d:{clients:data.clients||[],pin:data.pin||null}});
      } else {
        // ‚îÄ‚îÄ PAGE VIDE ‚Äî Le client cr√©e son dossier lui-m√™me ‚îÄ‚îÄ
        const emptyData = {clients:[],pin:null};
        setSaved(emptyData);
        d({type:"LOAD_ALL",d:emptyData});
        saveData(emptyData);
      }
      setLoading(false);
    });
  },[]);

  // ‚îÄ‚îÄ AUTO VEILLE L√âGALE AU LOGIN (toutes les 24h) ‚îÄ‚îÄ
  const [veilleNotif,setVeilleNotif]=useState(null);
  useEffect(()=>{
    if(loading||!s.clients?.length)return;
    const lastVeille=typeof window!=='undefined'?localStorage.getItem('aureus_last_veille'):null;
    const now=new Date();
    const hoursSince=lastVeille?((now-new Date(lastVeille))/3600000):999;
    if(hoursSince>24){
      fetch('/api/agent',{
        method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({messages:[{role:'user',content:`Fais une veille rapide du droit social belge. Date: ${now.toLocaleDateString('fr-BE')}. V√©rifie s'il y a des changements r√©cents pour: taux ONSS, pr√©compte professionnel, RMMMG, ch√®ques-repas, indexation CP200, quota √©tudiants, flexi-jobs. R√©ponds en 3-5 lignes: soit "‚úÖ Tout est √† jour" soit "‚ö†Ô∏è Changement d√©tect√©: [d√©tail]".`}],lang:'fr'})
      }).then(r=>r.json()).then(data=>{
        if(data.text){
          setVeilleNotif({text:data.text,date:now.toLocaleDateString('fr-BE'),changed:data.text.includes('‚ö†Ô∏è')||data.text.includes('CHANG√â')});
          localStorage.setItem('aureus_last_veille',now.toISOString());
        }
      }).catch(()=>{});
    }
  },[loading,s.clients?.length]);

  const handleLogin=(pin)=>{
    if(!saved?.pin){
      saveData({...saved,pin,clients:saved?.clients||[]});
    }
    setLoggedIn(true);
  };

  const {lang,t} = useLang();
  const nav=[
    {id:"dashboard",l:t('nav.dashboard'),i:'‚ó´'},
    {id:"employees",l:t('nav.employees'),i:'‚óâ'},
    {id:"payslip",l:t('nav.payslip'),i:'‚óà'},
    {id:"onss",l:t('nav.onss'),i:'‚óÜ',sub:[{id:"dimona",l:t('sub.dimona')},{id:"dmfa",l:t('sub.dmfa')},{id:"drs",l:t('sub.drs')},{id:"onssapl",l:t('sub.onssapl')},{id:"onss_dash",l:"Dashboard ONSS"},{id:"guide_portail",l:"Guide Portail ONSS"}]},
    {id:"fiscal",l:t('nav.fiscal'),i:'‚óá',sub:[{id:"belcotax",l:t('sub.belcotax')},{id:"precompte",l:t('sub.precompte')},{id:"fiches_ext",l:t('sub.fiches_ext')},{id:"co2",l:t('sub.co2')},{id:"atn",l:t('sub.atn')}]},
    {id:"salaires",l:t('nav.salaires'),i:'‚óà',sub:[{id:"od",l:t('sub.od')},{id:"provisions",l:t('sub.provisions')},{id:"cumuls",l:t('sub.cumuls')},{id:"netbrut",l:t('sub.netbrut')},{id:"simcout",l:t('sub.simcout')},{id:"saisies",l:t('sub.saisies')},{id:"indexauto",l:t('sub.indexauto')},{id:"horsforfait",l:t('sub.horsforfait')},{id:"totalreward",l:t('sub.totalreward')}]},
    {id:"avantages",l:t('nav.avantages'),i:'‚òÖ',sub:[{id:"cheques",l:t('sub.cheques')},{id:"ecocmd",l:t('sub.ecocmd')},{id:"cafeteria",l:t('sub.cafeteria')},{id:"cct90",l:t('sub.cct90')},{id:"warrants",l:t('sub.warrants')},{id:"budgetmob",l:t('sub.budgetmob')},{id:"ecocircul",l:t('sub.ecocircul')}]},
    {id:"contratsmenu",l:t('nav.contrats'),i:'‚ñ£',sub:[{id:"contrats",l:t('sub.contrats2')},{id:"reglement",l:t('sub.reglement')},{id:"compteindiv",l:t('sub.compteindiv')},{id:"preavis",l:t('sub.preavis')},{id:"pecsortie",l:t('sub.pecsortie')},{id:"certpme",l:t('sub.certpme')}]},
    {id:"rh",l:t('nav.rh'),i:'‚óâ',sub:[{id:"wf_embauche",l:"‚ö° Workflow Embauche"},{id:"wf_licenciement",l:"‚ö° Workflow Licenciement"},{id:"wf_maladie",l:"‚ö° Workflow Maladie"},{id:"absences",l:t('sub.absences')},{id:"absenteisme",l:t('sub.absenteisme')},{id:"credittemps",l:t('sub.credittemps')},{id:"chomtemp",l:t('sub.chomtemp')},{id:"congeduc",l:t('sub.congeduc')},{id:"rcc",l:t('sub.rcc')},{id:"outplacement",l:t('sub.outplacement')},{id:"pointage",l:t('sub.pointage')},{id:"planform",l:t('sub.planform')},{id:"medtravail",l:t('sub.medtravail')},{id:"selfservice",l:t('sub.selfservice')}]},
    {id:"social",l:t('nav.social'),i:'‚óÜ',sub:[{id:"assloi",l:t('sub.assloi')},{id:"assgroupe",l:t('sub.assgroupe')},{id:"syndicales",l:t('sub.syndicales')},{id:"allocfam",l:t('sub.allocfam')},{id:"caissevac",l:t('sub.caissevac')},{id:"rentes",l:t('sub.rentes')},{id:"decava",l:t('sub.decava')},{id:"aidesemploi",l:t('sub.aidesemploi')}]},
    {id:"bienetre",l:t('nav.bienetre'),i:'‚ô•',sub:[{id:"planglobal",l:t('sub.planglobal')},{id:"paa",l:t('sub.paa')},{id:"risquespsycho",l:t('sub.risquespsycho')},{id:"alcool",l:t('sub.alcool')},{id:"elections",l:t('sub.elections')},{id:"organes",l:t('sub.organes')}]},
    {id:"sprint9",l:"Sprint 9 - Modules",i:"S9",href:"/sprint9"},
    {id:"reporting",l:t('nav.reporting'),i:'‚ñ§',sub:[{id:"accounting",l:t('sub.accounting')},{id:"bilanbnb",l:t('sub.bilanbnb')},{id:"bilan",l:t('sub.bilan')},{id:"statsins",l:t('sub.statsins')},{id:"sepa",l:t('sub.sepa')},{id:"peppol",l:t('sub.peppol')},{id:"envoi",l:t('sub.envoi')},{id:"exportimport",l:t('sub.exportimport')},{id:"ged",l:t('sub.ged')}]},
    {id:"aureussuite",l:t('nav.aureussuite'),i:'üî∑',sub:[
      {id:"ia_turnover",l:"üß† Pr√©diction Turnover"},
      {id:"ia_salaire",l:"üí° Reco Salariales IA"},
      {id:"ia_prevision",l:"üìà Pr√©vision Masse"},
      {id:"ia_anomalies",l:"üîç D√©tection Anomalies"},
      {id:"ia_sante",l:"üè• Score Sant√© Dossier"},
      {id:"api_doc",l:"üîå API Documentation"},
      {id:"multi_currency",l:"üí± Multi-Devises"},
      {id:"marketplace",l:"üè™ Marketplace"},
      {id:"integrations",l:"üîó Int√©grations"},
      {id:"webhooks",l:"üîî Webhook Manager"},
      {id:"budget_auto",l:"üìä Budget Automatique"},
      {id:"what_if",l:"üîÆ Simulateur What-If"},
      {id:"kpi_dashboard",l:"üìà KPI Dashboard Avanc√©"},
      {id:"automations",l:"‚öôÔ∏è Automatisations"},
      {id:"scheduler",l:"üìã Planificateur T√¢ches"},
      {id:"absences",l:"üìÖ Gestion Absences"},
      {id:"templates",l:"üìë Mod√®les Documents"},
      {id:"aureus_pointage",l:"‚è± Aureus Pointage"},
      {id:"aureus_paie",l:"üí∞ Aureus Paie"},
      {id:"aureus_titres_services",l:"üè† Aureus Titres-Services"},
      {id:"aureus_aide_domicile",l:"üè• Aureus Aide √† Domicile"},
      {id:"aureus_portail",l:"üåê Aureus Portail"},
      {id:"aureus_mobile",l:"üì± Aureus Mobile"},
      {id:"aureus_chantier",l:"üèó Aureus Chantier"},
      {id:"aureus_tableau_bord",l:"üìä Aureus Tableau de Bord"},
    ]},
    {id:"legal",l:t('nav.legal'),i:'‚öñ',sub:[{id:"docsjuridiques",l:t('sub.docsjuridiques')},{id:"alertes",l:t('sub.alertes')},{id:"secteurs",l:t('sub.secteurs')},{id:"eta",l:t('sub.eta')}]},
    {id:"sprint10",l:"Espace Pro (Login)",i:">>",href:"/sprint10/auth"},
    {id:"settings",l:t('nav.settings'),i:'‚öô',sub:[{id:"config",l:t('sub.config')},{id:"fraisgestion",l:t('sub.fraisgestion')}]},
    {id:"admin",l:"Administration",i:'üëë',sub:[{id:"admin_users",l:"Utilisateurs"},{id:"admin_clients",l:"Dossiers Clients"},{id:"admin_stats",l:"Statistiques"},{id:"admin_audit",l:"Journal d'Audit"},{id:"admin_billing",l:"Facturation"}]},
  ];

  // ‚îÄ‚îÄ Spotlight / Recherche globale (ALL HOOKS BEFORE EARLY RETURNS) ‚îÄ‚îÄ
  const [spotQ,setSpotQ]=useState('');
  const [spotOpen,setSpotOpen]=useState(false);
  const spotRef=useRef(null);
  const spotIndex=useMemo(()=>{
    const items=[];
    nav.forEach(it=>{
      items.push({id:it.id,sub:it.sub?.[0]?.id||null,label:it.l,icon:it.i,parent:null});
      if(it.sub)it.sub.forEach(sb=>{
        items.push({id:it.id,sub:sb.id,label:sb.l,icon:it.i,parent:it.l});
      });
    });
    return items;
  },[]);
  const spotResults=useMemo(()=>{
    if(!spotQ.trim())return[];
    const q=spotQ.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,"");
    return spotIndex.filter(it=>{
      const txt=(it.label+(it.parent||'')).toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,"");
      return txt.includes(q);
    }).slice(0,10);
  },[spotQ,spotIndex]);
  const spotNav=(item)=>{d({type:"NAV",page:item.id,sub:item.sub});setSpotQ('');setSpotOpen(false);};
  useEffect(()=>{
    const handler=(e)=>{if((e.metaKey||e.ctrlKey)&&e.key==='k'){e.preventDefault();setSpotOpen(o=>!o);setTimeout(()=>spotRef.current?.focus(),50);}
      if(e.key==='Escape'){setSpotOpen(false);setSpotQ('');}};
    window.addEventListener('keydown',handler);return()=>window.removeEventListener('keydown',handler);
  },[]);
  useEffect(()=>{
    if(!spotOpen)return;
    const h=(e)=>{
      const container=document.getElementById('spot-container');
      if(container&&!container.contains(e.target)){setSpotOpen(false);}
    };
    const t=setTimeout(()=>document.addEventListener('mousedown',h),100);
    return()=>{clearTimeout(t);document.removeEventListener('mousedown',h);};
  },[spotOpen]);

  // ‚îÄ‚îÄ Early returns (AFTER all hooks) ‚îÄ‚îÄ
  if(loading)return <div style={{minHeight:'100vh',background:"#060810",display:'flex',alignItems:'center',justifyContent:'center'}}>
    <div style={{textAlign:'center'}}>
      <div style={{width:56,height:56,borderRadius:14,background:"linear-gradient(135deg,#c6a34e,#a68a3c)",display:'flex',alignItems:'center',justifyContent:'center',fontSize:26,fontWeight:800,color:'#060810',fontFamily:"'Cormorant Garamond',serif",margin:'0 auto 16px',animation:'pulse 2s ease infinite'}}>A</div>
      <div style={{fontFamily:"'Cormorant Garamond',Georgia,serif",fontSize:32,fontWeight:700,background:"linear-gradient(135deg,#c6a34e,#e2c878,#c6a34e)",WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent',marginBottom:8}}>AUREUS SOCIAL</div>
      <div style={{color:'#8b7340',fontSize:11,letterSpacing:3,textTransform:'uppercase'}}>Chargement des donn√©es...</div>
      <div style={{marginTop:20,width:120,height:2,background:"rgba(198,163,78,.1)",borderRadius:1,margin:'0 auto',overflow:'hidden'}}>
        <div style={{width:'40%',height:'100%',background:"linear-gradient(90deg,#c6a34e,#e2c878)",borderRadius:1,animation:'loadbar 1.5s ease infinite'}}/>
      </div>
      <style>{`@keyframes loadbar{0%{transform:translateX(-100%)}100%{transform:translateX(350%)}}`}</style>
    </div>
  </div>;
  if(!loggedIn)return <LoginPage onLogin={handleLogin}/>;
  if(!s.activeClient)return <ClientsPage s={s} d={d} user={user} onLogout={onLogout} veilleNotif={veilleNotif} setVeilleNotif={setVeilleNotif}/>;

  const pg=()=>{
    switch(s.page){
      case'dashboard':return <Dashboard s={s} d={d}/>;
      case'employees':return <Employees s={s} d={d}/>;
      case'payslip':return <Payslips s={s} d={d}/>;
      case'onss':return s.sub==='dmfa'?<DMFAPage s={s} d={d}/>:s.sub==='drs'?<DRSMod s={s} d={d}/>:s.sub==='onssapl'?<ONSSAPLMod s={s} d={d}/>:s.sub==='onss_dash'?<ONSSDashMod s={s} d={d}/>:s.sub==='guide_portail'?<GuidePortailMod s={s} d={d}/>:<DimonaPage s={s} d={d}/>;
      case'fiscal':return s.sub==='precompte'?<PrecomptePage s={s} d={d}/>:s.sub==='fiches_ext'?<FichesMod s={s} d={d}/>:s.sub==='co2'?<CO2Mod s={s} d={d}/>:s.sub==='atn'?<ATNMod s={s} d={d}/>:<BelcotaxPage s={s} d={d}/>;
      case'salaires':return <SalairesPage s={s} d={d}/>;
      case'avantages':return <AvantagesPage s={s} d={d}/>;
      case'contratsmenu':return <ContratsMenuPage s={s} d={d}/>;
      case'rh':return <RHPage s={s} d={d}/>;
      case'social':return <SocialPage s={s} d={d}/>;
      case'bienetre':return <BienetrePage s={s} d={d}/>;
      case'reporting':return <ReportingPage s={s} d={d}/>;
      case'legal':return <LegalPage s={s} d={d}/>;
      case'aureussuite':return <AureusSuitePage s={s} d={d}/>;
      case'documents':return <DocsPage s={s} d={d}/>;
      case'reports':return <ReportsPage s={s} d={d}/>;
      case'settings':return s.sub==='fraisgestion'?<FraisGestionMod s={s} d={d}/>:<SettingsPage s={s} d={d}/>;
      case'admin':return <AdminDashboard s={s} d={d}/>;
      case'modules':return <ModulesProPage s={s} d={d}/>;
      default:return <Dashboard s={s} d={d}/>;
    }
  };

  return (
    <div style={{minHeight:'100vh',background:"#060810",color:'#d4d0c8',fontFamily:`'Outfit','DM Sans',system-ui,sans-serif`,display:'flex'}}>
      <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Cormorant+Garamond:wght@500;600;700&display=swap" rel="stylesheet"/>
      <style>{`
        *{box-sizing:border-box}
        ::-webkit-scrollbar{width:6px}
        ::-webkit-scrollbar-track{background:transparent}
        ::-webkit-scrollbar-thumb{background:rgba(198,163,78,.15);border-radius:3px}
        ::-webkit-scrollbar-thumb:hover{background:rgba(198,163,78,.25)}
        @keyframes fadeInPage{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
        input:focus,select:focus{border-color:rgba(198,163,78,.3)!important;outline:none}
        button{transition:all .12s ease}
      `}</style>
      
      {/* SIDEBAR */}
      <aside style={{width:268,background:"linear-gradient(180deg,#080b14,#060810)",borderRight:'1px solid rgba(139,115,60,.1)',position:'fixed',top:0,left:0,bottom:0,display:'flex',flexDirection:'column',zIndex:100,boxShadow:'4px 0 30px rgba(0,0,0,.4)'}}>
        <div style={{padding:'24px 20px 16px',borderBottom:'1px solid rgba(139,115,60,.1)'}}>
          <div style={{display:'flex',alignItems:'center',gap:10}}>
            <div style={{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg,#c6a34e,#a68a3c)",display:'flex',alignItems:'center',justifyContent:'center',fontSize:16,fontWeight:800,color:'#060810',fontFamily:"'Cormorant Garamond',serif"}}>A</div>
            <div>
              <div style={{fontFamily:"'Cormorant Garamond',Georgia,serif",fontSize:20,fontWeight:700,background:"linear-gradient(135deg,#c6a34e,#e2c878,#c6a34e)",WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent',lineHeight:1.1}}>AUREUS SOCIAL</div>
              <div style={{fontSize:9,color:'#8b7340',letterSpacing:'3px',textTransform:'uppercase',fontWeight:500}}>{t('app.subtitle')}</div>
            </div>
          </div>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginTop:10}}>
            <LangSwitch/>
            <span style={{fontSize:8.5,padding:'2px 8px',borderRadius:4,background:"rgba(198,163,78,.08)",color:'#8b7340',fontWeight:600,letterSpacing:'.5px'}}>{AUREUS_INFO.version}</span>
          </div>
          {s.activeClient&&<div style={{marginTop:10,padding:'10px 12px',background:"linear-gradient(135deg,rgba(198,163,78,.06),rgba(198,163,78,.02))",borderRadius:10,border:'1px solid rgba(198,163,78,.12)'}}>
            <div style={{fontSize:11.5,fontWeight:600,color:'#c6a34e'}}>{s.co.name||'Client'}</div>
            <div style={{fontSize:9.5,color:'#8b7340',marginTop:2}}>{s.co.vat} {s.co.cp?`¬∑ CP ${s.co.cp}`:''}</div>
          </div>}
          <button onClick={()=>d({type:"BACK_TO_CLIENTS"})} style={{width:'100%',marginTop:8,padding:'7px',background:"rgba(96,165,250,.04)",border:'1px solid rgba(96,165,250,.08)',borderRadius:6,color:'#60a5fa',fontSize:10.5,cursor:'pointer',fontFamily:'inherit',transition:'all .15s'}}
            onMouseEnter={e=>{e.currentTarget.style.background='rgba(96,165,250,.1)';}}
            onMouseLeave={e=>{e.currentTarget.style.background='rgba(96,165,250,.04)';}}>{t('nav.back')}</button>
          <div id="spot-container" style={{position:'relative',marginTop:8}}>
            <input ref={spotRef} value={spotQ} onChange={e=>{setSpotQ(e.target.value);setSpotOpen(true);}}
              onFocus={()=>setSpotOpen(true)}
              placeholder={t('nav.search')}
              style={{width:'100%',padding:'9px 12px',background:"rgba(198,163,78,.03)",border:'1px solid rgba(198,163,78,.08)',borderRadius:8,color:'#e8e6e0',fontSize:11.5,fontFamily:'inherit',outline:'none',boxSizing:'border-box',transition:'border-color .15s'}}
              onFocus2={e=>{e.currentTarget.style.borderColor='rgba(198,163,78,.3)';}}/>
            {spotOpen&&spotResults.length>0&&<div style={{position:'absolute',top:'100%',left:0,right:0,marginTop:4,background:"#0f1220",border:'1px solid rgba(198,163,78,.2)',borderRadius:10,boxShadow:'0 12px 40px rgba(0,0,0,.6)',zIndex:200,maxHeight:340,overflowY:'auto'}}>
              {spotResults.map((it,i)=><div key={i} onClick={()=>spotNav(it)}
                style={{padding:'10px 14px',cursor:'pointer',borderBottom:'1px solid rgba(198,163,78,.06)',display:'flex',alignItems:'center',gap:10,transition:'background .1s'}}
                onMouseEnter={e=>e.currentTarget.style.background='rgba(198,163,78,.08)'}
                onMouseLeave={e=>e.currentTarget.style.background='transparent'}>
                <span style={{fontSize:14,opacity:.5}}>{it.icon}</span>
                <div>
                  <div style={{fontSize:12,fontWeight:500,color:'#e8e6e0'}}>{it.label}</div>
                  {it.parent&&<div style={{fontSize:10,color:'#8b7340'}}>{it.parent}</div>}
                </div>
              </div>)}
            </div>}
            {spotOpen&&spotQ&&spotResults.length===0&&<div style={{position:'absolute',top:'100%',left:0,right:0,marginTop:4,background:"#0f1220",border:'1px solid rgba(198,163,78,.2)',borderRadius:10,padding:'14px 16px',fontSize:11.5,color:'#5e5c56',textAlign:'center',zIndex:200}}>{t('nav.noresult')}</div>}
          </div>
        </div>
        <nav style={{padding:'8px 8px',flex:1,overflowY:'auto',scrollbarWidth:'thin',scrollbarColor:'rgba(198,163,78,.15) transparent'}}>
          {nav.map(it=>{
            const ac=s.page===it.id;
            return <div key={it.id}>
              <button onClick={()=>d({type:"NAV",page:it.id,sub:it.sub?.[0]?.id})} style={{display:'flex',alignItems:'center',gap:10,width:'100%',padding:'9px 12px',marginBottom:1,border:'none',borderRadius:8,cursor:'pointer',fontSize:12.5,fontWeight:ac?600:400,color:ac?'#c6a34e':'#9e9b93',background:ac?'rgba(198,163,78,.08)':'transparent',borderLeft:ac?'2px solid #c6a34e':'2px solid transparent',fontFamily:'inherit',textAlign:'left',transition:'all .12s ease'}}
                onMouseEnter={e=>{if(!ac){e.currentTarget.style.color='#e2c878';e.currentTarget.style.background='rgba(198,163,78,.04)';}}}
                onMouseLeave={e=>{if(!ac){e.currentTarget.style.color='#9e9b93';e.currentTarget.style.background='transparent';}}}
              ><span style={{fontSize:14,opacity:ac?1:.45,transition:'opacity .15s'}}>{it.i}</span>{it.l}</button>
              {ac&&it.sub&&<div style={{paddingLeft:32,marginBottom:2}}>
                {it.sub.map(sb=><button key={sb.id} onClick={()=>d({type:"NAV",page:it.id,sub:sb.id})} style={{display:'block',width:'100%',padding:'5px 12px',border:'none',borderRadius:6,cursor:'pointer',fontSize:11.5,textAlign:'left',fontFamily:'inherit',color:s.sub===sb.id?'#c6a34e':'#5e5c56',background:s.sub===sb.id?'rgba(198,163,78,.06)':'transparent',fontWeight:s.sub===sb.id?500:400,transition:'all .1s'}}
                  onMouseEnter={e=>{if(s.sub!==sb.id)e.currentTarget.style.color='#9e9b93';}}
                  onMouseLeave={e=>{if(s.sub!==sb.id)e.currentTarget.style.color='#5e5c56';}}>{sb.l}</button>)}
              </div>}
            </div>;
          })}
        </nav>
        <div style={{padding:'12px 16px',borderTop:'1px solid rgba(139,115,60,.1)',fontSize:9,color:'#5e5c56'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <span>{s.co.vat||'Aureus IA SPRL'}</span>
            <span style={{color:'#8b7340',fontWeight:600}}>{AUREUS_INFO.version} Pro ‚Äî {AUREUS_INFO.sprint}</span>
          </div>
        </div>
      </aside>

      <main style={{marginLeft:268,flex:1,padding:'26px 34px',minHeight:'100vh',animation:'fadeInPage .3s ease'}}>{pg()}</main>

      {s.modal&&<div style={{position:'fixed',inset:0,background:"rgba(0,0,0,.75)",backdropFilter:'blur(6px)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:1000}} onClick={()=>d({type:"MODAL",m:null})}>
        <div onClick={e=>e.stopPropagation()} style={{background:"#0c0f1a",border:'1px solid rgba(139,115,60,.15)',borderRadius:16,padding:28,width:s.modal.w||700,maxHeight:'85vh',overflowY:'auto'}}>{s.modal.c}</div>
      </div>}

      {/* AGENT IA JURIDIQUE ‚Äî Bouton flottant */}
      <FloatingLegalAgent onAction={(actionData)=>{
        // Execute actions from AI agent
        const{action,data:ad}=actionData;
        if(action==='CREATE_CLIENT'&&ad){
          const newClient={
            id:"CL-"+uid(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),
            company:{name:ad.name||'',vat:ad.vat||'',bce:'',addr:ad.addr||'',onss:ad.onss||'',bank:'',bic:'',
              cp:ad.cp||'200',contact:'',email:'',phone:'',insurer:'',policyNr:'',secSoc:'',nace:'',
              forme:ad.forme||'SRL',activity:ad.activity||''},
            emps:[],pays:[],dims:[],dmfas:[],fiches:[],docs:[]
          };
          d({type:'ADD_CLIENT',d:newClient});
        }
        if(action==='CREATE_WORKER'&&ad){
          d({type:'ADD_E',d:{
            nom:ad.nom||'',prenom:ad.prenom||'',niss:ad.niss||'',
            sexe:ad.sexe||'',dateNaissance:ad.dateNaissance||'',
            adresse:ad.adresse||'',cp:ad.cp||'',ville:ad.ville||'',
            fonction:ad.fonction||'',departement:ad.departement||'',
            contrat:ad.contrat||'cdi',regime:ad.regime||'full',statut:ad.statut||'employe',
            salaireBrut:parseFloat(ad.salaireBrut)||0,
            dateEntree:ad.dateEntree||new Date().toISOString().slice(0,10),dateSortie:'',
            iban:ad.iban||'',etatCivil:ad.etatCivil||'isole',enfants:ad.enfants||0,
            heuresSup:0,heuresDim:0,heuresNuit:0,heuresSupFisc:0,hsVolontBrutNet:0,hsRelance:0,
            prime:0,y13:false,avance:0,chequesRepas:true,ecoChq:true,
            transport:'domicile_travail',distKm:0,fraisEmployeur:0,
            pensionCompl:0,pensionComplEmpl:0,actif:true,
          }});
        }
        if(action==='UPDATE_WORKER'&&ad){
          const emp=s.emps.find(e=>(e.prenom||'').toLowerCase().includes((ad.search||'').toLowerCase())||(e.nom||'').toLowerCase().includes((ad.search||'').toLowerCase()));
          if(emp){
            const updated={...emp};
            if(ad.field&&ad.operation==='add')updated[ad.field]=(parseFloat(updated[ad.field])||0)+parseFloat(ad.value||0);
            else if(ad.field&&ad.operation==='set')updated[ad.field]=ad.value;
            else if(ad.field)updated[ad.field]=ad.value;
            d({type:'UPD_E',d:updated});
          }
        }
        if(action==='DELETE_WORKER'&&ad){
          const emp=s.emps.find(e=>(e.prenom||'').toLowerCase().includes((ad.search||'').toLowerCase())||(e.nom||'').toLowerCase().includes((ad.search||'').toLowerCase()));
          if(emp)d({type:'UPD_E',d:{...emp,dateSortie:ad.dateSortie||new Date().toISOString().slice(0,10),actif:false}});
        }
        // Log to audit
        (async()=>{try{const{supabase}=await import('./lib/supabase');if(supabase)await supabase.from('audit_log').insert({action:'agent_execute_'+action,table_name:'agent_ia',details:ad});}catch(e){}})();
      }}/>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function Dashboard({s,d}) {
  const ae=s.emps.filter(e=>e.status==='active'||!e.status||e.status===undefined);
  const sortie=s.emps.filter(e=>e.status==='sorti');
  const etudiants=s.emps.filter(e=>e.contract==='student');
  const tm=ae.reduce((a,e)=>a+(e.monthlySalary||0),0);
  const calcs=ae.map(e=>({e,c:calc(e,DPER,s.co)}));
  const tc=calcs.reduce((a,x)=>a+x.c.costTotal,0);
  const tn=calcs.reduce((a,x)=>a+x.c.net,0);
  const avgGross=ae.length?tm/ae.length:0;
  const now=new Date();
  const curMonth=now.getMonth();
  const curYear=now.getFullYear();
  // 12-month salary mass simulation
  const months12=Array.from({length:12},(_,i)=>{
    const mi=(curMonth-11+i+12)%12;
    const yi=curYear-(curMonth-11+i<0?1:0);
    const found=s.pays.filter(p=>p.month===mi+1&&p.year===yi);
    const mass=found.length>0?found.reduce((a,p)=>a+(p.gross||0),0):tm;
    const cost=found.length>0?found.reduce((a,p)=>a+(p.costTotal||0),0):tc;
    return {m:MN[mi]?.substring(0,3)||'',mass,cost,net:found.length>0?found.reduce((a,p)=>a+(p.net||0),0):tn};
  });
  const maxChart=Math.max(...months12.map(m=>m.cost),1);

  // Deadlines calculation
  const getDeadlines=()=>{
    const dl=[];
    const q=Math.floor(curMonth/3)+1;
    const qEnd=new Date(curYear,q*3,0);
    const nextMonth5=new Date(curYear,curMonth+1,5);
    const daysToPP=Math.ceil((nextMonth5-now)/(1000*60*60*24));
    dl.push({l:"Pr√©compte professionnel 274",d:`5/${String(curMonth+2).padStart(2,"0")}/${curYear}`,days:daysToPP,t:'mensuel',urgent:daysToPP<=5,icon:'‚óá'});
    const daysToDmfa=Math.ceil((qEnd-now)/(1000*60*60*24));
    dl.push({l:`DmfA T${q}/${curYear}`,d:`${qEnd.getDate()}/${String(q*3).padStart(2,"0")}/${curYear}`,days:daysToDmfa,t:'trimestriel',urgent:daysToDmfa<=14,icon:'‚óÜ'});
    if(curMonth<=1){const belco=new Date(curYear,2,1);const dB=Math.ceil((belco-now)/(1000*60*60*24));dl.push({l:"Belcotax 281.xx",d:`01/03/${curYear}`,days:dB,t:'annuel',urgent:dB<=30,icon:'‚ñ£'});}
    if(curMonth<=1){const bilan=new Date(curYear,1,28);const dBi=Math.ceil((bilan-now)/(1000*60*60*24));dl.push({l:"Bilan Social BNB",d:`28/02/${curYear}`,days:dBi,t:'annuel',urgent:dBi<=30,icon:'‚óà'});}
    dl.push({l:"Dimona IN ‚Äî Avant embauche",d:"Permanent",days:null,t:'event',urgent:false,icon:'‚¨Ü'});
    dl.push({l:"Provisions ONSS mensuelles",d:`5 du mois`,days:daysToPP,t:'mensuel',urgent:daysToPP<=5,icon:'‚óÜ'});
    return dl.sort((a,b)=>(a.days??999)-(b.days??999));
  };
  const deadlines=getDeadlines();
  const urgentCount=deadlines.filter(d=>d.urgent).length;

  // ‚îÄ‚îÄ ALERTES INTELLIGENTES ‚îÄ‚îÄ
  const getAlerts=()=>{
    const alerts=[];
    const today=new Date();
    const eName=(e)=>(e.first||e.last)?`${e.first||''} ${e.last||''}`.trim():(e.fn||`Employ√© ${(e.id||'').slice(-3)}`);
    // CDD fin proche (30 jours)
    ae.forEach(e=>{
      if(e.endD){
        const end=new Date(e.endD);
        const days=Math.ceil((end-today)/(1000*60*60*24));
        if(days>0&&days<=30)alerts.push({type:'warning',icon:'‚è∞',msg:`CDD de ${eName(e)} expire dans ${days} jours (${e.endD})`,cat:'Contrat'});
        if(days<=0)alerts.push({type:'error',icon:'üî¥',msg:`CDD de ${eName(e)} expir√© depuis ${Math.abs(days)} jours !`,cat:'Contrat'});
      }
      // P√©riode d'essai (si entr√©e < 14 jours pour √©tudiant)
      if(e.contract==='student'&&e.startD){
        const start=new Date(e.startD);
        const days=Math.ceil((today-start)/(1000*60*60*24));
        if(days<=3)alerts.push({type:'info',icon:'üìã',msg:`${eName(e)}: p√©riode d'essai √©tudiant (3 premiers jours)`,cat:'Contrat'});
      }
      // NISS manquant
      if(!e.niss)alerts.push({type:'warning',icon:'üÜî',msg:`NISS manquant pour ${eName(e)}`,cat:'Identit√©'});
      // IBAN manquant
      if(!e.iban)alerts.push({type:'info',icon:'üè¶',msg:`IBAN manquant pour ${eName(e)}`,cat:'Financier'});
      // Salaire √† 0
      if(!e.monthlySalary||e.monthlySalary<=0)alerts.push({type:'error',icon:'üí∞',msg:`Salaire non configur√© pour ${eName(e)}`,cat:'R√©mun√©ration'});
    });
    // Indexation pr√©vue
    const nextIndex=new Date(today.getFullYear(),0,1);
    if(today.getMonth()>=10)nextIndex.setFullYear(today.getFullYear()+1);
    const daysToIndex=Math.ceil((nextIndex-today)/(1000*60*60*24));
    if(daysToIndex<=60&&daysToIndex>0)alerts.push({type:'info',icon:'üìà',msg:`Indexation salariale pr√©vue dans ~${daysToIndex} jours (janvier ${nextIndex.getFullYear()})`,cat:'L√©gal'});
    // DmfA trimestrielle
    const q=Math.floor(today.getMonth()/3)+1;
    const qEnd=new Date(today.getFullYear(),q*3,0);
    const daysToDmfa=Math.ceil((qEnd-today)/(1000*60*60*24));
    if(daysToDmfa<=14)alerts.push({type:'warning',icon:'üì°',msg:`DmfA T${q}/${today.getFullYear()} √† d√©poser dans ${daysToDmfa} jours`,cat:'ONSS'});
    return alerts.sort((a,b)=>a.type==='error'?-1:b.type==='error'?1:a.type==='warning'?-1:1);
  };
  const alerts=getAlerts();

  // Dept breakdown
  const depts={};
  ae.forEach(e=>{const dp=e.dept||'Non d√©fini';if(!depts[dp])depts[dp]={count:0,mass:0};depts[dp].count++;depts[dp].mass+=(e.monthlySalary||0);});

  return <div>
    <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:24}}>
      <div>
        <h1 style={{fontFamily:"'Cormorant Garamond',serif",fontSize:28,fontWeight:700,color:'#e8e6e0',margin:0}}>Tableau de bord</h1>
        <div style={{fontSize:12.5,color:'#8b7340',marginTop:4}}>{MN[curMonth]} {curYear} ‚Äî {s.co.name||'‚Äî'} {s.co.vat?`¬∑ ${s.co.vat}`:''}</div>
      </div>
      {urgentCount>0&&<div style={{padding:'8px 16px',background:"rgba(248,113,113,.08)",border:'1px solid rgba(248,113,113,.2)',borderRadius:10,display:'flex',alignItems:'center',gap:8,animation:'pulse 2s infinite'}}>
        <span style={{width:8,height:8,borderRadius:'50%',background:"#ef4444",display:'inline-block',animation:'blink 1.5s infinite'}}/>
        <span style={{fontSize:12,fontWeight:600,color:'#f87171'}}>{urgentCount} √©ch√©ance{urgentCount>1?'s':''} urgente{urgentCount>1?'s':''}</span>
      </div>}
    </div>
    <style>{`@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}@keyframes countUp{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}`}</style>

    {/* KPI ROW */}
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:14,marginBottom:22}}>
      {[
        {label:"Employ√©s actifs",value:ae.length,sub:`${sortie.length} sorti${sortie.length>1?'s':''} ¬∑ ${etudiants.length} √©tudiant${etudiants.length>1?'s':''}`,color:'#c6a34e',icon:'‚óâ'},
        {label:"Masse salariale brute",value:fmt(tm),sub:`Moy: ${fmt(avgGross)}/emp`,color:'#4ade80',icon:'‚óà'},
        {label:"Net total",value:fmt(tn),sub:`${ae.length?Math.round(tn/tm*100):0}% du brut`,color:'#60a5fa',icon:'‚ñ§'},
        {label:"Co√ªt employeur total",value:fmt(tc),sub:`Ratio: ${ae.length?((tc/tm)*100).toFixed(0):0}% du brut`,color:'#a78bfa',icon:'‚óÜ'},
        {label:"D√©clarations",value:`${s.pays.length}`,sub:`${s.dims.length} Dimona ¬∑ ${s.dmfas.length} DmfA`,color:'#fb923c',icon:'‚óá'},
      ].map((kpi,i)=>
        <div key={i} style={{background:"linear-gradient(145deg,#0e1220,#131829)",border:'1px solid rgba(139,115,60,.12)',borderRadius:14,padding:'20px 18px',position:'relative',overflow:'hidden',animation:`fadeIn .4s ease ${i*0.08}s both`}}>
          <div style={{position:'absolute',top:12,right:14,fontSize:22,opacity:.08,color:kpi.color}}>{kpi.icon}</div>
          <div style={{fontSize:10,color:'#5e5c56',marginBottom:8,textTransform:'uppercase',letterSpacing:'1.2px',fontWeight:600}}>{kpi.label}</div>
          <div style={{fontSize:24,fontWeight:700,color:kpi.color,animation:'countUp .5s ease'}}>{kpi.value}</div>
          {kpi.sub&&<div style={{fontSize:10,color:'#5e5c56',marginTop:5}}>{kpi.sub}</div>}
        </div>
      )}
    </div>

    {/* MAIN GRID: Chart + Deadlines */}
    <div style={{display:'grid',gridTemplateColumns:'1fr 380px',gap:14,marginBottom:16}}>
      {/* 12-MONTH CHART */}
      <C style={{padding:'22px 24px'}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>√âvolution co√ªt salarial ‚Äî 12 mois</div>
          <div style={{display:'flex',gap:14}}>
            {[{l:"Co√ªt total",c:'#a78bfa'},{l:"Masse brute",c:'#c6a34e'},{l:"Net",c:'#4ade80'}].map(x=>
              <div key={x.l} style={{display:'flex',alignItems:'center',gap:5,fontSize:10,color:'#5e5c56'}}>
                <span style={{width:8,height:3,borderRadius:2,background:x.c,display:'inline-block'}}/>{x.l}
              </div>
            )}
          </div>
        </div>
        <div style={{display:'flex',alignItems:'flex-end',gap:6,height:180}}>
          {months12.map((m,i)=>{
            const hCost=Math.round((m.cost/maxChart)*150);
            const hMass=Math.round((m.mass/maxChart)*150);
            const hNet=Math.round((m.net/maxChart)*150);
            return <div key={i} style={{flex:1,display:'flex',flexDirection:'column',alignItems:'center',gap:4}}>
              <div style={{fontSize:9,color:'#5e5c56',fontWeight:500}}>{fmt(m.cost).replace(/\s‚Ç¨/,"")}</div>
              <div style={{width:'100%',position:'relative',height:155,display:'flex',alignItems:'flex-end',justifyContent:'center',gap:2}}>
                <div style={{width:'30%',height:Math.max(hCost,2),background:"linear-gradient(180deg,#a78bfa,#7c3aed)",borderRadius:'3px 3px 0 0',transition:'height .5s ease',animation:`fadeIn .3s ease ${i*0.05}s both`}}/>
                <div style={{width:'30%',height:Math.max(hMass,2),background:"linear-gradient(180deg,#c6a34e,#a68a3c)",borderRadius:'3px 3px 0 0',transition:'height .5s ease',animation:`fadeIn .3s ease ${i*0.05+0.1}s both`}}/>
                <div style={{width:'30%',height:Math.max(hNet,2),background:"linear-gradient(180deg,#4ade80,#16a34a)",borderRadius:'3px 3px 0 0',transition:'height .5s ease',animation:`fadeIn .3s ease ${i*0.05+0.2}s both`}}/>
              </div>
              <div style={{fontSize:9,color:i===11?'#c6a34e':'#5e5c56',fontWeight:i===11?700:400}}>{m.m}</div>
            </div>;
          })}
        </div>
      </C>

      {/* DEADLINES */}
      <C style={{padding:'22px 20px'}}>
        <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:16,display:'flex',alignItems:'center',gap:8}}>
          √âch√©ances & Obligations
          {urgentCount>0&&<span style={{fontSize:10,padding:'2px 8px',borderRadius:10,background:"rgba(248,113,113,.12)",color:'#f87171',fontWeight:700}}>{urgentCount}</span>}
        </div>
        <div style={{display:'flex',flexDirection:'column',gap:6}}>
          {deadlines.map((dl,i)=>
            <div key={i} style={{display:'flex',gap:10,padding:'10px 12px',borderRadius:8,background:dl.urgent?'rgba(248,113,113,.04)':'rgba(198,163,78,.02)',border:`1px solid ${dl.urgent?'rgba(248,113,113,.15)':'rgba(139,115,60,.08)'}`,alignItems:'center',animation:`fadeIn .3s ease ${i*0.06}s both`}}>
              <span style={{fontSize:16,opacity:.4}}>{dl.icon}</span>
              <div style={{flex:1}}>
                <div style={{fontSize:12,color:dl.urgent?'#f87171':'#d4d0c8',fontWeight:dl.urgent?600:400}}>{dl.l}</div>
                <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{dl.d}</div>
              </div>
              {dl.days!==null&&<div style={{textAlign:'right'}}>
                <div style={{fontSize:14,fontWeight:700,color:dl.urgent?'#ef4444':dl.days<=30?'#fb923c':'#4ade80'}}>{dl.days}j</div>
                <span style={{fontSize:8.5,padding:'1px 6px',borderRadius:4,fontWeight:600,textTransform:'uppercase',letterSpacing:'.5px',
                  background:dl.t==='mensuel'?'rgba(96,165,250,.1)':dl.t==='trimestriel'?'rgba(167,139,250,.1)':dl.t==='annuel'?'rgba(198,163,78,.1)':'rgba(74,222,128,.1)',
                  color:dl.t==='mensuel'?'#60a5fa':dl.t==='trimestriel'?'#a78bfa':dl.t==='annuel'?'#c6a34e':'#4ade80'}}>{dl.t}</span>
              </div>}
            </div>
          )}
        </div>
      </C>
    </div>

    {/* VERSION & CHANGELOG */}
    <C style={{marginBottom:16,border:'1px solid rgba(198,163,78,.15)'}}>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
        <div style={{display:'flex',alignItems:'center',gap:10}}>
          <span style={{fontSize:11,padding:'3px 10px',borderRadius:6,background:'linear-gradient(135deg,#c6a34e,#a68a3c)',color:'#060810',fontWeight:700}}>{AUREUS_INFO.version}</span>
          <span style={{fontSize:12,fontWeight:600,color:'#e8e6e0'}}>Aureus Social Pro ‚Äî {AUREUS_INFO.sprint}</span>
        </div>
        <span style={{fontSize:10,color:'#5e5c56'}}>Derni√®re mise √† jour: {new Date().toLocaleDateString('fr-BE')}</span>
      </div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8}}>
        {[
          {v:'v37',title:'Sprint 9',items:['‚öôÔ∏è 13 automatisations (validation obligatoire)','üìÖ Gestion absences pr√©-paie','‚ö° 8 actions en masse multi-clients','üè• Audit sant√© global','üìã Planificateur 14 t√¢ches','üìë 15 Mod√®les documents','üîç Filtres score sant√©'],color:'#06b6d4'},
          {v:'v36',title:'Sprint 8',items:['üìä Budget Auto','üîÆ Simulateur What-If','üìà KPI + Equal Pay'],color:'#f472b6'},
          {v:'v35',title:'Sprint 7',items:['üè™ Marketplace 12 modules','üîó Int√©grations 25+ connecteurs','üîî Webhook Manager'],color:'#a78bfa'},
          {v:'v34',title:'Sprint 6',items:['üåê 4 langues (FR/NL/EN/DE)','üîå API Documentation','üí± Multi-Devises'],color:'#fb923c'},
          {v:'v33',title:'Sprint 5',items:['üß† Pr√©diction Turnover','üí° Reco Salariales IA','üìà Pr√©vision Masse','üîç D√©tection Anomalies','üè• Score Sant√© Dossier'],color:'#f87171'},
          {v:'v32',title:'Sprint 4',items:['‚ö° Batch Processing','üîî Alertes intelligentes','üîê 2FA (TOTP)','üì° DmfA am√©lior√©e'],color:'#a78bfa'},
          {v:'v31',title:'Sprint 3',items:['‚ö° Workflow Embauche','‚ö° Workflow Licenciement','‚ö° Workflow Maladie','üìÇ Export 11 formats + ClearFact'],color:'#60a5fa'},
          {v:'v30',title:'Sprint 2',items:['üì• Import Excel','üí∞ ROI Calculator','üîí Validation NISS/IBAN','üß† 153 CP pr√©-remplissage'],color:'#4ade80'},
        ].map((sp,i)=><div key={i} style={{padding:12,borderRadius:10,background:'rgba(198,163,78,.02)',border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{display:'flex',alignItems:'center',gap:6,marginBottom:6}}>
            <span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:`${sp.color}22`,color:sp.color,fontWeight:700}}>{sp.v}</span>
            <span style={{fontSize:11,fontWeight:600,color:'#e8e6e0'}}>{sp.title}</span>
          </div>
          {sp.items.map((it,j)=><div key={j} style={{fontSize:10,color:'#9e9b93',padding:'2px 0'}}>{it}</div>)}
        </div>)}
      </div>
    </C>

    {/* BOTTOM ROW: Alerts + Actions + Employees + Dept breakdown */}
    {alerts.length>0&&<C style={{marginBottom:16,border:'1px solid '+(alerts.some(a=>a.type==='error')?'rgba(248,113,113,.2)':'rgba(251,146,60,.15)')}}>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
        <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>üîî Alertes intelligentes ({alerts.length})</div>
        <div style={{display:'flex',gap:8}}>
          <span style={{fontSize:10,padding:'2px 8px',borderRadius:10,background:'rgba(248,113,113,.1)',color:'#f87171'}}>{alerts.filter(a=>a.type==='error').length} critiques</span>
          <span style={{fontSize:10,padding:'2px 8px',borderRadius:10,background:'rgba(251,146,60,.1)',color:'#fb923c'}}>{alerts.filter(a=>a.type==='warning').length} avertissements</span>
          <span style={{fontSize:10,padding:'2px 8px',borderRadius:10,background:'rgba(96,165,250,.1)',color:'#60a5fa'}}>{alerts.filter(a=>a.type==='info').length} infos</span>
        </div>
      </div>
      <div style={{maxHeight:200,overflowY:'auto',display:'flex',flexDirection:'column',gap:4}}>
        {alerts.map((a,i)=><div key={i} style={{display:'flex',alignItems:'center',gap:8,padding:'8px 12px',borderRadius:8,background:a.type==='error'?'rgba(248,113,113,.04)':a.type==='warning'?'rgba(251,146,60,.04)':'rgba(96,165,250,.04)',border:'1px solid '+(a.type==='error'?'rgba(248,113,113,.1)':a.type==='warning'?'rgba(251,146,60,.1)':'rgba(96,165,250,.1)')}}>
          <span style={{fontSize:14}}>{a.icon}</span>
          <span style={{flex:1,fontSize:11.5,color:a.type==='error'?'#f87171':a.type==='warning'?'#fb923c':'#60a5fa'}}>{a.msg}</span>
          <span style={{fontSize:9,padding:'2px 6px',borderRadius:4,background:'rgba(198,163,78,.06)',color:'#5e5c56'}}>{a.cat}</span>
        </div>)}
      </div>
    </C>}
    <div style={{display:'grid',gridTemplateColumns:'260px 1fr 300px',gap:14}}>
      {/* QUICK ACTIONS */}
      <C style={{padding:'20px 18px'}}>
        <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:14}}>Actions rapides</div>
        {[
          {l:"+ Nouvel employ√©",p:'employees',i:'‚óâ',c:'#4ade80'},
          {l:"G√©n√©rer fiche de paie",p:'payslip',i:'‚óà',c:'#60a5fa'},
          {l:"Dimona IN/OUT",p:'onss',sb:'dimona',i:'‚¨Ü',c:'#c6a34e'},
          {l:"DmfA trimestrielle",p:'onss',sb:'dmfa',i:'‚óÜ',c:'#a78bfa'},
          {l:"Belcotax 281.10",p:'fiscal',sb:'belcotax',i:'‚óá',c:'#fb923c'},
          {l:"Virement SEPA",p:'reporting',sb:'sepa',i:'‚ñ§',c:'#06b6d4'},
        ].map((a,i)=>
          <button key={i} onClick={()=>d({type:"NAV",page:a.p,sub:a.sb})} style={{display:'flex',alignItems:'center',gap:10,width:'100%',padding:'10px 12px',marginBottom:4,background:"rgba(198,163,78,.03)",border:'1px solid rgba(198,163,78,.06)',borderRadius:8,color:'#d4d0c8',cursor:'pointer',fontSize:12,fontWeight:500,textAlign:'left',fontFamily:'inherit',transition:'all .15s'}}
            onMouseEnter={e=>{e.currentTarget.style.background='rgba(198,163,78,.08)';e.currentTarget.style.borderColor='rgba(198,163,78,.2)';}}
            onMouseLeave={e=>{e.currentTarget.style.background='rgba(198,163,78,.03)';e.currentTarget.style.borderColor='rgba(198,163,78,.06)';}}>
            <span style={{fontSize:14,color:a.c,opacity:.7}}>{a.i}</span>{a.l}
          </button>
        )}
      </C>

      {/* EMPLOYEES LIST */}
      <C style={{padding:'20px 18px',maxHeight:340,overflowY:'auto'}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>√âquipe ({ae.length})</div>
          <button onClick={()=>d({type:"NAV",page:'employees'})} style={{fontSize:10,color:'#c6a34e',background:"none",border:'none',cursor:'pointer',fontFamily:'inherit',fontWeight:500}}>Voir tout ‚Üí</button>
        </div>
        {calcs.slice(0,8).map(({e,c},i)=>(
          <div key={e.id} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'9px 0',borderBottom:'1px solid rgba(255,255,255,.03)',animation:`fadeIn .3s ease ${i*0.04}s both`}}>
            <div style={{display:'flex',alignItems:'center',gap:10}}>
              <div style={{width:32,height:32,borderRadius:8,background:`linear-gradient(135deg,${['#c6a34e',"#60a5fa","#a78bfa","#4ade80","#fb923c","#06b6d4"][i%6]}22,${['#c6a34e',"#60a5fa","#a78bfa","#4ade80","#fb923c","#06b6d4"][i%6]}08)`,display:'flex',alignItems:'center',justifyContent:'center',fontSize:12,fontWeight:700,color:['#c6a34e',"#60a5fa","#a78bfa","#4ade80","#fb923c","#06b6d4"][i%6]}}>{(e.first||'')[0]}{(e.last||'')[0]}</div>
              <div>
                <div style={{fontSize:12.5,fontWeight:500,color:'#e8e6e0'}}>{e.first||e.fn||'Employ√©'} {e.last||''}
                  <span style={{fontSize:8.5,padding:'1px 5px',borderRadius:3,marginLeft:6,fontWeight:600,
                    background:e.status==='sorti'?'rgba(248,113,113,.12)':e.contract==='student'?'rgba(251,146,60,.12)':e.statut==='ouvrier'?'rgba(251,146,60,.1)':'rgba(96,165,250,.08)',
                    color:e.status==='sorti'?'#f87171':e.contract==='student'?'#fb923c':e.statut==='ouvrier'?'#fb923c':'#60a5fa',
                  }}>{e.status==='sorti'?'SORTI':e.contract==='student'?'√âTU':e.statut==='ouvrier'?'OUV':'EMPL'}</span>
                </div>
                <div style={{fontSize:10,color:'#5e5c56'}}>{e.fn||'‚Äî'} ¬∑ CP {e.cp||'200'}</div>
              </div>
            </div>
            <div style={{textAlign:'right'}}>
              <div style={{fontSize:13,fontWeight:600,color:'#4ade80'}}>{fmt(c.net)}</div>
              <div style={{fontSize:9,color:'#5e5c56'}}>co√ªt: {fmt(c.costTotal)}</div>
            </div>
          </div>
        ))}
        {ae.length>8&&<div style={{textAlign:'center',padding:'10px 0',fontSize:11,color:'#8b7340'}}>+ {ae.length-8} autre{ae.length-8>1?'s':''}</div>}
      </C>

      {/* DEPARTMENT BREAKDOWN */}
      <C style={{padding:'20px 18px'}}>
        <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:16}}>R√©partition par d√©partement</div>
        {Object.entries(depts).sort((a,b)=>b[1].mass-a[1].mass).map(([dp,data],i)=>{
          const pct=tm>0?Math.round(data.mass/tm*100):0;
          return <div key={dp} style={{marginBottom:12,animation:`fadeIn .3s ease ${i*0.06}s both`}}>
            <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
              <div style={{fontSize:11.5,color:'#d4d0c8',fontWeight:500}}>{dp} <span style={{color:'#5e5c56',fontWeight:400}}>({data.count})</span></div>
              <div style={{fontSize:11,color:'#c6a34e',fontWeight:600}}>{fmt(data.mass)}</div>
            </div>
            <div style={{height:6,background:"rgba(198,163,78,.06)",borderRadius:3,overflow:'hidden'}}>
              <div style={{height:'100%',width:`${pct}%`,background:"linear-gradient(90deg,#c6a34e,#e2c878)",borderRadius:3,transition:'width .8s ease'}}/>
            </div>
            <div style={{fontSize:9,color:'#5e5c56',marginTop:2}}>{pct}% de la masse salariale</div>
          </div>;
        })}
        {Object.keys(depts).length===0&&<div style={{textAlign:'center',color:'#5e5c56',fontSize:12,padding:20}}>Aucun employ√©</div>}
        <div style={{marginTop:16,padding:'12px 14px',background:"rgba(198,163,78,.03)",borderRadius:8,border:'1px solid rgba(198,163,78,.06)'}}>
          <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
            <span style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'1px'}}>Ratio net/brut</span>
            <span style={{fontSize:13,fontWeight:700,color:'#4ade80'}}>{tm>0?Math.round(tn/tm*100):0}%</span>
          </div>
          <div style={{display:'flex',justifyContent:'space-between'}}>
            <span style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'1px'}}>Co√ªt/brut</span>
            <span style={{fontSize:13,fontWeight:700,color:'#a78bfa'}}>{tm>0?((tc/tm)*100).toFixed(0):0}%</span>
          </div>
        </div>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EMPLOYEES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function Employees({s,d}) {
  const [form,setF]=useState(null);
  const [ed,setEd]=useState(false);
  const [search,setSearch]=useState('');
  const [filter,setFilter]=useState('all'); // all, active, sorti, student, ouvrier
  const [viewMode,setViewMode]=useState('list'); // list, grid
  const empty={first:'',last:'',niss:'',birth:'',addr:'',city:'',zip:'',startD:'',endD:'',fn:"",dept:'',contract:'CDI',regime:'full',whWeek:38,monthlySalary:0,civil:"single",depChildren:0,handiChildren:0,iban:'',mvT:10,mvW:1.09,mvE:8.91,expense:0,cp:'200',dmfaCode:'495',dimType:'OTH',commDist:0,commType:'none',commMonth:0,status:'active',sexe:'M',statut:'employe',niveauEtude:'sec',carFuel:"none",carCO2:0,carCatVal:0,carBrand:"",carModel:"",atnGSM:false,atnPC:false,atnInternet:false,atnLogement:false,atnLogementRC:0,atnChauffage:false,atnElec:false,depAscendant:0,depAscendantHandi:0,conjointHandicap:false,depAutres:0,anciennete:0,nrEngagement:0,engagementTrimestre:1,
    veloSociete:false,veloType:'none',veloValeur:0,veloLeasingMois:0,carteCarburant:false,carteCarburantMois:0,borneRecharge:false,borneRechargeCo√ªt:0,
    frontalier:false,frontalierPays:'',frontalierConvention:'',frontalierA1:false,frontalierExoPP:false,
    pensionn√©:false,pensionType:'none',pensionAge:0,pensionCarriere:0,pensionCumulIllimite:false,pensionMontant:0,
  };
  // ‚îÄ‚îÄ NISS VALIDATION ‚îÄ‚îÄ
  const validateNISS=(niss)=>{
    if(!niss)return{valid:false,msg:'NISS requis'};
    const clean=niss.replace(/[\s.\-]/g,'');
    if(clean.length!==11||!/^\d{11}$/.test(clean))return{valid:false,msg:'NISS doit contenir 11 chiffres'};
    // Check digit (modulo 97)
    const base=clean.slice(0,9);
    const check=parseInt(clean.slice(9));
    // Born before 2000
    let mod=97-(parseInt(base)%97);
    if(mod===check)return{valid:true,msg:'‚úÖ NISS valide'};
    // Born after 2000 (prefix with 2)
    mod=97-(parseInt('2'+base)%97);
    if(mod===check)return{valid:true,msg:'‚úÖ NISS valide (n√©(e) apr√®s 2000)'};
    return{valid:false,msg:'‚ùå NISS invalide ‚Äî chiffre de contr√¥le incorrect'};
  };

  // ‚îÄ‚îÄ NISS DUPLICATE DETECTION ‚îÄ‚îÄ
  const checkNISSDuplicate=(niss,currentId)=>{
    if(!niss)return null;
    const clean=niss.replace(/[\s.\-]/g,'');
    // Level 1: Same dossier
    const dupLocal=s.emps.find(e=>e.niss&&e.niss.replace(/[\s.\-]/g,'')===clean&&e.id!==currentId);
    if(dupLocal)return{level:'error',msg:`‚õî NISS d√©j√† utilis√© dans ce dossier: ${dupLocal.first} ${dupLocal.last}`};
    // Level 2: Platform-wide (check all clients)
    const allClients=s.clients||[];
    for(const cl of allClients){
      if(cl.id===s.activeClient)continue;
      const dupPlatform=(cl.emps||[]).find(e=>e.niss&&e.niss.replace(/[\s.\-]/g,'')===clean);
      if(dupPlatform)return{level:'warn',msg:`‚ö†Ô∏è NISS existe dans le dossier ${cl.company?.name||'autre'}: ${dupPlatform.first} ${dupPlatform.last}. Transfert?`};
    }
    return null;
  };

  // ‚îÄ‚îÄ IBAN VALIDATION ‚îÄ‚îÄ
  const validateIBAN=(iban)=>{
    if(!iban)return null;
    const clean=iban.replace(/\s/g,'').toUpperCase();
    if(clean.length<15||clean.length>34)return{valid:false,msg:'‚ùå Longueur IBAN incorrecte'};
    if(!/^[A-Z]{2}\d{2}/.test(clean))return{valid:false,msg:'‚ùå Format IBAN invalide (doit commencer par 2 lettres + 2 chiffres)'};
    // Belgian IBAN check
    if(clean.startsWith('BE')&&clean.length!==16)return{valid:false,msg:'‚ùå IBAN belge = 16 caract√®res (BE + 14 chiffres)'};
    // Modulo 97 check
    const rearranged=clean.slice(4)+clean.slice(0,4);
    const numeric=rearranged.split('').map(c=>/\d/.test(c)?c:(c.charCodeAt(0)-55).toString()).join('');
    let remainder=numeric.slice(0,2);
    for(let i=2;i<numeric.length;i++){
      remainder=((parseInt(remainder+numeric[i]))%97).toString();
    }
    if(parseInt(remainder)!==1)return{valid:false,msg:'‚ùå IBAN invalide ‚Äî chiffre de contr√¥le incorrect'};
    return{valid:true,msg:`‚úÖ IBAN valide (${clean.slice(0,2)})`};
  };

  const [nissCheck,setNissCheck]=useState(null);
  const [nissDup,setNissDup]=useState(null);
  const [ibanCheck,setIbanCheck]=useState(null);

  const onNissChange=(v)=>{
    setF({...form,niss:v});
    if(v.replace(/[\s.\-]/g,'').length>=11){
      setNissCheck(validateNISS(v));
      setNissDup(checkNISSDuplicate(v,form.id));
    }else{setNissCheck(null);setNissDup(null);}
  };
  const onIbanChange=(v)=>{
    setF({...form,iban:v});
    if(v.replace(/\s/g,'').length>=15)setIbanCheck(validateIBAN(v));
    else setIbanCheck(null);
  };

  // ‚îÄ‚îÄ IMPORT EXCEL ‚îÄ‚îÄ
  const [importing,setImporting]=useState(false);
  const handleImportExcel=async(e)=>{
    const file=e.target.files?.[0];
    if(!file)return;
    setImporting(true);
    try{
      const XLSX=await import('https://cdn.sheetjs.com/xlsx-0.20.1/package/xlsx.mjs');
      const buf=await file.arrayBuffer();
      const wb=XLSX.read(buf);
      const ws=wb.Sheets[wb.SheetNames[0]];
      const rows=XLSX.utils.sheet_to_json(ws);
      let added=0;
      for(const r of rows){
        const emp={
          ...empty,
          first:r['Pr√©nom']||r['Prenom']||r['prenom']||r['first']||r['First']||'',
          last:r['Nom']||r['nom']||r['last']||r['Last']||'',
          niss:String(r['NISS']||r['niss']||r['Registre national']||''),
          fn:r['Fonction']||r['fonction']||r['function']||'',
          dept:r['D√©partement']||r['Departement']||r['dept']||'',
          contract:r['Contrat']||r['contrat']||r['Type']||'CDI',
          cp:String(r['CP']||r['cp']||r['Commission paritaire']||'200'),
          monthlySalary:parseFloat(r['Brut']||r['brut']||r['Salaire']||r['salaire']||0),
          startD:r['Entr√©e']||r['Entree']||r['Date entr√©e']||r['startD']||'',
          iban:r['IBAN']||r['iban']||'',
          statut:r['Statut']||r['statut']||'employe',
          sexe:r['Sexe']||r['sexe']||'M',
          status:'active',
        };
        if(emp.first||emp.last){
          d({type:'ADD_E',d:emp});
          added++;
        }
      }
      alert(`‚úÖ ${added} travailleur(s) import√©(s) depuis ${file.name}`);
    }catch(err){
      alert('‚ùå Erreur import: '+err.message);
    }
    setImporting(false);
    e.target.value='';
  };

  // ‚îÄ‚îÄ PR√â-REMPLISSAGE INTELLIGENT PAR CP (r√©f√©rence globale optimis√©e) ‚îÄ‚îÄ
  const onCPChange=(v)=>{
    const preset=CP_PRESETS_FULL[v];
    if(preset&&!ed){
      setF({...form,cp:v,
        fn:preset.fn,
        statut:preset.statut,
        monthlySalary:preset.monthlySalary,
        whWeek:preset.whWeek
      });
    }else{
      setF({...form,cp:v});
    }
  };

  // ‚îÄ‚îÄ ROI CALCULATOR ‚îÄ‚îÄ
  const [showROI,setShowROI]=useState(false);
  const [roiData,setRoiData]=useState({nbEmps:10,prixActuel:35,prixAureus:12});
  const roiSaving=(roiData.prixActuel-roiData.prixAureus)*roiData.nbEmps;
  const roiSavingYear=roiSaving*12;
  const roiPercent=roiData.prixActuel>0?Math.round((1-roiData.prixAureus/roiData.prixActuel)*100):0;

  const save=()=>{
    if(!form.first||!form.last)return alert('Nom requis');
    // NISS validation
    if(form.niss){
      const nc=validateNISS(form.niss);
      if(!nc.valid)return alert(nc.msg);
      const dup=checkNISSDuplicate(form.niss,form.id);
      if(dup&&dup.level==='error')return alert(dup.msg);
    }
    // IBAN validation
    if(form.iban){
      const ic=validateIBAN(form.iban);
      if(ic&&!ic.valid)return alert(ic.msg);
    }
    if(ed)d({type:"UPD_E",d:form});else d({type:"ADD_E",d:form});setF(null);setEd(false);
  };

  // Filter and search
  const filtered=s.emps.filter(e=>{
    if(filter==='active'&&e.status==='sorti')return false;
    if(filter==='sorti'&&e.status!=='sorti')return false;
    if(filter==='student'&&e.contract!=='student')return false;
    if(filter==='ouvrier'&&e.statut!=='ouvrier')return false;
    if(search){
      const q=search.toLowerCase();
      return `${e.first||e.fn||'Emp'} ${e.last||''} ${e.fn} ${e.niss} ${e.dept} ${e.cp}`.toLowerCase().includes(q);
    }
    return true;
  });

  // CSV Export
  const exportCSV=()=>{
    const headers=['Pr√©nom',"Nom","NISS","Fonction","D√©partement","Contrat","CP","Brut","Statut","Entr√©e","IBAN"];
    const rows=filtered.map(e=>[e.first,e.last,e.niss,e.fn,e.dept,e.contract,e.cp,e.monthlySalary,e.status||'active',e.startD,e.iban]);
    const csv=[headers,...rows].map(r=>r.map(c=>`"${(c||'').toString().replace(/"/g,'""')}"`).join(';')).join('\n');
    const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;a.download=`employees_${new Date().toISOString().slice(0,10)}.csv`;a.click();
    URL.revokeObjectURL(url);
  };

  const activeCount=s.emps.filter(e=>e.status!=='sorti').length;
  const sortiCount=s.emps.filter(e=>e.status==='sorti').length;
  const studentCount=s.emps.filter(e=>e.contract==='student').length;

  return <div>
    <PH title="Gestion des Employ√©s" sub={`${s.emps.length} employ√©(s)`} actions={<div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
      <label style={{padding:'8px 14px',borderRadius:8,fontSize:11,cursor:'pointer',border:'1px solid rgba(198,163,78,.25)',background:'transparent',color:'#c6a34e',fontWeight:600,display:'flex',alignItems:'center',gap:4}}>
        üì• {importing?'Import...':'Import Excel'}
        <input type="file" accept=".xlsx,.xls,.csv" onChange={handleImportExcel} style={{display:'none'}}/>
      </label>
      <B v="outline" onClick={()=>setShowROI(!showROI)} style={{padding:'8px 14px',fontSize:11}}>üí∞ ROI</B>
      <B v="outline" onClick={exportCSV} style={{padding:'8px 14px',fontSize:11}}>‚¨á CSV</B>
      <B onClick={()=>{setF({...empty});setEd(false);}}>+ Nouvel employ√©</B>
    </div>}/>
    {/* Search and filters bar */}
    <div style={{display:'flex',gap:10,marginBottom:16,alignItems:'center',flexWrap:'wrap'}}>
      <div style={{flex:1,minWidth:200,position:'relative'}}>
        <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="üîç Rechercher par nom, NISS, fonction, d√©partement..."
          style={{width:'100%',padding:'10px 14px 10px 14px',background:"#090c16",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,color:'#d4d0c8',fontSize:12.5,fontFamily:'inherit',outline:'none',boxSizing:'border-box'}}/>
      </div>
      <div style={{display:'flex',gap:4}}>
        {[
          {id:"all",l:`Tous (${s.emps.length})`},
          {id:"active",l:`Actifs (${activeCount})`},
          {id:"sorti",l:`Sortis (${sortiCount})`},
          {id:"student",l:`√âtudiants (${studentCount})`},
        ].map(f=>
          <button key={f.id} onClick={()=>setFilter(f.id)} style={{padding:'7px 12px',borderRadius:6,fontSize:11,fontWeight:filter===f.id?600:400,border:'1px solid '+(filter===f.id?'rgba(198,163,78,.3)':'rgba(139,115,60,.1)'),background:filter===f.id?'rgba(198,163,78,.1)':'transparent',color:filter===f.id?'#c6a34e':'#5e5c56',cursor:'pointer',fontFamily:'inherit',transition:'all .15s'}}>{f.l}</button>
        )}
      </div>
      <div style={{display:'flex',gap:2,background:"rgba(198,163,78,.04)",borderRadius:6,border:'1px solid rgba(139,115,60,.1)',overflow:'hidden'}}>
        <button onClick={()=>setViewMode('list')} style={{padding:'6px 10px',border:'none',background:viewMode==='list'?'rgba(198,163,78,.15)':'transparent',color:viewMode==='list'?'#c6a34e':'#5e5c56',cursor:'pointer',fontSize:13}}>‚ò∞</button>
        <button onClick={()=>setViewMode('grid')} style={{padding:'6px 10px',border:'none',background:viewMode==='grid'?'rgba(198,163,78,.15)':'transparent',color:viewMode==='grid'?'#c6a34e':'#5e5c56',cursor:'pointer',fontSize:13}}>‚äû</button>
      </div>
    </div>
    {/* ROI Calculator */}
    {showROI&&<C style={{marginBottom:20,border:'1px solid rgba(198,163,78,.25)'}}>
      <h3 style={{fontSize:15,fontWeight:600,color:'#c6a34e',margin:'0 0 12px'}}>üí∞ Calculateur ROI ‚Äî √âconomies vs secr√©tariat social</h3>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12,marginBottom:16}}>
        <I label="Nombre de travailleurs" type="number" value={roiData.nbEmps} onChange={v=>setRoiData({...roiData,nbEmps:parseInt(v)||0})}/>
        <I label="Prix actuel / fiche (‚Ç¨)" type="number" value={roiData.prixActuel} onChange={v=>setRoiData({...roiData,prixActuel:parseFloat(v)||0})}/>
        <I label="Prix Aureus / fiche (‚Ç¨)" type="number" value={roiData.prixAureus} onChange={v=>setRoiData({...roiData,prixAureus:parseFloat(v)||0})}/>
      </div>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12}}>
        <div style={{padding:16,borderRadius:10,background:'rgba(74,222,128,.06)',border:'1px solid rgba(74,222,128,.15)',textAlign:'center'}}>
          <div style={{fontSize:10,color:'#9e9b93',marginBottom:4}}>√âconomie / mois</div>
          <div style={{fontSize:22,fontWeight:700,color:'#4ade80'}}>{roiSaving.toFixed(0)} ‚Ç¨</div>
        </div>
        <div style={{padding:16,borderRadius:10,background:'rgba(198,163,78,.06)',border:'1px solid rgba(198,163,78,.15)',textAlign:'center'}}>
          <div style={{fontSize:10,color:'#9e9b93',marginBottom:4}}>√âconomie / an</div>
          <div style={{fontSize:22,fontWeight:700,color:'#c6a34e'}}>{roiSavingYear.toFixed(0)} ‚Ç¨</div>
        </div>
        <div style={{padding:16,borderRadius:10,background:'rgba(96,165,250,.06)',border:'1px solid rgba(96,165,250,.15)',textAlign:'center'}}>
          <div style={{fontSize:10,color:'#9e9b93',marginBottom:4}}>R√©duction</div>
          <div style={{fontSize:22,fontWeight:700,color:'#60a5fa'}}>{roiPercent}%</div>
        </div>
      </div>
      <div style={{marginTop:12,fontSize:11,color:'#5e5c56',textAlign:'center'}}>
        Compar√© √† {roiData.prixActuel}‚Ç¨/fiche chez Securex, SD Worx, Partena ‚Äî Aureus √† {roiData.prixAureus}‚Ç¨/fiche
      </div>
    </C>}
    {form&&<C style={{marginBottom:20}}>
      <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 16px',fontFamily:"'Cormorant Garamond',serif"}}>{ed?'Modifier':'Nouvel employ√©'}</h2>
      <ST>Identit√©</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10}}>
        <I label="Pr√©nom" value={form.first} onChange={v=>setF({...form,first:v})}/>
        <I label="Nom" value={form.last} onChange={v=>setF({...form,last:v})}/>
        <div>
          <I label="NISS" value={form.niss} onChange={onNissChange}/>
          {nissCheck&&<div style={{fontSize:10,marginTop:2,color:nissCheck.valid?'#4ade80':'#f87171'}}>{nissCheck.msg}</div>}
          {nissDup&&<div style={{fontSize:10,marginTop:2,color:nissDup.level==='error'?'#f87171':'#fb923c'}}>{nissDup.msg}</div>}
        </div>
        <I label="Naissance" type="date" value={form.birth} onChange={v=>setF({...form,birth:v})}/>
        <I label="Sexe" value={form.sexe} onChange={v=>setF({...form,sexe:v})} options={[{v:"M",l:"Homme"},{v:"F",l:"Femme"},{v:"X",l:"Non-binaire"}]}/>
        <I label="Statut" value={form.statut} onChange={v=>setF({...form,statut:v})} options={[{v:"employe",l:"Employ√©"},{v:"ouvrier",l:"Ouvrier"},{v:"etudiant",l:"√âtudiant"},{v:"apprenti",l:"Apprenti"},{v:"dirigeant",l:"Dirigeant d\'entreprise"}]}/>
        <I label="Adresse" value={form.addr} onChange={v=>setF({...form,addr:v})} span={2}/>
        <I label="CP" value={form.zip} onChange={v=>setF({...form,zip:v})}/>
        <I label="Ville" value={form.city} onChange={v=>setF({...form,city:v})}/>
        <div>
          <I label="IBAN" value={form.iban} onChange={onIbanChange}/>
          {ibanCheck&&<div style={{fontSize:10,marginTop:2,color:ibanCheck.valid?'#4ade80':'#f87171'}}>{ibanCheck.msg}</div>}
        </div>
        <I label="Niveau d'√©tudes" value={form.niveauEtude} onChange={v=>setF({...form,niveauEtude:v})} options={[{v:"prim",l:"Primaire"},{v:"sec_inf",l:"Secondaire inf√©rieur"},{v:"sec",l:"Secondaire sup√©rieur"},{v:"sup",l:"Sup√©rieur non-universitaire (bachelier)"},{v:"univ",l:"Universitaire (master/doctorat)"}]}/>
      </div>
      <ST>Contrat</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10}}>
        <I label="Fonction" value={form.fn} onChange={v=>setF({...form,fn:v})}/>
        <I label="D√©partement" value={form.dept} onChange={v=>setF({...form,dept:v})}/>
        <I label="Entr√©e" type="date" value={form.startD} onChange={v=>setF({...form,startD:v})}/>
        <I label="Contrat" value={form.contract} onChange={v=>setF({...form,contract:v})} options={[
          {v:"CDI",l:"CDI"},{v:"CDD",l:"CDD"},{v:"trav_det",l:"Travail nettement d√©fini"},{v:"remplacement",l:"Remplacement"},
          {v:"tpartiel",l:"Temps partiel"},{v:"interim",l:"Int√©rimaire"},{v:"student",l:"√âtudiant (650h)"},
          {v:"flexi",l:"Flexi-job"},{v:"saisonnier",l:"Saisonnier"},{v:"occas_horeca",l:"Extra Horeca"},
          {v:"titre_service",l:"Titres-services"},{v:"art60",l:"Art. 60¬ß7 (CPAS)"},{v:"CIP",l:"Convention immersion"},
          {v:"alternance",l:"Alternance"},{v:"CPE",l:"Premier emploi"},{v:"ETA",l:"Travail adapt√©"},
          {v:"detache",l:"D√©tach√©"},{v:"domestique",l:"Domestique"},{v:"teletravail",l:"T√©l√©travail struct."},
          {v:"domicile",l:"Travail √† domicile"},{v:"indep_princ",l:"Ind√©p. principal"},
          {v:"indep_compl",l:"Ind√©p. compl√©mentaire"},{v:"mandataire",l:"Mandataire soci√©t√©"},
          {v:"freelance",l:"Freelance/Consultant"},{v:"smart",l:"Smart (portage)"},
          {v:"volontariat",l:"Volontariat"},{v:"artiste",l:"Artiste (ATA)"},{v:"sportif",l:"Sportif r√©mun√©r√©"},
          {v:"plateforme",l:"√âconomie plateforme"}
        ]}/>
        <I label="H/sem" type="number" value={form.whWeek} onChange={v=>setF({...form,whWeek:v})}/>
        <I label="CP" value={form.cp} onChange={onCPChange} options={Object.entries(LEGAL.CP).map(([k,v])=>({v:k,l:v}))}/>
        <I label="Code DMFA" value={form.dmfaCode} onChange={v=>setF({...form,dmfaCode:v})} options={Object.entries(LEGAL.DMFA_CODES).map(([k,v])=>({v:k,l:`${k} - ${v}`}))}/>
        <I label="Rang engagement" value={form.nrEngagement||0} onChange={v=>setF({...form,nrEngagement:parseInt(v)||0})} options={[{v:0,l:"‚Äî Pas de r√©duction ‚Äî"},{v:1,l:"1er employ√© (exo totale)"},{v:2,l:"2√® employ√©"},{v:3,l:"3√® employ√©"},{v:4,l:"4√® employ√©"},{v:5,l:"5√® employ√©"},{v:6,l:"6√® employ√©"}]}/>
        {form.nrEngagement>0&&<I label="Trimestre depuis eng." type="number" value={form.engagementTrimestre||1} onChange={v=>setF({...form,engagementTrimestre:parseInt(v)||1})}/>}
      </div>
      <ST>Grille horaire (Loi 16/03/1971 + R√®glement de travail)</ST>
      <div style={{padding:10,background:"rgba(198,163,78,.03)",borderRadius:8,border:'1px solid rgba(198,163,78,.08)'}}>
        <div style={{display:'flex',gap:6,marginBottom:8,alignItems:'center'}}>
          <span style={{fontSize:11,color:'#9e9b93',fontWeight:600,width:70}}>Fraction:</span>
          <span style={{fontSize:13,fontWeight:700,color:(form.whWeek||38)>=38?'#4ade80':'#fb923c'}}>{Math.round((form.whWeek||38)/38*100)}%</span>
          <span style={{fontSize:10.5,color:'#5e5c56',marginLeft:6}}>({form.whWeek||38}h / 38h r√©f.) ‚Äî {(form.whWeek||38)>=38?'Temps plein':'Temps partiel'}</span>
          <span style={{fontSize:10.5,color:'#5e5c56',marginLeft:'auto'}}>{((form.whWeek||38)/5).toFixed(2)}h/jour ¬∑ Pause: 30min (si {'>'} 6h)</span>
        </div>
        <table style={{width:'100%',borderCollapse:'collapse',fontSize:11}}>
          <thead><tr style={{borderBottom:'1px solid rgba(198,163,78,.15)'}}>
            {['',"Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Total"].map(h=><th key={h} style={{padding:'4px 6px',fontSize:10,color:'#9e9b93',textAlign:'center',fontWeight:600}}>{h}</th>)}
          </tr></thead>
          <tbody>
            <tr>
              <td style={{padding:'4px 6px',fontSize:10,color:'#9e9b93'}}>D√©but</td>
              {['lu',"ma","me","je","ve","sa"].map(d=><td key={d}><input type="time" defaultValue={d==='sa'?'':'09:00'} style={{width:'100%',background:"rgba(198,163,78,.05)",border:'1px solid rgba(198,163,78,.1)',borderRadius:4,padding:'3px 4px',fontSize:10,color:'#e8e6e0',textAlign:'center'}} onChange={e=>setF({...form,[`h_${d}_de`]:e.target.value})}/></td>)}
              <td rowSpan={2} style={{textAlign:'center',verticalAlign:'middle'}}>
                <div style={{fontSize:16,fontWeight:700,color:'#c6a34e'}}>{form.whWeek||38}h</div>
                <div style={{fontSize:9,color:'#5e5c56'}}>/semaine</div>
              </td>
            </tr>
            <tr>
              <td style={{padding:'4px 6px',fontSize:10,color:'#9e9b93'}}>Fin</td>
              {['lu',"ma","me","je","ve","sa"].map(d=><td key={d}><input type="time" defaultValue={d==='sa'?'':'17:36'} style={{width:'100%',background:"rgba(198,163,78,.05)",border:'1px solid rgba(198,163,78,.1)',borderRadius:4,padding:'3px 4px',fontSize:10,color:'#e8e6e0',textAlign:'center'}} onChange={e=>setF({...form,[`h_${d}_a`]:e.target.value})}/></td>)}
            </tr>
          </tbody>
        </table>
        <div style={{marginTop:8,fontSize:9.5,color:'#5e5c56',lineHeight:1.5}}>
          ‚è± <b>Temps plein</b> = 38h/sem (Art. 19 Loi 16/03/1971). <b>Temps partiel</b> = min. 1/3 temps plein (‚â•12h40). Horaire variable possible (Art. 11bis). D√©rogation samedi/dimanche = CCT sectorielle ou accord d'entreprise.
        </div>
      </div>
      <ST>R√©mun√©ration</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10}}>
        <I label="Brut mensuel (‚Ç¨)" type="number" value={form.monthlySalary} onChange={v=>setF({...form,monthlySalary:v})}/>
        <I label="CR total (‚Ç¨)" type="number" value={form.mvT} onChange={v=>setF({...form,mvT:v})}/>
        <I label="CR part trav. (‚Ç¨)" type="number" value={form.mvW} onChange={v=>setF({...form,mvW:v})}/>
        <I label="CR part empl. (‚Ç¨)" type="number" value={form.mvE} onChange={v=>setF({...form,mvE:v})}/>
        <I label="Frais propres (‚Ç¨)" type="number" value={form.expense} onChange={v=>setF({...form,expense:v})}/>
        <I label="Transport domicile-travail" value={form.commType} onChange={v=>setF({...form,commType:v})} options={[{v:"none",l:"Aucun"},{v:"train",l:"üöÜ Train (SNCB)"},{v:"bus",l:"üöå Bus/Tram/M√©tro (STIB/TEC/De Lijn)"},{v:"bike",l:"üö≤ V√©lo"},{v:"car",l:"üöó Voiture priv√©e"},{v:"carpool",l:"üöó Covoiturage"},{v:"mixed",l:"üîÑ Combin√© (train+autre)"},{v:"company_car",l:"üè¢ Voiture de soci√©t√© (pas d\'interv.)"}]}/>
        {form.commType!=='none'&&form.commType!=='company_car'&&<I label="Distance simple (km)" type="number" value={form.commDist} onChange={v=>setF({...form,commDist:v})}/>}
        {(form.commType==='train'||form.commType==='bus'||form.commType==='mixed')&&<I label="Abonnement mensuel (‚Ç¨)" type="number" value={form.commMonth} onChange={v=>setF({...form,commMonth:v})}/>}
      </div>
      {form.commType!=='none'&&form.commType!=='company_car'&&<div style={{marginTop:8,padding:10,background:"rgba(96,165,250,.04)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.6}}>
        {form.commType==='train'&&'üöÜ Train SNCB: intervention employeur obligatoire = 75% de l\'abonnement (CCT 19/9). Exon√©r√© ONSS et IPP.'}
        {form.commType==='bus'&&'üöå Transport en commun: intervention obligatoire = prix abonnement SNCB pour m√™me distance (CCT 19/9). Exon√©r√© ONSS et IPP.'}
        {form.commType==='bike'&&`üö≤ V√©lo: indemnit√© ${form.commDist>0?((form.commDist*2*0.27).toFixed(2)+'‚Ç¨/jour = '):''}0,27 ‚Ç¨/km A/R (2026). Exon√©r√© ONSS et IPP (max 0,27‚Ç¨/km). Cumulable avec transport en commun.`}
        {form.commType==='car'&&`üöó Voiture priv√©e: pas d'obligation l√©gale (sauf CCT sectorielle). Si intervention: exon√©r√© ONSS jusqu'√† 490‚Ç¨/an. Distance: ${form.commDist||0} km √ó 2 = ${(form.commDist||0)*2} km A/R.`}
        {form.commType==='carpool'&&'üöó Covoiturage: m√™mes r√®gles que voiture priv√©e pour le conducteur. Passager = indemnit√© possible exon√©r√©e.'}
        {form.commType==='mixed'&&'üîÑ Combin√©: cumul possible train + v√©lo ou train + voiture. Chaque trajet est indemnis√© s√©par√©ment selon son mode.'}
      </div>}
      <ST>V√©hicule de soci√©t√© (ATN)</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10}}>
        <I label="Carburant" value={form.carFuel} onChange={v=>setF({...form,carFuel:v})} options={[{v:"none",l:"Pas de v√©hicule"},{v:"essence",l:"Essence"},{v:"diesel",l:"Diesel"},{v:"lpg",l:"LPG/CNG"},{v:"electrique",l:"√âlectrique"},{v:"hybride",l:"Hybride PHEV"}]}/>
        <I label="CO2 g/km" type="number" value={form.carCO2} onChange={v=>setF({...form,carCO2:v})}/>
        <I label="Valeur catalogue (‚Ç¨)" type="number" value={form.carCatVal} onChange={v=>setF({...form,carCatVal:v})}/>
        <I label="Marque" value={form.carBrand} onChange={v=>setF({...form,carBrand:v})} options={[
          {v:"",l:"‚Äî S√©lectionner ‚Äî"},{v:"Aiways",l:"Aiways"},{v:"Alfa Romeo",l:"Alfa Romeo"},{v:"Alpine",l:"Alpine"},{v:"Aston Martin",l:"Aston Martin"},
          {v:"Audi",l:"Audi"},{v:"Bentley",l:"Bentley"},{v:"BMW",l:"BMW"},{v:"BYD",l:"BYD"},{v:"Cadillac",l:"Cadillac"},
          {v:"Chevrolet",l:"Chevrolet"},{v:"Chrysler",l:"Chrysler"},{v:"Citro√´n",l:"Citro√´n"},{v:"Cupra",l:"Cupra"},{v:"Dacia",l:"Dacia"},
          {v:"Dodge",l:"Dodge"},{v:"DS",l:"DS Automobiles"},{v:"Ferrari",l:"Ferrari"},{v:"Fiat",l:"Fiat"},{v:"Ford",l:"Ford"},
          {v:"Genesis",l:"Genesis"},{v:"Honda",l:"Honda"},{v:"Hyundai",l:"Hyundai"},{v:"Infiniti",l:"Infiniti"},{v:"Isuzu",l:"Isuzu"},
          {v:"Jaguar",l:"Jaguar"},{v:"Jeep",l:"Jeep"},{v:"Kia",l:"Kia"},{v:"Lamborghini",l:"Lamborghini"},{v:"Land Rover",l:"Land Rover"},
          {v:"Lexus",l:"Lexus"},{v:"Lotus",l:"Lotus"},{v:"Lynk & Co",l:"Lynk & Co"},{v:"Maserati",l:"Maserati"},{v:"Mazda",l:"Mazda"},
          {v:"McLaren",l:"McLaren"},{v:"Mercedes",l:"Mercedes-Benz"},{v:"MG",l:"MG"},{v:"Mini",l:"Mini"},{v:"Mitsubishi",l:"Mitsubishi"},
          {v:"NIO",l:"NIO"},{v:"Nissan",l:"Nissan"},{v:"Opel",l:"Opel"},{v:"Peugeot",l:"Peugeot"},{v:"Polestar",l:"Polestar"},
          {v:"Porsche",l:"Porsche"},{v:"Renault",l:"Renault"},{v:"Rolls-Royce",l:"Rolls-Royce"},{v:"Seat",l:"Seat"},{v:"≈†koda",l:"≈†koda"},
          {v:"Smart",l:"Smart"},{v:"SsangYong",l:"SsangYong"},{v:"Subaru",l:"Subaru"},{v:"Suzuki",l:"Suzuki"},{v:"Tesla",l:"Tesla"},
          {v:"Toyota",l:"Toyota"},{v:"Volkswagen",l:"Volkswagen"},{v:"Volvo",l:"Volvo"},{v:"XPeng",l:"XPeng"},{v:"Autre",l:"Autre"}
        ]}/>
        <I label="Mod√®le" value={form.carModel} onChange={v=>setF({...form,carModel:v})} options={[
          {v:"",l:"‚Äî S√©lectionner ‚Äî"},...((CAR_MODELS[form.carBrand]||[]).map(m=>({v:m,l:m}))),{v:"_autre",l:"Autre mod√®le"}
        ]}/>
      </div>
      <ST>Avantages en nature (ATN)</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10}}>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>üì± GSM/T√©l√©phone (36‚Ç¨/an)</div>
          <div onClick={()=>setF({...form,atnGSM:!form.atnGSM})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.atnGSM?'rgba(198,163,78,.15)':'rgba(198,163,78,.04)',color:form.atnGSM?'#c6a34e':'#5e5c56',border:'1px solid '+(form.atnGSM?'rgba(198,163,78,.3)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.atnGSM?'‚úÖ OUI ‚Äî 3,00 ‚Ç¨/mois':'‚ùå NON'}
          </div>
        </div>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>üíª PC/Tablette (72‚Ç¨/an)</div>
          <div onClick={()=>setF({...form,atnPC:!form.atnPC})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.atnPC?'rgba(198,163,78,.15)':'rgba(198,163,78,.04)',color:form.atnPC?'#c6a34e':'#5e5c56',border:'1px solid '+(form.atnPC?'rgba(198,163,78,.3)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.atnPC?'‚úÖ OUI ‚Äî 6,00 ‚Ç¨/mois':'‚ùå NON'}
          </div>
        </div>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>üåê Internet priv√© (60‚Ç¨/an)</div>
          <div onClick={()=>setF({...form,atnInternet:!form.atnInternet})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.atnInternet?'rgba(198,163,78,.15)':'rgba(198,163,78,.04)',color:form.atnInternet?'#c6a34e':'#5e5c56',border:'1px solid '+(form.atnInternet?'rgba(198,163,78,.3)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.atnInternet?'‚úÖ OUI ‚Äî 5,00 ‚Ç¨/mois':'‚ùå NON'}
          </div>
        </div>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>üè† Logement gratuit (RC √ó coeff.)</div>
          <div onClick={()=>setF({...form,atnLogement:!form.atnLogement})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.atnLogement?'rgba(198,163,78,.15)':'rgba(198,163,78,.04)',color:form.atnLogement?'#c6a34e':'#5e5c56',border:'1px solid '+(form.atnLogement?'rgba(198,163,78,.3)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.atnLogement?'‚úÖ OUI':'‚ùå NON'}
          </div>
        </div>
        {form.atnLogement&&<I label="RC logement (‚Ç¨)" type="number" value={form.atnLogementRC} onChange={v=>setF({...form,atnLogementRC:v})}/>}
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>üî• Chauffage gratuit (2.130‚Ç¨/an)</div>
          <div onClick={()=>setF({...form,atnChauffage:!form.atnChauffage})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.atnChauffage?'rgba(198,163,78,.15)':'rgba(198,163,78,.04)',color:form.atnChauffage?'#c6a34e':'#5e5c56',border:'1px solid '+(form.atnChauffage?'rgba(198,163,78,.3)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.atnChauffage?'‚úÖ OUI ‚Äî 177,50 ‚Ç¨/mois':'‚ùå NON'}
          </div>
        </div>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>‚ö° √âlectricit√© gratuite (1.060‚Ç¨/an)</div>
          <div onClick={()=>setF({...form,atnElec:!form.atnElec})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.atnElec?'rgba(198,163,78,.15)':'rgba(198,163,78,.04)',color:form.atnElec?'#c6a34e':'#5e5c56',border:'1px solid '+(form.atnElec?'rgba(198,163,78,.3)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.atnElec?'‚úÖ OUI ‚Äî 88,33 ‚Ç¨/mois':'‚ùå NON'}
          </div>
        </div>
      </div>
      <ST>V√©lo de soci√©t√© & Mobilit√© verte</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>üö≤ V√©lo de soci√©t√© (leasing)</div>
          <div onClick={()=>setF({...form,veloSociete:!form.veloSociete})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.veloSociete?'rgba(74,222,128,.15)':'rgba(198,163,78,.04)',color:form.veloSociete?'#4ade80':'#5e5c56',border:'1px solid '+(form.veloSociete?'rgba(74,222,128,.3)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.veloSociete?'‚úÖ OUI ‚Äî ATN = 0‚Ç¨ (exon√©r√© depuis 2024)':'‚ùå NON'}
          </div>
        </div>
        {form.veloSociete&&<I label="Type de v√©lo" value={form.veloType||'none'} onChange={v=>setF({...form,veloType:v})} options={[{v:"classique",l:"üö≤ V√©lo classique"},{v:"electrique",l:"‚ö° V√©lo √©lectrique (‚â§25km/h)"},{v:"speed_pedelec",l:"üèé Speed pedelec (‚â§45km/h)"}]}/>}
        {form.veloSociete&&<I label="Valeur catalogue (‚Ç¨)" type="number" value={form.veloValeur} onChange={v=>setF({...form,veloValeur:v})}/>}
        {form.veloSociete&&<I label="Leasing mensuel (‚Ç¨)" type="number" value={form.veloLeasingMois} onChange={v=>setF({...form,veloLeasingMois:v})}/>}
      </div>
      {form.veloSociete&&<div style={{marginTop:8,padding:10,background:"rgba(74,222,128,.04)",borderRadius:8,fontSize:10.5,color:'#4ade80',lineHeight:1.6}}>
        üö≤ <b>V√©lo de soci√©t√©</b> ‚Äî ATN = 0‚Ç¨ (Art. 38¬ß1er 14¬∞a CIR ‚Äî exon√©r√© ONSS et IPP depuis 01/01/2024). Leasing v√©lo d√©ductible 100% pour l'employeur. Cumulable avec l'indemnit√© v√©lo 0,27‚Ç¨/km. Le speed pedelec est assimil√© √† un v√©lo.
      </div>}
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginTop:10}}>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>‚õΩ Carte carburant / recharge</div>
          <div onClick={()=>setF({...form,carteCarburant:!form.carteCarburant})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.carteCarburant?'rgba(251,146,60,.12)':'rgba(198,163,78,.04)',color:form.carteCarburant?'#fb923c':'#5e5c56',border:'1px solid '+(form.carteCarburant?'rgba(251,146,60,.25)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.carteCarburant?'‚úÖ OUI':'‚ùå NON'}
          </div>
        </div>
        {form.carteCarburant&&<I label="Budget mensuel carte (‚Ç¨)" type="number" value={form.carteCarburantMois} onChange={v=>setF({...form,carteCarburantMois:v})}/>}
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>üîå Borne de recharge domicile</div>
          <div onClick={()=>setF({...form,borneRecharge:!form.borneRecharge})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.borneRecharge?'rgba(96,165,250,.12)':'rgba(198,163,78,.04)',color:form.borneRecharge?'#60a5fa':'#5e5c56',border:'1px solid '+(form.borneRecharge?'rgba(96,165,250,.25)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.borneRecharge?'‚úÖ OUI ‚Äî install√©e au domicile':'‚ùå NON'}
          </div>
        </div>
        {form.borneRecharge&&<I label="Co√ªt mensuel borne+√©lec (‚Ç¨)" type="number" value={form.borneRechargeCo√ªt} onChange={v=>setF({...form,borneRechargeCo√ªt:v})}/>}
      </div>
      {form.carteCarburant&&!form.carFuel!=='none'&&<div style={{marginTop:8,padding:10,background:"rgba(251,146,60,.04)",borderRadius:8,fontSize:10.5,color:'#fb923c',lineHeight:1.6}}>
        ‚ö† <b>Carte carburant sans voiture de soci√©t√©</b> ‚Äî L'avantage est imposable √† 100% (ATN = montant total de la carte). Si voiture de soci√©t√©: inclus dans l'ATN voiture (Art. 36¬ß2 CIR).
      </div>}
      <ST>Travailleur frontalier (R√®gl. 883/2004)</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>üåç Travailleur frontalier</div>
          <div onClick={()=>setF({...form,frontalier:!form.frontalier})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.frontalier?'rgba(168,85,247,.12)':'rgba(198,163,78,.04)',color:form.frontalier?'#a855f7':'#5e5c56',border:'1px solid '+(form.frontalier?'rgba(168,85,247,.25)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.frontalier?'‚úÖ OUI ‚Äî R√©side hors Belgique':'‚ùå NON ‚Äî R√©side en Belgique'}
          </div>
        </div>
        {form.frontalier&&<I label="Pays de r√©sidence" value={form.frontalierPays||''} onChange={v=>setF({...form,frontalierPays:v})} options={[{v:"FR",l:"üá´üá∑ France"},{v:"NL",l:"üá≥üá± Pays-Bas"},{v:"DE",l:"üá©üá™ Allemagne"},{v:"LU",l:"üá±üá∫ Luxembourg"}]}/>}
      </div>
      {form.frontalier&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginTop:8}}>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>Formulaire A1 (d√©tachement)</div>
          <div onClick={()=>setF({...form,frontalierA1:!form.frontalierA1})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.frontalierA1?'rgba(96,165,250,.12)':'rgba(198,163,78,.04)',color:form.frontalierA1?'#60a5fa':'#5e5c56',border:'1px solid '+(form.frontalierA1?'rgba(96,165,250,.25)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.frontalierA1?'‚úÖ A1 en cours':"‚ùå Pas d'A1"}
          </div>
        </div>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>Exon√©ration PP (ancien r√©gime FR)</div>
          <div onClick={()=>setF({...form,frontalierExoPP:!form.frontalierExoPP})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.frontalierExoPP?'rgba(239,68,68,.12)':'rgba(198,163,78,.04)',color:form.frontalierExoPP?'#ef4444':'#5e5c56',border:'1px solid '+(form.frontalierExoPP?'rgba(239,68,68,.25)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.frontalierExoPP?'‚úÖ Exon√©r√© PP (tr√®s rare)':'‚ùå PP retenu en Belgique (normal)'}
          </div>
        </div>
      </div>}
      {form.frontalier&&<div style={{marginTop:8,padding:10,background:"rgba(168,85,247,.04)",borderRadius:8,fontSize:10.5,color:'#a855f7',lineHeight:1.6}}>
        üåç <b>Frontalier {form.frontalierPays==='FR'?'France':form.frontalierPays==='NL'?'Pays-Bas':form.frontalierPays==='DE'?'Allemagne':form.frontalierPays==='LU'?'Luxembourg':''}</b><br/>
        {form.frontalierPays==='FR'&&'‚Ä¢ Convention CPDI BE-FR 10/03/1964. Ancien r√©gime frontalier abrog√© 01/01/2012. PP retenu en Belgique. Le travailleur d√©clare en France avec cr√©dit d\'imp√¥t. Formulaire 276 Front.'}
        {form.frontalierPays==='NL'&&'‚Ä¢ Convention CPDI BE-NL 05/06/2001. PP retenu en Belgique. Exemption avec progression aux Pays-Bas. Option: kwalificerend buitenlands belastingplichtige.'}
        {form.frontalierPays==='DE'&&'‚Ä¢ Convention CPDI BE-DE 11/04/1967. PP retenu en Belgique. Cr√©dit d\'imp√¥t en Allemagne. Pas de r√©gime frontalier sp√©cial.'}
        {form.frontalierPays==='LU'&&'‚Ä¢ Convention CPDI BE-LU 17/09/1970. PP retenu en Belgique. Tol√©rance 24j/an de t√©l√©travail depuis le Luxembourg (accord amiable 2015).'}
        <br/>‚Ä¢ ONSS: toujours belge (lex loci laboris ‚Äî Art. 11 R√®gl. 883/2004).
        ‚Ä¢ Limosa: pas n√©cessaire (le travailleur r√©side √† l'√©tranger mais travaille en BE avec contrat BE).
      </div>}
      <ST>Travailleur pensionn√© (Cumul pension-travail)</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>üë¥ Pensionn√© en activit√©</div>
          <div onClick={()=>setF({...form,pensionn√©:!form.pensionn√©})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.pensionn√©?'rgba(251,191,36,.15)':'rgba(198,163,78,.04)',color:form.pensionn√©?'#fbbf24':'#5e5c56',border:'1px solid '+(form.pensionn√©?'rgba(251,191,36,.3)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.pensionn√©?'‚úÖ OUI ‚Äî B√©n√©ficiaire d\'une pension':'‚ùå NON'}
          </div>
        </div>
        {form.pensionn√©&&<I label="Type de pension" value={form.pensionType||'none'} onChange={v=>setF({...form,pensionType:v})} options={[{v:"legal",l:"üèõ Pension l√©gale (√¢ge l√©gal)"},{v:"anticipee",l:"‚è∞ Pension anticip√©e"},{v:"survie",l:"üíê Pension de survie"},{v:"invalidite",l:"‚ôø Pension d\'invalidit√©"}]}/>}
      </div>
      {form.pensionn√©&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10,marginTop:8}}>
        <I label="√Çge" type="number" value={form.pensionAge} onChange={v=>setF({...form,pensionAge:parseInt(v)||0})}/>
        <I label="Ann√©es de carri√®re" type="number" value={form.pensionCarriere} onChange={v=>setF({...form,pensionCarriere:parseInt(v)||0})}/>
        <I label="Pension mensuelle (‚Ç¨)" type="number" value={form.pensionMontant} onChange={v=>setF({...form,pensionMontant:v})}/>
      </div>}
      {form.pensionn√©&&<div style={{marginTop:8,padding:10,background:"rgba(251,191,36,.04)",borderRadius:8,fontSize:10.5,color:'#fbbf24',lineHeight:1.7}}>
        üë¥ <b>Cumul pension-travail</b><br/>
        {(form.pensionType==='legal'&&(form.pensionAge||0)>=66)||
         (form.pensionType==='anticipee'&&(form.pensionCarriere||0)>=45)||
         (form.pensionType==='survie'&&(form.pensionAge||0)>=65)
          ?<><span style={{color:'#4ade80',fontWeight:700}}>‚úÖ CUMUL ILLIMIT√â</span> ‚Äî {form.pensionType==='legal'?'√Çge l√©gal 66 ans atteint (AR 20/12/2006)':form.pensionType==='anticipee'?'45 ans de carri√®re atteints':'Pension de survie ‚â• 65 ans'}. Aucun plafond de revenus. Flexi-job: plafond 12.000‚Ç¨ ne s'applique PAS.<br/></>
          :<><span style={{color:'#ef4444',fontWeight:700}}>‚ö† CUMUL LIMIT√â</span> ‚Äî Plafonds annuels bruts ({(form.depChildren||0)>0?'avec':'sans'} enfant √† charge):<br/>
            {form.pensionType==='anticipee'&&`‚Ä¢ Anticip√©e: ${(form.depChildren||0)>0?'13.266':'10.613'}‚Ç¨/an brut`}
            {form.pensionType==='survie'&&`‚Ä¢ Survie: ${(form.depChildren||0)>0?'28.136':'22.509'}‚Ç¨/an brut`}
            {form.pensionType==='invalidite'&&'‚Ä¢ Invalidit√©: plafonds sp√©cifiques INAMI'}
            <br/>D√©passement = pension r√©duite du % de d√©passement (Art. 64 AR 21/12/1967).<br/></>}
        ‚Ä¢ ONSS: normal (13,07% travailleur + taux patronal). Pas d'exon√©ration.<br/>
        ‚Ä¢ PP: bar√®me normal. La pension est impos√©e s√©par√©ment par le SFP.<br/>
        ‚Ä¢ DmfA: d√©claration normale. SIGEDIS/SFP v√©rifie le cumul automatiquement.
      </div>}
      <ST>Situation familiale</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10}}>
        <I label="Situation" value={form.civil} onChange={v=>setF({...form,civil:v})} options={[{v:"single",l:"Isol√©"},{v:"married_2",l:"Mari√© (2 revenus)"},{v:"married_1",l:"Mari√© (1 revenu)"},{v:"cohabit",l:"Cohabitant l√©gal"}]}/>
        <I label="Enfants √† charge" type="number" value={form.depChildren} onChange={v=>setF({...form,depChildren:v})}/>
        <I label="Enfants handicap√©s" type="number" value={form.handiChildren} onChange={v=>setF({...form,handiChildren:v})}/>
        <I label="Ascendants ‚â•65 ans √† charge" type="number" value={form.depAscendant} onChange={v=>setF({...form,depAscendant:v})}/>
        <I label="Ascendants ‚â•65 handi." type="number" value={form.depAscendantHandi} onChange={v=>setF({...form,depAscendantHandi:v})}/>
        <I label="Autres pers. √† charge" type="number" value={form.depAutres} onChange={v=>setF({...form,depAutres:v})}/>
      </div>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginTop:8}}>
        <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>Conjoint handicap√© (Art.132 CIR)</div>
          <div onClick={()=>setF({...form,conjointHandicap:!form.conjointHandicap})} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
            background:form.conjointHandicap?'rgba(248,113,113,.12)':'rgba(198,163,78,.04)',color:form.conjointHandicap?'#f87171':'#5e5c56',border:'1px solid '+(form.conjointHandicap?'rgba(248,113,113,.25)':'rgba(198,163,78,.1)'),textAlign:'center'}}>
            {form.conjointHandicap?'‚úÖ OUI ‚Äî r√©duction suppl√©mentaire':'‚ùå NON'}
          </div>
        </div>
      </div>
      <div style={{display:'flex',gap:10,justifyContent:'flex-end',marginTop:20}}>
        <B v="outline" onClick={()=>{setF(null);setEd(false);}}>Annuler</B>
        <B onClick={save}>{ed?'Mettre √† jour':'Enregistrer'}</B>
      </div>
    </C>}
    {/* GRID VIEW */}
    {viewMode==='grid'&&<div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(280px,1fr))',gap:12}}>
      {filtered.map((r,i)=>{const p=calc(r,DPER,s.co);return(
        <C key={r.id} style={{padding:'18px 16px',cursor:'pointer',transition:'all .15s',position:'relative',overflow:'hidden'}} 
          onClick={()=>{setF({...r});setEd(true);}}
          onMouseEnter={e=>e.currentTarget.style.borderColor='rgba(198,163,78,.25)'}
          onMouseLeave={e=>e.currentTarget.style.borderColor='rgba(139,115,60,.12)'}>
          <div style={{display:'flex',alignItems:'center',gap:12,marginBottom:12}}>
            <div style={{width:40,height:40,borderRadius:10,background:`linear-gradient(135deg,${['#c6a34e',"#60a5fa","#a78bfa","#4ade80","#fb923c","#06b6d4"][i%6]}25,${['#c6a34e',"#60a5fa","#a78bfa","#4ade80","#fb923c","#06b6d4"][i%6]}08)`,display:'flex',alignItems:'center',justifyContent:'center',fontSize:14,fontWeight:700,color:['#c6a34e',"#60a5fa","#a78bfa","#4ade80","#fb923c","#06b6d4"][i%6]}}>{(r.first||'')[0]}{(r.last||'')[0]}</div>
            <div style={{flex:1}}>
              <div style={{fontSize:13.5,fontWeight:600,color:'#e8e6e0'}}>{r.first} {r.last}</div>
              <div style={{fontSize:10.5,color:'#5e5c56'}}>{r.fn||'‚Äî'}</div>
            </div>
            <span style={{fontSize:8.5,padding:'2px 7px',borderRadius:4,fontWeight:600,
              background:r.status==='sorti'?'rgba(248,113,113,.12)':r.contract==='student'?'rgba(251,146,60,.12)':r.statut==='ouvrier'?'rgba(251,146,60,.1)':'rgba(96,165,250,.08)',
              color:r.status==='sorti'?'#f87171':r.contract==='student'?'#fb923c':r.statut==='ouvrier'?'#fb923c':'#60a5fa',
            }}>{r.status==='sorti'?'SORTI':r.contract==='student'?'√âTUDIANT':r.statut==='ouvrier'?'OUVRIER':'EMPLOY√â'}</span>
          </div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:6,fontSize:11}}>
            <div><span style={{color:'#5e5c56'}}>CP:</span> <span style={{color:'#d4d0c8'}}>{r.cp}</span></div>
            <div><span style={{color:'#5e5c56'}}>Contrat:</span> <span style={{color:'#d4d0c8'}}>{r.contract}</span></div>
            <div><span style={{color:'#5e5c56'}}>Brut:</span> <span style={{color:'#c6a34e',fontWeight:600}}>{fmt(r.monthlySalary)}</span></div>
            <div><span style={{color:'#5e5c56'}}>Net:</span> <span style={{color:'#4ade80',fontWeight:600}}>{fmt(p.net)}</span></div>
          </div>
          <div style={{marginTop:10,display:'flex',gap:6,justifyContent:'flex-end'}}>
            <B v="ghost" style={{padding:'4px 8px',fontSize:10}} onClick={e=>{e.stopPropagation();setF({...r});setEd(true);}}>‚úé Modifier</B>
            <B v="danger" style={{padding:'4px 8px',fontSize:10}} onClick={e=>{e.stopPropagation();if(confirm('Supprimer ?'))d({type:"DEL_E",id:r.id});}}>‚úï</B>
          </div>
        </C>
      );})}
    </div>}
    {/* LIST VIEW */}
    {viewMode==='list'&&<C style={{padding:0,overflow:'hidden'}}>
      <Tbl cols={[
        {k:'n',l:"Employ√©",r:r=><div style={{display:'flex',alignItems:'center',gap:10}}>
          <div style={{width:30,height:30,borderRadius:7,background:"rgba(198,163,78,.06)",display:'flex',alignItems:'center',justifyContent:'center',fontSize:11,fontWeight:700,color:'#c6a34e'}}>{(r.first||'')[0]}{(r.last||'')[0]}</div>
          <div><div style={{fontWeight:500}}>{r.first} {r.last} <span style={{fontSize:8.5,padding:'1px 5px',borderRadius:3,fontWeight:600,background:r.status==='sorti'?'rgba(248,113,113,.12)':r.contract==='student'?'rgba(251,146,60,.12)':r.statut==='ouvrier'?'rgba(251,146,60,.1)':'rgba(96,165,250,.08)',color:r.status==='sorti'?'#f87171':r.contract==='student'?'#fb923c':r.statut==='ouvrier'?'#fb923c':'#60a5fa',marginLeft:4}}>{r.status==='sorti'?'SORTI':r.contract==='student'?'√âTU':r.statut==='ouvrier'?'OUV':'EMPL'}</span></div><div style={{fontSize:10.5,color:'#5e5c56'}}>{r.niss} ¬∑ {r.sexe==='F'?'‚ôÄ':'‚ôÇ'}</div></div>
        </div>},
        {k:'f',l:"Fonction",r:r=><div>{r.fn}<div style={{fontSize:10.5,color:'#5e5c56'}}>{r.dept}</div></div>},
        {k:'c',l:"Contrat",r:r=><span style={{fontSize:12}}>{r.contract} ¬∑ {r.whWeek}h</span>},
        {k:'cp',l:"CP",r:r=>r.cp},
        {k:'g',l:"Brut",a:'right',r:r=><span style={{fontWeight:600}}>{fmt(r.monthlySalary)}</span>},
        {k:'ne',l:"Net",a:'right',r:r=><span style={{fontWeight:600,color:'#4ade80'}}>{fmt(calc(r,DPER,s.co).net)}</span>},
        {k:'co',l:"Co√ªt",a:'right',r:r=><span style={{color:'#a78bfa'}}>{fmt(calc(r,DPER,s.co).costTotal)}</span>},
        {k:'a',l:"",a:'right',r:r=><div style={{display:'flex',gap:5,justifyContent:'flex-end'}}>
          <B v="ghost" style={{padding:'4px 8px',fontSize:10}} onClick={e=>{e.stopPropagation();setF({...r});setEd(true);}}>‚úé</B>
          <B v="danger" style={{padding:'4px 8px',fontSize:10}} onClick={e=>{e.stopPropagation();if(confirm('Supprimer ?'))d({type:"DEL_E",id:r.id});}}>‚úï</B>
        </div>},
      ]} data={filtered}/>
    </C>}
    {filtered.length===0&&search&&<div style={{textAlign:'center',padding:40,color:'#5e5c56',fontSize:13}}>Aucun employ√© trouv√© pour "{search}"</div>}
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PAYSLIPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function Payslips({s,d}) {
  const [eid,setEid]=useState(s.emps[0]?.id||'');
  const [per,setPer]=useState({...DPER});
  const [res,setRes]=useState(null);
  const [batchMode,setBatchMode]=useState(false);
  const [batchResults,setBatchResults]=useState([]);
  const [batchRunning,setBatchRunning]=useState(false);
  const emp=s.emps.find(e=>e.id===eid);

  // ‚îÄ‚îÄ BATCH PROCESSING ‚îÄ‚îÄ
  const runBatch=()=>{
    setBatchRunning(true);
    const ae=s.emps.filter(e=>e.status==='active'||!e.status);
    const results=[];
    for(const emp of ae){
      try{
        const r=calc(emp,per,s.co);
        d({type:"ADD_P",d:{eid:emp.id,ename:`${emp.first} ${emp.last}`,period:`${MN[per.month-1]} ${per.year}`,month:per.month,year:per.year,...r,at:new Date().toISOString(),batch:true}});
        results.push({emp,r,ok:true});
      }catch(e){
        results.push({emp,error:e.message,ok:false});
      }
    }
    setBatchResults(results);
    setBatchRunning(false);
    const ok=results.filter(r=>r.ok).length;
    const fail=results.filter(r=>!r.ok).length;
    alert(`‚úÖ Batch termin√©: ${ok} fiches calcul√©es${fail>0?`, ${fail} erreurs`:''}`);
  };

  const gen=()=>{if(!emp)return;const r=calc(emp,per,s.co);setRes(r);
    d({type:"ADD_P",d:{eid:emp.id,ename:`${emp.first} ${emp.last}`,period:`${MN[per.month-1]} ${per.year}`,month:per.month,year:per.year,...r,at:new Date().toISOString()}});};

  const PR=({l,rate,a,bold,neg,pos,sub})=><tr>
    <td style={{padding:'5px 0',fontWeight:bold?700:400,fontSize:sub?10.5:12,color:sub?'#999':'#333',fontStyle:sub?'italic':'normal'}}>{l}</td>
    <td style={{textAlign:'right',padding:'5px 0',color:'#999',fontSize:10.5}}>{rate||''}</td>
    <td style={{textAlign:'right',padding:'5px 0',fontWeight:bold?700:400,color:neg?'#dc2626':pos?'#16a34a':sub?'#999':'#333'}}>{neg&&a!==0?'- ':''}{fmt(Math.abs(a||0))}</td>
  </tr>;
  const PS=({t})=><tr style={{background:"#f8f7f2"}}><td colSpan={3} style={{padding:'11px 0 5px',fontWeight:700,fontSize:10.5,color:'#c6a34e',textTransform:'uppercase',letterSpacing:'1px'}}>{t}</td></tr>;

  return <div>
    <PH title="Fiches de Paie" sub="Formule-cl√© SPF Finances" actions={<div style={{display:'flex',gap:8}}>
      <B v={batchMode?'gold':'outline'} onClick={()=>setBatchMode(!batchMode)} style={{fontSize:11,padding:'8px 14px'}}>{batchMode?'‚ö° Mode Batch ON':'‚ö° Batch'}</B>
    </div>}/>
    {/* Batch Mode */}
    {batchMode&&<C style={{marginBottom:18,border:'1px solid rgba(198,163,78,.25)'}}>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}}>
        <div>
          <div style={{fontSize:15,fontWeight:600,color:'#c6a34e'}}>‚ö° Batch Processing ‚Äî Calcul en masse</div>
          <div style={{fontSize:11,color:'#5e5c56',marginTop:2}}>Calcule toutes les fiches de paie des travailleurs actifs en 1 clic</div>
        </div>
        <B onClick={runBatch} disabled={batchRunning} style={{fontSize:13,padding:'12px 24px'}}>
          {batchRunning?'‚è≥ Calcul en cours...':'‚ö° Lancer le batch ('+s.emps.filter(e=>e.status==='active'||!e.status).length+' fiches)'}
        </B>
      </div>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10,marginBottom:12}}>
        <I label="Mois" value={per.month} onChange={v=>setPer({...per,month:parseInt(v)})} options={MN.map((m,i)=>({v:i+1,l:m}))}/>
        <I label="Ann√©e" type="number" value={per.year} onChange={v=>setPer({...per,year:v})}/>
        <div style={{padding:12,background:'rgba(198,163,78,.06)',borderRadius:8,textAlign:'center'}}>
          <div style={{fontSize:10,color:'#9e9b93'}}>Travailleurs actifs</div>
          <div style={{fontSize:22,fontWeight:700,color:'#c6a34e'}}>{s.emps.filter(e=>e.status==='active'||!e.status).length}</div>
        </div>
      </div>
      {batchResults.length>0&&<div>
        <ST>R√©sultats du batch</ST>
        <div style={{maxHeight:300,overflowY:'auto'}}>
          {batchResults.map((br,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 12px',borderRadius:6,marginBottom:4,background:br.ok?'rgba(74,222,128,.04)':'rgba(248,113,113,.04)',border:'1px solid '+(br.ok?'rgba(74,222,128,.1)':'rgba(248,113,113,.1)')}}>
            <span style={{fontSize:12,color:br.ok?'#4ade80':'#f87171'}}>{br.ok?'‚úÖ':'‚ùå'} {br.emp.first} {br.emp.last}</span>
            {br.ok&&<span style={{fontSize:12,color:'#c6a34e',fontFamily:'monospace'}}>{fmt(br.r.gross)} brut ‚Üí {fmt(br.r.net)} net</span>}
            {!br.ok&&<span style={{fontSize:11,color:'#f87171'}}>{br.error}</span>}
          </div>)}
        </div>
        <div style={{marginTop:8,padding:10,background:'rgba(198,163,78,.06)',borderRadius:8,display:'flex',justifyContent:'space-between'}}>
          <span style={{fontSize:12,color:'#c6a34e',fontWeight:600}}>Total masse salariale</span>
          <span style={{fontSize:14,fontWeight:700,color:'#c6a34e'}}>{fmt(batchResults.filter(r=>r.ok).reduce((a,r)=>a+r.r.gross,0))} brut ‚Üí {fmt(batchResults.filter(r=>r.ok).reduce((a,r)=>a+r.r.net,0))} net</span>
        </div>
      </div>}
    </C>}
    <div style={{display:'grid',gridTemplateColumns:res?'360px 1fr':'1fr',gap:18}}>
      <C>
        <ST>Param√®tres</ST>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9}}>
          <I label="Employ√©" value={eid} onChange={setEid} options={s.emps.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))} span={2}/>
          <I label="Mois" value={per.month} onChange={v=>setPer({...per,month:parseInt(v)})} options={MN.map((m,i)=>({v:i+1,l:m}))}/>
          <I label="Ann√©e" type="number" value={per.year} onChange={v=>setPer({...per,year:v})}/>
          <I label="Jours prest√©s" type="number" value={per.days} onChange={v=>setPer({...per,days:v})}/>
          <I label="H. sup." type="number" value={per.overtimeH} onChange={v=>setPer({...per,overtimeH:v})}/>
          <I label="H. dimanche" type="number" value={per.sundayH} onChange={v=>setPer({...per,sundayH:v})}/>
          <I label="H. nuit" type="number" value={per.nightH} onChange={v=>setPer({...per,nightH:v})}/>
          <I label="Maladie (j garanti)" type="number" value={per.sickG} onChange={v=>setPer({...per,sickG:v})}/>
          <I label="Prime (‚Ç¨)" type="number" value={per.bonus} onChange={v=>setPer({...per,bonus:v})}/>
          <I label="13√®me mois (‚Ç¨)" type="number" value={per.y13} onChange={v=>setPer({...per,y13:v})}/>
          <I label="Acompte (‚Ç¨)" type="number" value={per.advance} onChange={v=>setPer({...per,advance:v})}/>
          <I label="Saisie (‚Ç¨)" type="number" value={per.garnish} onChange={v=>setPer({...per,garnish:v})}/>
          <I label="PP volontaire (‚Ç¨)" type="number" value={per.ppVolontaire} onChange={v=>setPer({...per,ppVolontaire:v})}/>
          <I label="Autres ret. (‚Ç¨)" type="number" value={per.otherDed} onChange={v=>setPer({...per,otherDed:v})}/>
        </div>
        <ST style={{marginTop:14}}>√âl√©ments fiscaux sp√©ciaux</ST>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9}}>
          <I label="Double p√©cule vac. (‚Ç¨)" type="number" value={per.doublePecule} onChange={v=>setPer({...per,doublePecule:v})}/>
          <I label="P√©cule d√©part (‚Ç¨)" type="number" value={per.peculeDepart} onChange={v=>setPer({...per,peculeDepart:v})}/>
          <I label="Prime anciennet√© (‚Ç¨)" type="number" value={per.primeAnciennete} onChange={v=>setPer({...per,primeAnciennete:v})}/>
          <I label="Prime naissance/mariage (‚Ç¨)" type="number" value={per.primeNaissance} onChange={v=>setPer({...per,primeNaissance:v})}/>
          <I label="Prime innovation (‚Ç¨)" type="number" value={per.primeInnovation} onChange={v=>setPer({...per,primeInnovation:v})}/>
          <I label="Indem. t√©l√©travail (‚Ç¨)" type="number" value={per.indemTeletravail} onChange={v=>setPer({...per,indemTeletravail:v})}/>
          <I label="Indem. bureau (‚Ç¨)" type="number" value={per.indemBureau} onChange={v=>setPer({...per,indemBureau:v})}/>
          <I label="H.sup fiscales (180h)" type="number" value={per.heuresSupFisc} onChange={v=>setPer({...per,heuresSupFisc:v})}/>
          <I label="HS volont. brut=net (h)" type="number" value={per.hsVolontBrutNet} onChange={v=>setPer({...per,hsVolontBrutNet:v})}/>
          <I label="HS relance T1 (h)" type="number" value={per.hsRelance} onChange={v=>setPer({...per,hsRelance:v})}/>
          <I label="Pension compl. ret. (‚Ç¨)" type="number" value={per.pensionCompl} onChange={v=>setPer({...per,pensionCompl:v})}/>
          <I label="Cotis. syndicale (‚Ç¨)" type="number" value={per.retSyndicale} onChange={v=>setPer({...per,retSyndicale:v})}/>
          <I label="Pension aliment. (‚Ç¨)" type="number" value={per.saisieAlim} onChange={v=>setPer({...per,saisieAlim:v})}/>
          <I label="Type sp√©cial" value={per.typeSpecial||'normal'} onChange={v=>setPer({...per,typeSpecial:v})} options={[{v:"normal",l:"Normal"},{v:"doublePecule",l:"Double p√©cule"},{v:"y13",l:"13√®me mois"},{v:"depart",l:"Sortie de service"},{v:"preavis",l:"Indemnit√© de pr√©avis"}]}/>
          <I label="Petit ch√¥mage (jours)" type="number" value={per.petitChomage} onChange={v=>setPer({...per,petitChomage:v})}/>
          <I label="√âco-ch√®ques (‚Ç¨)" type="number" value={per.ecoCheques} onChange={v=>setPer({...per,ecoCheques:v})}/>
          <I label="Cadeaux/√©v√©nements (‚Ç¨)" type="number" value={per.cadeaux} onChange={v=>setPer({...per,cadeaux:v})}/>
          <I label="Budget mobilit√© P2 (‚Ç¨)" type="number" value={per.budgetMobP2} onChange={v=>setPer({...per,budgetMobP2:v})}/>
          <I label="Budget mobilit√© P3 (‚Ç¨)" type="number" value={per.budgetMobP3} onChange={v=>setPer({...per,budgetMobP3:v})}/>
          <I label="R√©d. trav. √¢g√© 55+ (‚Ç¨)" type="number" value={per.redGCAge} onChange={v=>setPer({...per,redGCAge:v})}/>
          <I label="R√©d. jeune <26 (‚Ç¨)" type="number" value={per.redGCJeune} onChange={v=>setPer({...per,redGCJeune:v})}/>
          <I label="R√©d. handicap (‚Ç¨)" type="number" value={per.redGCHandicap} onChange={v=>setPer({...per,redGCHandicap:v})}/>
          <I label="Activation ONEM" value={per.allocTravailType||'none'} onChange={v=>setPer({...per,allocTravailType:v,allocTravail:0})} options={[{v:"none",l:"‚Äî Aucune ‚Äî"},{v:"activa_bxl",l:"Activa.brussels (‚Ç¨350/m)"},{v:"activa_jeune",l:"Activa Jeunes <30 (‚Ç¨350/m)"},{v:"impulsion_wal",l:"Impulsion Wallonie (‚Ç¨500/m)"},{v:"impulsion55",l:"Impulsion 55+ (‚Ç¨500/m)"},{v:"sine",l:"SINE √©con. sociale (‚Ç¨500/m)"},{v:"vdab",l:"VDAB (prime directe)"}]}/>
          {per.allocTravailType&&per.allocTravailType!=='none'&&<I label="Montant alloc. ONEM (‚Ç¨)" type="number" value={per.allocTravail} onChange={v=>setPer({...per,allocTravail:v})}/>}
        </div>
        <ST style={{marginTop:14}}>Mi-temps m√©dical / th√©rapeutique</ST>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9}}>
          <div style={{gridColumn:'1/-1'}}><div onClick={()=>setPer({...per,miTempsMed:!per.miTempsMed})} style={{padding:'10px 14px',borderRadius:8,cursor:'pointer',fontSize:12,
            background:per.miTempsMed?'rgba(251,146,60,.1)':'rgba(198,163,78,.04)',color:per.miTempsMed?'#fb923c':'#5e5c56',border:'1px solid '+(per.miTempsMed?'rgba(251,146,60,.25)':'rgba(198,163,78,.1)'),textAlign:'center',fontWeight:600}}>
            {per.miTempsMed?'‚öï MI-TEMPS M√âDICAL / TH√âRAPEUTIQUE ‚Äî Reprise progressive INAMI (Art. 100¬ß2)':'‚ùå Pas de mi-temps m√©dical / th√©rapeutique'}
          </div></div>
          {per.miTempsMed&&<><I label="Heures/sem prest√©es" type="number" value={per.miTempsHeures} onChange={v=>setPer({...per,miTempsHeures:v})}/>
          <I label="Compl√©ment INAMI (‚Ç¨/mois)" type="number" value={per.miTempsINAMI} onChange={v=>setPer({...per,miTempsINAMI:v})}/>
          <div style={{gridColumn:'1/-1',padding:10,background:"rgba(96,165,250,.04)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.6}}>
            ‚öï <b>Reprise progressive</b> ‚Äî Le travailleur preste {per.miTempsHeures||0}h/{emp?.whWeek||38}h = <b>{Math.round((per.miTempsHeures||0)/(emp?.whWeek||38)*100)}%</b>. L'employeur paie le salaire prorata. L'INAMI verse le compl√©ment directement au travailleur via la mutuelle. Documents: C3.2 (m√©decin-conseil) + DRS (eBox).
          </div></>}
        </div>
        <B onClick={gen} style={{width:'100%',marginTop:14,padding:13,fontSize:13.5,letterSpacing:'.5px'}}>G√âN√âRER LA FICHE DE PAIE</B>
      </C>

      {res&&emp&&<div data-payslip style={{background:"#fffef9",borderRadius:14,padding:'32px 36px',color:'#1a1a18',fontFamily:"'Outfit',sans-serif",boxShadow:'0 4px 30px rgba(0,0,0,.3)'}}>
        <div style={{display:'flex',justifyContent:'space-between',paddingBottom:18,borderBottom:'3px solid #c6a34e',marginBottom:22}}>
          <div><div style={{fontFamily:"'Cormorant Garamond',serif",fontSize:20,fontWeight:700}}>{s.co.name}</div><div style={{fontSize:10.5,color:'#888',marginTop:2}}>{s.co.addr}</div><div style={{fontSize:10.5,color:'#888'}}>TVA: {s.co.vat} ¬∑ BCE: {s.co.bce||s.co.vat?.replace(/^BE\s?/,"")||'‚Äî'} ¬∑ ONSS: {s.co.onss}</div><div style={{fontSize:10.5,color:'#888'}}>CP: {emp.cp||s.co.cp||'200'} ‚Äî {LEGAL.CP[emp.cp||s.co.cp||'200']||''}</div></div>
          <div style={{textAlign:'right'}}><div style={{fontSize:14,fontWeight:700,color:'#c6a34e',textTransform:'uppercase',letterSpacing:'2px'}}>Fiche de Paie</div><div style={{fontSize:12.5,color:'#888',marginTop:3}}>{MN[per.month-1]} {per.year}</div><div style={{fontSize:10,color:'#aaa',marginTop:2}}>P√©riode du 01/{String(per.month).padStart(2,"0")}/{per.year} au {new Date(per.year,per.month,0).getDate()}/{String(per.month).padStart(2,"0")}/{per.year}</div><div style={{fontSize:10,color:'#aaa'}}>Date de paiement: dernier jour ouvrable du mois</div></div>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18,marginBottom:20,padding:14,background:"#f5f4ef",borderRadius:8}}>
          <div><div style={{fontSize:9.5,color:'#aaa',textTransform:'uppercase',letterSpacing:'1px',marginBottom:3}}>Travailleur</div><div style={{fontWeight:600,fontSize:13.5}}>{emp.first} {emp.last}</div><div style={{fontSize:10.5,color:'#666'}}>{emp.fn} ‚Äî {emp.dept}</div><div style={{fontSize:10.5,color:'#666'}}>NISS: {emp.niss}{emp.birth?` ¬∑ N√©(e) le ${emp.birth}`:''}</div><div style={{fontSize:10.5,color:'#666'}}>{emp.addr?`${emp.addr}, ${emp.zip||''} ${emp.city||''}`:''}</div></div>
          <div><div style={{fontSize:9.5,color:'#aaa',textTransform:'uppercase',letterSpacing:'1px',marginBottom:3}}>Contrat & Bar√®me</div><div style={{fontSize:10.5,color:'#555'}}>{emp.contract} ¬∑ CP {emp.cp} ¬∑ {emp.whWeek}h/sem ¬∑ {emp.statut==='ouvrier'?'Ouvrier':'Employ√©'}</div><div style={{fontSize:10.5,color:'#555'}}>Entr√©e: {emp.startD} ¬∑ Anciennet√©: {emp.anciennete||0} an(s)</div><div style={{fontSize:10.5,color:'#555'}}>Sit: {emp.civil==='single'?'Isol√©':emp.civil==='married_1'?'Mari√© (1 revenu)':emp.civil==='married_2'?'Mari√© (2 revenus)':emp.civil==='cohabit'?'Cohabitant':emp.civil==='widowed'?'Veuf/ve':emp.civil}{emp.depChildren>0?` ¬∑ ${emp.depChildren} enfant(s)`:''}</div><div style={{fontSize:10.5,color:'#555'}}>Bar√®me: {fmt(emp.monthlySalary)}/mois ¬∑ {fmt(Math.round((emp.monthlySalary||0)/(emp.whWeek||38)/4.33*100)/100)}/h ¬∑ {per.days||0}j / {Math.round((per.days||0)*(emp.whWeek||38)/5*100)/100}h prest√©es</div>
            {emp.frontalier&&<div style={{fontSize:10.5,color:'#a855f7',fontWeight:600}}>üåç Frontalier ‚Äî R√©side: {emp.frontalierPays==='FR'?'France':emp.frontalierPays==='NL'?'Pays-Bas':emp.frontalierPays==='DE'?'Allemagne':emp.frontalierPays==='LU'?'Luxembourg':emp.frontalierPays} ¬∑ ONSS: Belgique ¬∑ PP: {emp.frontalierExoPP?'Exon√©r√© (276 Front.)':'Retenu en Belgique'}</div>}
            {emp.pensionn√©&&<div style={{fontSize:10.5,color:'#fbbf24',fontWeight:600}}>üë¥ Pensionn√© ({emp.pensionType==='legal'?'pension l√©gale':emp.pensionType==='anticipee'?'pension anticip√©e':emp.pensionType==='survie'?'pension de survie':'pension invalidit√©'}) ‚Äî Cumul: {res.pensionCumulIllimite?'ILLIMIT√â':'LIMIT√â (plafond '+fmt(res.pensionPlafond)+'/an)'}{res.pensionDepassement?' ‚ö† D√âPASSEMENT ESTIM√â: '+res.pensionDepassPct+'%':''}</div>}
          </div>
        </div>
        <table style={{width:'100%',borderCollapse:'collapse',fontSize:12}}>
          <thead><tr style={{borderBottom:'2px solid #c6a34e'}}><th style={{textAlign:'left',padding:'7px 0',fontSize:9.5,textTransform:'uppercase',letterSpacing:'1px',color:'#999'}}>Description</th><th style={{textAlign:'right',padding:'7px 0',fontSize:9.5,textTransform:'uppercase',letterSpacing:'1px',color:'#999'}}>Taux</th><th style={{textAlign:'right',padding:'7px 0',fontSize:9.5,textTransform:'uppercase',letterSpacing:'1px',color:'#999'}}>Montant</th></tr></thead>
          <tbody>
            <PS t="R√©mun√©ration brute"/>
            {res.isFlexiJob&&<tr><td colSpan={3} style={{padding:'6px 0 8px',fontSize:11,color:'#4ade80',fontWeight:600,background:"rgba(74,222,128,.05)",borderRadius:4}}>üîÑ FLEXI-JOB ‚Äî Loi 16/11/2015 ¬∑ Net = Brut ¬∑ ONSS trav. 0% ¬∑ PP 0% ¬∑ ONSS empl. 28%</td></tr>}
            {res.isFlexiJob&&<><PR l={`Flexi-salaire (${res.flexiHeures}h √ó ${fmt(res.flexiSalaireH)}/h)`} a={res.flexiBrut}/>
              <PR l="Flexi-p√©cule vacances (7,67%)" a={res.flexiPecule} pos/>
              <PR l="TOTAL FLEXI BRUT" a={res.gross} bold/>
              <PS t="Cotisations"/>
              <PR l="ONSS travailleur" rate="0%" a={0}/>
              <PR l="Pr√©compte professionnel" rate="0%" a={0}/>
              <PR l="Cotisation sp√©ciale SS" rate="0%" a={0}/>
              <PS t="Co√ªt employeur"/>
              <PR l="ONSS patronal sp√©cial (28%)" a={-res.flexiOnssPatronal} neg/>
            </>}
            {!res.isFlexiJob&&<>
            {res.miTempsMed&&<tr><td colSpan={3} style={{padding:'6px 0 8px',fontSize:11,color:'#fb923c',fontWeight:600,background:"rgba(251,146,60,.05)",borderRadius:4}}>‚öï REPRISE PROGRESSIVE ‚Äî Mi-temps m√©dical / th√©rapeutique (Art. 100¬ß2 Loi coord. 14/07/1994) ‚Äî Fraction: {Math.round(res.miTempsFraction*100)}% ({res.miTempsHeures}h/{emp.whWeek||38}h)</td></tr>}
            <PR l="Salaire de base" a={res.base}/>
            {res.miTempsMed&&<PR l={`  ‚îî Brut normal: ${fmt(res.miTempsBrutOriginal)} √ó ${Math.round(res.miTempsFraction*100)}% prorata`} a={res.base} sub/>}
            {res.overtime>0&&<PR l="Heures sup. (150%)" rate={`${per.overtimeH}h`} a={res.overtime}/>}
            {res.sunday>0&&<PR l="Dimanche (200%)" rate={`${per.sundayH}h`} a={res.sunday}/>}
            {res.night>0&&<PR l="Nuit (125%)" rate={`${per.nightH}h`} a={res.night}/>}
            {res.bonus>0&&<PR l="Prime" a={res.bonus}/>}
            {res.y13>0&&<PR l="Prime fin d'ann√©e" a={res.y13}/>}
            {res.sickPay>0&&<PR l="Salaire garanti maladie" a={res.sickPay}/>}
            <PR l="TOTAL BRUT" a={res.gross} bold/>
            {emp.statut==='ouvrier'&&<>
              <tr><td colSpan={3} style={{padding:'4px 0 2px',fontSize:10,color:'#fb923c',fontStyle:'italic'}}>
                Ouvrier ‚Äî Base ONSS = brut √ó 108% = {fmt(res.gross)} √ó 1,08 = <b>{fmt(res.gross*1.08)}</b> (compensation p√©cule vacances simple ‚Äî Art. 23 AR 28/11/1969)
              </td></tr>
              {res.cotisVacOuv>0&&<PR l={`Cotisation vacances ouvrier (15,84% sur brut 108%)`} a={-res.cotisVacOuv} neg/>}
            </>}
            {res.atnCar>0&&<><PS t="Avantage de toute nature (ATN)"/>
            <PR l={`ATN voiture de soci√©t√© (${emp.carBrand||''} ${emp.carModel||''} ‚Äî ${emp.carCO2||0}g CO2)`} rate={`${(res.atnPct||0).toFixed(1)}%`} a={res.atnCar}/>
            <PR l="ATN ajout√© au revenu imposable" a={res.atnCar} sub/></>}
            {(res.atnAutresTot>0&&!res.atnCar)&&<PS t="Avantages de toute nature (ATN)"/>}
            {res.atnGSM>0&&<PR l="ATN GSM/T√©l√©phone (forfait 36‚Ç¨/an)" a={res.atnGSM}/>}
            {res.atnPC>0&&<PR l="ATN PC/Tablette (forfait 72‚Ç¨/an)" a={res.atnPC}/>}
            {res.atnInternet>0&&<PR l="ATN Internet priv√© (forfait 60‚Ç¨/an)" a={res.atnInternet}/>}
            {res.atnLogement>0&&<PR l="ATN Logement gratuit (RC √ó coeff.)" a={res.atnLogement}/>}
            {res.atnChauffage>0&&<PR l="ATN Chauffage gratuit (2.130‚Ç¨/an)" a={res.atnChauffage}/>}
            {res.atnElec>0&&<PR l="ATN √âlectricit√© gratuite (1.060‚Ç¨/an)" a={res.atnElec}/>}
            {res.veloSociete&&<PR l={`üö≤ V√©lo de soci√©t√© (${res.veloType}) ‚Äî ATN = 0‚Ç¨ (Art.38¬ß1er 14¬∞a ‚Äî exon√©r√©)`} a={0}/>}
            {res.atnCarteCarburant>0&&<PR l="ATN Carte carburant (sans voiture soc. ‚Äî imposable)" a={res.atnCarteCarburant}/>}
            {res.atnBorne>0&&<PR l="ATN Borne recharge domicile (sans voiture soc.)" a={res.atnBorne}/>}
            {res.atnAutresTot>0&&<PR l="Total ATN autres (ajout√© au revenu imposable)" a={res.atnAutresTot} sub/>}
            <PS t="Cotisations ONSS"/>
            <PR l={`ONSS travailleur (${fmtP(LEGAL.ONSS_W)} sur ${emp.statut==='ouvrier'?'brut 108% = '+fmt(res.gross*1.08):'brut '+fmt(res.gross)})`} rate={fmtP(LEGAL.ONSS_W)} a={-res.onssW} neg/>
            {res.empBonus>0&&<PR l={`Bonus √† l'emploi social (r√©duction ONSS bas salaires ‚Äî AR 21/12/2017)`} a={res.empBonus} pos/>}
            {res.empBonusA>0&&<PR l={`  ‚îî Volet A (bas salaires): ${fmt(res.empBonusA)}`} a={res.empBonusA} pos sub/>}
            {res.empBonusB>0&&<PR l={`  ‚îî Volet B (tr√®s bas salaires): ${fmt(res.empBonusB)}`} a={res.empBonusB} pos sub/>}
            <PR l={`ONSS net √† retenir (${fmt(res.onssW)} ‚àí ${fmt(res.empBonus)} bonus)`} a={-res.onssNet} bold neg/>
            {res.redStructMois>0&&<PR l={`R√©duction structurelle patronale (Cat ${res.redStructCat}${res.redStructFraction<1?' √ó '+Math.round(res.redStructFraction*100)+'% TP':''})`} a={res.redStructMois} pos/>}
            {res.empBonusFisc>0&&<PR l={`Bonus emploi fiscal (r√©duction PP: volet A ${fmtP(0.3314)} + volet B ${fmtP(0.5254)})`} a={res.empBonusFisc} pos/>}
            <PS t="Fiscalit√© (Formule-cl√© SPF)"/>
            <PR l="Revenu imposable" a={res.taxGross} sub/>
            <PR l="Frais prof. forfaitaires" a={-res.profExp} sub/>
            <PR l="Base taxable" a={res.taxNet} sub/>
            <PR l="Imp√¥t (bar√®me progressif)" a={-res.baseTax} neg/>
            {res.famRed>0&&<PR l="R√©ductions familiales (Art.132-140 CIR)" a={res.famRed} pos/>}
            <PR l="Pr√©compte professionnel" a={-res.tax} bold neg/>
            {res.ppVolontaire>0&&<PR l="Pr√©compte volontaire (Art. 275¬ß1 CIR 92 ‚Äî demande √©crite travailleur)" a={-res.ppVolontaire} neg/>}
            <PR l="Cotisation sp√©ciale SS" a={-res.css} neg/>
            <PS t="Retenues & Avantages"/>
            {res.mvWorker>0&&<PR l={`Ch√®ques repas (${res.mvDays}j)`} a={-res.mvWorker} neg/>}
            {res.transport>0&&<PR l={`Transport dom.-travail (${res.transportDetail||emp.commType})`} a={res.transport} pos/>}
            {res.transport>0&&emp.commType==='bike'&&<tr><td colSpan={3} style={{padding:'2px 0 6px',fontSize:9.5,color:'#4ade80',fontStyle:'italic'}}>üö≤ Total: {((emp.commDist||0)*2*(per.days||21))} km/mois ({emp.commDist} km √ó 2 A/R √ó {per.days||21} jours) ‚Äî Exon√©r√© ONSS et IPP (Art. 38¬ß1er 14¬∞ CIR)</td></tr>}
            {res.expense>0&&<PR l="Frais propres employeur" a={res.expense} pos/>}
            {res.indemTeletravail>0&&<PR l="Indemnit√© t√©l√©travail (exon√©r√©e ‚Äî max 154,74‚Ç¨)" a={res.indemTeletravail} pos/>}
            {res.indemBureau>0&&<PR l="Indemnit√© frais de bureau (exon√©r√©e)" a={res.indemBureau} pos/>}
            {res.garnish>0&&<PR l="Saisie sur salaire" a={-res.garnish} neg/>}
            {res.saisieAlim>0&&<PR l="Pension alimentaire (prioritaire ‚Äî Art.1409 C.jud.)" a={-res.saisieAlim} neg/>}
            {res.advance>0&&<PR l="Acompte" a={-res.advance} neg/>}
            {res.pensionCompl>0&&<PR l="Retenue pension compl√©mentaire (2√® pilier ‚Äî LPC)" a={-res.pensionCompl} neg/>}
            {res.retSyndicale>0&&<PR l="Cotisation syndicale" a={-res.retSyndicale} neg/>}
            {res.otherDed>0&&<PR l="Autres retenues" a={-res.otherDed} neg/>}
            {res.atnCar>0&&<PR l="ATN voiture (d√©duit du net)" a={-res.atnCar} neg/>}
            {res.atnAutresTot>0&&<PR l="ATN autres (d√©duit du net)" a={-res.atnAutresTot} neg/>}
            {(res.doublePecule>0||res.peculeDepart>0||res.primeAnciennete>0||res.primeNaissance>0||res.primeInnovation>0)&&<PS t="√âl√©ments exceptionnels"/>}
            {res.doublePecule>0&&<><PR l="Double p√©cule vacances (92% brut)" a={res.doublePecule} pos/>
              <PR l="  ‚îî ONSS sur 2√®me partie (7% √ó 13,07%)" a={-res.dpOnss} neg sub/>
              <PR l="  ‚îî Cotisation sp√©ciale 1%" a={-res.dpCotisSpec} neg sub/></>}
            {res.peculeDepart>0&&<><PR l="P√©cule vacances de d√©part (Art.46)" a={res.peculeDepart} pos/>
              <PR l="  ‚îî ONSS 13,07% sur p√©cule d√©part" a={-res.pdOnss} neg sub/></>}
            {res.primeAnciennete>0&&<><PR l={`Prime anciennet√© (${emp.anciennete||0} ans)`} a={res.primeAnciennete}/>
              {res.primeAncExoneree>0&&<PR l="  ‚îî Dont exon√©r√© ONSS+IPP (Art.19¬ß2 14¬∞)" a={res.primeAncExoneree} pos sub/>}
              {res.primeAncTaxable>0&&<PR l="  ‚îî Dont taxable" a={res.primeAncTaxable} sub/>}</>}
            {res.primeNaissance>0&&<PR l="Prime naissance/mariage (avantage social ‚Äî exo)" a={res.primeNaissance} pos/>}
            {res.primeInnovation>0&&<PR l="Prime innovation (Art.38¬ß1er 25¬∞ CIR ‚Äî exo IPP)" a={res.primeInnovation} pos/>}
            {res.redPPHeuresSup>0&&<PS t="R√©ductions fiscales"/>}
            {res.redPPHeuresSup>0&&<PR l={`R√©d. PP heures sup. (${res.heuresSupFisc}h √ó 66,81% ‚Äî Art.154bis)`} a={res.redPPHeuresSup} pos/>}
            {res.ppTauxExcep>0&&<PR l={`PP taux exceptionnel ${(res.ppTauxExcepRate*100).toFixed(2)}% (AR 09/01/2024 ann.III)`} a={-res.ppTauxExcep} neg/>}
            {res.petitChomageVal>0&&<><PS t="Absences r√©mun√©r√©es"/>
              <PR l={`Petit ch√¥mage / Cong√© circonstanciel (${res.petitChomage}j ‚Äî AR 28/08/1963)`} a={res.petitChomageVal} pos/></>}
            {(res.ecoCheques>0||res.cadeaux>0||res.budgetMobPilier2>0)&&<PS t="Avantages exon√©r√©s"/>}
            {res.ecoCheques>0&&<PR l="√âco-ch√®ques (CCT 98 ‚Äî max 250‚Ç¨/an ‚Äî exo ONSS+IPP)" a={res.ecoCheques} pos/>}
            {res.cadeaux>0&&<PR l="Cadeaux/√©v√©nements (exo si ‚â§ plafond ‚Äî Circ. ONSS)" a={res.cadeaux} pos/>}
            {res.budgetMobPilier2>0&&<PR l="Budget mobilit√© ‚Äî Pilier 2 (mobilit√© durable ‚Äî exo)" a={res.budgetMobPilier2} pos/>}
            {res.hsBrutNetTotal>0&&<><PS t="Heures suppl√©mentaires brut=net (01/04/2026)"/>
              {res.hsVolontBrutNet>0&&<PR l={`HS volontaires brut=net (${per.hsVolontBrutNet||0}h √ó ${fmt(res.hsVolontBrutNet/(per.hsVolontBrutNet||1))}/h ‚Äî exo ONSS+PP)`} a={res.hsVolontBrutNet} pos/>}
              {res.hsRelance>0&&<PR l={`HS relance transitoire T1 (${per.hsRelance||0}h ‚Äî brut=net ‚Äî d√©duit quota 240h)`} a={res.hsRelance} pos/>}
              <tr><td colSpan={3} style={{padding:'4px 0 6px',fontSize:10,color:'#4ade80',fontStyle:'italic'}}>
                Nouveau r√©gime: max 360h/an (450h horeca). 240h brut=net. Pas de sursalaire. Accord √©crit 1 an requis.
              </td></tr></>}
            {res.budgetMobPilier3>0&&<><PR l="Budget mobilit√© ‚Äî Pilier 3 (cash)" a={res.budgetMobPilier3}/>
              <PR l="  ‚îî Cotisation sp√©ciale 38,07% (Loi 17/03/2019)" a={-res.budgetMobCotis38} neg sub/></>}
            {res.allocTravail>0&&<><PS t="Activation ONEM"/>
              <PR l={`Allocation de travail ${res.allocTravailLabel} (AR 19/12/2001)`} a={-res.allocTravail} neg/>
              <tr><td colSpan={3} style={{padding:'4px 0 8px',fontSize:10,color:'#60a5fa',fontStyle:'italic',lineHeight:1.5}}>
                ‚Üí D√©duit du salaire net. Le travailleur re√ßoit {fmt(res.allocTravail)}/mois directement de l'ONEM via CAPAC/syndicat.<br/>
                ‚Üí R√©mun√©ration totale travailleur inchang√©e: {fmt(res.net)} (employeur) + {fmt(res.allocTravail)} (ONEM) = {fmt(res.net+res.allocTravail)}<br/>
                ‚Üí L'allocation n'est PAS soumise √† l'ONSS (pas de r√©mun√©ration). Le PP est retenu par l'ONEM (10,09%).<br/>
                ‚Üí L'employeur ne d√©clare PAS l'allocation en DmfA. Formulaire: C78 (ONEM) + carte Activa/attestation FOREM.
              </td></tr></>}
            </>}
            <tr style={{borderTop:'3px solid #c6a34e'}}><td style={{padding:'14px 0',fontWeight:800,fontSize:15}}>NET √Ä PAYER</td><td></td><td style={{textAlign:'right',padding:'14px 0',fontWeight:800,fontSize:18,color:'#16a34a'}}>{fmt(res.net)}</td></tr>
            {res.miTempsMed&&<><tr style={{background:"rgba(251,146,60,.04)"}}><td colSpan={3} style={{padding:'10px 0 4px'}}>
              <div style={{fontSize:11,fontWeight:700,color:'#fb923c'}}>‚öï POUR M√âMOIRE ‚Äî Compl√©ment INAMI (hors fiche de paie)</div>
            </td></tr>
            <PR l={`Indemnit√©s INAMI mutuelle (${Math.round((1-res.miTempsFraction)*100)}% non prest√©)`} a={res.miTempsINAMI}/>
            <tr><td style={{padding:'6px 0',fontWeight:700,fontSize:13}}>REVENU TOTAL TRAVAILLEUR</td><td></td><td style={{textAlign:'right',padding:'6px 0',fontWeight:700,fontSize:14,color:'#c6a34e'}}>{fmt(res.net + res.miTempsINAMI)}</td></tr>
            <tr><td colSpan={3} style={{padding:'4px 0 8px',fontSize:9.5,color:'#999',fontStyle:'italic'}}>Le compl√©ment INAMI est vers√© directement par la mutuelle au travailleur. Il n'est pas soumis √† l'ONSS. Le PP est retenu √† la source par la mutuelle (11,11%). Le travailleur conserve son contrat √† temps plein.</td></tr></>}
          </tbody>
        </table>
        {/* CUMUL ANNUEL YTD (AR 27/09/1966 Art.9 ‚Äî mention obligatoire) */}
        <div style={{marginTop:14,padding:12,background:"#f5f4ef",borderRadius:8}}>
          <div style={{fontSize:9.5,color:'#aaa',textTransform:'uppercase',letterSpacing:'1px',fontWeight:600,marginBottom:8}}>Cumul annuel (YTD ‚Äî Janvier √† {MN[per.month-1]} {per.year})</div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:8}}>
            {[
              {l:"Brut cumul√©",v:res.gross*per.month},
              {l:"ONSS cumul√©",v:res.onssNet*per.month},
              {l:"PP cumul√©",v:res.tax*per.month},
              {l:"CSS cumul√©",v:res.css*per.month},
              {l:"Net cumul√©",v:res.net*per.month,c:'#16a34a'},
              {l:"Co√ªt empl. cumul√©",v:res.costTotal*per.month,c:'#c6a34e'},
            ].map((x,i)=><div key={i} style={{textAlign:'center'}}>
              <div style={{fontSize:8.5,color:'#999'}}>{x.l}</div>
              <div style={{fontSize:11.5,fontWeight:600,color:x.c||'#555',marginTop:2}}>{fmt(x.v)}</div>
            </div>)}
          </div>
          <div style={{fontSize:8,color:'#bbb',marginTop:6,fontStyle:'italic'}}>* Estimation bas√©e sur le salaire du mois courant √ó {per.month} mois. Les cumuls r√©els seront calcul√©s sur base de l'historique des fiches.</div>
        </div>
        {/* COMPTEURS CONG√âS & HEURES (Loi 28/06/1971 + CCT) */}
        <div style={{marginTop:10,padding:12,background:"#f5f4ef",borderRadius:8,display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12}}>
          {[
            {l:"Cong√©s l√©gaux",v:`${20-Math.min(per.month*2,20)}j restants`,s:`Total: 20j/an (employ√© TP)`},
            {l:"Heures sup. r√©cup.",v:`${(per.overtimeH||0)}h ce mois`,s:'R√©cup√©rables dans les 3 mois'},
            {l:"Jours maladie",v:`${per.sickG||0}j ce mois`,s:'Sal. garanti: 30j (employ√©) / 7+7+14j (ouvrier)'},
            {l:"Cr√©dit-temps",v:"‚Äî",s:'Non activ√©'},
          ].map((x,i)=><div key={i} style={{textAlign:'center'}}>
            <div style={{fontSize:8.5,color:'#999'}}>{x.l}</div>
            <div style={{fontSize:11,fontWeight:600,color:'#555',marginTop:2}}>{x.v}</div>
            <div style={{fontSize:7.5,color:'#bbb',marginTop:1}}>{x.s}</div>
          </div>)}
        </div>
        {/* P√âCULE VACANCES & 13√àME MOIS ‚Äî Estimations annuelles */}
        <div style={{marginTop:10,padding:12,background:"#f8f7f2",borderRadius:8,border:'1px solid rgba(198,163,78,.1)'}}>
          <div style={{fontSize:9,color:'#c6a34e',textTransform:'uppercase',letterSpacing:'1px',fontWeight:600,marginBottom:8}}>Estimations annuelles ‚Äî P√©cule vacances & 13√®me mois</div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14}}>
            <div>
              <div style={{fontSize:9.5,fontWeight:600,color:'#555',marginBottom:4}}>üèñ P√©cule de vacances ({res.peculeVacCalc?.type==='ouvrier'?'Ouvrier ‚Äî ONVA':'Employ√© ‚Äî Employeur'})</div>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:4,fontSize:9.5,color:'#777'}}>
                <span>Simple:</span><span style={{fontWeight:600,textAlign:'right'}}>{fmt(res.peculeVacCalc?.simple||0)}</span>
                <span>Double (92%):</span><span style={{fontWeight:600,textAlign:'right'}}>{fmt(res.peculeVacCalc?.double||0)}</span>
                <span>ONSS 2√® partie:</span><span style={{fontWeight:600,textAlign:'right',color:'#f87171'}}>-{fmt(res.peculeVacCalc?.onss2emePartie||0)}</span>
                <span>PP exceptionnel:</span><span style={{fontWeight:600,textAlign:'right',color:'#f87171'}}>-{fmt(res.peculeVacCalc?.ppExcep||0)} ({Math.round((res.peculeVacCalc?.ppExcepRate||0)*100)}%)</span>
                <span style={{borderTop:'1px solid #ddd',paddingTop:3}}>Total estim√©:</span><span style={{fontWeight:700,textAlign:'right',color:'#16a34a',borderTop:'1px solid #ddd',paddingTop:3}}>{fmt(res.peculeVacCalc?.total||0)}</span>
              </div>
              <div style={{fontSize:8,color:'#aaa',marginTop:4}}>Paiement: {res.peculeVacCalc?.moisPaiement}</div>
            </div>
            <div>
              <div style={{fontSize:9.5,fontWeight:600,color:'#555',marginBottom:4}}>üéÑ Prime de fin d'ann√©e (13√®me mois)</div>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:4,fontSize:9.5,color:'#777'}}>
                <span>Brut:</span><span style={{fontWeight:600,textAlign:'right'}}>{fmt(res.y13Calc?.montant||0)}</span>
                <span>ONSS (13,07%):</span><span style={{fontWeight:600,textAlign:'right',color:'#f87171'}}>-{fmt(res.y13Calc?.onss||0)}</span>
                <span>PP exceptionnel:</span><span style={{fontWeight:600,textAlign:'right',color:'#f87171'}}>-{fmt(res.y13Calc?.ppExcep||0)} ({Math.round((res.y13Calc?.ppExcepRate||0)*100)}%)</span>
                <span style={{borderTop:'1px solid #ddd',paddingTop:3}}>Net estim√©:</span><span style={{fontWeight:700,textAlign:'right',color:'#16a34a',borderTop:'1px solid #ddd',paddingTop:3}}>{fmt(res.y13Calc?.netEstime||0)}</span>
              </div>
              <div style={{fontSize:8,color:'#aaa',marginTop:4}}>{res.y13Calc?.methode} ¬∑ Paiement: {res.y13Calc?.moisPaiement}</div>
            </div>
          </div>
        </div>
        <div style={{marginTop:18,padding:14,background:"#f0efea",borderRadius:8,display:'grid',gridTemplateColumns:res.atnCar>0?'repeat(5,1fr)':'repeat(4,1fr)',gap:10}}>
          {[{l:"Brut",v:res.gross},{l:`ONSS empl. (${(res.onssE_rate*100).toFixed(0)}%)`,v:res.onssE},...(res.cotisVacOuv>0?[{l:"Cot. vac. ouvrier (15,84%)",v:res.cotisVacOuv}]:[]),...(res.atnCar>0?[{l:"Cot. CO2",v:res.cotCO2}]:[]),...(res.pensionComplEmpl>0?[{l:"Pension compl. empl.",v:res.pensionComplEmpl}]:[]),...(res.ecoCheques>0?[{l:"√âco-ch√®ques",v:res.ecoCheques}]:[]),...(res.dispensePPTotal>0?[{l:"Dispense PP (nuit/HS)",v:-res.dispensePPTotal}]:[]),...(res.redGCPremier>0?[{l:`R√©d. ${res.redGCPremierLabel||'1er eng.'} (Art.336 LP)`,v:-res.redGCPremier}]:[]),...(res.redGCAge>0?[{l:"R√©d. trav. √¢g√© 55+",v:-res.redGCAge}]:[]),...(res.redGCJeune>0?[{l:"R√©d. jeune <26",v:-res.redGCJeune}]:[]),...(res.redGCHandicap>0?[{l:"R√©d. handicap",v:-res.redGCHandicap}]:[]),...(res.allocTravail>0?[{l:`Alloc. ONEM ${res.allocTravailLabel}`,v:-res.allocTravail}]:[]),{l:"Avantages",v:res.mvEmployer+res.expense+res.transport+res.indemTeletravail+res.indemBureau},{l:"CO√õT TOTAL",v:res.costTotal,g:1}].map((x,i)=>
            <div key={i} style={{textAlign:'center'}}><div style={{fontSize:9.5,color:'#999',textTransform:'uppercase'}}>{x.l}</div><div style={{fontSize:13,fontWeight:x.g?800:600,marginTop:3,color:x.g?'#c6a34e':'#333'}}>{fmt(x.v)}</div></div>
          )}
        </div>
        <div style={{marginTop:10,fontSize:10.5,color:'#bbb'}}>Versement: {emp.iban}</div>
        {/* CONDITIONS G√âN√âRALES INSTITUTIONNELLES */}
        <div style={{marginTop:18,paddingTop:14,borderTop:'1px solid #e0dfda'}}>
          <div style={{fontSize:8.5,color:'#bbb',textTransform:'uppercase',letterSpacing:'1.5px',fontWeight:600,marginBottom:8}}>Conditions g√©n√©rales</div>
          <div style={{fontSize:8,color:'#aaa',lineHeight:1.7,columnCount:2,columnGap:20}}>
            <p style={{margin:'0 0 4px'}}><b style={{color:'#999'}}>1. Confidentialit√©</b> ‚Äî La pr√©sente fiche de paie est un document strictement confidentiel destin√© exclusivement au travailleur mentionn√© ci-dessus. Toute reproduction, diffusion ou communication √† des tiers est interdite sauf accord √©crit de l'employeur.</p>
            <p style={{margin:'0 0 4px'}}><b style={{color:'#999'}}>2. Base l√©gale</b> ‚Äî Ce document est √©tabli conform√©ment √† la loi du 12 avril 1965 concernant la protection de la r√©mun√©ration des travailleurs et √† l'arr√™t√© royal du 27 septembre 1966 d√©terminant les mentions obligatoires du d√©compte de r√©mun√©ration.</p>
            <p style={{margin:'0 0 4px'}}><b style={{color:'#999'}}>3. Calculs</b> ‚Äî Les retenues ONSS sont effectu√©es conform√©ment √† la loi du 29 juin 1981. Le pr√©compte professionnel est calcul√© selon la formule-cl√© du SPF Finances (annexe III AR/CIR 92). La cotisation sp√©ciale de s√©curit√© sociale est √©tablie conform√©ment √† la loi du 30 mars 1994.</p>
            <p style={{margin:'0 0 4px'}}><b style={{color:'#999'}}>4. Contestation</b> ‚Äî Toute contestation relative au pr√©sent d√©compte doit √™tre adress√©e par √©crit √† l'employeur dans un d√©lai d'un mois √† compter de la date de r√©ception. Pass√© ce d√©lai, le d√©compte est r√©put√© accept√©, sans pr√©judice du droit de r√©clamation l√©gal.</p>
            <p style={{margin:'0 0 4px'}}><b style={{color:'#999'}}>5. Conservation</b> ‚Äî Le travailleur est tenu de conserver ce document pendant une dur√©e minimale de 5 ans. Ce document peut √™tre requis pour l'√©tablissement de la d√©claration fiscale (IPP) et pour toute d√©marche administrative (ch√¥mage, pension, cr√©dit).</p>
            <p style={{margin:'0 0 4px'}}><b style={{color:'#999'}}>6. Donn√©es personnelles</b> ‚Äî Le traitement des donn√©es √† caract√®re personnel figurant sur ce document est effectu√© conform√©ment au R√®glement (UE) 2016/679 (RGPD). Les donn√©es sont trait√©es aux seules fins de gestion salariale, d√©clarations sociales et fiscales. Le travailleur dispose d'un droit d'acc√®s, de rectification et de suppression de ses donn√©es (art. 15-17 RGPD).</p>
            <p style={{margin:'0 0 4px'}}><b style={{color:'#999'}}>7. Bar√®mes</b> ‚Äî Les r√©mun√©rations sont conformes aux bar√®mes sectoriels en vigueur de la commission paritaire applicable (CP {emp.cp||s.co.cp||'200'}), tels que publi√©s par le SPF Emploi, Travail et Concertation sociale.</p>
            <p style={{margin:'0 0 4px'}}><b style={{color:'#999'}}>8. Paiement</b> ‚Äî Le salaire net est vers√© par virement bancaire sur le compte communiqu√© par le travailleur, au plus tard le dernier jour ouvrable du mois en cours, conform√©ment √† l'art. 5 de la loi du 12/04/1965.</p>
          </div>
          <div style={{marginTop:10,paddingTop:8,borderTop:'1px solid #eee',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <div style={{fontSize:7.5,color:'#ccc'}}>{s.co.name} ¬∑ {s.co.vat} ¬∑ {s.co.addr} ¬∑ Secr√©tariat social: Aureus Social Pro</div>
            <div style={{fontSize:7.5,color:'#ccc'}}>Document g√©n√©r√© le {new Date().toLocaleDateString('fr-BE')} ¬∑ Page 1/1</div>
          </div>
        </div>

        {/* TABLEAU R√âCAPITULATIF SOUMISSION ONSS / PP PAR √âL√âMENT */}
        <div style={{marginTop:18,padding:14,background:"#f0efea",borderRadius:8}}>
          <div style={{fontSize:9.5,color:'#999',textTransform:'uppercase',letterSpacing:'1px',fontWeight:600,marginBottom:10}}>R√©capitulatif soumission ONSS & Pr√©compte professionnel</div>
          <table style={{width:'100%',borderCollapse:'collapse',fontSize:10.5}}>
            <thead><tr style={{borderBottom:'2px solid #c6a34e'}}>
              <th style={{textAlign:'left',padding:'6px 8px',color:'#999',fontSize:9}}>√âl√©ment</th>
              <th style={{textAlign:'center',padding:'6px 8px',color:'#999',fontSize:9}}>Montant</th>
              <th style={{textAlign:'center',padding:'6px 8px',color:'#999',fontSize:9}}>ONSS</th>
              <th style={{textAlign:'center',padding:'6px 8px',color:'#999',fontSize:9}}>PP</th>
              <th style={{textAlign:'left',padding:'6px 8px',color:'#999',fontSize:9}}>Base l√©gale</th>
            </tr></thead>
            <tbody>
              {[
                {l:"Salaire de base",m:res.base,onss:'‚úÖ Oui',pp:'‚úÖ Oui',ref:"Loi 12/04/1965"},
                ...(res.overtime>0?[{l:"Heures suppl√©mentaires (150%)",m:res.overtime,onss:'‚úÖ Oui',pp:'‚úÖ Oui',ref:"Loi 16/03/1971"}]:[]),
                ...(res.sunday>0?[{l:"Suppl√©ment dimanche (200%)",m:res.sunday,onss:'‚úÖ Oui',pp:'‚úÖ Oui',ref:"Loi 16/03/1971"}]:[]),
                ...(res.night>0?[{l:"Suppl√©ment nuit (125%)",m:res.night,onss:'‚úÖ Oui',pp:'‚úÖ Oui',ref:"Loi 16/03/1971"}]:[]),
                ...(res.bonus>0?[{l:"Prime",m:res.bonus,onss:'‚úÖ Oui',pp:'‚úÖ Oui',ref:"Art. 2 Loi 12/04/1965"}]:[]),
                ...(res.y13>0?[{l:"13√®me mois",m:res.y13,onss:'‚úÖ Oui',pp:'‚úÖ Taux except.',ref:"AR 09/01/2024 ann.III"}]:[]),
                ...(res.sickPay>0?[{l:"Salaire garanti maladie",m:res.sickPay,onss:'‚úÖ Oui',pp:'‚úÖ Oui',ref:"Loi 03/07/1978 Art.52-70"}]:[]),
                {l:"‚ñ¨ TOTAL BRUT",m:res.gross,onss:'',pp:'',ref:"",bold:true},
                ...(emp.statut==='ouvrier'?[{l:"  ‚îî Base ONSS ouvrier (brut √ó 108%)",m:Math.round(res.gross*1.08*100)/100,onss:'‚úÖ 13,07%',pp:'‚Äî',ref:"Loi 29/06/1981 Art.23",hl:"orange"}]:[]),
                {l:"ONSS travailleur (13,07%)",m:res.onssW,onss:'‚Äî',pp:'‚Äî',ref:"Loi 29/06/1981",neg:true},
                ...(res.empBonus>0?[{l:"  ‚îî Bonus √† l\'emploi social (volet A+B)",m:res.empBonus,onss:'R√©duction',pp:'‚Äî',ref:"AR 01/06/1999 Art.2",hl:"green"}]:[]),
                ...(res.empBonusFisc>0?[{l:"  ‚îî Bonus emploi fiscal (PP)",m:res.empBonusFisc,onss:'‚Äî',pp:'R√©duction',ref:"Art. 289ter CIR 92",hl:"green"}]:[]),
                {l:"ONSS net retenu",m:res.onssNet,onss:'‚Äî',pp:'‚Äî',ref:"",neg:true,bold:true},
                {l:"Pr√©compte professionnel",m:res.tax,onss:'‚Äî',pp:'‚Äî',ref:"AR/CIR 92 annexe III",neg:true},
                ...(res.ppVolontaire>0?[{l:"PP volontaire",m:res.ppVolontaire,onss:'‚Äî',pp:'‚Äî',ref:"Art. 275¬ß1 CIR 92",neg:true}]:[]),
                {l:"Cotisation sp√©ciale SS",m:res.css,onss:'‚Äî',pp:'‚Äî',ref:"Loi 30/03/1994",neg:true},
                ...(res.atnCar>0?[{l:"ATN Voiture de soci√©t√©",m:res.atnCar,onss:'‚ùå Non',pp:'‚úÖ Oui',ref:"Art. 36 CIR 92"}]:[]),
                ...(res.atnGSM>0?[{l:"ATN GSM",m:res.atnGSM,onss:'‚ùå Non',pp:'‚úÖ Oui',ref:"AR 18/12/2024 forfait"}]:[]),
                ...(res.atnPC>0?[{l:"ATN PC",m:res.atnPC,onss:'‚ùå Non',pp:'‚úÖ Oui',ref:"AR 18/12/2024 forfait"}]:[]),
                ...(res.atnInternet>0?[{l:"ATN Internet",m:res.atnInternet,onss:'‚ùå Non',pp:'‚úÖ Oui',ref:"AR 18/12/2024 forfait"}]:[]),
                ...(res.atnLogement>0?[{l:"ATN Logement",m:res.atnLogement,onss:'‚ùå Non',pp:'‚úÖ Oui',ref:"Art. 18 AR/CIR 92"}]:[]),
                ...(res.atnChauffage>0?[{l:"ATN Chauffage",m:res.atnChauffage,onss:'‚ùå Non',pp:'‚úÖ Oui',ref:"Art. 18 AR/CIR 92"}]:[]),
                ...(res.atnElec>0?[{l:"ATN √âlectricit√©",m:res.atnElec,onss:'‚ùå Non',pp:'‚úÖ Oui',ref:"Art. 18 AR/CIR 92"}]:[]),
                ...(res.veloSociete?[{l:"üö≤ V√©lo de soci√©t√©",m:0,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"Art. 38¬ß1er 14¬∞a CIR",hl:"green"}]:[]),
                ...(res.atnCarteCarburant>0?[{l:"Carte carburant (sans voit. soc.)",m:res.atnCarteCarburant,onss:'‚úÖ Oui',pp:'‚úÖ Oui',ref:"Art. 36¬ß2 CIR 92"}]:[]),
                ...(res.transport>0?[{l:"Transport domicile-travail",m:res.transport,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"CCT 19/9 + Art. 38¬ß1er 9¬∞ CIR",hl:"green"}]:[]),
                ...(res.expense>0?[{l:"Frais propres employeur",m:res.expense,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"Art. 31 CIR 92",hl:"green"}]:[]),
                ...(res.indemTeletravail>0?[{l:"Indemnit√© t√©l√©travail",m:res.indemTeletravail,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"Circ. 2021/C/20 (max 154,74‚Ç¨)",hl:"green"}]:[]),
                ...(res.indemBureau>0?[{l:"Indemnit√© bureau",m:res.indemBureau,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"Art. 31 CIR 92",hl:"green"}]:[]),
                ...(res.doublePecule>0?[{l:"Double p√©cule vacances",m:res.doublePecule,onss:'‚úÖ 2√® partie',pp:'‚úÖ Taux except.',ref:"AR 28/11/1969 Art.19¬ß2"}]:[]),
                ...(res.peculeDepart>0?[{l:"P√©cule vacances d√©part",m:res.peculeDepart,onss:'‚úÖ 13,07%',pp:'‚úÖ Taux except.',ref:"Loi 12/04/1965 Art.46"}]:[]),
                ...(res.primeAncExoneree>0?[{l:"Prime anciennet√© (exon√©r√©e)",m:res.primeAncExoneree,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"Art. 19¬ß2 14¬∞ AR ONSS",hl:"green"}]:[]),
                ...(res.primeAncTaxable>0?[{l:"Prime anciennet√© (taxable)",m:res.primeAncTaxable,onss:'‚úÖ Oui',pp:'‚úÖ Oui',ref:"Art. 19¬ß2 14¬∞ AR ONSS"}]:[]),
                ...(res.primeNaissance>0?[{l:"Prime naissance/mariage",m:res.primeNaissance,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"Circ. ONSS ‚Äî avantage social",hl:"green"}]:[]),
                ...(res.primeInnovation>0?[{l:"Prime innovation",m:res.primeInnovation,onss:'‚úÖ Oui',pp:'‚ùå Exon√©r√©',ref:"Art. 38¬ß1er 25¬∞ CIR"}]:[]),
                ...(res.ecoCheques>0?[{l:"√âco-ch√®ques",m:res.ecoCheques,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"CCT 98 du 20/02/2009",hl:"green"}]:[]),
                ...(res.cadeaux>0?[{l:"Cadeaux/√©v√©nements",m:res.cadeaux,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"Circ. ONSS (‚â§ plafond)",hl:"green"}]:[]),
                ...(res.budgetMobPilier2>0?[{l:"Budget mobilit√© Pilier 2",m:res.budgetMobPilier2,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"Loi 17/03/2019",hl:"green"}]:[]),
                ...(res.budgetMobPilier3>0?[{l:"Budget mobilit√© Pilier 3 (cash)",m:res.budgetMobPilier3,onss:'‚úÖ 38,07%',pp:'‚ùå Non',ref:"Loi 17/03/2019"}]:[]),
                ...(res.pensionCompl>0?[{l:"Pension compl√©mentaire (ret. pers.)",m:res.pensionCompl,onss:'‚úÖ Oui',pp:'‚ùå R√©duc. 30%',ref:"LPC 28/04/2003 + Art.145/1"}]:[]),
                ...(res.allocTravail>0?[{l:`Allocation travail ONEM (${res.allocTravailLabel})`,m:res.allocTravail,onss:'‚ùå Non',pp:'‚úÖ Retenu ONEM',ref:"AR 19/12/2001"}]:[]),
                ...(res.mvWorker>0?[{l:"Ch√®ques-repas (part travailleur)",m:res.mvWorker,onss:'‚ùå Exon√©r√©',pp:'‚ùå Exon√©r√©',ref:"AR 28/11/1969 Art.19bis¬ß2",hl:"green"}]:[]),
                {l:"‚ñ¨ TOTAL RETENUES",m:res.totalDed,onss:'',pp:'',ref:"",bold:true,neg:true},
                {l:"‚ñ¨ NET √Ä PAYER",m:res.net,onss:'',pp:'',ref:"",bold:true,hl:"net"},
              ].map((x,i)=><tr key={i} style={{borderBottom:'1px solid '+(x.bold?'#c6a34e':'#e5e4df'),background:x.hl==='green'?'rgba(22,163,74,.03)':x.hl==='orange'?'rgba(251,146,60,.04)':x.hl==='net'?'rgba(22,163,74,.06)':'transparent'}}>
                <td style={{padding:'5px 8px',color:x.bold?'#1a1a18':'#555',fontWeight:x.bold?700:400,fontSize:x.bold?11:10.5}}>{x.l}</td>
                <td style={{padding:'5px 8px',textAlign:'center',fontWeight:600,color:x.neg?'#dc2626':x.bold?'#1a1a18':x.hl==='net'?'#16a34a':'#333',fontSize:x.bold?12:10.5}}>{x.neg?'-':''}{fmt(x.m)}</td>
                <td style={{padding:'5px 8px',textAlign:'center',color:x.onss?.includes('‚ùå')?'#16a34a':x.onss?.includes('‚úÖ')?'#dc2626':'#999',fontWeight:600,fontSize:10}}>{x.onss||''}</td>
                <td style={{padding:'5px 8px',textAlign:'center',color:x.pp?.includes('‚ùå')?'#16a34a':x.pp?.includes('‚úÖ')?'#dc2626':'#999',fontWeight:600,fontSize:10}}>{x.pp||''}</td>
                <td style={{padding:'5px 8px',fontSize:9,color:'#999'}}>{x.ref||''}</td>
              </tr>)}
            </tbody>
          </table>
        </div>

        {/* BOUTON EXPORT PDF */}
        <div style={{marginTop:14,display:'flex',gap:10,justifyContent:'center'}} className="no-print">
          <button onClick={()=>{
            const el=document.querySelector('[data-payslip]');
            if(el){const w=window.open('',"","width=900,height=1200");
            w.document.write('<html><head><title>Fiche de paie ‚Äî '+emp.first+' '+emp.last+' ‚Äî '+MN[per.month-1]+' '+per.year+'</title><style>@import url("https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Cormorant+Garamond:wght@600;700&display=swap");*{margin:0;padding:0;box-sizing:border-box}body{font-family:Outfit,sans-serif;color:#1a1a18;background:#fff}.no-print{display:none!important}@media print{.no-print{display:none!important}@page{margin:10mm;size:A4}}</style></head><body>');
            w.document.write(el.outerHTML);w.document.write('</body></html>');w.document.close();
            setTimeout(()=>{w.print();},500);}
          }} style={{padding:'12px 28px',background:"#c6a34e",color:'#fff',border:'none',borderRadius:8,fontSize:13,fontWeight:600,cursor:'pointer',letterSpacing:'.5px'}}>üñ® Imprimer / PDF</button>
          <button onClick={()=>{
            const el=document.querySelector('[data-payslip]');
            if(el){const b=new Blob(['<html><head><meta charset="utf-8"><style>*{font-family:Outfit,sans-serif;color:#1a1a18}</style></head><body>'+el.outerHTML+'</body></html>'],{type:"text/html"});
            const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=`fiche_paie_${emp.last}_${emp.first}_${per.year}_${String(per.month).padStart(2,"0")}.html`;a.click();}
          }} style={{padding:'12px 28px',background:"transparent",color:'#c6a34e',border:'2px solid #c6a34e',borderRadius:8,fontSize:13,fontWeight:600,cursor:'pointer'}}>üíæ T√©l√©charger HTML</button>
        </div>
      </div>}
    </div>
    {s.pays.length>0&&<C style={{marginTop:20,padding:0,overflow:'hidden'}}>
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Historique</div></div>
      <Tbl cols={[
        {k:'p',l:"P√©riode",b:1,c:'#c6a34e',r:r=>r.period},{k:'e',l:"Employ√©",r:r=>r.ename},
        {k:'g',l:"Brut",a:'right',r:r=>fmt(r.gross)},{k:'o',l:"ONSS",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.onssNet)}</span>},
        {k:'t',l:"Pr√©compte",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.tax)}</span>},
        {k:'n',l:"Net",a:'right',r:r=><span style={{fontWeight:700,color:'#4ade80'}}>{fmt(r.net)}</span>},
        {k:'c',l:"Co√ªt",a:'right',r:r=><span style={{color:'#a78bfa'}}>{fmt(r.costTotal)}</span>},
      ]} data={s.pays}/>
    </C>}
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DIMONA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function DimonaPage({s,d}) {
  const [f,setF]=useState({eid:s.emps[0]?.id||'',action:"IN",wtype:"OTH",start:new Date().toISOString().split('T')[0],end:"",hours:'',reason:'',dimonaP:'',planHrs:''});
  const [tab,setTab]=useState('new');
  const [filter,setFilter]=useState('all');
  const emp=s.emps.find(e=>e.id===f.eid);

  // Validation engine
  const validate=()=>{
    const errs=[];
    if(!emp) errs.push('S√©lectionnez un travailleur');
    if(emp&&!emp.niss) errs.push('NISS manquant pour '+emp.first+' '+emp.last);
    if(!f.start) errs.push('Date de d√©but obligatoire');
    if(f.action==='OUT'&&!f.end) errs.push('Date de fin obligatoire pour OUT');
    if(f.action==='UPDATE'&&!f.dimonaP) errs.push('Num√©ro Dimona p√©riode requis pour UPDATE');
    if(['STU',"FLX"].includes(f.wtype)&&!f.planHrs) errs.push('Heures planifi√©es obligatoires pour '+f.wtype);
    if(f.action==='IN'){
      const startD=new Date(f.start);const today=new Date();today.setHours(0,0,0,0);
      if(startD<today) errs.push('‚ö† Dimona IN tardive (d√©but pass√©) ‚Äî amende possible');
    }
    if(f.action==='OUT'&&f.end&&f.start&&new Date(f.end)<new Date(f.start)) errs.push('Date fin avant date d√©but');
    return errs;
  };
  const errs=validate();

  // Worker type descriptions
  const wtDescs={OTH:'Ordinaire',STU:'√âtudiant (max 600h/an)',FLX:'Flexi-job',EXT:'Extra Horeca',DWD:'Travailleur occasionnel',IVT:'Stagiaire',BCW:'ALE/PWA',APP:'Apprenti',ART:'Artiste',SP1:'Travailleurs saisonniers',DIP:'Diplomate'};

  // Dimona type specific fields
  const needsEnd=f.action==='OUT'||f.wtype==='STU'||f.wtype==='FLX'||f.wtype==='EXT';
  const needsHours=['STU',"FLX","EXT","DWD"].includes(f.wtype);

  const gen=()=>{
    if(errs.filter(e=>!e.startsWith('‚ö†')).length>0) return;
    const xml=genDimonaXML({action:f.action,wtype:f.wtype,start:f.start,end:f.end,hours:f.planHrs||f.hours,first:emp.first,last:emp.last,niss:emp.niss,birth:emp.birth,cp:emp.cp,onss:s.co.onss,vat:s.co.vat,dimonaP:f.dimonaP,reason:f.reason});
    const dimNr='DIM'+Date.now().toString(36).toUpperCase();
    d({type:"ADD_DIM",d:{eid:emp.id,ename:`${emp.first} ${emp.last}`,action:f.action,wtype:f.wtype,wtypeDesc:wtDescs[f.wtype]||f.wtype,start:f.start,end:f.end,xml,at:new Date().toISOString(),status:'ok',dimNr,hours:f.planHrs||f.hours,reason:f.reason}});
    d({type:"MODAL",m:{w:850,c:<div>
      <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 6px',fontFamily:"'Cormorant Garamond',serif"}}>Dimona {f.action} ‚Äî {emp.first} {emp.last}</h2>
      <div style={{display:'flex',gap:8,marginBottom:12}}>
        <span style={{fontSize:10,padding:'3px 10px',borderRadius:4,background:"rgba(74,222,128,.1)",color:'#4ade80',fontWeight:600}}>‚úì XML g√©n√©r√©</span>
        <span style={{fontSize:10,padding:'3px 10px',borderRadius:4,background:"rgba(198,163,78,.1)",color:'#c6a34e',fontWeight:600}}>{f.wtype} ‚Äî {wtDescs[f.wtype]||f.wtype}</span>
        <span style={{fontSize:10,padding:'3px 10px',borderRadius:4,background:"rgba(96,165,250,.1)",color:'#60a5fa',fontWeight:600}}>R√©f: {dimNr}</span>
      </div>
      {errs.filter(e=>e.startsWith('‚ö†')).map((e,i)=><div key={i} style={{fontSize:10.5,color:'#f59e0b',marginBottom:6}}>‚ö† {e.replace('‚ö† ',"")}</div>)}
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginBottom:12}}>
        <div style={{padding:10,background:"rgba(198,163,78,.05)",borderRadius:6,fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>Identifiants</div>
          <div>Travailleur: <b style={{color:'#e8e6e0'}}>{emp.first} {emp.last}</b></div>
          <div>NISS: <b style={{color:'#e8e6e0',fontFamily:'monospace'}}>{emp.niss}</b></div>
          <div>CP: <b style={{color:'#e8e6e0'}}>{emp.cp}</b></div>
        </div>
        <div style={{padding:10,background:"rgba(96,165,250,.05)",borderRadius:6,fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          <div style={{fontWeight:600,color:'#60a5fa',marginBottom:4}}>D√©claration</div>
          <div>Action: <b style={{color:'#e8e6e0'}}>{f.action}</b></div>
          <div>Type: <b style={{color:'#e8e6e0'}}>{f.wtype} ({wtDescs[f.wtype]})</b></div>
          <div>D√©but: <b style={{color:'#e8e6e0'}}>{f.start}</b></div>
          {f.end&&<div>Fin: <b style={{color:'#e8e6e0'}}>{f.end}</b></div>}
        </div>
      </div>
      <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10,color:'#9e9b93',overflowX:'auto',whiteSpace:'pre-wrap',maxHeight:320,overflowY:'auto'}}>{xml}</pre>
      <div style={{display:'flex',gap:10,marginTop:14,justifyContent:'flex-end'}}>
        <B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B>
        <B onClick={()=>{navigator.clipboard?.writeText(xml);alert('XML Dimona copi√© !')}}>Copier XML</B>
      </div>
    </div>}});
  };

  // Stats
  const statsIN=s.dims.filter(x=>x.action==='IN').length;
  const statsOUT=s.dims.filter(x=>x.action==='OUT').length;
  const statsUPD=s.dims.filter(x=>x.action==='UPDATE').length;
  const filtered=filter==='all'?s.dims:s.dims.filter(x=>x.action===filter);

  return <div>
    <PH title="D√©clarations Dimona" sub="D√©claration imm√©diate de l'emploi ‚Äî ONSS / Portail s√©curit√© sociale"/>
    {/* Stats bar */}
    <div style={{display:'flex',gap:12,marginBottom:18}}>
      {[{l:"Total",v:s.dims.length,c:'#c6a34e'},{l:"IN",v:statsIN,c:'#4ade80'},{l:"OUT",v:statsOUT,c:'#f87171'},{l:"UPDATE",v:statsUPD,c:'#60a5fa'}].map((st,i)=>
        <div key={i} style={{flex:1,padding:'12px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{st.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:st.c,marginTop:2}}>{st.v}</div>
        </div>
      )}
    </div>
    {/* Tabs */}
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"new",l:"Nouvelle d√©claration"},{v:"history",l:"Historique"},{v:"rules",l:"R√®gles & D√©lais"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>

    {tab==='new'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>D√©claration Dimona</ST>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9}}>
          <I label="Travailleur" value={f.eid} onChange={v=>setF({...f,eid:v})} span={2} options={s.emps.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''} ${e.niss?'':'‚ö† NISS!'}`}))}/>
          <I label="Action" value={f.action} onChange={v=>setF({...f,action:v})} options={[{v:"IN",l:"IN ‚Äî Entr√©e en service"},{v:"OUT",l:"OUT ‚Äî Sortie de service"},{v:"UPDATE",l:"UPDATE ‚Äî Modification"},{v:"CANCEL",l:"CANCEL ‚Äî Annulation"}]}/>
          <I label="Type travailleur" value={f.wtype} onChange={v=>setF({...f,wtype:v})} options={Object.entries(wtDescs).map(([k,v])=>({v:k,l:`${k} ‚Äî ${v}`}))}/>
          <I label="Date d√©but" type="date" value={f.start} onChange={v=>setF({...f,start:v})}/>
          {needsEnd&&<I label="Date fin" type="date" value={f.end} onChange={v=>setF({...f,end:v})}/>}
          {needsHours&&<I label="Heures planifi√©es" type="number" value={f.planHrs} onChange={v=>setF({...f,planHrs:v})}/>}
          {f.action==='OUT'&&<I label="Motif sortie" value={f.reason} onChange={v=>setF({...f,reason:v})} options={[{v:"",l:"‚Äî S√©lectionner ‚Äî"},{v:"DEM",l:"D√©mission"},{v:"LIC",l:"Licenciement"},{v:"RUP",l:"Rupture amiable"},{v:"FIN",l:"Fin contrat d√©termin√©"},{v:"RET",l:"Retraite"},{v:"DEC",l:"D√©c√®s"},{v:"FOR",l:"Force majeure"}]}/>}
          {f.action==='UPDATE'&&<I label="N¬∞ Dimona p√©riode" value={f.dimonaP} onChange={v=>setF({...f,dimonaP:v})}/>}
        </div>
        {/* Validation errors */}
        {errs.length>0&&<div style={{marginTop:12,padding:10,background:errs.some(e=>!e.startsWith('‚ö†'))?'rgba(239,68,68,.06)':'rgba(245,158,11,.06)',borderRadius:8,border:`1px solid ${errs.some(e=>!e.startsWith('‚ö†'))?'rgba(239,68,68,.15)':'rgba(245,158,11,.15)'}`}}>
          {errs.map((e,i)=><div key={i} style={{fontSize:10.5,color:e.startsWith('‚ö†')?'#f59e0b':'#ef4444',padding:'2px 0'}}>‚Ä¢ {e}</div>)}
        </div>}
        <B onClick={gen} disabled={errs.filter(e=>!e.startsWith('‚ö†')).length>0} style={{width:'100%',marginTop:14,opacity:errs.filter(e=>!e.startsWith('‚ö†')).length>0?.5:1}}>G√©n√©rer Dimona {f.action}</B>
      </C>
      <div>
        <C><ST>Info type: {f.wtype}</ST>
          <div style={{fontSize:12,color:'#9e9b93',lineHeight:1.7}}>
            {f.wtype==='OTH'&&<>Type ordinaire ‚Äî contrat √† dur√©e d√©termin√©e ou ind√©termin√©e. Pas de champs sp√©cifiques suppl√©mentaires.</>}
            {f.wtype==='STU'&&<><b style={{color:'#c6a34e'}}>√âtudiant:</b> Max 600h/an exon√©r√©es cotisations ONSS normales (cotis solidarit√© 5,42% + 2,71%). Heures planifi√©es obligatoires. V√©rifier compteur Student@Work.</>}
            {f.wtype==='FLX'&&<><b style={{color:'#c6a34e'}}>Flexi-job:</b> Exclusivement pour secteurs autoris√©s (Horeca CP 302, Commerce CP 201/202, etc.). Travailleur doit avoir un emploi principal √† min 4/5. Net = Brut (pas d'ONSS/PP). Cotis patronale 28%.</>}
            {f.wtype==='EXT'&&<><b style={{color:'#c6a34e'}}>Extra Horeca:</b> Maximum 50 jours/an. Forfait journalier ONSS. Uniquement CP 302.</>}
            {f.wtype==='DWD'&&<><b style={{color:'#c6a34e'}}>Occasionnel:</b> Travailleurs occasionnels agriculture/horticulture. Forfait journalier.</>}
            {f.wtype==='IVT'&&<><b style={{color:'#c6a34e'}}>Stagiaire:</b> Convention d'immersion professionnelle (CIP). Pas de cotisations ONSS normales si indemnit√© ‚â§ plafond.</>}
            {f.wtype==='APP'&&<><b style={{color:'#c6a34e'}}>Apprenti:</b> Contrat d'apprentissage (IFAPME/EFP/VDAB/Syntra). Cotisations r√©duites.</>}
            {f.wtype==='ART'&&<><b style={{color:'#c6a34e'}}>Artiste:</b> Visa artiste ou d√©claration d'activit√© artistique. R√©gime sp√©cifique.</>}
            {!['OTH',"STU","FLX","EXT","DWD","IVT","APP","ART"].includes(f.wtype)&&<>Type sp√©cifique ‚Äî consultez la documentation ONSS.</>}
          </div>
        </C>
        <C style={{marginTop:12}}><ST>Rappels l√©gaux</ST>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.7}}>
            <div style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <b style={{color:'#4ade80'}}>IN:</b> Au plus tard au <b>moment</b> de la mise au travail</div>
            <div style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <b style={{color:'#f87171'}}>OUT:</b> Au plus tard le <b>dernier jour</b> de travail</div>
            <div style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <b style={{color:'#60a5fa'}}>UPDATE:</b> D√®s que la modification est connue</div>
            <div style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <b style={{color:'#a78bfa'}}>CANCEL:</b> Si le travailleur ne se pr√©sente pas</div>
            <div style={{padding:'6px 0',marginTop:6,background:"rgba(239,68,68,.06)",borderRadius:6,paddingLeft:8}}>
              <b style={{color:'#ef4444'}}>Amendes:</b> 2.500‚Ç¨ √† 12.500‚Ç¨ par travailleur non d√©clar√© (Code p√©nal social Art. 181)
            </div>
          </div>
        </C>
      </div>
    </div>}

    {tab==='history'&&<C style={{padding:0,overflow:'hidden'}}>
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
        <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Historique Dimona ({filtered.length})</div>
        <div style={{display:'flex',gap:6}}>
          {['all',"IN","OUT","UPDATE"].map(v=>
            <button key={v} onClick={()=>setFilter(v)} style={{padding:'4px 10px',borderRadius:6,border:'none',cursor:'pointer',fontSize:10,fontFamily:'inherit',fontWeight:filter===v?600:400,
              background:filter===v?'rgba(198,163,78,.15)':'rgba(255,255,255,.04)',color:filter===v?'#c6a34e':'#9e9b93'}}>{v==='all'?'Tous':v}</button>
          )}
        </div>
      </div>
      <Tbl cols={[
        {k:'a',l:"Action",r:r=><span style={{padding:'2px 7px',borderRadius:4,fontSize:10.5,fontWeight:600,background:r.action==='IN'?'rgba(74,222,128,.1)':r.action==='OUT'?'rgba(248,113,113,.1)':r.action==='UPDATE'?'rgba(96,165,250,.1)':'rgba(167,139,250,.1)',color:r.action==='IN'?'#4ade80':r.action==='OUT'?'#f87171':r.action==='UPDATE'?'#60a5fa':'#a78bfa'}}>{r.action}</span>},
        {k:'t',l:"Type",r:r=><span style={{fontSize:10,color:'#c6a34e'}}>{r.wtype} {r.wtypeDesc?`(${r.wtypeDesc})`:''}</span>},
        {k:'e',l:"Travailleur",r:r=>r.ename},
        {k:'s',l:"D√©but",r:r=>r.start},{k:'en',l:"Fin",r:r=>r.end||'‚Äî'},
        {k:'h',l:"Heures",r:r=>r.hours||'‚Äî'},
        {k:'r',l:"R√©f",r:r=><span style={{fontFamily:'monospace',fontSize:9.5,color:'#60a5fa'}}>{r.dimNr||'‚Äî'}</span>},
        {k:'st',l:"Statut",r:r=><span style={{color:'#4ade80',fontSize:11}}>‚úì</span>},
        {k:'x',l:"",a:'right',r:r=><B v="ghost" style={{padding:'3px 8px',fontSize:10}} onClick={()=>d({type:"MODAL",m:{w:800,c:<div><h3 style={{color:'#e8e6e0',margin:'0 0 10px'}}>Dimona {r.action} ‚Äî {r.ename}</h3><pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:380,overflowY:'auto'}}>{r.xml}</pre><div style={{display:'flex',gap:10,marginTop:12,justifyContent:'flex-end'}}><B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B><B onClick={()=>{navigator.clipboard?.writeText(r.xml);alert('Copi√© !')}}>Copier</B></div></div>}})}>XML</B>},
      ]} data={filtered}/>
    </C>}

    {tab==='rules'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>D√©lais l√©gaux par type</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{t:'OTH ‚Äî Ordinaire',d:"IN: avant mise au travail. OUT: dernier jour.",c:'#e8e6e0'},
            {t:'STU ‚Äî √âtudiant',d:"IN: avant d√©but. V√©rifier Student@Work (600h/an). OUT: dernier jour.",c:'#60a5fa'},
            {t:'FLX ‚Äî Flexi-job',d:"IN: avant chaque prestation. OUT: dernier jour prestation. Heures planifi√©es obligatoires.",c:'#4ade80'},
            {t:'EXT ‚Äî Extra Horeca',d:"IN: avant mise au travail. Max 50j/an. Forfait ONSS journalier.",c:'#f59e0b'},
            {t:'DWD ‚Äî Occasionnel',d:"Agriculture/horticulture. Dimona journali√®re.",c:'#a78bfa'},
            {t:'APP ‚Äî Apprenti',d:"Comme ordinaire + num√©ro contrat apprentissage.",c:'#f87171'},
          ].map((r,i)=><div key={i} style={{padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <div style={{fontWeight:600,color:r.c}}>{r.t}</div><div style={{fontSize:10.5,marginTop:2}}>{r.d}</div>
          </div>)}
        </div>
      </C>
      <C><ST>Sanctions & Amendes</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{l:"Absence de Dimona IN",a:'Niveau 4: 2.500‚Ç¨ ‚Äî 12.500‚Ç¨/travailleur',s:'Art. 181 CPS'},{l:"Dimona IN tardive",a:'Niveau 2: 400‚Ç¨ ‚Äî 4.000‚Ç¨',s:'Art. 182 CPS'},{l:"Absence de Dimona OUT",a:'Niveau 2: 400‚Ç¨ ‚Äî 4.000‚Ç¨',s:'Art. 182 CPS'},{l:"Donn√©es inexactes",a:'Niveau 2: 400‚Ç¨ ‚Äî 4.000‚Ç¨',s:'Art. 182 CPS'},{l:"R√©cidive dans les 12 mois",a:'Amende doubl√©e',s:'Art. 111 CPS'}].map((r,i)=>
            <div key={i} style={{padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <div style={{fontWeight:600,color:'#e8e6e0'}}>{r.l}</div>
              <div style={{color:'#f87171',fontSize:10.5}}>{r.a}</div>
              <div style={{color:'#5e5c56',fontSize:10}}>{r.s}</div>
            </div>
          )}
        </div>
        <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          <b>Portail:</b> www.socialsecurity.be ‚Üí Dimona Web<br/>
          <b>Batch:</b> Envoi XML via canal s√©curis√© (FTP/MQ)<br/>
          <b>Helpdesk:</b> Contact Center ONSS ‚Äî 02/509 59 59
        </div>
      </C>
    </div>}
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DMFA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function DMFAPage({s,d}) {
  const [q,setQ]=useState(Math.ceil((new Date().getMonth()+1)/3));
  const [y,setY]=useState(new Date().getFullYear());
  const [view,setView]=useState('detail');
  const ae=s.emps.filter(e=>e.status==='active');
  const sum=ae.map(e=>{
    const p=calc(e,{...DPER,days:65},s.co);
    const isOuv=(e.statut==='ouvrier');
    const base=isOuv?p.gross*3*1.08:p.gross*3;
    return{e,g3:p.gross*3,base3:base,isOuv,ow3:p.onssNet*3,oe3:p.onssE*3,
      ffe3:p.onss_ffe*3,chomT3:p.onss_chomTemp*3,amia3:p.onss_amiante*3,
      rate:p.onssE_rate,note:p.onssE_note,type:p.onssE_type};
  });
  const tot=sum.reduce((a,r)=>({g:a.g+r.g3,b:a.b+r.base3,ow:a.ow+r.ow3,oe:a.oe+r.oe3,ffe:a.ffe+r.ffe3,ct:a.ct+r.chomT3,am:a.am+r.amia3}),{g:0,b:0,ow:0,oe:0,ffe:0,ct:0,am:0});

  // Calendrier ONSS 2026 ‚Äî provisions mensuelles (le 5) + solde trimestriel
  const calONSS=[
    {p:'T1 2026',prov:['05/02',"05/03","05/04"],solde:'30/04/2026'},
    {p:'T2 2026',prov:['05/05',"05/06","05/07"],solde:'31/07/2026'},
    {p:'T3 2026',prov:['05/08',"05/09","05/10"],solde:'31/10/2026'},
    {p:'T4 2026',prov:['05/11',"05/12","05/01/2027"],solde:'31/01/2027'},
  ];

  const [ticket,setTicket]=useState(null);
  const gen=()=>{
    const xml=genDMFAXML(s.co,ae,q,y);
    const refMatch=xml.match(/Reference>([^<]+)</);
    const ref=refMatch?refMatch[1]:'REF-'+Date.now();
    const acrf=genDMFATicket(ref,s.co);
    const totAll=tot.ow+tot.oe+tot.ffe+tot.ct+tot.am;
    const anomalies=[];
    ae.forEach(e=>{if(!e.niss)anomalies.push({zone:'INSS',sev:"E",desc:`NISS manquant pour ${e.first||e.fn||'Emp'} ${e.last||''}`});});
    if(!s.co.onss)anomalies.push({zone:'NLOSSRegistrationNbr',sev:"E",desc:"Matricule ONSS employeur manquant"});
    const notif=genDMFANotification(acrf.ticket,s.co,q,y,ae.length,totAll.toFixed(2),anomalies);
    d({type:"ADD_DMFA",d:{q,y,cnt:ae.length,xml,ticket:acrf.ticket,ref,at:new Date().toISOString()}});
    setTicket({ref,ticket:acrf.ticket,acrfXml:acrf.xml,notifXml:notif,anomalies,xml});
    d({type:"MODAL",m:{w:950,c:<div>
      <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 6px',fontFamily:"'Cormorant Garamond',serif"}}>DMFA T{q}/{y} ‚Äî Envoi simul√©</h2>
      <div style={{display:'flex',gap:8,marginBottom:14}}>
        <span style={{fontSize:10,padding:'3px 10px',borderRadius:4,background:"rgba(74,222,128,.1)",color:'#4ade80',fontWeight:600}}>‚úì ACRF positif</span>
        <span style={{fontSize:10,padding:'3px 10px',borderRadius:4,background:anomalies.length>0?'rgba(198,163,78,.1)':'rgba(74,222,128,.1)',color:anomalies.length>0?'#c6a34e':'#4ade80',fontWeight:600}}>{anomalies.length>0?`‚ö† ${anomalies.length} anomalie(s)`:'‚úì Accept√©e sans anomalie'}</span>
      </div>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginBottom:14}}>
        <div style={{padding:10,background:"rgba(198,163,78,.05)",borderRadius:6,fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>Identifiants</div>
          <div>R√©f√©rence: <b style={{color:'#e8e6e0',fontFamily:'monospace'}}>{ref}</b></div>
          <div>Ticket ONSS: <b style={{color:'#4ade80',fontFamily:'monospace'}}>{acrf.ticket}</b></div>
          <div>Trimestre: <b style={{color:'#e8e6e0'}}>T{q}/{y}</b></div>
          <div>Travailleurs: <b style={{color:'#e8e6e0'}}>{ae.length}</b></div>
          <div>Total cotisations: <b style={{color:'#c6a34e'}}>{fmt(totAll)}</b></div>
        </div>
        <div style={{padding:10,background:"rgba(96,165,250,.05)",borderRadius:6,fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          <div style={{fontWeight:600,color:'#60a5fa',marginBottom:4}}>Flux ONSS</div>
          <div>1. <span style={{color:'#4ade80'}}>‚úì</span> Envoi XML DmfAOriginal</div>
          <div>2. <span style={{color:'#4ade80'}}>‚úì</span> Accus√© de r√©ception (ACRF) positif</div>
          <div>3. <span style={{color:'#4ade80'}}>‚úì</span> Notification (DMNO) ‚Äî accept√©e</div>
          <div>4. <span style={{color:'#60a5fa'}}>‚Üí</span> PID re√ßu (identifiants permanents)</div>
          <div>5. <span style={{color:'#5e5c56'}}>‚óã</span> √âventuelle notification de modification</div>
        </div>
      </div>
      {anomalies.length>0&&<div style={{padding:10,background:"rgba(248,113,113,.05)",borderRadius:6,marginBottom:14,border:'1px solid rgba(248,113,113,.1)'}}>
        <div style={{fontSize:11,fontWeight:600,color:'#f87171',marginBottom:6}}>Anomalies d√©tect√©es</div>
        {anomalies.map((a,i)=><div key={i} style={{fontSize:11,color:'#9e9b93',padding:'3px 0'}}>‚Ä¢ <b style={{color:'#f87171'}}>{a.zone}</b>: {a.desc}</div>)}
      </div>}
      <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:9.5,color:'#9e9b93',overflowX:'auto',whiteSpace:'pre-wrap',maxHeight:350,overflowY:'auto'}}>{xml}</pre>
      <div style={{display:'flex',gap:10,marginTop:14,justifyContent:'flex-end'}}>
        <B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B>
        <B v="outline" onClick={()=>{navigator.clipboard?.writeText(acrf.xml);alert('ACRF copi√© !')}}>Copier ACRF</B>
        <B onClick={()=>{navigator.clipboard?.writeText(xml);alert('XML DMFA copi√© !')}}>Copier XML</B>
      </div>
    </div>}});
  };
  return <div>
    <PH title="D√©claration DMFA" sub="Trimestrielle ‚Äî ONSS"/>
    <div style={{display:'grid',gridTemplateColumns:'300px 1fr',gap:18}}>
      <div>
      <C><ST>P√©riode</ST>
        <I label="Trimestre" value={q} onChange={v=>setQ(parseInt(v))} options={[{v:1,l:"T1 (Jan-Mar)"},{v:2,l:"T2 (Avr-Jun)"},{v:3,l:"T3 (Jul-Sep)"},{v:4,l:"T4 (Oct-D√©c)"}]}/>
        <I label="Ann√©e" type="number" value={y} onChange={v=>setY(v)} style={{marginTop:9}}/>
        <I label="Vue" value={view} onChange={setView} style={{marginTop:9}} options={[{v:"detail",l:"D√©tail par travailleur"},{v:"ventil",l:"Ventilation cotisations"},{v:"calendar",l:"Calendrier ONSS"}]}/>
        <B onClick={gen} style={{width:'100%',marginTop:14}}>G√©n√©rer DMFA T{q}/{y}</B>
        {ticket&&<div style={{marginTop:12,padding:10,background:"rgba(74,222,128,.05)",borderRadius:8,border:'1px solid rgba(74,222,128,.15)'}}>
          <div style={{fontSize:11,fontWeight:600,color:'#4ade80',marginBottom:6}}>‚úì Dernier envoi</div>
          <div style={{fontSize:10.5,color:'#9e9b93',lineHeight:2}}>
            <div>Ticket: <b style={{color:'#4ade80',fontFamily:'monospace',fontSize:9.5}}>{ticket.ticket}</b></div>
            <div>R√©f: <b style={{color:'#e8e6e0',fontFamily:'monospace',fontSize:9.5}}>{ticket.ref}</b></div>
            <div>Anomalies: <b style={{color:ticket.anomalies.length>0?'#f87171':'#4ade80'}}>{ticket.anomalies.length>0?ticket.anomalies.length+' ‚ö†':'Aucune ‚úì'}</b></div>
          </div>
          <div style={{display:'flex',gap:6,marginTop:6}}>
            <B v="ghost" style={{padding:'3px 8px',fontSize:9.5}} onClick={()=>d({type:"MODAL",m:{w:700,c:<div><h3 style={{color:'#e8e6e0',margin:'0 0 10px'}}>Accus√© de r√©ception (ACRF)</h3><pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:12,fontSize:9.5,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:300,overflowY:'auto'}}>{ticket.acrfXml}</pre><B v="outline" onClick={()=>d({type:"MODAL",m:null})} style={{marginTop:10}}>Fermer</B></div>}})}>ACRF</B>
            <B v="ghost" style={{padding:'3px 8px',fontSize:9.5}} onClick={()=>d({type:"MODAL",m:{w:700,c:<div><h3 style={{color:'#e8e6e0',margin:'0 0 10px'}}>Notification (DMNO)</h3><pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:12,fontSize:9.5,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:300,overflowY:'auto'}}>{ticket.notifXml}</pre><B v="outline" onClick={()=>d({type:"MODAL",m:null})} style={{marginTop:10}}>Fermer</B></div>}})}>DMNO</B>
            <B v="ghost" style={{padding:'3px 8px',fontSize:9.5}} onClick={()=>d({type:"MODAL",m:{w:900,c:<div><h3 style={{color:'#e8e6e0',margin:'0 0 10px'}}>XML DmfAOriginal complet</h3><pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:12,fontSize:9,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:400,overflowY:'auto'}}>{ticket.xml}</pre><B v="outline" onClick={()=>d({type:"MODAL",m:null})} style={{marginTop:10}}>Fermer</B></div>}})}>XML</B>
          </div>
        </div>}
        <div style={{marginTop:18,padding:12,background:"rgba(198,163,78,.05)",borderRadius:8,border:'1px solid rgba(198,163,78,.1)'}}>
          <div style={{fontSize:11.5,fontWeight:600,color:'#c6a34e',marginBottom:6}}>R√©capitulatif T{q}/{y}</div>
          <div style={{fontSize:11.5,color:'#9e9b93',lineHeight:2}}>
            <div>Travailleurs: <b style={{color:'#e8e6e0'}}>{ae.length}</b> ({sum.filter(s2=>s2.isOuv).length} ouv. / {sum.filter(s2=>!s2.isOuv).length} empl.)</div>
            <div>Masse brute: <b style={{color:'#e8e6e0'}}>{fmt(tot.g)}</b></div>
            <div>Base ONSS (108%): <b style={{color:'#e8e6e0'}}>{fmt(tot.b)}</b></div>
            <div>ONSS trav.: <b style={{color:'#f87171'}}>{fmt(tot.ow)}</b></div>
            <div>ONSS empl.: <b style={{color:'#f87171'}}>{fmt(tot.oe)}</b></div>
            <div style={{borderTop:'1px solid rgba(198,163,78,.15)',paddingTop:4,marginTop:4}}>Total ONSS: <b style={{color:'#c6a34e'}}>{fmt(tot.ow+tot.oe)}</b></div>
          </div>
        </div>
        <div style={{marginTop:10,padding:8,background:"rgba(96,165,250,.06)",borderRadius:6,fontSize:10,color:'#60a5fa',lineHeight:1.6}}>
          <b>Provisions:</b> le 5 de chaque mois<br/>
          <b>Solde trim.:</b> dernier jour du mois suivant<br/>
          <b>Ouvriers:</b> base = brut √ó 108%<br/>
          <b>Marchand:</b> 25% | <b>Non-marchand:</b> 32,40%
        </div>
      </C>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        {view==='detail'&&<><div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>D√©tail T{q}/{y}</div></div>
        <Tbl cols={[
          {k:'n',l:"Travailleur",r:r=><span style={{fontWeight:500}}>{r.e.first} {r.e.last}</span>},
          {k:'st',l:"Statut",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:r.isOuv?'rgba(248,113,113,.1)':'rgba(96,165,250,.1)',color:r.isOuv?'#f87171':'#60a5fa'}}>{r.isOuv?'Ouvrier':'Employ√©'}</span>},
          {k:'c',l:"Code",r:r=>r.e.dmfaCode},{k:'cp',l:"CP",r:r=>r.e.cp},
          {k:'b',l:"Base ONSS",a:'right',r:r=><span style={{fontSize:11}}>{fmt(r.base3)}{r.isOuv?' (108%)':''}</span>},
          {k:'ow',l:"ONSS trav.",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.ow3)}</span>},
          {k:'oe',l:"ONSS empl.",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.oe3)}</span>},
          {k:'r',l:"Taux",a:'right',r:r=><span style={{fontSize:10,color:'#c6a34e'}}>{(r.rate*100).toFixed(1)}%</span>},
        ]} data={sum}/></>}

        {view==='ventil'&&<><div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Ventilation cotisations T{q}/{y}</div></div>
        <div style={{padding:18}}>
          {[
            {l:"Cotisation patronale de base",v:tot.oe,pct:(tot.oe/tot.b*100).toFixed(2),c:'#f87171'},
            {l:"Cotisation Fonds fermeture (FFE)",v:tot.ffe,pct:(tot.ffe/tot.b*100).toFixed(3),c:'#a78bfa'},
            {l:"Cotisation ch√¥mage temporaire",v:tot.ct,pct:(tot.ct/tot.b*100).toFixed(3),c:'#60a5fa'},
            {l:"Cotisation Fonds amiante",v:tot.am,pct:(tot.am/tot.b*100).toFixed(4),c:'#4ade80'},
            {l:"ONSS travailleur (13,07%)",v:tot.ow,pct:"13.07",c:'#f87171'},
          ].map((r,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <span style={{fontSize:12,color:'#9e9b93'}}>{r.l}</span>
            <span style={{display:'flex',gap:12,alignItems:'center'}}>
              <span style={{fontSize:10,color:'#5e5c56'}}>{r.pct}%</span>
              <span style={{fontWeight:600,color:r.c,fontSize:13,minWidth:90,textAlign:'right'}}>{fmt(r.v)}</span>
            </span>
          </div>)}
          <div style={{display:'flex',justifyContent:'space-between',padding:'12px 0',borderTop:'2px solid rgba(198,163,78,.3)',marginTop:8}}>
            <span style={{fontSize:13,fontWeight:700,color:'#e8e6e0'}}>TOTAL ONSS √† verser</span>
            <span style={{fontSize:16,fontWeight:700,color:'#c6a34e'}}>{fmt(tot.ow+tot.oe+tot.ffe+tot.ct+tot.am)}</span>
          </div>
          <div style={{marginTop:14,padding:10,background:"rgba(198,163,78,.05)",borderRadius:6,fontSize:10.5,color:'#9e9b93',lineHeight:1.6}}>
            <b style={{color:'#c6a34e'}}>Notes:</b><br/>
            ‚Ä¢ Cotis. patronale base: {sum.filter(s2=>s2.type==='marchand').length} trav. marchand (25%) + {sum.filter(s2=>s2.type==='non_marchand').length} trav. non-marchand (32,40%)<br/>
            ‚Ä¢ Fonds amiante: d√ª T1-T3 2026 uniquement<br/>
            ‚Ä¢ Ouvriers ({sum.filter(s2=>s2.isOuv).length}): base calcul√©e sur brut √ó 108%<br/>
            ‚Ä¢ R√©duction structurelle incluse (Cat {ae[0]?.statut==='ouvrier'?'1':'1'}) ‚Ä¢ Hors r√©ductions groupes-cibles
          </div>
        </div></>}

        {view==='calendar'&&<><div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Calendrier ONSS {y}</div></div>
        <div style={{padding:18}}>
          {calONSS.map((c,i)=><div key={i} style={{marginBottom:16,padding:12,background:"rgba(198,163,78,.04)",borderRadius:8,border:i===(q-1)?'1px solid rgba(198,163,78,.3)':'1px solid rgba(255,255,255,.03)'}}>
            <div style={{fontSize:12,fontWeight:600,color:i===(q-1)?'#c6a34e':'#e8e6e0',marginBottom:6}}>{c.p} {i===(q-1)?'‚Üê actuel':''}</div>
            <div style={{fontSize:11,color:'#9e9b93',lineHeight:2}}>
              {c.prov.map((pr,j)=><div key={j}>Provision {j+1}: <b style={{color:'#d4d0c8'}}>{pr}</b></div>)}
              <div style={{borderTop:'1px solid rgba(255,255,255,.05)',paddingTop:4,marginTop:4}}>Solde + DmfA: <b style={{color:'#c6a34e'}}>{c.solde}</b></div>
            </div>
          </div>)}
          <div style={{padding:10,background:"rgba(96,165,250,.06)",borderRadius:6,fontSize:10.5,color:'#60a5fa',lineHeight:1.6}}>
            <b>Rappel l√©gal:</b> Les provisions mensuelles sont calcul√©es par l'ONSS et communiqu√©es √† l'employeur. L'employeur verse la diff√©rence entre le total des provisions et la somme totale des cotisations au plus tard le dernier jour du mois suivant le trimestre.
          </div>
        </div></>}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ADMIN DASHBOARD ‚Äî PANNEAU D'ADMINISTRATION ULTRA COMPLET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function AdminDashboard({s,d}){
  const sub=s.sub||'admin_users';
  const [users,setUsers]=useState([]);
  const [clients,setClients]=useState([]);
  const [travailleurs,setTravailleurs]=useState([]);
  const [fiches,setFiches]=useState([]);
  const [audit,setAudit]=useState([]);
  const [loading,setLoading]=useState(true);
  const [search,setSearch]=useState('');
  const [selectedUser,setSelectedUser]=useState(null);
  const [dateRange,setDateRange]=useState('30');

  // Charger donn√©es depuis Supabase
  useEffect(()=>{
    loadData();
  },[sub]);

  async function loadData(){
    setLoading(true);
    try{
      const {supabase}=await import('./lib/supabase');
      if(!supabase){setLoading(false);return;}
      
      // Charger users
      const {data:usersData}=await supabase.from('users').select('*').order('created_at',{ascending:false});
      if(usersData)setUsers(usersData);
      
      // Charger clients
      const {data:clientsData}=await supabase.from('clients').select('*').order('created_at',{ascending:false});
      if(clientsData)setClients(clientsData);
      
      // Charger travailleurs
      const {data:travData}=await supabase.from('travailleurs').select('*').order('created_at',{ascending:false});
      if(travData)setTravailleurs(travData);
      
      // Charger fiches
      const {data:fichesData}=await supabase.from('fiches_paie').select('*').order('created_at',{ascending:false}).limit(500);
      if(fichesData)setFiches(fichesData);
      
      // Charger audit
      const {data:auditData}=await supabase.from('audit_log').select('*').order('created_at',{ascending:false}).limit(200);
      if(auditData)setAudit(auditData);
    }catch(e){console.error('Admin load error:',e);}
    setLoading(false);
  }

  // Stats globales
  const totalUsers=users.length;
  const activeUsers=users.filter(u=>u.active).length;
  const totalClients=clients.length;
  const activeClients=clients.filter(c=>c.active).length;
  const totalTrav=travailleurs.length;
  const activeTrav=travailleurs.filter(t=>t.actif).length;
  const totalFiches=fiches.length;
  const fichesMois=fiches.filter(f=>{const now=new Date();return f.annee===now.getFullYear()&&f.mois===now.getMonth()+1;}).length;
  
  // Revenue calc
  const revenuMensuelEstime=totalTrav*12; // 12‚Ç¨/fiche
  const revenuAnnuelEstime=revenuMensuelEstime*12;
  
  // Travailleurs par client
  const travParClient={};
  travailleurs.forEach(t=>{travParClient[t.client_id]=(travParClient[t.client_id]||0)+1;});
  const moyTravParClient=totalClients>0?(totalTrav/totalClients).toFixed(1):0;

  // Cards style
  const Stat=({label,value,sub,color,icon})=><div style={{padding:16,background:"rgba(255,255,255,.02)",borderRadius:12,border:"1px solid rgba(255,255,255,.04)",flex:1,minWidth:140}}>
    <div style={{fontSize:11,color:'#9e9b93',marginBottom:4}}>{icon} {label}</div>
    <div style={{fontSize:26,fontWeight:700,color:color||'#e8e6e0'}}>{value}</div>
    {sub&&<div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{sub}</div>}
  </div>;

  const Badge=({text,color})=><span style={{padding:'2px 8px',borderRadius:10,fontSize:10,fontWeight:600,background:`${color}15`,color,border:`1px solid ${color}30`}}>{text}</span>;

  // Format date
  const fDate=(d)=>{if(!d)return'-';const dt=new Date(d);return dt.toLocaleDateString('fr-BE',{day:'2-digit',month:'2-digit',year:'numeric'});};
  const fDateTime=(d)=>{if(!d)return'-';const dt=new Date(d);return dt.toLocaleDateString('fr-BE',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});};
  const timeAgo=(d)=>{if(!d)return'Jamais';const now=new Date();const dt=new Date(d);const diff=Math.floor((now-dt)/1000);if(diff<60)return'Il y a '+diff+'s';if(diff<3600)return'Il y a '+Math.floor(diff/60)+'min';if(diff<86400)return'Il y a '+Math.floor(diff/3600)+'h';return'Il y a '+Math.floor(diff/86400)+'j';};

  return <div>
    <div style={{padding:'18px 24px',borderBottom:'1px solid rgba(139,115,60,.15)',display:'flex',alignItems:'center',justifyContent:'space-between'}}>
      <div>
        <div style={{fontSize:18,fontWeight:700,color:'#e8e6e0'}}>üëë Administration Aureus Social Pro</div>
        <div style={{fontSize:11.5,color:'#9e9b93',marginTop:2}}>Panneau de controle ‚Äî Vue globale plateforme</div>
      </div>
      <div style={{display:'flex',gap:8,alignItems:'center'}}>
        <button onClick={loadData} style={{padding:'6px 14px',borderRadius:8,border:'1px solid rgba(198,163,78,.3)',background:'rgba(198,163,78,.08)',color:'#c6a34e',fontSize:11,cursor:'pointer',fontWeight:600}}>üîÑ Rafraichir</button>
        <div style={{fontSize:10,color:loading?'#fb923c':'#4ade80'}}>‚óè {loading?'Chargement...':'Connecte'}</div>
      </div>
    </div>
    
    <div style={{padding:24,maxHeight:'calc(100vh - 200px)',overflowY:'auto'}}>
    
    {/* ‚ïê‚ïê‚ïê ONGLET: USERS ‚ïê‚ïê‚ïê */}
    {sub==='admin_users'&&<div>
      {/* KPIs */}
      <div style={{display:'flex',gap:12,marginBottom:20,flexWrap:'wrap'}}>
        <Stat icon="üë§" label="Utilisateurs total" value={totalUsers} sub={`${activeUsers} actifs`} color="#c6a34e"/>
        <Stat icon="üè¢" label="Dossiers clients" value={totalClients} sub={`${activeClients} actifs`} color="#60a5fa"/>
        <Stat icon="üë•" label="Travailleurs" value={totalTrav} sub={`${activeTrav} actifs`} color="#4ade80"/>
        <Stat icon="üìÑ" label="Fiches de paie" value={totalFiches} sub={`${fichesMois} ce mois`} color="#a78bfa"/>
        <Stat icon="üí∞" label="Revenu mensuel est." value={`‚Ç¨${revenuMensuelEstime.toLocaleString()}`} sub={`‚Ç¨${revenuAnnuelEstime.toLocaleString()}/an`} color="#c6a34e"/>
      </div>

      {/* Search */}
      <div style={{marginBottom:16}}>
        <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="üîç Rechercher un utilisateur (nom, email...)" style={{width:'100%',padding:'10px 14px',background:'rgba(255,255,255,.04)',border:'1px solid rgba(198,163,78,.15)',borderRadius:8,color:'#e8e6e0',fontSize:12,outline:'none',boxSizing:'border-box'}}/>
      </div>

      {/* Users table */}
      <div style={{background:"rgba(255,255,255,.02)",borderRadius:12,border:"1px solid rgba(255,255,255,.04)",overflow:'hidden'}}>
        <div style={{display:'grid',gridTemplateColumns:'2fr 2fr 1fr 1fr 1.5fr 1.5fr 1fr',padding:'10px 14px',background:"rgba(198,163,78,.06)",borderBottom:'1px solid rgba(198,163,78,.1)',fontSize:10,fontWeight:600,color:'#c6a34e',textTransform:'uppercase',letterSpacing:.5}}>
          <div>Nom</div><div>Email</div><div>Role</div><div>Langue</div><div>Derniere connexion</div><div>Inscription</div><div>Statut</div>
        </div>
        {users.length===0?<div style={{padding:30,textAlign:'center',color:'#5e5c56',fontSize:12}}>
          {loading?'Chargement...':'Aucun utilisateur inscrit. Les utilisateurs apparaitront ici apres inscription.'}
        </div>:
        users.filter(u=>{
          if(!search)return true;
          const s=search.toLowerCase();
          return (u.nom||'').toLowerCase().includes(s)||(u.email||'').toLowerCase().includes(s)||(u.prenom||'').toLowerCase().includes(s);
        }).map((u,i)=>{
          const nbClients=clients.filter(c=>c.user_id===u.id).length;
          const nbTrav=travailleurs.filter(t=>clients.some(c=>c.id===t.client_id&&c.user_id===u.id)).length;
          return <div key={u.id} onClick={()=>setSelectedUser(selectedUser===u.id?null:u.id)} style={{display:'grid',gridTemplateColumns:'2fr 2fr 1fr 1fr 1.5fr 1.5fr 1fr',padding:'10px 14px',borderBottom:'1px solid rgba(255,255,255,.03)',cursor:'pointer',background:selectedUser===u.id?"rgba(198,163,78,.06)":i%2===0?"transparent":"rgba(255,255,255,.01)",fontSize:11.5,alignItems:'center',transition:'background .15s'}}>
            <div>
              <div style={{fontWeight:600,color:'#e8e6e0'}}>{u.prenom||''} {u.nom||''}</div>
              <div style={{fontSize:10,color:'#5e5c56'}}>{nbClients} dossier{nbClients!==1?'s':''} ¬∑ {nbTrav} travailleur{nbTrav!==1?'s':''}</div>
            </div>
            <div style={{color:'#9e9b93'}}>{u.email}</div>
            <div><Badge text={u.role||'admin'} color={u.role==='admin'?'#c6a34e':u.role==='gestionnaire'?'#60a5fa':'#9e9b93'}/></div>
            <div style={{color:'#9e9b93',fontSize:11}}>{(u.lang||'fr').toUpperCase()}</div>
            <div style={{color:'#9e9b93',fontSize:10.5}}>{timeAgo(u.last_login)}</div>
            <div style={{color:'#9e9b93',fontSize:10.5}}>{fDate(u.created_at)}</div>
            <div><Badge text={u.active?'Actif':'Inactif'} color={u.active?'#4ade80':'#f87171'}/></div>
          </div>;
        })}
        
        {/* Detail panel */}
        {selectedUser&&<div style={{padding:16,background:"rgba(198,163,78,.04)",borderTop:'1px solid rgba(198,163,78,.15)'}}>
          {(()=>{
            const u=users.find(u=>u.id===selectedUser);
            if(!u)return null;
            const uClients=clients.filter(c=>c.user_id===u.id);
            const uTrav=travailleurs.filter(t=>uClients.some(c=>c.id===t.client_id));
            const uFiches=fiches.filter(f=>uClients.some(c=>c.id===f.client_id));
            const revenu=uTrav.length*12;
            return <div>
              <div style={{fontSize:13,fontWeight:600,color:'#c6a34e',marginBottom:10}}>Detail: {u.prenom} {u.nom} ({u.email})</div>
              <div style={{display:'flex',gap:12,marginBottom:12,flexWrap:'wrap'}}>
                <Stat icon="üè¢" label="Dossiers" value={uClients.length} color="#60a5fa"/>
                <Stat icon="üë•" label="Travailleurs" value={uTrav.length} color="#4ade80"/>
                <Stat icon="üìÑ" label="Fiches" value={uFiches.length} color="#a78bfa"/>
                <Stat icon="üí∞" label="Revenu/mois" value={`‚Ç¨${revenu}`} sub={`‚Ç¨${revenu*12}/an`} color="#c6a34e"/>
              </div>
              {uClients.length>0&&<div>
                <div style={{fontSize:11,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>Ses dossiers clients :</div>
                {uClients.map(c=><div key={c.id} style={{display:'flex',alignItems:'center',gap:10,padding:'6px 10px',background:"rgba(255,255,255,.02)",borderRadius:6,marginBottom:4}}>
                  <div style={{fontSize:11,fontWeight:600,color:'#e8e6e0',flex:1}}>{c.nom}</div>
                  <div style={{fontSize:10,color:'#9e9b93'}}>TVA: {c.tva||'-'}</div>
                  <div style={{fontSize:10,color:'#9e9b93'}}>ONSS: {c.onss||'-'}</div>
                  <div style={{fontSize:10,color:'#9e9b93'}}>CP: {c.cp_number||'-'}</div>
                  <div style={{fontSize:10,color:'#9e9b93'}}>{travParClient[c.id]||0} trav.</div>
                  <Badge text={c.active?'Actif':'Inactif'} color={c.active?'#4ade80':'#f87171'}/>
                </div>)}
              </div>}
            </div>;
          })()}
        </div>}
      </div>
    </div>}

    {/* ‚ïê‚ïê‚ïê ONGLET: CLIENTS ‚ïê‚ïê‚ïê */}
    {sub==='admin_clients'&&<div>
      <div style={{display:'flex',gap:12,marginBottom:20,flexWrap:'wrap'}}>
        <Stat icon="üè¢" label="Total dossiers" value={totalClients} color="#60a5fa"/>
        <Stat icon="‚úÖ" label="Actifs" value={activeClients} color="#4ade80"/>
        <Stat icon="‚è∏" label="Inactifs" value={totalClients-activeClients} color="#fb923c"/>
        <Stat icon="üë•" label="Moy. travailleurs/client" value={moyTravParClient} color="#a78bfa"/>
      </div>

      <div style={{marginBottom:16}}>
        <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="üîç Rechercher un dossier (nom, TVA, ONSS...)" style={{width:'100%',padding:'10px 14px',background:'rgba(255,255,255,.04)',border:'1px solid rgba(198,163,78,.15)',borderRadius:8,color:'#e8e6e0',fontSize:12,outline:'none',boxSizing:'border-box'}}/>
      </div>

      <div style={{background:"rgba(255,255,255,.02)",borderRadius:12,border:"1px solid rgba(255,255,255,.04)",overflow:'hidden'}}>
        <div style={{display:'grid',gridTemplateColumns:'2.5fr 1.5fr 1fr 1fr 1fr 1fr 1fr',padding:'10px 14px',background:"rgba(198,163,78,.06)",borderBottom:'1px solid rgba(198,163,78,.1)',fontSize:10,fontWeight:600,color:'#c6a34e',textTransform:'uppercase',letterSpacing:.5}}>
          <div>Societe</div><div>TVA / ONSS</div><div>CP</div><div>Secteur</div><div>Travailleurs</div><div>Inscription</div><div>Statut</div>
        </div>
        {clients.length===0?<div style={{padding:30,textAlign:'center',color:'#5e5c56',fontSize:12}}>Aucun dossier client.</div>:
        clients.filter(c=>{
          if(!search)return true;
          const s=search.toLowerCase();
          return (c.nom||'').toLowerCase().includes(s)||(c.tva||'').toLowerCase().includes(s)||(c.onss||'').toLowerCase().includes(s);
        }).map((c,i)=>{
          const nb=travParClient[c.id]||0;
          const owner=users.find(u=>u.id===c.user_id);
          return <div key={c.id} style={{display:'grid',gridTemplateColumns:'2.5fr 1.5fr 1fr 1fr 1fr 1fr 1fr',padding:'10px 14px',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:11.5,alignItems:'center',background:i%2===0?"transparent":"rgba(255,255,255,.01)"}}>
            <div>
              <div style={{fontWeight:600,color:'#e8e6e0'}}>{c.nom}</div>
              <div style={{fontSize:10,color:'#5e5c56'}}>{c.forme_juridique||'SRL'} ¬∑ {c.ville||'-'} {owner?`¬∑ ${owner.prenom||''} ${owner.nom||''}`:''}</div>
            </div>
            <div><div style={{fontSize:10.5,color:'#9e9b93'}}>{c.tva||'-'}</div><div style={{fontSize:10,color:'#5e5c56'}}>{c.onss||'-'}</div></div>
            <div style={{color:'#c6a34e',fontWeight:600,fontSize:11}}>{c.cp_number||'-'}</div>
            <div style={{fontSize:10.5,color:'#9e9b93'}}>{c.secteur||'-'}</div>
            <div style={{fontWeight:600,color:nb>0?'#4ade80':'#5e5c56'}}>{nb}</div>
            <div style={{fontSize:10.5,color:'#9e9b93'}}>{fDate(c.created_at)}</div>
            <div><Badge text={c.active?'Actif':'Inactif'} color={c.active?'#4ade80':'#f87171'}/></div>
          </div>;
        })}
      </div>
    </div>}

    {/* ‚ïê‚ïê‚ïê ONGLET: STATS ‚ïê‚ïê‚ïê */}
    {sub==='admin_stats'&&<div>
      <div style={{display:'flex',gap:12,marginBottom:20,flexWrap:'wrap'}}>
        <Stat icon="üë§" label="Utilisateurs" value={totalUsers} sub={`${activeUsers} actifs`} color="#c6a34e"/>
        <Stat icon="üè¢" label="Dossiers" value={totalClients} sub={`${activeClients} actifs`} color="#60a5fa"/>
        <Stat icon="üë•" label="Travailleurs" value={totalTrav} sub={`${activeTrav} actifs`} color="#4ade80"/>
        <Stat icon="üìÑ" label="Fiches totales" value={totalFiches} color="#a78bfa"/>
        <Stat icon="üí∞" label="Revenu mensuel" value={`‚Ç¨${revenuMensuelEstime.toLocaleString()}`} color="#c6a34e"/>
        <Stat icon="üìà" label="Revenu annuel" value={`‚Ç¨${revenuAnnuelEstime.toLocaleString()}`} color="#4ade80"/>
      </div>

      {/* R√©partition par forme juridique */}
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:16,marginBottom:16}}>
        <div style={{padding:16,background:"rgba(255,255,255,.02)",borderRadius:12,border:"1px solid rgba(255,255,255,.04)"}}>
          <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:10}}>Repartition par forme juridique</div>
          {(()=>{
            const formes={};
            clients.forEach(c=>{const f=c.forme_juridique||'SRL';formes[f]=(formes[f]||0)+1;});
            return Object.entries(formes).sort((a,b)=>b[1]-a[1]).map(([f,n],i)=>{
              const pct=totalClients>0?((n/totalClients)*100).toFixed(1):0;
              return <div key={i} style={{display:'flex',alignItems:'center',gap:8,marginBottom:6}}>
                <div style={{flex:1,fontSize:11,color:'#e8e6e0'}}>{f}</div>
                <div style={{width:120,height:6,background:"rgba(255,255,255,.05)",borderRadius:3,overflow:'hidden'}}>
                  <div style={{width:`${pct}%`,height:'100%',background:'#c6a34e',borderRadius:3}}/>
                </div>
                <div style={{fontSize:10,color:'#9e9b93',width:50,textAlign:'right'}}>{n} ({pct}%)</div>
              </div>;
            });
          })()}
        </div>

        <div style={{padding:16,background:"rgba(255,255,255,.02)",borderRadius:12,border:"1px solid rgba(255,255,255,.04)"}}>
          <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:10}}>Repartition par secteur</div>
          {(()=>{
            const secteurs={};
            clients.forEach(c=>{const s=c.secteur||'Non defini';secteurs[s]=(secteurs[s]||0)+1;});
            return Object.entries(secteurs).sort((a,b)=>b[1]-a[1]).slice(0,10).map(([s,n],i)=>{
              const pct=totalClients>0?((n/totalClients)*100).toFixed(1):0;
              return <div key={i} style={{display:'flex',alignItems:'center',gap:8,marginBottom:6}}>
                <div style={{flex:1,fontSize:11,color:'#e8e6e0',whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'}}>{s}</div>
                <div style={{width:120,height:6,background:"rgba(255,255,255,.05)",borderRadius:3,overflow:'hidden'}}>
                  <div style={{width:`${pct}%`,height:'100%',background:'#60a5fa',borderRadius:3}}/>
                </div>
                <div style={{fontSize:10,color:'#9e9b93',width:50,textAlign:'right'}}>{n} ({pct}%)</div>
              </div>;
            });
          })()}
        </div>
      </div>

      {/* R√©partition par CP */}
      <div style={{padding:16,background:"rgba(255,255,255,.02)",borderRadius:12,border:"1px solid rgba(255,255,255,.04)"}}>
        <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:10}}>Top Commissions Paritaires</div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(150px,1fr))',gap:8}}>
          {(()=>{
            const cps={};
            clients.forEach(c=>{const cp=c.cp_number||'?';cps[cp]=(cps[cp]||0)+1;});
            return Object.entries(cps).sort((a,b)=>b[1]-a[1]).slice(0,12).map(([cp,n],i)=><div key={i} style={{padding:'8px 12px',background:"rgba(198,163,78,.04)",borderRadius:8,display:'flex',justifyContent:'space-between',alignItems:'center'}}>
              <div style={{fontSize:12,fontWeight:600,color:'#e8e6e0'}}>CP {cp}</div>
              <div style={{fontSize:11,color:'#c6a34e',fontWeight:600}}>{n}</div>
            </div>);
          })()}
        </div>
      </div>

      {/* Revenue projection */}
      <div style={{marginTop:16,padding:16,background:"rgba(198,163,78,.04)",borderRadius:12,border:"1px solid rgba(198,163,78,.15)"}}>
        <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:10}}>üí∞ Projection revenus (modele ‚Ç¨12/fiche/mois)</div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12}}>
          {[
            {l:'Actuel',users:totalUsers,trav:totalTrav},
            {l:'+3 mois',users:Math.ceil(totalUsers*1.5)||5,trav:Math.ceil(totalTrav*1.5)||50},
            {l:'+6 mois',users:Math.ceil(totalUsers*3)||15,trav:Math.ceil(totalTrav*3)||150},
            {l:'+12 mois',users:Math.ceil(totalUsers*8)||50,trav:Math.ceil(totalTrav*8)||500},
          ].map((p,i)=><div key={i} style={{padding:12,background:"rgba(255,255,255,.03)",borderRadius:8,textAlign:'center'}}>
            <div style={{fontSize:10,color:'#9e9b93',marginBottom:4}}>{p.l}</div>
            <div style={{fontSize:10,color:'#5e5c56'}}>{p.users} users ¬∑ {p.trav} trav.</div>
            <div style={{fontSize:18,fontWeight:700,color:'#4ade80',marginTop:4}}>‚Ç¨{(p.trav*12).toLocaleString()}</div>
            <div style={{fontSize:10,color:'#5e5c56'}}>/mois</div>
            <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginTop:2}}>‚Ç¨{(p.trav*12*12).toLocaleString()}/an</div>
          </div>)}
        </div>
      </div>
    </div>}

    {/* ‚ïê‚ïê‚ïê ONGLET: AUDIT ‚ïê‚ïê‚ïê */}
    {sub==='admin_audit'&&<div>
      <div style={{display:'flex',gap:8,marginBottom:16}}>
        {['7','30','90','365'].map(d=><button key={d} onClick={()=>setDateRange(d)} style={{padding:'6px 14px',borderRadius:8,border:dateRange===d?'1px solid rgba(198,163,78,.4)':'1px solid rgba(255,255,255,.06)',background:dateRange===d?"rgba(198,163,78,.12)":"rgba(255,255,255,.02)",color:dateRange===d?'#c6a34e':'#9e9b93',fontSize:11,cursor:'pointer'}}>{d==='365'?'1 an':`${d} jours`}</button>)}
      </div>
      
      <div style={{background:"rgba(255,255,255,.02)",borderRadius:12,border:"1px solid rgba(255,255,255,.04)",overflow:'hidden'}}>
        <div style={{display:'grid',gridTemplateColumns:'1.5fr 1.5fr 2fr 2fr 2fr',padding:'10px 14px',background:"rgba(198,163,78,.06)",borderBottom:'1px solid rgba(198,163,78,.1)',fontSize:10,fontWeight:600,color:'#c6a34e',textTransform:'uppercase',letterSpacing:.5}}>
          <div>Date</div><div>Utilisateur</div><div>Action</div><div>Table</div><div>Details</div>
        </div>
        {audit.length===0?<div style={{padding:30,textAlign:'center',color:'#5e5c56',fontSize:12}}>
          Aucune entree dans le journal d'audit. Les actions seront enregistrees automatiquement.
        </div>:
        audit.filter(a=>{
          const d=new Date(a.created_at);
          const now=new Date();
          return (now-d)<(parseInt(dateRange)*86400000);
        }).map((a,i)=>{
          const usr=users.find(u=>u.id===a.user_id);
          return <div key={a.id} style={{display:'grid',gridTemplateColumns:'1.5fr 1.5fr 2fr 2fr 2fr',padding:'8px 14px',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:11,alignItems:'center',background:i%2===0?"transparent":"rgba(255,255,255,.01)"}}>
            <div style={{color:'#9e9b93',fontSize:10}}>{fDateTime(a.created_at)}</div>
            <div style={{color:'#e8e6e0'}}>{usr?`${usr.prenom||''} ${usr.nom||''}`:a.user_id?.slice(0,8)||'-'}</div>
            <div><Badge text={a.action} color={a.action?.includes('create')?'#4ade80':a.action?.includes('delete')?'#f87171':'#60a5fa'}/></div>
            <div style={{color:'#9e9b93'}}>{a.table_name||'-'}</div>
            <div style={{fontSize:10,color:'#5e5c56',whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'}}>{a.details?JSON.stringify(a.details).slice(0,60):'-'}</div>
          </div>;
        })}
      </div>
    </div>}

    {/* ‚ïê‚ïê‚ïê ONGLET: BILLING ‚ïê‚ïê‚ïê */}
    {sub==='admin_billing'&&<div>
      <div style={{display:'flex',gap:12,marginBottom:20,flexWrap:'wrap'}}>
        <Stat icon="üí∞" label="Revenu mensuel" value={`‚Ç¨${revenuMensuelEstime.toLocaleString()}`} color="#4ade80"/>
        <Stat icon="üìà" label="Revenu annuel" value={`‚Ç¨${revenuAnnuelEstime.toLocaleString()}`} color="#c6a34e"/>
        <Stat icon="üë•" label="Fiches facturables" value={totalTrav} sub="travailleurs actifs" color="#60a5fa"/>
        <Stat icon="üè¢" label="Clients facturables" value={activeClients} color="#a78bfa"/>
      </div>

      {/* Facturation par client */}
      <div style={{background:"rgba(255,255,255,.02)",borderRadius:12,border:"1px solid rgba(255,255,255,.04)",overflow:'hidden'}}>
        <div style={{display:'grid',gridTemplateColumns:'2.5fr 1fr 1fr 1fr 1fr 1fr',padding:'10px 14px',background:"rgba(198,163,78,.06)",borderBottom:'1px solid rgba(198,163,78,.1)',fontSize:10,fontWeight:600,color:'#c6a34e',textTransform:'uppercase',letterSpacing:.5}}>
          <div>Client</div><div>Travailleurs</div><div>Tarif/fiche</div><div>Mensuel</div><div>Annuel</div><div>Entree</div>
        </div>
        {clients.filter(c=>c.active).map((c,i)=>{
          const nb=travParClient[c.id]||0;
          const tarif=nb<=5?15:nb<=20?12:nb<=50?9:nb<=100?7:5;
          const mensuel=nb*tarif;
          const annuel=mensuel*12;
          const entree=nb<=5?149:nb<=20?299:nb<=50?499:999;
          return <div key={c.id} style={{display:'grid',gridTemplateColumns:'2.5fr 1fr 1fr 1fr 1fr 1fr',padding:'10px 14px',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:11.5,alignItems:'center',background:i%2===0?"transparent":"rgba(255,255,255,.01)"}}>
            <div style={{fontWeight:600,color:'#e8e6e0'}}>{c.nom}</div>
            <div style={{color:'#9e9b93'}}>{nb}</div>
            <div style={{color:'#c6a34e',fontWeight:600}}>‚Ç¨{tarif}</div>
            <div style={{color:'#4ade80',fontWeight:600}}>‚Ç¨{mensuel}</div>
            <div style={{color:'#60a5fa'}}>‚Ç¨{annuel.toLocaleString()}</div>
            <div style={{color:'#a78bfa'}}>‚Ç¨{entree}</div>
          </div>;
        })}
        {/* Total row */}
        <div style={{display:'grid',gridTemplateColumns:'2.5fr 1fr 1fr 1fr 1fr 1fr',padding:'12px 14px',background:"rgba(198,163,78,.08)",fontSize:12,fontWeight:700,alignItems:'center',borderTop:'2px solid rgba(198,163,78,.2)'}}>
          <div style={{color:'#c6a34e'}}>TOTAL</div>
          <div style={{color:'#e8e6e0'}}>{totalTrav}</div>
          <div style={{color:'#9e9b93'}}>-</div>
          <div style={{color:'#4ade80'}}>‚Ç¨{revenuMensuelEstime.toLocaleString()}</div>
          <div style={{color:'#60a5fa'}}>‚Ç¨{revenuAnnuelEstime.toLocaleString()}</div>
          <div style={{color:'#a78bfa'}}>‚Ç¨{clients.filter(c=>c.active).reduce((sum,c)=>{const nb=travParClient[c.id]||0;return sum+(nb<=5?149:nb<=20?299:nb<=50?499:999);},0).toLocaleString()}</div>
        </div>
      </div>

      <div style={{marginTop:16,padding:12,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:11,color:'#60a5fa',lineHeight:1.6}}>
        ‚ÑπÔ∏è La grille tarifaire appliquee: 1-5 trav. = ‚Ç¨15/fiche ¬∑ 6-20 = ‚Ç¨12 ¬∑ 21-50 = ‚Ç¨9 ¬∑ 51-100 = ‚Ç¨7 ¬∑ 100+ = ‚Ç¨5. Frais d'entree: Starter ‚Ç¨149 ¬∑ Business ‚Ç¨299 ¬∑ Premium ‚Ç¨499 ¬∑ Enterprise ‚Ç¨999.
      </div>
    </div>}

    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GUIDE PORTAIL ONSS ‚Äî PAS A PAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function GuidePortailMod({s,d}){
  const [tab,setTab]=useState('intro');
  const tabs=[
    {id:'intro',l:"Vue d'ensemble",i:'üìã'},
    {id:'acces',l:'Acces au portail',i:'üîë'},
    {id:'dimona',l:'Dimona pas a pas',i:'‚¨Ü'},
    {id:'dmfa',l:'DmfA pas a pas',i:'‚óÜ'},
    {id:'paiement',l:'Paiement ONSS',i:'üí≥'},
    {id:'pp',l:'Precompte Pro',i:'üìä'},
    {id:'belcotax',l:'Belcotax 281',i:'üìÑ'},
    {id:'calendrier',l:'Calendrier annuel',i:'üìÖ'},
    {id:'faq',l:'FAQ',i:'‚ùì'},
  ];
  const Step=({n,title,desc,link,warn})=><div style={{marginBottom:16,padding:14,background:"rgba(198,163,78,.04)",borderRadius:10,border:"1px solid rgba(198,163,78,.08)"}}>
    <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:6}}>
      <div style={{width:28,height:28,borderRadius:'50%',background:"linear-gradient(135deg,#c6a34e,#8b6914)",display:'flex',alignItems:'center',justifyContent:'center',fontSize:13,fontWeight:700,color:'#0a0e1a',flexShrink:0}}>{n}</div>
      <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>{title}</div>
    </div>
    <div style={{fontSize:11.5,color:'#9e9b93',lineHeight:1.7,marginLeft:38}}>{desc}</div>
    {link&&<div style={{marginTop:6,marginLeft:38}}><a href={link} target="_blank" rel="noopener noreferrer" style={{fontSize:11,color:'#60a5fa',textDecoration:'underline'}}>{link}</a></div>}
    {warn&&<div style={{marginTop:8,marginLeft:38,padding:8,background:"rgba(251,146,60,.08)",borderRadius:6,fontSize:10.5,color:'#fb923c',lineHeight:1.5}}>‚ö†Ô∏è {warn}</div>}
  </div>;
  const Info=({text})=><div style={{padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:11,color:'#60a5fa',lineHeight:1.6,marginBottom:14}}>‚ÑπÔ∏è {text}</div>;
  const Warn=({text})=><div style={{padding:10,background:"rgba(248,113,113,.06)",borderRadius:8,fontSize:11,color:'#f87171',lineHeight:1.6,marginBottom:14}}>‚ö†Ô∏è {text}</div>;
  return <div>
    <div style={{padding:'18px 24px',borderBottom:'1px solid rgba(139,115,60,.15)'}}>
      <div style={{fontSize:18,fontWeight:700,color:'#e8e6e0'}}>üìò Guide Portail ONSS & Fiscal ‚Äî Pas a Pas</div>
      <div style={{fontSize:11.5,color:'#9e9b93',marginTop:4}}>Comment envoyer vos declarations vous-meme sur socialsecurity.be et MyMinfin</div>
    </div>
    <div style={{display:'flex',flexWrap:'wrap',gap:6,padding:'12px 24px',borderBottom:'1px solid rgba(139,115,60,.08)'}}>
      {tabs.map(t=><button key={t.id} onClick={()=>setTab(t.id)} style={{padding:'6px 12px',borderRadius:8,border:tab===t.id?'1px solid rgba(198,163,78,.4)':'1px solid rgba(255,255,255,.06)',background:tab===t.id?"rgba(198,163,78,.12)":"rgba(255,255,255,.02)",color:tab===t.id?'#c6a34e':'#9e9b93',fontSize:11,fontWeight:tab===t.id?600:400,cursor:'pointer'}}>{t.i} {t.l}</button>)}
    </div>
    <div style={{padding:24,maxHeight:'calc(100vh - 280px)',overflowY:'auto'}}>

    {tab==='intro'&&<div>
      <div style={{fontSize:14,fontWeight:600,color:'#c6a34e',marginBottom:12}}>Comment ca fonctionne ?</div>
      <Info text={"Aureus Social Pro calcule tout pour vous : salaires, ONSS, precompte, fiches de paie. Vous n'avez plus qu'a envoyer les declarations et payer. Ce guide vous explique comment faire, etape par etape."}/>
      <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:10}}>Repartition des taches</div>
      {[
        {tache:"Calcul salaires brut/net",qui:"Aureus Social Pro",icon:"‚úÖ"},
        {tache:"Fiches de paie",qui:"Aureus Social Pro",icon:"‚úÖ"},
        {tache:"Calcul cotisations ONSS (13,07% + patronal)",qui:"Aureus Social Pro",icon:"‚úÖ"},
        {tache:"Calcul precompte professionnel",qui:"Aureus Social Pro",icon:"‚úÖ"},
        {tache:"Preparation donnees DmfA",qui:"Aureus Social Pro",icon:"‚úÖ"},
        {tache:"Generation documents (C4, contrats...)",qui:"Aureus Social Pro",icon:"‚úÖ"},
        {tache:"Envoi Dimona IN/OUT",qui:"Vous, sur socialsecurity.be",icon:"üë§"},
        {tache:"Envoi DmfA trimestrielle",qui:"Vous, sur socialsecurity.be",icon:"üë§"},
        {tache:"Paiement cotisations ONSS",qui:"Vous, par virement bancaire",icon:"üë§"},
        {tache:"Paiement precompte professionnel",qui:"Vous, via MyMinfin",icon:"üë§"},
        {tache:"Envoi Belcotax 281 (annuel)",qui:"Vous, sur Belcotax-on-web",icon:"üë§"},
      ].map((r,i)=><div key={i} style={{display:'flex',alignItems:'center',gap:10,padding:'8px 12px',background:i%2===0?"rgba(255,255,255,.02)":"transparent",borderRadius:6,marginBottom:2}}>
        <div style={{fontSize:14,width:24,textAlign:'center'}}>{r.icon}</div>
        <div style={{flex:1,fontSize:11.5,color:'#e8e6e0'}}>{r.tache}</div>
        <div style={{fontSize:10.5,color:r.icon==='‚úÖ'?'#4ade80':'#c6a34e',fontWeight:600}}>{r.qui}</div>
      </div>)}
      <Info text={"Vous n'avez PAS besoin d'etre affilie a un secretariat social agree. L'affiliation est facultative (source: CCI France Belgique). Vous pouvez gerer vos obligations sociales vous-meme avec l'aide de notre logiciel."}/>
    </div>}

    {tab==='acces'&&<div>
      <div style={{fontSize:14,fontWeight:600,color:'#c6a34e',marginBottom:12}}>Obtenir l'acces au portail de la securite sociale</div>
      <Step n={1} title="Obtenir une carte eID ou itsme" desc="Pour acceder au portail de la securite sociale, vous devez vous identifier avec votre carte d'identite electronique (eID + lecteur de carte) ou via l'application itsme. Si vous n'avez pas encore itsme, telechargez l'application et activez-la via votre banque ou votre commune." link="https://www.itsme.be/fr"/>
      <Step n={2} title="Se connecter a socialsecurity.be" desc="Allez sur le portail de la securite sociale. Cliquez 'Se connecter' en haut a droite. Choisissez votre methode d'identification : eID, itsme, ou token. Vous arrivez sur votre espace employeur." link="https://www.socialsecurity.be" warn="Premiere connexion ? Vous devez d'abord etre identifie comme employeur. Si ce n'est pas encore fait, allez dans 'Repertoire des employeurs (WIDE)'."/>
      <Step n={3} title="S'inscrire comme employeur (WIDE)" desc="Si c'est votre premier travailleur, inscrivez-vous via le service WIDE (Werkgever Identificatie / Identification Employeur). Vous recevrez un numero ONSS. Ce numero est indispensable pour toutes vos declarations." link="https://www.socialsecurity.be/site_fr/employer/infos/employers_nsso.htm"/>
      <Step n={4} title="Donner acces a vos collaborateurs (optionnel)" desc="Via le service 'Gestion des acces' (MAHIS), vous pouvez deleguer l'acces a votre comptable ou a un collaborateur. Il pourra alors faire les declarations en votre nom. Vous restez toujours responsable legalement." link="https://www.socialsecurity.be/site_fr/employer/infos/access-management.htm"/>
      <Info text={"Conseil: installez un lecteur de carte eID sur votre PC (environ 15 EUR). C'est le moyen le plus rapide pour se connecter. Sinon, itsme fonctionne depuis votre smartphone."}/>
    </div>}

    {tab==='dimona'&&<div>
      <div style={{fontSize:14,fontWeight:600,color:'#c6a34e',marginBottom:12}}>Declarer une Dimona IN (embauche)</div>
      <Warn text={"La Dimona IN doit etre faite AVANT que le travailleur commence a travailler. Amende: 2.500 a 12.500 EUR par infraction (art. 181 Code Penal Social)."}/>
      <Step n={1} title="Preparer les informations dans Aureus Social Pro" desc="Allez dans ONSS > Dimona. Selectionnez le travailleur. Verifiez : NISS (numero national), date d'entree, type de contrat (ordinaire, etudiant, flexi...). Notez ces informations."/>
      <Step n={2} title="Se connecter au portail" desc="Allez sur socialsecurity.be > Se connecter > Dimona Web. Identifiez-vous avec eID ou itsme." link="https://www.socialsecurity.be/site_fr/employer/applics/dimona/index.htm"/>
      <Step n={3} title="Creer une nouvelle declaration" desc="Cliquez 'Nouvelle declaration' > Type: IN. Remplissez: Numero ONSS de votre entreprise, NISS du travailleur, date de debut, commission paritaire, type de travailleur (ouvrier/employe/etudiant)."/>
      <Step n={4} title="Cas etudiant (STU)" desc="Pour un etudiant: selectionnez le type STU. Indiquez les dates de debut et fin + nombre d'heures prevues. Rappel: max 650h/an a cotisations reduites (2,71% + 5,43%)." warn="Depassement des 650h = cotisations ONSS normales (13,07% + ~25% patronal) !"/>
      <Step n={5} title="Cas flexi-job (FLX)" desc="Selectionnez le type FLX. Le travailleur doit avoir un emploi d'au moins 4/5 temps chez un autre employeur (T-3). Cotisation patronale speciale: 28%."/>
      <Step n={6} title="Valider et envoyer" desc="Verifiez toutes les donnees. Cliquez 'Envoyer'. Vous recevez un numero de reference Dimona. Conservez-le. Le statut passe a 'Accepte' si tout est correct."/>
      <Step n={7} title="Dimona OUT (depart)" desc="Quand un travailleur quitte l'entreprise: refaites la meme procedure avec le type OUT. Indiquez la date de fin. Delai: au plus tard le premier jour ouvrable apres la fin du contrat."/>
      <Info text={"Astuce: dans Aureus Social Pro, l'historique de vos Dimona est enregistre. Notez-y le numero de reference ONSS apres chaque declaration pour garder une trace."}/>
    </div>}

    {tab==='dmfa'&&<div>
      <div style={{fontSize:14,fontWeight:600,color:'#c6a34e',marginBottom:12}}>Envoyer la DmfA trimestrielle</div>
      <Info text={"La DmfA (Declaration Multifonctionnelle) reprend TOUTES les donnees de salaires et prestations de vos travailleurs pour un trimestre. Aureus Social Pro calcule tout ‚Äî vous n'avez qu'a encoder sur le portail."}/>
      <Step n={1} title="Generer les donnees dans Aureus Social Pro" desc="Allez dans ONSS > DmfA. Selectionnez le trimestre. Cliquez 'Generer'. Le systeme prepare un recapitulatif avec: chaque travailleur, ses prestations (jours/heures), sa remuneration brute, les cotisations calculees. Imprimez ou exportez ce recapitulatif."/>
      <Step n={2} title="Se connecter a DmfA Web" desc="Sur socialsecurity.be > Se connecter > DmfA Web. C'est l'application en ligne officielle pour encoder votre declaration trimestrielle." link="https://www.socialsecurity.be/site_fr/employer/applics/dmfa/index.htm"/>
      <Step n={3} title="Creer une nouvelle declaration" desc="Cliquez 'Nouvelle declaration'. Selectionnez le trimestre concerne. Le systeme affiche votre numero ONSS et les travailleurs deja connus (via Dimona)."/>
      <Step n={4} title="Encoder les donnees par travailleur" desc="Pour chaque travailleur, remplissez: la ligne travailleur (categorie, code travailleur), la ligne occupation (regime, nombre de jours, heures), la ligne remuneration (brut, cotisations). Utilisez le recapitulatif d'Aureus Social Pro comme reference." warn="Verifiez que les montants correspondent EXACTEMENT aux calculs d'Aureus Social Pro. Toute difference peut entrainer un controle ONSS."/>
      <Step n={5} title="Verifier et envoyer" desc="DmfA Web dispose d'un outil de validation. Lancez-le avant d'envoyer. Il detecte les erreurs (anomalies A = bloquantes, anomalies W = avertissements). Corrigez les anomalies A puis envoyez."/>
      <Step n={6} title="Telecharger l'accuse de reception" desc="Apres envoi, vous recevez un accuse de reception avec un numero unique. Telechargez-le et conservez-le dans votre GED (Aureus Social Pro > Documents)."/>
      <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginTop:16,marginBottom:10}}>Echeances DmfA</div>
      {[{t:'T1 (jan-mars)',d:'30 avril'},{t:'T2 (avr-juin)',d:'31 juillet'},{t:'T3 (juil-sept)',d:'31 octobre'},{t:'T4 (oct-dec)',d:'31 janvier N+1'}].map((e,i)=><div key={i} style={{display:'flex',gap:10,padding:'6px 12px',background:i%2===0?"rgba(255,255,255,.02)":"transparent",borderRadius:4}}>
        <div style={{fontSize:11.5,color:'#c6a34e',fontWeight:600,width:120}}>{e.t}</div>
        <div style={{fontSize:11.5,color:'#e8e6e0'}}>au plus tard le <b>{e.d}</b></div>
      </div>)}
      <Warn text={"Retard de declaration = majorations de 0,5% par mois de retard sur les cotisations dues + interets de retard de 7% par an."}/>
    </div>}

    {tab==='paiement'&&<div>
      <div style={{fontSize:14,fontWeight:600,color:'#c6a34e',marginBottom:12}}>Payer les cotisations ONSS</div>
      <Step n={1} title="Consulter le montant dans Aureus Social Pro" desc="Allez dans ONSS > Dashboard ONSS ou Salaires > Fiches de paie. Le montant total des cotisations (travailleur 13,07% + patronal ~25%) est calcule automatiquement pour chaque travailleur."/>
      <Step n={2} title="Provisions mensuelles" desc="Chaque mois, vous devez verser une provision a l'ONSS. Le montant est communique par l'ONSS (visible dans 'Consultation factures employeurs' sur le portail). Payez le 5 du mois suivant." warn="Les provisions sont obligatoires si vos cotisations du trimestre T-2 depassent 4.000 EUR."/>
      <Step n={3} title="Effectuer le virement" desc={<span>Faites un virement vers:<br/><b>IBAN: BE63 6790 2618 1108</b><br/><b>BIC: PCHQBEBB</b><br/>Communication structuree: votre numero ONSS + trimestre. Le format exact est indique sur votre avis de provision ONSS.</span>}/>
      <Step n={4} title="Solde trimestriel" desc="Apres envoi de votre DmfA, l'ONSS calcule le solde (total cotisations du trimestre - provisions deja versees). Payez la difference avant la fin du mois suivant le trimestre."/>
      <Step n={5} title="Verifier vos paiements" desc="Connectez-vous a 'Consultation factures employeurs' sur socialsecurity.be. Vous y voyez l'historique de vos paiements, les montants dus et les eventuels retards." link="https://www.socialsecurity.be/site_fr/employer/applics/epayment/index.htm"/>
      <Info text={"Conseil: creez un ordre permanent mensuel dans votre banque pour ne jamais oublier les provisions. Ajustez le montant chaque trimestre si votre masse salariale change."}/>
    </div>}

    {tab==='pp'&&<div>
      <div style={{fontSize:14,fontWeight:600,color:'#c6a34e',marginBottom:12}}>Payer le precompte professionnel</div>
      <Info text={"Le precompte professionnel (PP) est l'impot que vous retenez sur le salaire de vos travailleurs et que vous versez au SPF Finances. Aureus Social Pro calcule le montant exact avec la formule-cle 2026."}/>
      <Step n={1} title="Consulter le montant PP" desc="Dans Aureus Social Pro, allez dans Fiscal > Precompte. Le montant du PP par travailleur est calcule automatiquement. Additionnez tous les PP pour obtenir le total a verser."/>
      <Step n={2} title="Se connecter a MyMinfin" desc="Allez sur MyMinfin (finances.belgium.be). Connectez-vous avec eID ou itsme. Allez dans 'Precompte professionnel'." link="https://eservices.minfin.fgov.be/myMinfin"/>
      <Step n={3} title="Remplir la declaration 274" desc="Remplissez le formulaire 274 (declaration mensuelle PP). Indiquez le montant total du precompte retenu pour le mois. Delai: le 15 du mois suivant."/>
      <Step n={4} title="Payer le precompte" desc={<span>Effectuez le virement vers le SPF Finances. Utilisez la communication structuree fournie sur MyMinfin.<br/><b>Delai: au plus tard le 15 du mois suivant.</b></span>} warn="Retard = majorations de 10% + interets (taux mensuel 0,8%)."/>
      <Step n={5} title="Declaration annuelle 325" desc="En fin d'annee, vous devez soumettre un recapitulatif annuel (fiche 281.10 pour les salaries). Utilisez Belcotax-on-web (voir onglet Belcotax)."/>
    </div>}

    {tab==='belcotax'&&<div>
      <div style={{fontSize:14,fontWeight:600,color:'#c6a34e',marginBottom:12}}>Envoyer les fiches Belcotax 281</div>
      <Step n={1} title="Generer les fiches dans Aureus Social Pro" desc="Allez dans Fiscal > Belcotax 281. Selectionnez l'annee. Le systeme genere les fiches 281.10 (salaries), 281.20 (dirigeants d'entreprise), 281.30 (honoraires) avec tous les montants annuels."/>
      <Step n={2} title="Se connecter a Belcotax-on-web" desc="Allez sur Belcotax-on-web via MyMinfin ou directement. Connectez-vous avec eID/itsme." link="https://eservices.minfin.fgov.be/belcotax-on-web"/>
      <Step n={3} title="Encoder ou importer les fiches" desc="Deux options: encoder manuellement chaque fiche (petit nombre de travailleurs) ou importer un fichier XML (Aureus Social Pro peut generer ce format dans une version future). Pour chaque travailleur: NISS, adresse, remuneration brute imposable, PP retenu, ONSS, avantages."/>
      <Step n={4} title="Valider et envoyer" desc="Belcotax valide automatiquement les donnees. Corrigez les erreurs detectees. Envoyez. Vous recevez un accuse de reception." warn="Delai: au plus tard le 1er mars de l'annee suivante. Passee cette date: amendes."/>
      <Step n={5} title="Distribuer les fiches aux travailleurs" desc="Chaque travailleur doit recevoir une copie de sa fiche 281.10 pour sa declaration d'impots. Envoyez-la via Aureus Social Pro > Envoi Documents ou imprimez-la."/>
    </div>}

    {tab==='calendrier'&&<div>
      <div style={{fontSize:14,fontWeight:600,color:'#c6a34e',marginBottom:12}}>Calendrier des echeances 2026</div>
      {[
        {m:'Chaque mois',t:[{l:'Provisions ONSS',d:'5 du mois suivant',c:'#4ade80'},{l:'Precompte Pro 274',d:'15 du mois suivant',c:'#60a5fa'},{l:'Fiches de paie',d:'Jour du paiement',c:'#c6a34e'}]},
        {m:'Chaque trimestre',t:[{l:'DmfA T1',d:'30 avril 2026',c:'#a78bfa'},{l:'DmfA T2',d:'31 juillet 2026',c:'#a78bfa'},{l:'DmfA T3',d:'31 octobre 2026',c:'#a78bfa'},{l:'DmfA T4',d:'31 janvier 2027',c:'#a78bfa'},{l:'Solde cotisations ONSS',d:'Fin du mois suivant le trimestre',c:'#4ade80'}]},
        {m:'Annuel',t:[{l:'Bilan Social BNB',d:'28 fevrier 2026',c:'#fb923c'},{l:'Belcotax 281',d:'1 mars 2026',c:'#f87171'},{l:'Compte individuel',d:'1 mars 2026',c:'#fb923c'},{l:'Vacances annuelles (attestation)',d:'31 mars 2026',c:'#fb923c'}]},
        {m:'Ponctuel',t:[{l:'Dimona IN',d:'AVANT debut travail',c:'#f87171'},{l:'Dimona OUT',d:'1er jour ouvrable apres fin',c:'#f87171'},{l:'DRS (risques sociaux)',d:'5 jours ouvrables',c:'#fb923c'}]},
      ].map((section,si)=><div key={si} style={{marginBottom:16}}>
        <div style={{fontSize:12,fontWeight:600,color:'#e8e6e0',marginBottom:8,padding:'6px 10px',background:"rgba(198,163,78,.08)",borderRadius:6}}>{section.m}</div>
        {section.t.map((e,i)=><div key={i} style={{display:'flex',alignItems:'center',gap:10,padding:'6px 12px',marginBottom:2}}>
          <div style={{width:8,height:8,borderRadius:'50%',background:e.c,flexShrink:0}}/>
          <div style={{flex:1,fontSize:11.5,color:'#e8e6e0'}}>{e.l}</div>
          <div style={{fontSize:11,color:'#9e9b93',fontWeight:500}}>{e.d}</div>
        </div>)}
      </div>)}
    </div>}

    {tab==='faq'&&<div>
      <div style={{fontSize:14,fontWeight:600,color:'#c6a34e',marginBottom:12}}>Questions frequentes</div>
      {[
        {q:"Dois-je obligatoirement m'affilier a un secretariat social ?",a:"Non. L'affiliation a un secretariat social agree n'est pas une obligation legale. Vous pouvez gerer vos obligations sociales vous-meme. Aureus Social Pro fait les calculs, vous faites les declarations sur le portail officiel."},
        {q:"Puis-je encaisser les cotisations ONSS de mes clients ?",a:"Non. Seuls les secretariats sociaux agrees par le Ministre des Affaires Sociales ont le droit exclusif de percevoir les cotisations. Aureus IA est un prestataire de services / editeur de logiciel, pas un secretariat social agree. Le client paye toujours directement a l'ONSS."},
        {q:"Que se passe-t-il si je suis en retard pour la Dimona ?",a:"Dimona IN absente: amende de niveau 4 (2.500 a 12.500 EUR par travailleur). Dimona IN tardive: amende de niveau 2 (400 a 4.000 EUR). Faites-la TOUJOURS avant le debut du travail."},
        {q:"Combien coute l'acces au portail socialsecurity.be ?",a:"C'est entierement GRATUIT. Le portail est un service public. Vous avez juste besoin d'une carte eID ou de l'app itsme pour vous connecter."},
        {q:"Puis-je deleguer les declarations a mon comptable ?",a:"Oui. Via le service MAHIS (Gestion des acces) sur socialsecurity.be, vous pouvez donner procuration a votre comptable, un collaborateur, ou un prestataire de services. Vous restez legalement responsable."},
        {q:"Les calculs d'Aureus Social Pro sont-ils certifies ?",a:"Les calculs suivent la formule-cle officielle du SPF Finances 2026 et les taux ONSS en vigueur. Toutefois, pour les cas complexes (expatries, detachements, multi-employeurs), nous recommandons de verifier avec un juriste specialise."},
        {q:"Mon ancien secretariat social peut-il bloquer mon depart ?",a:"Non. Vous pouvez quitter votre secretariat social a tout moment moyennant un preavis de 6 mois (convention-type). Demandez le transfert de votre dossier et commencez a utiliser Aureus Social Pro."},
      ].map((faq,i)=><div key={i} style={{marginBottom:14,padding:14,background:"rgba(255,255,255,.02)",borderRadius:10,border:"1px solid rgba(255,255,255,.04)"}}>
        <div style={{fontSize:12,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>‚ùì {faq.q}</div>
        <div style={{fontSize:11.5,color:'#9e9b93',lineHeight:1.7}}>{faq.a}</div>
      </div>)}
    </div>}

    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BELCOTAX
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function BelcotaxPage({s,d}) {
  const [yr,setYr]=useState(new Date().getFullYear()-1);
  const [ft,setFt]=useState('10');
  const [tab,setTab]=useState('gen');
  const [allXml,setAllXml]=useState('');
  const ae=s.emps.filter(e=>e.status==='active');

  // Validation
  const warnings=[];
  ae.forEach(e=>{
    if(!e.niss) warnings.push({emp:`${e.first||e.fn||'Emp'} ${e.last||''}`,msg:'NISS manquant ‚Äî fiche invalide'});
    if(!e.addr&&!e.zip) warnings.push({emp:`${e.first||e.fn||'Emp'} ${e.last||''}`,msg:'Adresse incompl√®te'});
  });
  if(!s.co.onss) warnings.push({emp:'Employeur',msg:'Matricule ONSS manquant'});
  if(!s.co.vat) warnings.push({emp:'Employeur',msg:'Num√©ro TVA manquant'});

  const gen=()=>{
    const xmlParts=[];
    ae.forEach(emp=>{
      const p=calc(emp,DPER,s.co);
      const ad={gross:p.gross*12,onss:p.onssNet*12,empB:p.empBonus*12,tax:p.tax*12,css:p.css*12,mvC:Math.round(p.mvDays*12),mvE:p.mvEmployer*12,tr:p.transport*12,atnCar:(p.atnCar||0)*12,atnAutres:(p.atnAutresTot||0)*12,pensionCompl:(p.pensionCompl||0)*12,fraisPropres:((p.expense||0)+(p.indemTeletravail||0)+(p.indemBureau||0))*12,ecoCheques:(p.ecoCheques||0)*12};
      const xml=genBelcotax(s.co,emp,yr,ad);
      xmlParts.push(xml);
      d({type:"ADD_F",d:{eid:emp.id,ename:`${emp.first} ${emp.last}`,yr,ft,ftl:LEGAL.FICHE_281[ft],ag:ad.gross,an:p.net*12,aonss:ad.onss,atax:ad.tax,acss:ad.css,xml,at:new Date().toISOString()}});
    });
    // R√©capitulatif XML global BelcotaxOnWeb
    const globalXml=`<?xml version="1.0" encoding="UTF-8"?>\n<!-- BelcotaxOnWeb ‚Äî Fichier recapitulatif -->\n<!-- ${ae.length} fiche(s) 281.${ft} ‚Äî Annee ${yr} -->\n<!-- Genere par: Aureus Social Pro -->\n<Belcotax xmlns="urn:belcotax:${yr}">\n  <Verzending>\n    <Aangiftenr>BELCO${Date.now().toString(36).toUpperCase()}</Aangiftenr>\n    <Aangiftetype>281.${ft}</Aangiftetype>\n    <AangifteJaar>${yr}</AangifteJaar>\n    <AantalOpgaven>${ae.length}</AantalOpgaven>\n    <Schuldenaar>\n      <KBO>${(s.co.bce||s.co.vat||'').replace(/[^0-9]/g,"")}</KBO>\n      <Naam>${s.co.name}</Naam>\n      <Adres>${s.co.addr}</Adres>\n    </Schuldenaar>\n  </Verzending>\n</Belcotax>`;
    setAllXml(globalXml);
  };

  // Stats from fiches
  const fichesYr=s.fiches.filter(f2=>f2.yr==yr);
  const totBrut=fichesYr.reduce((a,f2)=>a+(f2.ag||0),0);
  const totNet=fichesYr.reduce((a,f2)=>a+(f2.an||0),0);

  return <div>
    <PH title="Fiches Fiscales BELCOTAX" sub="BelcotaxOnWeb ‚Äî SPF Finances"/>
    {/* Stats */}
    <div style={{display:'flex',gap:12,marginBottom:18}}>
      {[{l:"Fiches g√©n√©r√©es",v:fichesYr.length,c:'#c6a34e'},{l:"Brut total",v:fmt(totBrut),c:'#e8e6e0'},{l:"Net total",v:fmt(totNet),c:'#4ade80'},{l:"Travailleurs actifs",v:ae.length,c:'#60a5fa'}].map((st,i)=>
        <div key={i} style={{flex:1,padding:'12px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{st.l}</div>
          <div style={{fontSize:typeof st.v==='number'?22:16,fontWeight:700,color:st.c,marginTop:2}}>{st.v}</div>
        </div>
      )}
    </div>
    {/* Tabs */}
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"gen",l:"G√©n√©ration"},{v:"fiches",l:"Fiches g√©n√©r√©es"},{v:"deadlines",l:"√âch√©ances & R√®gles"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>

    {tab==='gen'&&<div style={{display:'grid',gridTemplateColumns:'320px 1fr',gap:18}}>
      <div>
        <C><ST>Param√®tres</ST>
          <I label="Ann√©e de revenus" type="number" value={yr} onChange={v=>setYr(v)}/>
          <I label="Type de fiche" value={ft} onChange={v=>setFt(v)} style={{marginTop:9}} options={Object.entries(LEGAL.FICHE_281).map(([k,v2])=>({v:k,l:`281.${k} ‚Äî ${v2}`}))}/>
          <B onClick={gen} style={{width:'100%',marginTop:14}}>G√©n√©rer toutes les 281.{ft} ({ae.length} fiches)</B>
          {allXml&&<div style={{marginTop:12}}>
            <B v="outline" style={{width:'100%',fontSize:11}} onClick={()=>d({type:"MODAL",m:{w:800,c:<div><h3 style={{color:'#e8e6e0',margin:'0 0 10px'}}>R√©capitulatif BelcotaxOnWeb</h3><pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:400,overflowY:'auto'}}>{allXml}</pre><div style={{display:'flex',gap:10,marginTop:12,justifyContent:'flex-end'}}><B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B><B onClick={()=>{navigator.clipboard?.writeText(allXml);alert('Copi√© !')}}>Copier</B></div></div>}})}>Voir XML r√©capitulatif</B>
          </div>}
        </C>
        {warnings.length>0&&<C style={{marginTop:12,borderColor:'rgba(239,68,68,.15)'}}><ST>Anomalies ({warnings.length})</ST>
          {warnings.map((w,i)=><div key={i} style={{fontSize:10.5,color:'#9e9b93',padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <b style={{color:'#f87171'}}>{w.emp}</b>: {w.msg}
          </div>)}
        </C>}
        <C style={{marginTop:12}}><ST>Types disponibles</ST>
          {Object.entries(LEGAL.FICHE_281).map(([k,v2])=><div key={k} style={{fontSize:10.5,color:'#9e9b93',padding:'3px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}><b style={{color:'#d4d0c8'}}>281.{k}</b> ‚Äî {v2}</div>)}
        </C>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Aper√ßu ‚Äî 281.{ft} ann√©e {yr}</div></div>
        <Tbl cols={[
          {k:'n',l:"Travailleur",b:1,r:r=>`${r.first} ${r.last}`},
          {k:'niss',l:"NISS",r:r=><span style={{fontFamily:'monospace',fontSize:10,color:r.niss?'#9e9b93':'#f87171'}}>{r.niss||'MANQUANT'}</span>},
          {k:'g',l:"Brut annuel",a:'right',r:r=>{const p=calc(r,DPER,s.co);return fmt(p.gross*12)}},
          {k:'t',l:"PP annuel",a:'right',r:r=>{const p=calc(r,DPER,s.co);return <span style={{color:'#f87171'}}>{fmt(p.tax*12)}</span>}},
          {k:'ne',l:"Net annuel",a:'right',r:r=>{const p=calc(r,DPER,s.co);return <span style={{color:'#4ade80'}}>{fmt(p.net*12)}</span>}},
        ]} data={ae}/>
      </C>
    </div>}

    {tab==='fiches'&&<C style={{padding:0,overflow:'hidden'}}>
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Fiches g√©n√©r√©es ({s.fiches.length})</div></div>
      <Tbl cols={[
        {k:'y',l:"Ann√©e",r:r=><span style={{fontWeight:600,color:'#c6a34e'}}>{r.yr}</span>},
        {k:'t',l:"Type",r:r=>`281.${r.ft}`},{k:'e',l:"Employ√©",r:r=>r.ename},
        {k:'g',l:"Brut annuel",a:'right',r:r=>fmt(r.ag)},
        {k:'n',l:"Net annuel",a:'right',r:r=><span style={{color:'#4ade80'}}>{fmt(r.an)}</span>},
        {k:'x',l:"",a:'right',r:r=><B v="ghost" style={{padding:'3px 8px',fontSize:10}} onClick={()=>d({type:"MODAL",m:{w:800,c:<div><h3 style={{color:'#e8e6e0',margin:'0 0 10px'}}>281.{r.ft} ‚Äî {r.ename} ({r.yr})</h3><pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10,color:'#9e9b93',overflowX:'auto',whiteSpace:'pre-wrap',maxHeight:380,overflowY:'auto'}}>{r.xml}</pre><div style={{display:'flex',gap:10,marginTop:12,justifyContent:'flex-end'}}><B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B><B onClick={()=>{navigator.clipboard?.writeText(r.xml);alert('Copi√© !')}}>Copier</B></div></div>}})}>XML</B>},
      ]} data={s.fiches}/>
    </C>}

    {tab==='deadlines'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>√âch√©ances BelcotaxOnWeb</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{l:"281.10 R√©mun√©rations",dl:"28/02 (N+1)",note:"Obligatoire pour tous les employeurs"},{l:"281.20 Dirigeants",dl:"28/02 (N+1)",note:"Administrateurs, g√©rants"},{l:"281.50 Honoraires/Commissions",dl:"30/06 (N+1)",note:"> 250‚Ç¨/an/b√©n√©ficiaire"},{l:"281.30 Jetons pr√©sence",dl:"28/02 (N+1)",note:"Membres CA, ASBL"},{l:"Rectificative",dl:"Pas de deadline fixe",note:"Via BelcotaxOnWeb portail SPF"}].map((r,i)=>
            <div key={i} style={{padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <div style={{display:'flex',justifyContent:'space-between'}}><b style={{color:'#e8e6e0'}}>{r.l}</b><span style={{color:'#c6a34e',fontWeight:600}}>{r.dl}</span></div>
              <div style={{fontSize:10,color:'#5e5c56'}}>{r.note}</div>
            </div>
          )}
        </div>
      </C>
      <C><ST>Proc√©dure</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {['1. G√©n√©rer les fiches 281.xx dans Aureus Social Pro',"2. V√©rifier les donn√©es (NISS, montants, adresses)","3. Exporter le XML r√©capitulatif","4. Se connecter √† BelcotaxOnWeb (MyMinfin)","5. Uploader le fichier XML","6. Valider et envoyer","7. Conserver l'accus√© de r√©ception"].map((step,i)=>
            <div key={i} style={{padding:'4px 0'}}>{step}</div>
          )}
        </div>
        <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          <b>Portail:</b> finances.belgium.be/fr/E-services/Belcotaxonweb<br/>
          <b>Helpdesk SPF:</b> 0257/257 57<br/>
          <b>Format XML:</b> Conforme XSD BelcotaxOnWeb v{yr}
        </div>
      </C>
    </div>}
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PR√âCOMPTE 274
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function PrecomptePage({s,d}) {
  const [mode,setMode]=useState('mensuel');
  const [m,setM]=useState(new Date().getMonth()+1);
  const [q,setQ]=useState(Math.ceil((new Date().getMonth()+1)/3));
  const [y,setY]=useState(new Date().getFullYear());
  const ae=s.emps.filter(e=>e.status==='active');

  // Calcul mensuel
  const detMens=ae.map(e=>{const p=calc(e,{...DPER,month:m,year:y},s.co);return{e,tax:p.tax,gross:p.gross};});
  const totMens=detMens.reduce((a,r)=>a+r.tax,0);

  // Calcul trimestriel (3 mois cumul√©s)
  const qMonths=[(q-1)*3+1,(q-1)*3+2,(q-1)*3+3];
  const detTrim=ae.map(e=>{
    let taxQ=0,grossQ=0;
    qMonths.forEach(mo=>{const p=calc(e,{...DPER,month:mo,year:y},s.co);taxQ+=p.tax;grossQ+=p.gross;});
    return{e,tax:taxQ,gross:grossQ};
  });
  const totTrim=detTrim.reduce((a,r)=>a+r.tax,0);

  // Seuil: PP ann√©e N-1 > 50 240‚Ç¨ ‚Üí obligatoirement mensuel
  const ppAnnuel=totMens*12;
  const seuilMensuel=50240;
  const obligMensuel=ppAnnuel>seuilMensuel;

  const det=mode==='mensuel'?detMens:detTrim;
  const tot=mode==='mensuel'?totMens:totTrim;

  // Calendrier SPF 2026
  const calMens=[{p:'Janvier 2026',dl:"13/02/2026"},{p:'F√©vrier 2026',dl:"13/03/2026"},{p:'Mars 2026',dl:"15/04/2026"},{p:'Avril 2026',dl:"15/05/2026"},{p:'Mai 2026',dl:"15/06/2026"},{p:'Juin 2026',dl:"15/07/2026"},{p:'Juillet 2026',dl:"14/08/2026"},{p:'Ao√ªt 2026',dl:"15/09/2026"},{p:'Septembre 2026',dl:"15/10/2026"},{p:'Octobre 2026',dl:"13/11/2026"},{p:'Novembre 2026',dl:"15/12/2026"},{p:'D√©cembre 2026',dl:"15/01/2027"}];
  const calTrim=[{p:'T1 2026',dl:"15/04/2026"},{p:'T2 2026',dl:"15/07/2026"},{p:'T3 2026',dl:"15/10/2026"},{p:'T4 2026',dl:"15/01/2027"}];

  return <div>
    <PH title="Pr√©compte Professionnel 274" sub="D√©claration et versement ‚Äî FINPROF"/>
    <div style={{display:'grid',gridTemplateColumns:'300px 1fr',gap:18}}>
      <div>
      <C><ST>Configuration</ST>
        <I label="P√©riodicit√©" value={mode} onChange={setMode} options={[{v:"mensuel",l:"Mensuel"},{v:"trimestriel",l:"Trimestriel"}]}/>
        {mode==='mensuel'?<I label="Mois" value={m} onChange={v=>setM(parseInt(v))} options={MN.map((x,i)=>({v:i+1,l:x}))} style={{marginTop:9}}/>
        :<I label="Trimestre" value={q} onChange={v=>setQ(parseInt(v))} options={[{v:1,l:"T1 (jan-mar)"},{v:2,l:"T2 (avr-jun)"},{v:3,l:"T3 (jul-sep)"},{v:4,l:"T4 (oct-d√©c)"}]} style={{marginTop:9}}/>}
        <I label="Ann√©e" type="number" value={y} onChange={v=>setY(v)} style={{marginTop:9}}/>
        <div style={{marginTop:18,padding:14,background:"rgba(198,163,78,.06)",borderRadius:8,border:'1px solid rgba(198,163,78,.1)',textAlign:'center'}}>
          <div style={{fontSize:10.5,color:'#9e9b93',textTransform:'uppercase',letterSpacing:'1px'}}>Total √† verser</div>
          <div style={{fontSize:26,fontWeight:700,color:'#c6a34e',marginTop:6}}>{fmt(tot)}</div>
          <div style={{fontSize:10.5,color:'#5e5c56',marginTop:3}}>{mode==='mensuel'?`${MN[m-1]} ${y}`:`T${q} ${y}`} ¬∑ {ae.length} trav.</div>
        </div>
        {obligMensuel&&mode==='trimestriel'&&<div style={{marginTop:10,padding:8,background:"rgba(239,68,68,.08)",borderRadius:6,border:'1px solid rgba(239,68,68,.15)',fontSize:10.5,color:'#ef4444'}}>
          <b>‚ö†</b> PP annuel estim√© ({fmt(ppAnnuel)}) d√©passe le seuil de {fmt(seuilMensuel)}. D√©claration <b>mensuelle obligatoire</b>.
        </div>}
        <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,border:'1px solid rgba(96,165,250,.1)'}}>
          <div style={{fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
            <b>Seuil:</b> PP N-1 {'>'} 50 240‚Ç¨ ‚Üí mensuel<br/>
            <b>√âch√©ance:</b> 15 du mois suivant (mensuel) ou 15 du mois suivant le trimestre<br/>
            <b>D√©claration:</b> Via FINPROF (application SPF Finances)
          </div>
        </div>
      </C>
      <C style={{marginTop:12}}><ST>Calendrier SPF {y}</ST>
        <div style={{maxHeight:200,overflow:'auto'}}>
        {(mode==='mensuel'?calMens:calTrim).map((c,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'5px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:11}}>
          <span style={{color:'#9e9b93'}}>{c.p}</span><span style={{fontWeight:600,color:i===((mode==='mensuel'?m:q)-1)?'#c6a34e':'#d4d0c8'}}>{c.dl}</span>
        </div>)}
        </div>
      </C>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>D√©tail ‚Äî {mode==='mensuel'?`${MN[m-1]} ${y}`:`T${q} ${y} (${qMonths.map(mo=>MN[mo-1]).join(' + ')})`}</div></div>
        <Tbl cols={[
          {k:'n',l:"Travailleur",r:r=><span style={{fontWeight:500}}>{r.e.first} {r.e.last}</span>},
          {k:'g',l:mode==='mensuel'?'Brut':'Brut cumul√©',a:'right',r:r=>fmt(r.gross)},
          {k:'t',l:mode==='mensuel'?'Pr√©compte':'PP cumul√©',a:'right',r:r=><span style={{fontWeight:600,color:'#c6a34e'}}>{fmt(r.tax)}</span>},
        ]} data={det}/>
        {det.length>0&&<div style={{padding:'12px 18px',borderTop:'1px solid rgba(139,115,60,.1)',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
          <div style={{display:'flex',gap:8}}>
            <B v="outline" style={{fontSize:10.5,padding:'6px 12px'}} onClick={()=>{
              const periode=mode==='mensuel'?`${String(m).padStart(2,"0")}/${y}`:`T${q}/${y}`;
              const xml274=`<?xml version="1.0" encoding="UTF-8"?>\n<!-- Declaration Precompte Professionnel 274 -->\n<!-- SPF Finances ‚Äî FINPROF -->\n<!-- Genere par: Aureus Social Pro -->\n<PP274 xmlns="urn:pp274:${y}">\n  <Declaration>\n    <Periode>${periode}</Periode>\n    <Periodicite>${mode}</Periodicite>\n    <Employeur>\n      <KBO>${(s.co.bce||s.co.vat||'').replace(/[^0-9]/g,"")}</KBO>\n      <ONSS>${(s.co.onss||'').replace(/[^0-9]/g,"")}</ONSS>\n      <Naam>${s.co.name}</Naam>\n    </Employeur>\n    <NbrTravailleurs>${ae.length}</NbrTravailleurs>\n    <TotalBrut>${det.reduce((a,r)=>a+r.gross,0).toFixed(2)}</TotalBrut>\n    <TotalPrecompte>${tot.toFixed(2)}</TotalPrecompte>\n${det.map(r=>`    <Travailleur>\n      <Naam>${r.e.last||''} ${r.e.first||''}</Naam>\n      <INSZ>${(r.e.niss||'').replace(/[\\.-\\s]/g,"")}</INSZ>\n      <Brut>${r.gross.toFixed(2)}</Brut>\n      <PP>${r.tax.toFixed(2)}</PP>\n    </Travailleur>`).join('\n')}\n  </Declaration>\n</PP274>`;
              d({type:"MODAL",m:{w:850,c:<div>
                <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 6px',fontFamily:"'Cormorant Garamond',serif"}}>D√©claration PP 274 ‚Äî {periode}</h2>
                <div style={{display:'flex',gap:8,marginBottom:12}}>
                  <span style={{fontSize:10,padding:'3px 10px',borderRadius:4,background:"rgba(74,222,128,.1)",color:'#4ade80',fontWeight:600}}>‚úì XML g√©n√©r√©</span>
                  <span style={{fontSize:10,padding:'3px 10px',borderRadius:4,background:"rgba(198,163,78,.1)",color:'#c6a34e',fontWeight:600}}>{ae.length} trav. ¬∑ {fmt(tot)}</span>
                </div>
                <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10,color:'#9e9b93',overflowX:'auto',whiteSpace:'pre-wrap',maxHeight:350,overflowY:'auto'}}>{xml274}</pre>
                <div style={{display:'flex',gap:10,marginTop:14,justifyContent:'flex-end'}}>
                  <B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B>
                  <B onClick={()=>{navigator.clipboard?.writeText(xml274);alert('XML 274 copi√© !')}}>Copier XML</B>
                </div>
              </div>}});
            }}>G√©n√©rer XML 274</B>
          </div>
          <div style={{display:'flex',gap:16,alignItems:'center'}}><span style={{fontSize:12,color:'#9e9b93'}}>TOTAL:</span><span style={{fontSize:14,fontWeight:700,color:'#c6a34e'}}>{fmt(tot)}</span></div>
        </div>}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DOCUMENTS SOCIAUX
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function DocsPage({s,d}) {
  const [dt,setDt]=useState('C4');
  const [eid,setEid]=useState(s.emps[0]?.id||'');
  const [endD,setEndD]=useState(new Date().toISOString().split('T')[0]);
  const [reason,setReason]=useState('Licenciement');
  const emp=s.emps.find(e=>e.id===eid);

  const gen=()=>{if(!emp)return;
    const fields=dt==='C4'?[
      {l:"Employeur",v:s.co.name},{l:"N¬∞ ONSS",v:s.co.onss},{l:"Travailleur",v:`${emp.first} ${emp.last}`},{l:"NISS",v:emp.niss},
      {l:"Fonction",v:emp.fn},{l:"CP",v:`CP ${emp.cp}`},{l:"Entr√©e",v:emp.startD},{l:"Sortie",v:endD},{l:"Motif",v:reason},
      {l:"Dernier brut",v:fmt(emp.monthlySalary)},{l:"R√©gime",v:`${emp.whWeek}h/sem`},
    ]:dt==='VACATION'?[
      {l:"Employeur",v:s.co.name},{l:"Travailleur",v:`${emp.first} ${emp.last}`},{l:"Ann√©e r√©f.",v:`${new Date().getFullYear()-1}`},
      {l:"Jours vacances",v:"20 jours"},{l:"Simple p√©cule",v:fmt(emp.monthlySalary)},{l:"Double p√©cule (92% brut)",v:fmt(emp.monthlySalary*0.92)},{l:"  dont 1√®re partie (85%)",v:fmt(emp.monthlySalary*0.85)},{l:"  dont 2√®me partie (7%)",v:fmt(emp.monthlySalary*0.07)},{l:"ONSS sur 2√®me partie",v:fmt(emp.monthlySalary*0.07*0.1307)},
    ]:[{l:"Employeur",v:s.co.name},{l:"Travailleur",v:`${emp.first} ${emp.last}`},{l:"Date",v:new Date().toLocaleDateString('fr-BE')}];

    const title=LEGAL.SOCIAL_DOCS[dt]||dt;
    d({type:"ADD_DOC",d:{eid:emp.id,ename:`${emp.first} ${emp.last}`,dt,title,fields,at:new Date().toISOString()}});
    d({type:"MODAL",m:{w:580,c:<div>
      <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 3px',fontFamily:"'Cormorant Garamond',serif"}}>{title}</h2>
      <div style={{fontSize:10.5,color:'#c6a34e',marginBottom:16}}>{s.co.name}</div>
      <div style={{padding:18,background:"#faf9f4",borderRadius:10,color:'#1a1a18'}}>
        {fields.map((f,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'7px 0',borderBottom:'1px solid #eee',fontSize:12.5}}><span style={{color:'#888'}}>{f.l}</span><span style={{fontWeight:500}}>{f.v}</span></div>)}
        <div style={{marginTop:22,display:'flex',justifyContent:'space-between'}}>
          <div style={{fontSize:10.5,color:'#999'}}>Fait le {new Date().toLocaleDateString('fr-BE')}</div>
          <div style={{fontSize:10.5,color:'#999',textAlign:'right'}}>Signature<br/><br/>_____________________</div>
        </div>
      </div>
      <div style={{display:'flex',gap:10,marginTop:14,justifyContent:'flex-end'}}><B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B></div>
    </div>}});
  };
  return <div>
    <PH title="Documents Sociaux" sub="C4, attestations, certificats"/>
    <div style={{display:'grid',gridTemplateColumns:'320px 1fr',gap:18}}>
      <C><ST>Nouveau document</ST>
        <I label="Type" value={dt} onChange={setDt} options={Object.entries(LEGAL.SOCIAL_DOCS).map(([k,v])=>({v:k,l:v}))}/>
        <I label="Employ√©" value={eid} onChange={setEid} style={{marginTop:9}} options={s.emps.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        {dt==='C4'&&<><I label="Date sortie" type="date" value={endD} onChange={setEndD} style={{marginTop:9}}/>
          <I label="Motif" value={reason} onChange={setReason} style={{marginTop:9}} options={[{v:"Licenciement",l:"Licenciement"},{v:"D√©mission",l:"D√©mission"},{v:"Fin CDD",l:"Fin de CDD"},{v:"Commun accord",l:"Commun accord"},{v:"Faute grave",l:"Faute grave"}]}/></>}
        <B onClick={gen} style={{width:'100%',marginTop:14}}>G√©n√©rer</B>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Documents g√©n√©r√©s</div></div>
        <Tbl cols={[
          {k:'t',l:"Type",r:r=><span style={{fontWeight:600,color:'#c6a34e'}}>{r.title}</span>},
          {k:'e',l:"Employ√©",r:r=>r.ename},
          {k:'d',l:"Date",r:r=>new Date(r.at).toLocaleDateString('fr-BE')},
        ]} data={s.docs}/>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  REPORTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ReportsPage({s,d}) {
  const ae=s.emps.filter(e=>e.status==='active');
  const md=ae.map(e=>{const p=calc(e,DPER,s.co);return{name:`${e.first||e.fn||'Emp'} ${e.last||''}`,gross:p.gross,onssW:p.onssNet,tax:p.tax,css:p.css,net:p.net,onssE:p.onssE,cost:p.costTotal};});
  const t=md.reduce((a,r)=>({g:a.g+r.gross,ow:a.ow+r.onssW,tx:a.tx+r.tax,cs:a.cs+r.css,n:a.n+r.net,oe:a.oe+r.onssE,co:a.co+r.cost}),{g:0,ow:0,tx:0,cs:0,n:0,oe:0,co:0});
  return <div>
    <PH title="Rapports" sub="Analyse masse salariale"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:14,marginBottom:22}}>
      <SC label="Masse brute" value={fmt(t.g)} color="#60a5fa"/>
      <SC label="Charges ONSS" value={fmt(t.ow+t.oe)} color="#f87171" sub={`Trav: ${fmt(t.ow)} ¬∑ Empl: ${fmt(t.oe)}`}/>
      <SC label="Pr√©compte" value={fmt(t.tx)} color="#a78bfa"/>
      <SC label="Co√ªt employeur" value={fmt(t.co)} color="#c6a34e" sub={`Net: ${fmt(t.n)}`}/>
    </div>
    <C style={{padding:0,overflow:'hidden'}}>
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>D√©tail mensuel</div></div>
      <Tbl cols={[{k:'name',l:"Employ√©",b:1},{k:'g',l:"Brut",a:'right',r:r=>fmt(r.gross)},{k:'o',l:"ONSS",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.onssW)}</span>},{k:'t',l:"Pr√©c.",a:'right',r:r=><span style={{color:'#a78bfa'}}>{fmt(r.tax)}</span>},{k:'n',l:"Net",a:'right',r:r=><span style={{fontWeight:700,color:'#4ade80'}}>{fmt(r.net)}</span>},{k:'e',l:"ONSS empl.",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.onssE)}</span>},{k:'c',l:"Co√ªt",a:'right',r:r=><span style={{fontWeight:600,color:'#c6a34e'}}>{fmt(r.cost)}</span>}]} data={md}/>
    </C>
    <C style={{marginTop:18}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:14}}>Projection annuelle</div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:14}}>
        {[{l:"Masse brute",v:t.g*12,c:'#60a5fa'},{l:"Charges sociales",v:(t.ow+t.oe)*12,c:'#f87171'},{l:"Net vers√©",v:t.n*12,c:'#4ade80'},{l:"Co√ªt total",v:t.co*12,c:'#c6a34e'}].map((x,i)=>
          <div key={i} style={{textAlign:'center',padding:14,background:`${x.c}08`,borderRadius:8}}><div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>{x.l}</div><div style={{fontSize:18,fontWeight:700,color:x.c,marginTop:5}}>{fmt(x.v)}</div></div>
        )}
      </div>
    </C>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FRAIS DE GESTION ‚Äî Grille tarifaire secr√©tariat social
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function FraisGestionMod({s,d}){
  const [tarifs,setTarifs]=useState(()=>{
    const cats=[
      {cat:"Gestion courante",color:'#c6a34e',items:[
        {id:"fg_fiche_paie",l:"Fiche de paie mensuelle",unit:'/fiche/mois',desc:"Calcul et √©mission de la fiche de paie conforme SPF",price:''},
        {id:"fg_fiche_paie_ouvrier",l:"Fiche de paie ouvrier (construction)",unit:'/fiche/mois',desc:"Sp√©cificit√©s CP 124: timbres, intemp√©ries, caisse cong√©s",price:''},
        {id:"fg_entree",l:"Entr√©e en service (onboarding)",unit:'/travailleur',desc:"Dimona IN, contrat, annexes, DRS, affiliation caisse",price:''},
        {id:"fg_sortie",l:"Sortie de service",unit:'/travailleur',desc:"Dimona OUT, C4, p√©cule de sortie, solde de tout compte",price:''},
        {id:"fg_abonnement",l:"Abonnement mensuel de gestion",unit:'/mois',desc:"Acc√®s plateforme, support, mises √† jour l√©gales",price:''},
        {id:"fg_abonnement_trav",l:"Suppl√©ment par travailleur actif",unit:'/travailleur/mois',desc:"Gestion courante par travailleur inscrit",price:''},
        {id:"fg_minimum",l:"Minimum de facturation mensuel",unit:'/mois',desc:"Montant minimum m√™me sans activit√©",price:''},
        {id:"fg_tableau_bord",l:"Tableau de bord",unit:'/mois',desc:"Acc√®s tableau de bord avec indicateurs RH et paie",price:''},
        {id:"fg_interface_pointage",l:"Interface pointage",unit:'/mois',desc:"Importation donn√©es de pointage / paie depuis syst√®me externe",price:''},
      ]},
      {cat:"Modules comptables & Ch√®ques-Repas",color:'#4ade80',items:[
        {id:"fg_od_sans",l:"O.D. ‚Äî sans liaison comptabilit√©",unit:'/mois',desc:"Op√©rations diverses salaires sans export comptable",price:''},
        {id:"fg_od_liaison",l:"O.D. ‚Äî Liaison BOB/Winbooks/Kluwer/Popsy",unit:'/mois',desc:"Export automatique OD vers logiciel comptable",price:''},
        {id:"fg_cr_pluxee",l:"Ch√®ques-Repas: liaison Pluxee (ex-Sodexo)",unit:'/mois',desc:"Commande automatique ch√®ques-repas via Pluxee",price:''},
        {id:"fg_cr_edenred",l:"Ch√®ques-Repas: liaison Edenred",unit:'/mois',desc:"Commande automatique ch√®ques-repas via Edenred",price:''},
        {id:"fg_cr_monizze",l:"Ch√®ques-Repas: liaison Monizze",unit:'/mois',desc:"Commande automatique ch√®ques-repas via Monizze",price:''},
        {id:"fg_cr_got",l:"Ch√®ques-Repas: liaison G.O.T. Connection",unit:'/mois',desc:"Commande automatique ch√®ques-repas via G.O.T. Connection",price:''},
      ]},
      {cat:"Envoi automatique documents",color:'#60a5fa',items:[
        {id:"fg_envoi_outlook",l:"Envoi PDF via Outlook (BP, FF, CI)",unit:'/mois',desc:"Envoi automatique bons paie, fiches fiscales, comptes individuels par email",price:''},
        {id:"fg_envoi_doccle",l:"Envoi PDF via Doccle",unit:'/mois',desc:"Envoi automatique documents via coffre-fort num√©rique Doccle",price:''},
      ]},
      {cat:"D√©clarations sociales",color:'#22d3ee',items:[
        {id:"fg_dimona",l:"D√©claration Dimona (IN/OUT/UPDATE)",unit:'/d√©claration',desc:"D√©claration imm√©diate d'emploi √† l'ONSS",price:''},
        {id:"fg_dmfa",l:"D√©claration DMFA trimestrielle",unit:'/trimestre',desc:"D√©claration multifonctionnelle ONSS trimestrielle",price:''},
        {id:"fg_dmfappl",l:"Module ONSS-APL (DMFAPPL)",unit:'/trimestre',desc:"D√©claration ONSS pour administrations provinciales et locales",price:''},
        {id:"fg_primes_synd",l:"Module Primes Syndicales",unit:'/an',desc:"D√©claration et paiement des primes syndicales",price:''},
        {id:"fg_eta",l:"Relev√©s ETA (Awiph / Cocof)",unit:'/an',desc:"Relev√©s pour entreprises de travail adapt√©",price:''},
        {id:"fg_limosa",l:"D√©claration Limosa (d√©tachement)",unit:'/d√©claration',desc:"Travailleur √©tranger d√©tach√© en Belgique",price:''},
      ]},
      {cat:"Fiches fiscales & Relev√©s",color:'#a78bfa',items:[
        {id:"fg_belcotax_10",l:"Fiches Belcotax 281.10 (R√©mun√©rations)",unit:'/fiche/an',desc:"Fiche fiscale annuelle salari√©s et dirigeants",price:''},
        {id:"fg_fiche_11",l:"Fiches & relev√©s 281.11 (Pensions)",unit:'/fiche/an',desc:"Pensions, rentes, capitaux",price:''},
        {id:"fg_fiche_14",l:"Fiches & relev√©s 281.14 (Rentes)",unit:'/fiche/an',desc:"Rentes alimentaires et autres",price:''},
        {id:"fg_fiche_29",l:"Fiches & relev√©s 281.29 (√âconomie collaborative)",unit:'/fiche/an',desc:"Revenus plateformes collaboratives",price:''},
        {id:"fg_fiche_30",l:"Fiches & relev√©s 281.30 (Jetons de pr√©sence)",unit:'/fiche/an',desc:"Jetons de pr√©sence administrateurs",price:''},
        {id:"fg_fiche_45",l:"Fiches & relev√©s 281.45 (Droits d\'auteur)",unit:'/fiche/an',desc:"Droits d'auteur et droits voisins",price:''},
        {id:"fg_fiche_50",l:"Fiches & relev√©s 281.50 (Honoraires)",unit:'/fiche/an',desc:"Honoraires, commissions, ind√©pendants",price:''},
        {id:"fg_precompte",l:"Pr√©compte professionnel (274)",unit:'/mois',desc:"Calcul et d√©claration mensuelle du PP",price:''},
        {id:"fg_fiche_fiscal",l:"Fiche fiscale individuelle annuelle",unit:'/travailleur/an',desc:"R√©sum√© fiscal annuel par travailleur",price:''},
      ]},
      {cat:"Documents sociaux ‚Äî Secteur Ch√¥mage",color:'#fb923c',items:[
        {id:"fg_c4",l:"C4 certificat de ch√¥mage",unit:'/document',desc:"Certificat de ch√¥mage complet C4",price:''},
        {id:"fg_c4_rcc",l:"C4 pr√©pension (RCC)",unit:'/document',desc:"C4 r√©gime de ch√¥mage avec compl√©ment d'entreprise",price:''},
        {id:"fg_c4_ens",l:"C4 Enseignement",unit:'/document',desc:"C4 sp√©cifique secteur enseignement",price:''},
        {id:"fg_c32_cd",l:"C3.2 constat du droit",unit:'/document',desc:"Constat du droit au ch√¥mage temporaire",price:''},
        {id:"fg_c32_ouv",l:"C3.2 employeur ‚Üí ouvriers",unit:'/document',desc:"Ch√¥mage temporaire ouvriers",price:''},
        {id:"fg_c32_emp",l:"C3.2 employeur anti-crise ‚Üí employ√©s",unit:'/document',desc:"Ch√¥mage temporaire employ√©s mesures anti-crise",price:''},
        {id:"fg_c131a",l:"C131A Employeur",unit:'/document',desc:"Attestation employeur ch√¥mage temporaire",price:''},
        {id:"fg_c131b",l:"C131B",unit:'/document',desc:"Attestation compl√©mentaire ch√¥mage temporaire",price:''},
        {id:"fg_c131a_ens",l:"C131A Employeur - Enseignement",unit:'/document',desc:"C131A sp√©cifique enseignement",price:''},
        {id:"fg_c131b_ens",l:"C131B - Enseignement",unit:'/document',desc:"C131B sp√©cifique enseignement",price:''},
        {id:"fg_c78_act",l:"C78 Activa Winwin/Impulsion/Actiris",unit:'/document',desc:"Activation demandeurs d'emploi Bruxelles/Wallonie",price:''},
        {id:"fg_c78_eta",l:"C78 E.T.A.",unit:'/document',desc:"Entreprise de travail adapt√©",price:''},
        {id:"fg_c78_start",l:"C78 Activa Start",unit:'/document',desc:"Activation jeunes demandeurs d'emploi",price:''},
        {id:"fg_c78_sine",l:"C78 SINE",unit:'/document',desc:"√âconomie d'insertion sociale",price:''},
        {id:"fg_c783_ptp",l:"C78.3 P.T.P.",unit:'/document',desc:"Programme de transition professionnelle",price:''},
        {id:"fg_c78_sec",l:"C78 Personnel de s√©curit√© et pr√©vention",unit:'/document',desc:"Activation personnel s√©curit√©/pr√©vention",price:''},
        {id:"fg_c103_je",l:"C103 Jeunes Employeur",unit:'/document',desc:"Obligation d'occupation jeunes - volet employeur",price:''},
        {id:"fg_c103_jt",l:"C103 Jeunes Travailleur",unit:'/document',desc:"Obligation d'occupation jeunes - volet travailleur",price:''},
        {id:"fg_c103_se",l:"C103 Seniors Employeur",unit:'/document',desc:"Obligation d'occupation seniors - volet employeur",price:''},
        {id:"fg_c103_st",l:"C103 Seniors Travailleur",unit:'/document',desc:"Obligation d'occupation seniors - volet travailleur",price:''},
        {id:"fg_c4_drs",l:"C4 DRS (papier)",unit:'/document',desc:"C4 format papier DRS",price:''},
        {id:"fg_c4_rcc_drs",l:"C4 DRS-RCC (papier)",unit:'/document',desc:"C4 RCC format papier DRS",price:''},
      ]},
      {cat:"Documents sociaux ‚Äî Secteur INAMI",color:'#f472b6',items:[
        {id:"fg_inami_mal",l:"Incapacit√© de travail (maladie, accident)",unit:'/document',desc:"D√©claration incapacit√© maladie/accident droit commun",price:''},
        {id:"fg_inami_mat",l:"Incapacit√© ‚Äî repos de maternit√©",unit:'/document',desc:"D√©claration repos de maternit√©",price:''},
        {id:"fg_inami_ecar_c",l:"Incapacit√© ‚Äî √©cartement complet maternit√©",unit:'/document',desc:"√âcartement complet protection maternit√©",price:''},
        {id:"fg_inami_ecar_p",l:"Incapacit√© ‚Äî √©cartement partiel maternit√©",unit:'/document',desc:"√âcartement partiel protection maternit√©",price:''},
        {id:"fg_inami_conv",l:"Repos maternit√©/paternit√© converti",unit:'/document',desc:"Conversion cong√© maternit√©/paternit√©",price:''},
        {id:"fg_inami_nais",l:"Cong√© de naissance (10 jours)",unit:'/document',desc:"D√©claration cong√© de naissance",price:''},
        {id:"fg_inami_adop",l:"Cong√© d\'adoption",unit:'/document',desc:"D√©claration cong√© d'adoption",price:''},
        {id:"fg_inami_rep",l:"Travail adapt√©: reprise partielle du travail",unit:'/document',desc:"Mi-temps m√©dical, reprise progressive INAMI",price:''},
        {id:"fg_inami_prot",l:"Travail adapt√©: protection de la maternit√©",unit:'/document',desc:"Am√©nagement poste protection maternit√©",price:''},
        {id:"fg_inami_2emp",l:"Travail adapt√©: 2 employeurs diff√©rents",unit:'/document',desc:"Poursuite travail chez 2 employeurs",price:''},
        {id:"fg_inami_all",l:"Allaitement: d√©claration des pauses",unit:'/document',desc:"D√©claration pauses d'allaitement",price:''},
        {id:"fg_vac_caisse",l:"D√©claration annuelle vacances (PV caisse)",unit:'/document',desc:"P√©cule vacances pay√© par une caisse",price:''},
        {id:"fg_vac_empl",l:"D√©claration annuelle vacances (PV employeur)",unit:'/document',desc:"P√©cule vacances pay√© par l'employeur",price:''},
        {id:"fg_inami_repr",l:"D√©claration de reprise du travail",unit:'/document',desc:"D√©claration de reprise apr√®s incapacit√©",price:''},
      ]},
      {cat:"Attestations & Documents papier",color:'#e879f9',items:[
        {id:"fg_att_pv",l:"Attestation P√©cules de vacances",unit:'/document',desc:"Attestation simple et double p√©cule",price:''},
        {id:"fg_att_trav",l:"Attestation de travail",unit:'/document',desc:"Certificat d'occupation",price:''},
        {id:"fg_att_276",l:"Attestation 276 frontaliers",unit:'/document',desc:"Attestation fiscale travailleurs frontaliers",price:''},
      ]},
      {cat:"Secr√©tariat social ‚Äî Prestations r√©currentes",color:'#818cf8',items:[
        {id:"fg_index",l:"Indexation salariale",unit:'/indexation',desc:"Adaptation des salaires suite √† indexation sectorielle",price:''},
        {id:"fg_echeance",l:"Suivi √©ch√©ances bar√©miques",unit:'/travailleur/an',desc:"Passage automatique √©chelon anciennet√©",price:''},
        {id:"fg_pecule_vac",l:"Calcul p√©cule de vacances",unit:'/travailleur/an',desc:"Simple + double p√©cule, attestation annuelle",price:''},
        {id:"fg_prime_fin",l:"Prime de fin d\'ann√©e / 13√®me mois",unit:'/travailleur/an',desc:"Calcul et traitement de la prime annuelle",price:''},
        {id:"fg_eco_cheques",l:"Gestion √©co-ch√®ques",unit:'/an',desc:"Commande et attribution annuelle",price:''},
        {id:"fg_sepa",l:"G√©n√©ration fichier SEPA virements",unit:'/mois',desc:"Fichier pain.001 pour banque",price:''},
        {id:"fg_compte_indiv",l:"Compte individuel annuel",unit:'/travailleur/an',desc:"R√©capitulatif annuel obligatoire par travailleur",price:''},
      ]},
      {cat:"√âv√©nements & Prestations ponctuelles",color:'#f59e0b',items:[
        {id:"fg_maladie",l:"Gestion maladie / accident",unit:'/√©v√©nement',desc:"Salaire garanti, attestation mutuelle, suivi",price:''},
        {id:"fg_mitemps_med",l:"Mi-temps m√©dical / th√©rapeutique (reprise progressive)",unit:'/dossier',desc:"Simulation, formulaires, suivi INAMI",price:''},
        {id:"fg_maternite",l:"Cong√© de maternit√© / naissance",unit:'/√©v√©nement',desc:"D√©claration, calcul indemnit√©s, formulaires",price:''},
        {id:"fg_credit_temps",l:"Cr√©dit-temps / cong√© th√©matique",unit:'/dossier',desc:"Demande ONEM, simulation allocation, avenant",price:''},
        {id:"fg_preavis",l:"Calcul de pr√©avis",unit:'/simulation',desc:"Simulation pr√©avis l√©gal selon anciennet√© Claeys",price:''},
        {id:"fg_licenciement",l:"Dossier licenciement complet",unit:'/dossier',desc:"Lettre, C4, p√©cule sortie, outplacement, motivation",price:''},
        {id:"fg_faute_grave",l:"Proc√©dure faute grave",unit:'/dossier',desc:"Lettre recommand√©e, constat, d√©lais l√©gaux",price:''},
        {id:"fg_sanctions",l:"Sanctions disciplinaires",unit:'/dossier',desc:"Avertissement, bl√¢me, r√©trogradation",price:''},
        {id:"fg_accident_travail",l:"D√©claration accident de travail",unit:'/d√©claration',desc:"Formulaire assureur, rapport circonstanci√©",price:''},
        {id:"fg_detachement",l:"D√©tachement travailleur",unit:'/dossier',desc:"Formulaire A1, Limosa, conditions pays d'accueil",price:''},
      ]},
      {cat:"Contrats & Documents juridiques",color:'#34d399',items:[
        {id:"fg_contrat_cdi",l:"R√©daction contrat CDI",unit:'/contrat',desc:"Contrat conforme loi 03/07/1978 + clauses",price:''},
        {id:"fg_contrat_cdd",l:"R√©daction contrat CDD",unit:'/contrat',desc:"Contrat √† dur√©e d√©termin√©e + renouvellements",price:''},
        {id:"fg_contrat_etudiant",l:"Convention √©tudiant",unit:'/contrat',desc:"Convention d'occupation √©tudiant + Dimona STU",price:''},
        {id:"fg_contrat_flexi",l:"Contrat flexi-job",unit:'/contrat',desc:"Contrat-cadre + contrat d'ex√©cution",price:''},
        {id:"fg_contrat_indep",l:"Convention collaboration ind√©pendante",unit:'/convention',desc:"Convention B2B, crit√®res de subordination",price:''},
        {id:"fg_avenant",l:"Avenant au contrat",unit:'/avenant',desc:"Modification conditions: temps partiel, fonction, salaire",price:''},
        {id:"fg_reglement",l:"R√©daction r√®glement de travail",unit:'/document',desc:"R√®glement de travail conforme + proc√©dure affichage",price:''},
        {id:"fg_politique",l:"Politique interne (car policy, t√©l√©travail...)",unit:'/document',desc:"R√©daction politique d'entreprise",price:''},
      ]},
      {cat:"Reporting & Obligations annuelles",color:'#06b6d4',items:[
        {id:"fg_bilan_social",l:"Bilan social BNB",unit:'/an',desc:"√âtablissement et d√©p√¥t du bilan social annuel",price:''},
        {id:"fg_stats_ins",l:"Statistiques INS",unit:'/an',desc:"Enqu√™te statistique obligatoire INS/Statbel",price:''},
        {id:"fg_assloi",l:"Relev√© assurance-loi AT",unit:'/an',desc:"D√©claration annuelle masse salariale assureur AT",price:''},
        {id:"fg_caisse_vac",l:"D√©claration caisse vacances (ouvriers)",unit:'/an',desc:"D√©claration annuelle √† la caisse de vacances",price:''},
        {id:"fg_peppol",l:"Facturation PEPPOL / e-Invoicing",unit:'/facture',desc:"√âmission facture UBL via r√©seau PEPPOL",price:''},
      ]},
      {cat:"Simulations & Outils RH",color:'#f97316',items:[
        {id:"fg_sim_cout_sal",l:"Simulation co√ªt salarial",unit:'/simulation',desc:"Simulation compl√®te du co√ªt d'un travailleur (brut‚Üínet, charges patronales)",price:''},
        {id:"fg_sim_brut_net",l:"Calcul brut ‚Üí net / net ‚Üí brut",unit:'/simulation',desc:"Conversion salariale avec toutes les retenues",price:''},
        {id:"fg_sim_preavis_det",l:"Simulation indemnit√© de pr√©avis d√©taill√©e",unit:'/simulation',desc:"Calcul pr√©avis Claeys avec ventilation compl√®te",price:''},
        {id:"fg_sim_vacances",l:"Simulation p√©cule de vacances",unit:'/simulation',desc:"Estimation simple et double p√©cule anticip√©e",price:''},
        {id:"fg_sim_prime_fin",l:"Simulation prime de fin d\'ann√©e",unit:'/simulation',desc:"Calcul anticip√© prime sectorielle ou d'entreprise",price:''},
        {id:"fg_benchmark_sal",l:"Benchmark salarial sectoriel",unit:'/rapport',desc:"Comparaison r√©mun√©ration avec le march√© du secteur",price:''},
        {id:"fg_total_reward",l:"Total Reward Statement",unit:'/travailleur/an',desc:"R√©capitulatif global de la r√©mun√©ration (salaire + avantages)",price:''},
      ]},
      {cat:"Aides √† l'emploi & R√©ductions",color:'#14b8a6',items:[
        {id:"fg_aide_1er_eng",l:"R√©duction premier engagement (groupe-cible)",unit:'/dossier',desc:"Demande r√©duction cotisations patronales 1er √† 6√®me travailleur",price:''},
        {id:"fg_aide_activa",l:"Activation Activa / Impulsion / Actiris",unit:'/dossier',desc:"Demande d'aides r√©gionales √† l'embauche",price:''},
        {id:"fg_aide_restructuration",l:"R√©duction restructuration / zone d\'aide",unit:'/dossier',desc:"R√©ductions cotisations zones en difficult√© / restructuration",price:''},
        {id:"fg_aide_travailleurs_ages",l:"R√©duction travailleurs √¢g√©s",unit:'/dossier',desc:"Demande r√©duction groupe-cible travailleurs 55+",price:''},
        {id:"fg_aide_jeunes",l:"Convention premier emploi (CPE / Rosetta)",unit:'/dossier',desc:"Demande mise en place convention premier emploi jeunes",price:''},
        {id:"fg_aide_titre_service",l:"Titres-services",unit:'/dossier',desc:"Gestion administrative titres-services (employeurs agr√©√©s)",price:''},
        {id:"fg_suivi_subsides",l:"Suivi et optimisation subsides / aides",unit:'/trimestre',desc:"Screening permanent des aides applicables √† l'entreprise",price:''},
      ]},
      {cat:"R√©mun√©ration alternative & Avantages",color:'#8b5cf6',items:[
        {id:"fg_plan_cafeteria",l:"Mise en place plan caf√©t√©ria",unit:'/dossier',desc:"Impl√©mentation r√©mun√©ration flexible (Payflip, MyChoice...)",price:''},
        {id:"fg_plan_cafeteria_gestion",l:"Gestion plan caf√©t√©ria (r√©current)",unit:'/mois',desc:"Suivi mensuel choix salari√©s, ajustements, administration",price:''},
        {id:"fg_bonus_cct90",l:"Bonus salarial CCT 90 (non-r√©current)",unit:'/dossier',desc:"Mise en place et gestion bonus li√© aux r√©sultats collectifs",price:''},
        {id:"fg_prime_benef",l:"Prime b√©n√©ficiaire (Loi 2018)",unit:'/dossier',desc:"Calcul et administration prime sur b√©n√©fices de la soci√©t√©",price:''},
        {id:"fg_warrants",l:"Warrants / Stock options",unit:'/dossier',desc:"Attribution et gestion warrants comme r√©mun√©ration alternative",price:''},
        {id:"fg_voiture_societe",l:"Gestion voiture de soci√©t√© / ATN",unit:'/v√©hicule/mois',desc:"Calcul ATN, cotisation CO‚ÇÇ, avantage fiscal",price:''},
        {id:"fg_budget_mobilite",l:"Budget mobilit√© (multimodal)",unit:'/travailleur/mois',desc:"Gestion budget mobilit√© : pilier 1/2/3, allocation cash",price:''},
        {id:"fg_cheques_sport",l:"Ch√®ques sport & culture",unit:'/an',desc:"Attribution et commande ch√®ques sport & culture",price:''},
        {id:"fg_assurance_groupe",l:"Assurance groupe / pension compl√©mentaire",unit:'/travailleur/an',desc:"Gestion 2√®me pilier pension, fiche 281.11",price:''},
        {id:"fg_assurance_hosp",l:"Assurance hospitalisation DKV/AG/Ethias",unit:'/travailleur/an',desc:"Gestion affiliations/r√©siliations assurance hospitalisation",price:''},
      ]},
      {cat:"Cong√©s sp√©ciaux & Absences",color:'#ec4899',items:[
        {id:"fg_conge_educ",l:"Cong√©-√©ducation pay√© (CEP)",unit:'/dossier',desc:"Demande remboursement cong√©-√©ducation pay√© aupr√®s de la R√©gion",price:''},
        {id:"fg_conge_politique",l:"Cong√© politique / mandat public",unit:'/dossier',desc:"Gestion absence et r√©mun√©ration mandat politique",price:''},
        {id:"fg_chomage_temp",l:"Ch√¥mage temporaire (√©conomique / force majeure)",unit:'/dossier',desc:"Demande ONEM, C3.2, notification, suivi mensuel",price:''},
        {id:"fg_chomage_temp_intemperies",l:"Ch√¥mage temporaire intemp√©ries (construction)",unit:'/dossier',desc:"D√©claration ch√¥mage intemp√©ries secteur construction",price:''},
        {id:"fg_prepension",l:"RCC / Pr√©pension (r√©gime ch√¥mage avec compl√©ment)",unit:'/dossier',desc:"Dossier complet RCC: calcul, C4-RCC, convention, ONEM",price:''},
        {id:"fg_outplacement",l:"Outplacement (reclassement professionnel)",unit:'/dossier',desc:"Organisation et suivi outplacement obligatoire ou volontaire",price:''},
        {id:"fg_conge_paternel",l:"Cong√© parental",unit:'/dossier',desc:"Demande ONEM cong√© parental 1/5 ou 1/2 temps",price:''},
        {id:"fg_conge_aidant",l:"Cong√© pour aidants proches",unit:'/dossier',desc:"Demande cong√© th√©matique aidant proche reconnu",price:''},
        {id:"fg_absence_track",l:"Rapport & analyse absent√©isme",unit:'/rapport',desc:"Rapport p√©riodique absent√©isme, Bradford Factor, co√ªts",price:''},
      ]},
      {cat:"Bien-√™tre & Pr√©vention au travail",color:'#10b981',items:[
        {id:"fg_sepp",l:"Affiliation SEPP (service externe PPT)",unit:'/an',desc:"Affiliation service externe pr√©vention et protection au travail",price:''},
        {id:"fg_plan_prevention",l:"Plan global de pr√©vention (5 ans)",unit:'/document',desc:"R√©daction plan global pr√©vention s√©curit√© sant√©",price:''},
        {id:"fg_plan_annuel",l:"Plan d\'action annuel (PAA)",unit:'/an',desc:"R√©daction plan d'action annuel bien-√™tre au travail",price:''},
        {id:"fg_risques_psycho",l:"Analyse risques psychosociaux",unit:'/audit',desc:"Enqu√™te et rapport risques burnout, harc√®lement, stress",price:''},
        {id:"fg_conseiller_prev",l:"D√©signation conseiller en pr√©vention",unit:'/dossier',desc:"Mise en conformit√© d√©signation conseiller pr√©vention interne",price:''},
        {id:"fg_medecine_travail",l:"Gestion examens m√©decine du travail",unit:'/travailleur/an',desc:"Planification visites m√©dicales, suivi aptitudes",price:''},
        {id:"fg_alcool_drogues",l:"Politique alcool et drogues",unit:'/document',desc:"R√©daction politique pr√©ventive CCT 100",price:''},
      ]},
      {cat:"Organes sociaux & Relations collectives",color:'#0ea5e9',items:[
        {id:"fg_ce",l:"Secr√©tariat Conseil d\'Entreprise (CE)",unit:'/r√©union',desc:"Pr√©paration informations √©conomiques et sociales CE",price:''},
        {id:"fg_cppt",l:"Secr√©tariat CPPT",unit:'/r√©union',desc:"Pr√©paration r√©unions Comit√© Pr√©vention Protection Travail",price:''},
        {id:"fg_ds",l:"Accompagnement d√©l√©gation syndicale",unit:'/r√©union',desc:"Pr√©paration r√©ponses, CCT d'entreprise, n√©gociations",price:''},
        {id:"fg_elections_sociales",l:"√âlections sociales",unit:'/cycle',desc:"Gestion compl√®te proc√©dure √©lections sociales (tous les 4 ans)",price:''},
        {id:"fg_cct_entreprise",l:"R√©daction CCT d\'entreprise",unit:'/document',desc:"N√©gociation et r√©daction convention collective d'entreprise",price:''},
      ]},
      {cat:"Consulting & Accompagnement",color:'#c084fc',items:[
        {id:"fg_conseil_rh",l:"Conseil RH / Droit social",unit:'/heure',desc:"Consultation en droit du travail, CCT, conventions",price:''},
        {id:"fg_audit_social",l:"Audit social",unit:'/audit',desc:"V√©rification conformit√© sociale, analyse risques",price:''},
        {id:"fg_optimisation",l:"Optimisation salariale",unit:'/dossier',desc:"Plan caf√©t√©ria, warrants, avantages fiscaux",price:''},
        {id:"fg_restructuration",l:"Accompagnement restructuration",unit:'/dossier',desc:"Plan Renault, licenciement collectif, plan social",price:''},
        {id:"fg_starter",l:"Pack starter nouvelle entreprise",unit:'/dossier',desc:"Inscription ONSS, 1er engagement, affiliations",price:''},
        {id:"fg_formation",l:"Formation client (logiciel/payroll)",unit:'/session',desc:"Formation utilisation plateforme ou process paie",price:''},
        {id:"fg_due_diligence",l:"Due diligence sociale (acquisition)",unit:'/dossier',desc:"Audit social pr√©-acquisition: risques, provisions, conformit√©",price:''},
        {id:"fg_inspection",l:"Accompagnement contr√¥le / inspection sociale",unit:'/dossier',desc:"Assistance lors d'inspection ONSS, SPF Emploi, contributions",price:''},
        {id:"fg_mediation",l:"M√©diation sociale",unit:'/dossier',desc:"M√©diation conflits employeur-travailleur, harc√®lement",price:''},
      ]},
      {cat:"Export / Import & Frais administratifs",color:'#9ca3af',items:[
        {id:"fg_export_dif",l:"Exportation donn√©es format DIF",unit:'/export',desc:"Export donn√©es en format DIF pour usage externe",price:''},
        {id:"fg_import_pointage",l:"Importation donn√©es pointage / paie",unit:'/import',desc:"Import fichiers pointage/paie depuis syst√®mes externes",price:''},
        {id:"fg_export_compta",l:"Export √©critures comptables personnalis√©es",unit:'/mois',desc:"Export OD vers logiciel comptable avec mapping personnalis√©",price:''},
        {id:"fg_courrier_rec",l:"Envoi courrier recommand√©",unit:'/envoi',desc:"Lettre recommand√©e avec AR",price:''},
        {id:"fg_copies",l:"Copies et impressions",unit:'/page',desc:"Copies documents, fiches, contrats",price:''},
        {id:"fg_archivage",l:"Archivage dossier (5 ans)",unit:'/travailleur/an',desc:"Conservation obligatoire documents sociaux",price:''},
        {id:"fg_urgence",l:"Suppl√©ment traitement urgent",unit:'/prestation',desc:"Prestation hors d√©lai standard (< 24h)",price:''},
        {id:"fg_hors_heures",l:"Prestation hors heures bureau",unit:'/heure',desc:"Travail soir, week-end, jours f√©ri√©s",price:''},
        {id:"fg_traduction",l:"Traduction documents (FR/NL/DE/EN)",unit:'/document',desc:"Traduction contrats, r√®glements, communications multilingues",price:''},
      ]},
    ];
    return cats;
  });

  const updPrice=(catIdx,itemIdx,val)=>{
    setTarifs(prev=>{
      const nw=[...prev];
      nw[catIdx]={...nw[catIdx],items:[...nw[catIdx].items]};
      nw[catIdx].items[itemIdx]={...nw[catIdx].items[itemIdx],price:val};
      return nw;
    });
  };

  const totalItems=tarifs.reduce((a,c)=>a+c.items.length,0);
  const filledItems=tarifs.reduce((a,c)=>a+c.items.filter(i=>i.price!=='').length,0);

  const exportGrille=()=>{
    let txt='GRILLE TARIFAIRE ‚Äî AUREUS SOCIAL PRO\n';
    txt+=`Secr√©tariat social: ${s.co.name||'[Nom soci√©t√©]'}\n`;
    txt+=`Date: ${new Date().toLocaleDateString('fr-BE')}\n`;
    txt+='‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
    tarifs.forEach(cat=>{
      txt+=`‚ñ¨ ${cat.cat.toUpperCase()}\n`;
      txt+='‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
      cat.items.forEach(it=>{
        txt+=`  ${it.l}\n`;
        txt+=`    ${it.desc}\n`;
        txt+=`    Unit√©: ${it.unit}  ‚îÇ  Tarif: ${it.price?`${it.price} ‚Ç¨ HTVA`:'√Ä d√©finir'}\n\n`;
      });
      txt+='\n';
    });
    txt+='\nConditions g√©n√©rales:\n';
    txt+='- Tous les prix sont HTVA (TVA 21%)\n';
    txt+='- Paiement √† 30 jours fin de mois\n';
    txt+='- Indexation annuelle selon indice sant√©\n';
    txt+='- Tarifs valables pour l\'ann√©e civile en cours\n';
    return txt;
  };

  return <div>
    <PH title="Frais de gestion" sub={`Grille tarifaire ‚Äî ${totalItems} prestations ¬∑ ${filledItems} tarifs d√©finis`} actions={<div style={{display:'flex',gap:10}}>
      <B v="outline" onClick={()=>{const txt=exportGrille();navigator.clipboard?.writeText(txt);alert('Grille tarifaire copi√©e !')}}>üìã Copier grille</B>
      <B onClick={()=>d({type:"MODAL",m:{w:900,c:<div>
        <h3 style={{color:'#e8e6e0',margin:'0 0 10px',fontFamily:"'Cormorant Garamond',serif"}}>Grille tarifaire ‚Äî {s.co.name||'Aureus Social Pro'}</h3>
        <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:500,overflowY:'auto'}}>{exportGrille()}</pre>
        <div style={{display:'flex',gap:10,marginTop:12,justifyContent:'flex-end'}}>
          <B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B>
          <B onClick={()=>{navigator.clipboard?.writeText(exportGrille());alert('Copi√© !')}}>Copier</B>
        </div>
      </div>}})}>üìÑ Aper√ßu grille</B>
    </div>}/>

    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      {tarifs.map((cat,ci)=><C key={ci}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}}>
          <ST style={{margin:0}}><span style={{color:cat.color}}>{cat.cat}</span></ST>
          <span style={{fontSize:10,color:'#5e5c56'}}>{cat.items.filter(i=>i.price!=='').length}/{cat.items.length}</span>
        </div>
        {cat.items.map((it,ii)=><div key={it.id} style={{padding:'10px 12px',marginBottom:6,background:"rgba(198,163,78,.02)",border:'1px solid rgba(198,163,78,.04)',borderRadius:8}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',gap:10}}>
            <div style={{flex:1}}>
              <div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0'}}>{it.l}</div>
              <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{it.desc}</div>
              <div style={{fontSize:9.5,color:cat.color,marginTop:3}}>{it.unit}</div>
            </div>
            <div style={{display:'flex',alignItems:'center',gap:4,minWidth:100}}>
              <input type="number" value={it.price} onChange={e=>updPrice(ci,ii,e.target.value)} placeholder="‚Äî" style={{width:70,padding:'5px 8px',background:"#090c16",border:'1px solid rgba(139,115,60,.12)',borderRadius:5,color:it.price?'#4ade80':'#5e5c56',fontSize:12,fontFamily:'inherit',outline:'none',textAlign:'right'}}/>
              <span style={{fontSize:10,color:'#5e5c56'}}>‚Ç¨</span>
            </div>
          </div>
        </div>)}
      </C>)}
    </div>

    <C style={{marginTop:20}}>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:16}}>
        <div style={{padding:14,background:"rgba(198,163,78,.06)",borderRadius:10,textAlign:'center'}}>
          <div style={{fontSize:10,color:'#5e5c56'}}>Prestations</div>
          <div style={{fontSize:24,fontWeight:700,color:'#c6a34e'}}>{totalItems}</div>
          <div style={{fontSize:10,color:'#5e5c56'}}>types de services</div>
        </div>
        <div style={{padding:14,background:"rgba(74,222,128,.06)",borderRadius:10,textAlign:'center'}}>
          <div style={{fontSize:10,color:'#5e5c56'}}>Tarifs d√©finis</div>
          <div style={{fontSize:24,fontWeight:700,color:'#4ade80'}}>{filledItems}</div>
          <div style={{fontSize:10,color:'#5e5c56'}}>sur {totalItems}</div>
        </div>
        <div style={{padding:14,background:"rgba(96,165,250,.06)",borderRadius:10,textAlign:'center'}}>
          <div style={{fontSize:10,color:'#5e5c56'}}>Cat√©gories</div>
          <div style={{fontSize:24,fontWeight:700,color:'#60a5fa'}}>{tarifs.length}</div>
          <div style={{fontSize:10,color:'#5e5c56'}}>familles de services</div>
        </div>
      </div>
      <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.05)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.6}}>
        <b>üí° Conseil:</b> D√©finissez vos tarifs puis utilisez le module PEPPOL pour facturer directement vos clients via le r√©seau de facturation √©lectronique. Les frais de gestion sont factur√©s HTVA (TVA 21% applicable). Vous pouvez exporter la grille tarifaire compl√®te comme annexe √† vos conventions de service.
      </div>
    </C>
  </div>;
}

function SettingsPage({s,d}) {
  const [f,setF]=useState({...s.co});
  return <div>
    <PH title="Param√®tres" sub="Configuration soci√©t√©"/>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Identification</ST><div style={{display:'grid',gap:9}}>
        <I label="Soci√©t√©" value={f.name} onChange={v=>setF({...f,name:v})}/>
        <I label="TVA" value={f.vat} onChange={v=>setF({...f,vat:v})}/>
        <I label="BCE" value={f.bce} onChange={v=>setF({...f,bce:v})}/>
        <I label="ONSS" value={f.onss} onChange={v=>setF({...f,onss:v})}/>
        <I label="Code NACE" value={f.nace} onChange={v=>setF({...f,nace:v})}/>
        <I label="Adresse" value={f.addr} onChange={v=>setF({...f,addr:v})}/>
        <I label="CP" value={f.cp} onChange={v=>setF({...f,cp:v})} options={Object.entries(LEGAL.CP).map(([k,v])=>({v:k,l:v}))}/>
        <I label="IBAN (compte bancaire)" value={f.bank} onChange={v=>setF({...f,bank:v})}/>
        <I label="BIC (code banque)" value={f.bic} onChange={v=>setF({...f,bic:v})} options={[
          {v:"GEBABEBB",l:"GEBABEBB ‚Äî BNP Paribas Fortis"},
          {v:"BBRUBEBB",l:"BBRUBEBB ‚Äî ING Belgique"},
          {v:"KREDBEBB",l:"KREDBEBB ‚Äî KBC / CBC"},
          {v:"GKCCBEBB",l:"GKCCBEBB ‚Äî Belfius"},
          {v:"ARSPBE22",l:"ARSPBE22 ‚Äî Argenta"},
          {v:"NICABEBB",l:"NICABEBB ‚Äî Crelan"},
          {v:"TRIOBEBB",l:"TRIOBEBB ‚Äî Triodos"},
          {v:"AXABBE22",l:"AXABBE22 ‚Äî AXA Banque"},
        ]}/>
      </div></C>
      <C><ST>Contact & Assurances</ST><div style={{display:'grid',gap:9}}>
        <I label="Contact" value={f.contact} onChange={v=>setF({...f,contact:v})}/>
        <I label="Email" value={f.email} onChange={v=>setF({...f,email:v})}/>
        <I label="T√©l√©phone" value={f.phone} onChange={v=>setF({...f,phone:v})}/>
        <I label="Assureur AT" value={f.insurer} onChange={v=>setF({...f,insurer:v})}/>
        <I label="N¬∞ police" value={f.policyNr} onChange={v=>setF({...f,policyNr:v})}/>
        <I label="Secr√©tariat social" value={f.secSoc} onChange={v=>setF({...f,secSoc:v})}/>
      </div></C>
    </div>
    <div style={{marginTop:14,display:'flex',justifyContent:'flex-end'}}><B onClick={()=>{d({type:"UPD_CO",d:f});alert('Sauvegard√© !')}}>Sauvegarder</B></div>
    
    {/* 2FA Security Section */}
    <C style={{marginTop:20}}>
      <ST>üîê S√©curit√© ‚Äî Authentification √† deux facteurs (2FA)</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:16}}>
        <div>
          <div style={{fontSize:12,color:'#e8e6e0',marginBottom:8,fontWeight:600}}>Statut 2FA</div>
          <div style={{display:'flex',alignItems:'center',gap:10,padding:14,background:'rgba(74,222,128,.04)',borderRadius:10,border:'1px solid rgba(74,222,128,.12)'}}>
            <span style={{fontSize:24}}>üîí</span>
            <div>
              <div style={{fontSize:13,fontWeight:600,color:'#4ade80'}}>2FA disponible via Supabase</div>
              <div style={{fontSize:10.5,color:'#5e5c56',marginTop:2}}>Activez la v√©rification en deux √©tapes pour s√©curiser votre compte</div>
            </div>
          </div>
          <div style={{marginTop:12}}>
            <B v="outline" style={{width:'100%'}} onClick={async()=>{
              try{
                const{data,error}=await(await import('./lib/supabase')).supabase.auth.mfa.enroll({factorType:'totp'});
                if(error)return alert('Erreur: '+error.message);
                if(data){
                  const qr=data.totp?.qr_code;
                  const secret=data.totp?.secret;
                  alert('2FA activ√© !\\n\\nScannez le QR code avec Google Authenticator ou Authy.\\n\\nSecret: '+secret+'\\n\\n(Le QR code sera affich√© dans une prochaine version)');
                }
              }catch(e){alert('2FA via TOTP ‚Äî Activez dans Supabase Dashboard > Authentication > MFA');}
            }}>üîê Activer 2FA (TOTP)</B>
          </div>
        </div>
        <div>
          <div style={{fontSize:12,color:'#e8e6e0',marginBottom:8,fontWeight:600}}>Options de s√©curit√©</div>
          <div style={{display:'flex',flexDirection:'column',gap:8}}>
            <div style={{display:'flex',alignItems:'center',gap:10,padding:12,background:'rgba(198,163,78,.03)',borderRadius:8,border:'1px solid rgba(198,163,78,.08)'}}>
              <span>üìß</span>
              <div style={{flex:1}}>
                <div style={{fontSize:11.5,color:'#e8e6e0'}}>Email de confirmation</div>
                <div style={{fontSize:9.5,color:'#5e5c56'}}>Requis √† l'inscription</div>
              </div>
              <span style={{fontSize:10,color:'#4ade80',fontWeight:600}}>Actif ‚úì</span>
            </div>
            <div style={{display:'flex',alignItems:'center',gap:10,padding:12,background:'rgba(198,163,78,.03)',borderRadius:8,border:'1px solid rgba(198,163,78,.08)'}}>
              <span>üîë</span>
              <div style={{flex:1}}>
                <div style={{fontSize:11.5,color:'#e8e6e0'}}>R√©initialisation mot de passe</div>
                <div style={{fontSize:9.5,color:'#5e5c56'}}>Par email s√©curis√©</div>
              </div>
              <span style={{fontSize:10,color:'#4ade80',fontWeight:600}}>Actif ‚úì</span>
            </div>
            <div style={{display:'flex',alignItems:'center',gap:10,padding:12,background:'rgba(198,163,78,.03)',borderRadius:8,border:'1px solid rgba(198,163,78,.08)'}}>
              <span>‚è±</span>
              <div style={{flex:1}}>
                <div style={{fontSize:11.5,color:'#e8e6e0'}}>Session timeout</div>
                <div style={{fontSize:9.5,color:'#5e5c56'}}>D√©connexion apr√®s inactivit√©</div>
              </div>
              <span style={{fontSize:10,color:'#fb923c',fontWeight:600}}>1 heure</span>
            </div>
            <div style={{display:'flex',alignItems:'center',gap:10,padding:12,background:'rgba(198,163,78,.03)',borderRadius:8,border:'1px solid rgba(198,163,78,.08)'}}>
              <span>üì±</span>
              <div style={{flex:1}}>
                <div style={{fontSize:11.5,color:'#e8e6e0'}}>TOTP (Google Authenticator / Authy)</div>
                <div style={{fontSize:9.5,color:'#5e5c56'}}>Code √† 6 chiffres toutes les 30 secondes</div>
              </div>
              <span style={{fontSize:10,color:'#fb923c',fontWeight:600}}>√Ä activer</span>
            </div>
            <div style={{display:'flex',alignItems:'center',gap:10,padding:12,background:'rgba(198,163,78,.03)',borderRadius:8,border:'1px solid rgba(198,163,78,.08)'}}>
              <span>üõ°</span>
              <div style={{flex:1}}>
                <div style={{fontSize:11.5,color:'#e8e6e0'}}>Audit trail (Bo√Æte noire)</div>
                <div style={{fontSize:9.5,color:'#5e5c56'}}>Toute action est trac√©e dans audit_log</div>
              </div>
              <span style={{fontSize:10,color:'#4ade80',fontWeight:600}}>Actif ‚úì</span>
            </div>
          </div>
        </div>
      </div>
    </C>
    <C style={{marginTop:20}}>
      <ST>Bar√®mes l√©gaux</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:20,marginTop:10}}>
        <div><div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>ONSS</div><div style={{fontSize:11.5,color:'#9e9b93',lineHeight:2}}>
          <div>Travailleur: <b style={{color:'#e8e6e0'}}>{fmtP(LEGAL.ONSS_W)}</b></div>
          <div>Employeur (marchand): <b style={{color:'#e8e6e0'}}>25,00%</b></div>
          <div>Employeur (non-march.): <b style={{color:'#e8e6e0'}}>32,40%</b></div>
          <div>Ouvriers: brut √ó 108%</div>
          <div>Bonus max: <b style={{color:'#e8e6e0'}}>{fmt(LEGAL.BONUS_2026.A_MAX)}</b></div>
        </div></div>
        <div><div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>Avantages</div><div style={{fontSize:11.5,color:'#9e9b93',lineHeight:2}}>
          <div>CR empl. max: <b style={{color:'#e8e6e0'}}>{fmt(LEGAL.MV.emax)}</b> (2026)</div>
          <div>CR trav. min: <b style={{color:'#e8e6e0'}}>{fmt(LEGAL.MV.wmin)}</b></div>
          <div>CR valeur max: <b style={{color:'#e8e6e0'}}>{fmt(LEGAL.MV.maxTotal)}</b></div>
          <div>√âco-ch√®ques: <b style={{color:'#e8e6e0'}}>{fmt(LEGAL.ECO)}/an</b></div>
        </div></div>
        <div><div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>R√©gime</div><div style={{fontSize:11.5,color:'#9e9b93',lineHeight:2}}>
          <div>Heures/sem: <b style={{color:'#e8e6e0'}}>{LEGAL.WH}h</b></div>
          <div>Heures/jour: <b style={{color:'#e8e6e0'}}>{LEGAL.WHD}h</b></div>
          <div>Jours/mois: <b style={{color:'#e8e6e0'}}>{LEGAL.WD}</b></div>
        </div></div>
      </div>
      <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.05)",borderRadius:8,border:'1px solid rgba(96,165,250,.08)'}}>
        <div style={{fontSize:10.5,color:'#4ade80',lineHeight:1.5}}>‚úÖ Pr√©compte professionnel calcul√© selon la formule-cl√© compl√®te SPF Finances ‚Äî Annexe III AR/CIR 92 ‚Äî Bar√®mes 2026 (tranches annuelles 26,75% √† 53,50%, quotit√© exempt√©e 10 900‚Ç¨, frais forfaitaires 30% plafond 5 930‚Ç¨, quotient conjugal, r√©ductions familiales annualis√©es).</div>
      </div>
    </C>
    <C style={{marginTop:20}}>
      <ST>üîç Audit syst√®me ‚Äî Aureus Social Pro</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18,marginTop:12}}>
        <div>
          <div style={{fontSize:11.5,fontWeight:600,color:'#4ade80',marginBottom:10}}>‚úÖ Bar√®mes SPF v√©rifi√©s (salairesminimums.be)</div>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:2.2}}>
            {[
              {cp:'200',n:'CP AUXILIAIRE EMPLOY√âS',idx:'2,21%',dt:'01/01/2026',src:'Grille A/B/C/D, 0-26 ans anc.'},
              {cp:'124',n:'CONSTRUCTION',idx:'0,22%',dt:'01/01/2026',src:'Taux horaires I‚ÜíChef IV'},
              {cp:'302',n:'H√îTELLERIE',idx:'2,19%',dt:'01/01/2026',src:'Cat I-V par anciennet√©'},
              {cp:'118',n:'INDUSTRIE ALIMENTAIRE (ouv.)',idx:'2,19%',dt:'01/01/2026',src:'S-sect.17, 8 classes, anc mois'},
              {cp:'140',n:'TRANSPORT ROUTIER',idx:'2,18%',dt:'01/01/2026',src:'SCP 140.03 roulant/non-roulant/garage'},
              {cp:'330',n:'SANT√â',idx:'2,0%',dt:'01/01/2026',src:'√âch. 1.12‚Üí1.59, 13 √©chelons anc.'},
              {cp:'121',n:'NETTOYAGE',idx:'0,56%',dt:'01/01/2026',src:'8 cat√©gories, r√©gime 37h'},
              {cp:'111',n:'M√âTAL/M√âCANIQUE (ouv.)',idx:'2,72%',dt:'01/07/2025',src:'Cat 1-7 national + Agoria'},
              {cp:'116',n:'CHIMIE (ouvriers)',idx:'2,0%',dt:'01/04/2025',src:'Taux horaires man≈ìuvre, 2 √©chelons'},
              {cp:'201',n:'COMMERCE D√âTAIL IND√âPENDANT',idx:'2,0%',dt:'01/04/2025',src:'Grp1 vente Cat.1-4, exp 0-14 ans'},
              {cp:'202',n:'COMMERCE D√âTAIL ALIMENTAIRE',idx:'1,0%',dt:'01/01/2026',src:'Cat 1-5 par anciennet√©'},
              {cp:'209',n:'FAB. M√âTALLIQUE (empl.)',idx:'2,0%',dt:'01/07/2025',src:'Classes SCE, Agoria'},
              {cp:'220',n:'INDUSTRIE ALIMENTAIRE (empl.)',idx:'2,19%',dt:'01/01/2026',src:'Cat 1-6, CGSLB'},
              {cp:'306',n:'ASSURANCES',idx:'2,23%',dt:'01/01/2026',src:'Employ√©s Cat.1-4B, 22 √©ch. anc.'},
              {cp:'304',n:'SPECTACLE',idx:'x1,37',dt:'01/02/2026',src:'Groupes 1a-6, SPF officiel'},
              {cp:'311',n:'GRANDES SURFACES',idx:'2,21%',dt:'01/01/2026',src:'Cat 1-5, vente d√©tail'},
              {cp:'313',n:'PHARMACIES',idx:'2,0%',dt:'01/03/2025',src:'Non-pharma Cat I-IV 0-42 ans + Pharmaciens'},
              {cp:'317',n:'GARDIENNAGE',idx:'2,21%',dt:'01/01/2026',src:'Agent A-D, s√©curit√©'},
              {cp:'318',n:'AIDES FAMILIALES',idx:'2,0%',dt:'01/01/2026',src:'Cat 1-4 non-marchand'},
              {cp:'329',n:'SOCIO-CULTUREL',idx:'2,0%',dt:'01/01/2026',src:'Bar√®me 1-4.1, ASBL'},
              {cp:'331',n:'AIDE SOCIALE (Flandre)',idx:'2,0%',dt:'01/01/2026',src:'IFIC Cat 1-5'},
              {cp:'332',n:'AIDE SOCIALE (francophone)',idx:'2,0%',dt:'01/01/2026',src:'IFIC Cat 1-5'},
              {cp:'336',n:'PROFESSIONS LIB√âRALES',idx:'2,21%',dt:'01/01/2026',src:'Cat 1-4 align√© CP 200'},
              {cp:'144',n:'AGRICULTURE',idx:'2,21%',dt:'01/01/2026',src:'Cat 1-4 secteurs verts'},
              {cp:'145',n:'HORTICULTURE',idx:'2,21%',dt:'01/01/2026',src:'Cat 1-3 secteurs verts'},
              {cp:'152',n:'ENSEIGNEMENT LIBRE (ouv.)',idx:'2,0%',dt:'01/01/2026',src:'6 cat√©gories CP 152.02'},
              {cp:'333',n:'ATTRACTIONS TOURISTIQUES',idx:'2,21%',dt:'01/01/2026',src:'Cat 1-4 loisirs'},
            ].map(b=><div key={b.cp} style={{display:'flex',gap:8,alignItems:'center'}}>
              <span style={{background:"rgba(74,222,128,.1)",color:'#4ade80',padding:'1px 6px',borderRadius:4,fontSize:9,fontWeight:700,minWidth:44,textAlign:'center'}}>CP {b.cp}</span>
              <span style={{color:'#d4d0c8',fontSize:11}}>{b.n}</span>
              <span style={{color:'#5e5c56',fontSize:10,marginLeft:'auto'}}>idx {b.idx} ¬∑ {b.dt}</span>
            </div>)}
          </div>
          <div style={{fontSize:11.5,fontWeight:600,color:'#facc15',marginTop:16,marginBottom:10}}>‚âà Bar√®mes estim√©s (structure confirm√©e, montants approximatifs)</div>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:2.2}}>
            {[
              {cp:'149',n:'√âLECTRICIENS',idx:'2,0%',dt:'01/01/2026',src:'5 cat. avec prime anciennet√©'},
              {cp:'225',n:'ENSEIGNEMENT PRIV√â (empl.)',idx:'2,21%',dt:'01/01/2026',src:'Align√© CP 200'},
              {cp:'226',n:'COMMERCE INTERNATIONAL',idx:'2,23%',dt:'01/01/2026',src:'CGSLB v√©rifi√©'},
              {cp:'307',n:'COURTAGE ASSURANCES',idx:'2,21%',dt:'01/01/2026',src:'Align√© CP 200 + compl√©ments'},
              {cp:'319',n:'√âDUCATIFS',idx:'2,0%',dt:'01/01/2026',src:'Non-marchand, IFIC'},
              {cp:'322.01',n:'TITRES-SERVICES',idx:'2,0%',dt:'01/01/2026',src:'Salaire sectoriel minimum'},
              {cp:'323',n:'IMMOBILIER',idx:'2,21%',dt:'01/01/2026',src:'Align√© CP 200'},
              {cp:'327',n:'ETA',idx:'2,0%',dt:'01/01/2026',src:'Travailleurs adapt√©s + encadrement'},
            ].map(b=><div key={b.cp} style={{display:'flex',gap:8,alignItems:'center'}}>
              <span style={{background:"rgba(250,204,21,.1)",color:'#facc15',padding:'1px 6px',borderRadius:4,fontSize:9,fontWeight:700,minWidth:44,textAlign:'center'}}>CP {b.cp}</span>
              <span style={{color:'#d4d0c8',fontSize:11}}>{b.n}</span>
              <span style={{color:'#5e5c56',fontSize:10,marginLeft:'auto'}}>idx {b.idx} ¬∑ {b.dt}</span>
            </div>)}
          </div>
          <div style={{fontSize:11.5,fontWeight:600,color:'#4ade80',marginTop:16,marginBottom:10}}>‚úÖ 35 CPs ‚Äî 27 v√©rifi√©s SPF + 8 estim√©s fiables</div>
        </div>
        <div>
          <div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:10}}>üìä Statistiques application</div>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:2.2}}>
            <div>Modules fonctionnels: <b style={{color:'#c6a34e'}}>46</b></div>
            <div>Composants React: <b style={{color:'#c6a34e'}}>~90</b></div>
            <div>Cat√©gories navigation: <b style={{color:'#c6a34e'}}>12</b></div>
            <div>CPs avec bar√®mes: <b style={{color:'#4ade80'}}>35</b> / 35 (27 SPF + 8 estim√©s)</div>
            <div>Secteurs wizard: <b style={{color:'#c6a34e'}}>26</b> activit√©s</div>
            <div>Documents DRS: <b style={{color:'#c6a34e'}}>14 types Activa + 15 ch√¥mage + 14 INAMI</b></div>
            <div>Formats comptables: <b style={{color:'#c6a34e'}}>6</b> (BOB, Winbooks, Kluwer, Popsy, Soda, Autre)</div>
            <div>R√©gions Activa: <b style={{color:'#c6a34e'}}>3</b> (Actiris, FOREM, VDAB)</div>
          </div>
          <div style={{fontSize:11.5,fontWeight:600,color:'#4ade80',marginTop:16,marginBottom:10}}>‚úÖ Calculs conformes Annexe III 2026</div>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
            {[
              'Pr√©compte pro: formule-cl√© COMPL√àTE SPF Finances 2026 (tranches 26,75%‚Üí53,50%, quotit√© exempt√©e 10 900‚Ç¨)',
              '35 CPs avec bar√®mes v√©rifi√©s (sources SPF et syndicales officielles)',
              'CP 209: bar√®mes index√©s +2,72% au 01/07/2025 ‚Äî montants exacts emploi.belgique.be',
              'CP 330: bar√®mes classiques + √©chelles IFIC (Cat.1.12‚Üí1.59)',
              'ONSS: taux 25% marchand + 32,40% non-marchand + ouvrier 108% + modulations sectorielles + cotis. sp√©ciales (FFE, ch√¥mage temp., amiante)',
              'P√©cule vacances: double p√©cule d√©taill√© (85% + 7%, ONSS 2√®me partie, cotis. sp√©c. 1%)',
            ].map((p,i)=><div key={i} style={{paddingLeft:10,borderLeft:'2px solid rgba(74,222,128,.3)',marginBottom:6,fontSize:10.5,color:'#4ade80'}}>{p}</div>)}
          </div>
          <div style={{fontSize:11.5,fontWeight:600,color:'#60a5fa',marginTop:16,marginBottom:10}}>üí° Pistes d'√©volution future</div>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
            {[
              'Module flexi-jobs (horeca, commerce, sant√©)',
              'Export SEPA XML ISO 20022 pour virements salaires',
              'Module √©valuation annuelle / entretien fonctionnement',
              'Gestion planning/horaires avec badgeuse',
              'Int√©gration eBox entreprise (documents sociaux d√©mat√©rialis√©s)',
              'Module accident du travail (d√©claration + suivi FEDRIS)',
              'Connexion API DmfA / Dimona (batch ONSS)',
            ].map((p,i)=><div key={i} style={{paddingLeft:10,borderLeft:'2px solid rgba(96,165,250,.2)',marginBottom:6,fontSize:10.5,color:'#60a5fa'}}>{p}</div>)}
          </div>
        </div>
      </div>
    </C>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODULES PRO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DRS_DOCS={
  chomage:[
    {code:'C4',l:"C4 ‚Äî Certificat de ch√¥mage",f:['motif',"brut","regime","preavis"]},
    {code:'C4-RCC',l:"C4 Pr√©pension (RCC)",f:['motif',"brut","date_rcc"]},
    {code:'C4-ENS',l:"C4 Enseignement",f:['motif',"etablissement"]},
    {code:'C3.2-CD',l:"C3.2 Constat du droit",f:['regime',"heures"]},
    {code:'C3.2-OUV',l:"C3.2 Employeur ‚Üí Ouvriers",f:['jours',"motif"]},
    {code:'C3.2-EMP',l:"C3.2 Anti-crise ‚Üí Employ√©s",f:['jours',"motif"]},
    {code:'C131A',l:"C131A Employeur",f:['debut',"motif","regime"]},
    {code:'C131B',l:"C131B",f:['debut',"regime"]},
    {code:'C131A-E',l:"C131A Enseignement",f:['debut',"etablissement"]},
    {code:'C131B-E',l:"C131B Enseignement",f:['debut']},
    {code:'C78-ACT-BXL',l:"C78 Activa.brussels (Actiris)",f:['type_activa',"debut","duree","montant_red"]},
    {code:'C78-ACT-WAL',l:"C78 Impulsion -12/-25 mois (FOREM)",f:['type_impulsion',"debut","duree","montant_red"]},
    {code:'C78-ACT-VL',l:"C78 Werkplekleren / Winwin (VDAB)",f:['type_vl',"debut","duree"]},
    {code:'C78-TRANS',l:"C78 Prime de transition (Bruxelles)",f:['debut',"duree","montant"]},
    {code:'C78-START',l:"C78 Activa Start (<26 ans)",f:['debut',"duree","age"]},
    {code:'C78-ETA',l:"C78 E.T.A. (Entreprise Travail Adapt√©)",f:['type',"debut","pct_prime"]},
    {code:'C78-ART60',l:"C78 Article 60¬ß7 (CPAS)",f:['cpas',"debut","fin","type_art60","subsides"]},
    {code:'C78-ART61',l:"C78 Article 61 (CPAS mise √† dispo)",f:['cpas',"debut","fin"]},
    {code:'C78-SINE',l:"C78 SINE (√âconomie sociale insertion)",f:['debut',"duree","agr√©ment"]},
    {code:'C78.3',l:"C78.3 P.T.P. (Programme Transition Pro)",f:['debut',"heures","org_encadrement"]},
    {code:'C78-SEC',l:"C78 S√©curit√© & pr√©vention",f:['debut',"fonction"]},
    {code:'C78-FIRST',l:"C78 Stage First / FPI (Actiris/FOREM)",f:['debut',"duree","indemnite"]},
    {code:'C78-FORM',l:"C78 Contrat de formation (IFAPME/EFP)",f:['debut',"duree","centre"]},
    {code:'C78-HAND',l:"C78 Prime handicap (AVIQ/PHARE/VDAB)",f:['debut',"organisme","pct_prime"]},
    {code:'C103-JE',l:"C103 Jeunes Employeur",f:['debut',"age"]},
    {code:'C103-JT',l:"C103 Jeunes Travailleur",f:['debut',"age"]},
    {code:'C103-SE',l:"C103 Seniors Employeur",f:['debut',"age"]},
    {code:'C103-ST',l:"C103 Seniors Travailleur",f:['debut',"age"]},
  ],
  inami:[
    {code:'IN-MAL',l:"Incapacit√© ‚Äî Maladie/Accident",f:['debut',"fin","diagnostic"]},
    {code:'IN-MAT',l:"Repos de maternit√©",f:['accouchement',"debut","fin"]},
    {code:'IN-EC',l:"√âcartement complet maternit√©",f:['debut',"fin"]},
    {code:'IN-EP',l:"√âcartement partiel maternit√©",f:['debut',"fin","heures"]},
    {code:'IN-CONV',l:"Maternit√©/Paternit√© converti",f:['debut',"fin"]},
    {code:'IN-NAIS',l:"Cong√© naissance (10j)",f:['naissance',"debut"]},
    {code:'IN-ADOP',l:"Cong√© adoption",f:['debut',"fin"]},
    {code:'IN-REP',l:"Reprise partielle travail",f:['debut',"heures"]},
    {code:'IN-PROT',l:"Protection maternit√©",f:['debut',"fin"]},
    {code:'IN-2EMP',l:"2 employeurs diff√©rents",f:['debut',"employeur2"]},
    {code:'IN-ALL',l:"Allaitement ‚Äî Pauses",f:['debut',"nb_pauses"]},
    {code:'VAC-C',l:"Vacances annuelles (caisse)",f:['annee',"jours"]},
    {code:'VAC-E',l:"Vacances annuelles (employeur)",f:['annee',"jours","montant"]},
    {code:'IN-REPR',l:"Reprise du travail",f:['date_reprise']},
  ],
  papier:[
    {code:'C4-P',l:"C4 DRS (papier)",f:['motif']},
    {code:'C4-RCC-P',l:"C4 DRS-RCC (papier)",f:['motif']},
    {code:'ATT-PV',l:"Attestation P√©cules de vacances",f:['annee',"simple","double"]},
    {code:'ATT-TRAV',l:"Attestation de travail",f:['debut',"fin","fonction"]},
    {code:'ATT-276',l:"Attestation 276 frontaliers",f:['pays',"annee"]},
  ],
};
const COMPTA=[{id:"bob",n:'BOB Software',fmt:'CSV/XML'},{id:"winbooks",n:'Winbooks',fmt:'TXT/CSV'},{id:"kluwer",n:'Kluwer Expert',fmt:'CSV'},{id:"popsy",n:'Popsy',fmt:'TXT'},{id:"soda",n:'Soda',fmt:'CSV'},{id:"exact",n:'Exact Online',fmt:'CSV/XML'},{id:"octopus",n:'Octopus',fmt:'CSV'},{id:"clearfact",n:'ClearFact',fmt:'CSV/UBL'},{id:"yuki",n:'Yuki',fmt:'XML'},{id:"horus",n:'Horus',fmt:'CSV'},{id:"other",n:'Autre (txt/xls)',fmt:'TXT/XLS'}];
const CR_PROV=[{id:"pluxee",n:'Pluxee (ex-Sodexo)',ic:'üü†'},{id:"edenred",n:'Edenred',ic:'üî¥'},{id:"monizze",n:'Monizze',ic:'üü¢'},{id:"got",n:'G.O.T. CONNECTION',ic:'üîµ'}];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CATEGORY ROUTER PAGES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function SalairesPage({s,d}){const sub=s.sub||'od';return <div>
  <PH title="Salaires & Calculs" sub={`Module: ${{'od':'O.D. Comptables',"provisions":'Provisions',"cumuls":'Cumuls annuels',"netbrut":'Net ‚Üí Brut',"simcout":'Simulation co√ªt salarial',"saisies":'Saisies-Cessions',"indexauto":'Index automatique',"horsforfait":'Heures suppl√©mentaires',"totalreward":'Total Reward Statement'}[sub]||sub}`}/>
  {sub==='od'&&<ODMod s={s} d={d}/>}{sub==='provisions'&&<ProvisionsMod s={s} d={d}/>}
  {sub==='cumuls'&&<CumulsMod s={s} d={d}/>}{sub==='netbrut'&&<NetBrutMod s={s} d={d}/>}
  {sub==='simcout'&&<SimCoutMod s={s} d={d}/>}{sub==='totalreward'&&<TotalRewardMod s={s} d={d}/>}
  {sub==='saisies'&&<SaisiesMod s={s} d={d}/>}{sub==='indexauto'&&<IndexAutoMod s={s} d={d}/>}
  {sub==='horsforfait'&&<HeuresSupMod s={s} d={d}/>}
</div>;}

function AvantagesPage({s,d}){const sub=s.sub||'cheques';return <div>
  <PH title="Avantages & R√©mun√©ration" sub={`Module: ${{'cheques':'Ch√®ques-Repas',"ecocmd":'√âco-ch√®ques',"cafeteria":'Plan caf√©t√©ria',"cct90":'Bonus CCT 90',"warrants":'Warrants',"budgetmob":'Budget mobilit√©',"ecocircul":'Notes de frais'}[sub]||sub}`}/>
  {sub==='cheques'&&<CRMod s={s} d={d}/>}{sub==='ecocmd'&&<EcoCommandeMod s={s} d={d}/>}
  {sub==='cafeteria'&&<CafeteriaMod s={s} d={d}/>}{sub==='cct90'&&<CCT90Mod s={s} d={d}/>}
  {sub==='warrants'&&<WarrantsMod s={s} d={d}/>}{sub==='budgetmob'&&<BudgetMobiliteMod s={s} d={d}/>}
  {sub==='ecocircul'&&<NoteFraisMod s={s} d={d}/>}
</div>;}

function ContratsMenuPage({s,d}){const sub=s.sub||'contrats';return <div>
  <PH title="Contrats & Documents" sub={`Module: ${{'contrats':'Contrats de travail',"reglement":'R√®glement de travail',"compteindiv":'Compte individuel',"preavis":'Pr√©avis l√©gal',"pecsortie":'P√©cule de sortie',"certpme":'Certificat PME'}[sub]||sub}`}/>
  {sub==='contrats'&&<ContratsTravailMod s={s} d={d}/>}{sub==='reglement'&&<ReglementTravailMod s={s} d={d}/>}
  {sub==='compteindiv'&&<CompteIndividuelMod s={s} d={d}/>}{sub==='preavis'&&<PreavisMod s={s} d={d}/>}
  {sub==='pecsortie'&&<PeculeSortieMod s={s} d={d}/>}{sub==='certpme'&&<CertPMEMod s={s} d={d}/>}
</div>;}

function RHPage({s,d}){const sub=s.sub||'absences';return <div>
  <PH title="RH & Personnel" sub={`Module: ${{'wf_embauche':'‚ö° Workflow Embauche','wf_licenciement':'‚ö° Workflow Licenciement','wf_maladie':'‚ö° Workflow Maladie','absences':'Gestion absences',"absenteisme":'Analyse absent√©isme',"credittemps":'Cr√©dit-temps',"chomtemp":'Ch√¥mage temporaire',"congeduc":'Cong√©-√©ducation pay√©',"rcc":'RCC / Pr√©pension',"outplacement":'Outplacement',"pointage":'Pointage & Portail Employeur',"planform":'Plan de formation',"medtravail":'M√©decine du travail',"selfservice":'Portail travailleur'}[sub]||sub}`}/>
  {sub==='wf_embauche'&&<WorkflowEmbaucheMod s={s} d={d}/>}{sub==='wf_licenciement'&&<WorkflowLicenciementMod s={s} d={d}/>}{sub==='wf_maladie'&&<WorkflowMaladieMod s={s} d={d}/>}
  {sub==='absences'&&<AbsencesMod s={s} d={d}/>}{sub==='absenteisme'&&<AbsenteismeMod s={s} d={d}/>}
  {sub==='credittemps'&&<CreditTempsMod s={s} d={d}/>}{sub==='chomtemp'&&<ChomTempMod s={s} d={d}/>}
  {sub==='congeduc'&&<CongeEducMod s={s} d={d}/>}{sub==='rcc'&&<RCCMod s={s} d={d}/>}
  {sub==='outplacement'&&<OutplacementMod s={s} d={d}/>}{sub==='pointage'&&<PointageMod s={s} d={d}/>}
  {sub==='planform'&&<PlanFormationMod s={s} d={d}/>}{sub==='medtravail'&&<MedTravailMod s={s} d={d}/>}
  {sub==='selfservice'&&<SelfServiceMod s={s} d={d}/>}
</div>;}

function SocialPage({s,d}){const sub=s.sub||'assloi';return <div>
  <PH title="Social & Assurances" sub={`Module: ${{'assloi':'Assurance-Loi AT',"assgroupe":'Assurance Groupe',"syndicales":'Primes syndicales',"allocfam":'Alloc. familiales',"caissevac":'Caisse de vacances',"rentes":'Rentes',"decava":'DECAVA',"aidesemploi":"Aides √† l'emploi"}[sub]||sub}`}/>
  {sub==='assloi'&&<AssLoiMod s={s} d={d}/>}{sub==='assgroupe'&&<AssGroupeMod s={s} d={d}/>}
  {sub==='syndicales'&&<SyndicalesMod s={s} d={d}/>}{sub==='allocfam'&&<AllocFamMod s={s} d={d}/>}
  {sub==='caissevac'&&<CaisseVacMod s={s} d={d}/>}{sub==='rentes'&&<RentesMod s={s} d={d}/>}
  {sub==='decava'&&<DecavaMod s={s} d={d}/>}{sub==='aidesemploi'&&<AidesEmploiMod s={s} d={d}/>}
</div>;}

function ReportingPage({s,d}){const sub=s.sub||'accounting';return <div>
  <PH title="Reporting & Export" sub={`Module: ${{'accounting':'Accounting Output',"bilanbnb":'Bilan Social BNB',"bilan":'Bilan Social',"statsins":'Statistiques INS',"sepa":'SEPA / Virements',"peppol":'PEPPOL e-Invoicing',"envoi":'Envoi documents',"exportimport":'Export / Import',"ged":'GED / Archivage'}[sub]||sub}`}/>
  {sub==='accounting'&&<AccountingOutputMod s={s} d={d}/>}{sub==='bilanbnb'&&<BilanSocialBNBMod s={s} d={d}/>}
  {sub==='bilan'&&<BilanSocialMod s={s} d={d}/>}{sub==='statsins'&&<StatsINSMod s={s} d={d}/>}
  {sub==='sepa'&&<SEPAMod s={s} d={d}/>}{sub==='peppol'&&<PeppolMod s={s} d={d}/>}{sub==='envoi'&&<EnvoiMod s={s} d={d}/>}
  {sub==='exportimport'&&<ExportImportMod s={s} d={d}/>}{sub==='ged'&&<GEDMod s={s} d={d}/>}
</div>;}

function LegalPage({s,d}){const sub=s.sub||'docsjuridiques';return <div>
  <PH title="Juridique & Veille" sub={`Module: ${{'docsjuridiques':'Documents Juridiques',"alertes":'Alertes l√©gales',"secteurs":'Secteurs sp√©cifiques',"eta":'Relev√©s ETA'}[sub]||sub}`}/>
  {sub==='docsjuridiques'&&<DocumentsJuridiquesMod s={s} d={d}/>}
  {sub==='alertes'&&<AlertesLegalesMod s={s} d={d}/>}{sub==='secteurs'&&<SecteursMod s={s} d={d}/>}
  {sub==='eta'&&<ETAMod s={s} d={d}/>}
</div>;}

function ModulesProPage({s,d}){
  const sub=s.sub||'od';
  return <div>
    <PH title="Modules Pro" sub="47 modules ‚Äî La Rolls Royce du secr√©tariat social"/>
    {sub==='od'&&<ODMod s={s} d={d}/>}
    {sub==='cheques'&&<CRMod s={s} d={d}/>}
    {sub==='envoi'&&<EnvoiMod s={s} d={d}/>}
    {sub==='drs'&&<DRSMod s={s} d={d}/>}
    {sub==='fiches_ext'&&<FichesMod s={s} d={d}/>}
    {sub==='pointage'&&<PointageMod s={s} d={d}/>}
    {sub==='syndicales'&&<SyndicalesMod s={s} d={d}/>}
    {sub==='onssapl'&&<ONSSAPLMod s={s} d={d}/>}
    {sub==='eta'&&<ETAMod s={s} d={d}/>}
    {sub==='exportimport'&&<ExportImportMod s={s} d={d}/>}
    {sub==='netbrut'&&<NetBrutMod s={s} d={d}/>}
    {sub==='decava'&&<DecavaMod s={s} d={d}/>}
    {sub==='bilan'&&<BilanSocialMod s={s} d={d}/>}
    {sub==='provisions'&&<ProvisionsMod s={s} d={d}/>}
    {sub==='cumuls'&&<CumulsMod s={s} d={d}/>}
    {sub==='saisies'&&<SaisiesMod s={s} d={d}/>}
    {sub==='rentes'&&<RentesMod s={s} d={d}/>}
    {sub==='assloi'&&<AssLoiMod s={s} d={d}/>}
    {sub==='assgroupe'&&<AssGroupeMod s={s} d={d}/>}
    {sub==='medtravail'&&<MedTravailMod s={s} d={d}/>}
    {sub==='allocfam'&&<AllocFamMod s={s} d={d}/>}
    {sub==='caissevac'&&<CaisseVacMod s={s} d={d}/>}
    {sub==='sepa'&&<SEPAMod s={s} d={d}/>}
    {sub==='secteurs'&&<SecteursMod s={s} d={d}/>}
    {sub==='reglement'&&<ReglementTravailMod s={s} d={d}/>}
    {sub==='contrats'&&<ContratsTravailMod s={s} d={d}/>}
    {sub==='compteindiv'&&<CompteIndividuelMod s={s} d={d}/>}
    {sub==='accounting'&&<AccountingOutputMod s={s} d={d}/>}
    {sub==='alertes'&&<AlertesLegalesMod s={s} d={d}/>}
    {sub==='bilanbnb'&&<BilanSocialBNBMod s={s} d={d}/>}
    {sub==='co2'&&<CO2Mod s={s} d={d}/>}
    {sub==='certpme'&&<CertPMEMod s={s} d={d}/>}
    {sub==='ecocmd'&&<EcoCommandeMod s={s} d={d}/>}
    {sub==='preavis'&&<PreavisMod s={s} d={d}/>}
    {sub==='pecsortie'&&<PeculeSortieMod s={s} d={d}/>}
    {sub==='credittemps'&&<CreditTempsMod s={s} d={d}/>}
    {sub==='absences'&&<AbsencesMod s={s} d={d}/>}
    {sub==='indexauto'&&<IndexAutoMod s={s} d={d}/>}
    {sub==='cafeteria'&&<CafeteriaMod s={s} d={d}/>}
    {sub==='cct90'&&<CCT90Mod s={s} d={d}/>}
    {sub==='budgetmob'&&<BudgetMobiliteMod s={s} d={d}/>}
    {sub==='statsins'&&<StatsINSMod s={s} d={d}/>}
    {sub==='warrants'&&<WarrantsMod s={s} d={d}/>}
    {sub==='planform'&&<PlanFormationMod s={s} d={d}/>}
    {sub==='ecocircul'&&<NoteFraisMod s={s} d={d}/>}
    {sub==='horsforfait'&&<HeuresSupMod s={s} d={d}/>}
    {sub==='peppol'&&<PeppolMod s={s} d={d}/>}
  </div>;
}

function ODMod({s,d}){
  const ae=s.emps||[];const [docs,setDocs]=useState([]);
  const [f,setF]=useState({type:"attestation",emp:'',motif:'',date:new Date().toISOString().split('T')[0]});
  const types=[{v:"attestation",l:"Attestation d\'emploi"},{v:"c4",l:"Formulaire C4 (ch√¥mage)"},{v:"c131",l:"Certificat C131A (vacances)"},{v:"c98",l:"Formulaire C98 (allocations familiales)"},{v:"fin_contrat",l:"Lettre fin de contrat"},{v:"avenant",l:"Avenant au contrat"},{v:"attestation_salaire",l:"Attestation de salaire"},{v:"certificat_travail",l:"Certificat de travail"}];
  const add=()=>{if(!f.emp)return;const emp=ae.find(e=>e.id===f.emp);setDocs(p=>[{...f,id:"DOC-"+Date.now(),ename:`${emp?.first} ${emp?.last}`,created:new Date().toISOString().split('T')[0]},...p]);};
  
  return <div>
    <PH title="Documents Officiels" sub="Attestations, C4, C131A, certificats ‚Äî G√©n√©ration automatique"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Documents g√©n√©r√©s",v:docs.length,c:'#60a5fa'},{l:"Types disponibles",v:types.length,c:'#c6a34e'},{l:"Ce mois",v:docs.filter(d=>d.created?.startsWith(new Date().toISOString().slice(0,7))).length,c:'#4ade80'},{l:"Travailleurs",v:ae.length,c:'#a78bfa'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'350px 1fr',gap:18}}>
      <C><ST>G√©n√©rer document</ST>
        <I label="Type" value={f.type} onChange={v=>setF({...f,type:v})} options={types}/>
        <I label="Travailleur" value={f.emp} onChange={v=>setF({...f,emp:v})} style={{marginTop:9}} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <I label="Motif / Notes" value={f.motif} onChange={v=>setF({...f,motif:v})} style={{marginTop:9}}/>
        <I label="Date" type="date" value={f.date} onChange={v=>setF({...f,date:v})} style={{marginTop:9}}/>
        <B onClick={add} style={{width:'100%',marginTop:14}}>G√©n√©rer</B>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Documents ({docs.length})</div></div>
        {docs.length>0?<Tbl cols={[
          {k:'t',l:"Type",b:1,r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:"rgba(198,163,78,.1)",color:'#c6a34e'}}>{types.find(t=>t.v===r.type)?.l}</span>},
          {k:'e',l:"Travailleur",r:r=>r.ename},
          {k:'d',l:"Date",r:r=>r.created},
          {k:'m',l:"Motif",r:r=>r.motif||'‚Äî'},
          {k:'a',l:"",r:r=><span style={{color:'#60a5fa',cursor:'pointer',fontSize:10}}>üìÑ PDF</span>},
        ]} data={docs}/>:<div style={{padding:40,textAlign:'center',color:'#5e5c56'}}>Aucun document</div>}
      </C>
    </div>
  </div>;
}


function CRMod({s,d}){
  const [prov,setProv]=useState('pluxee');
  const [per,setPer]=useState({m:new Date().getMonth()+1,y:new Date().getFullYear()});
  const [gen,setGen]=useState(null);
  const ae=s.emps.filter(e=>e.status==='active');
  const run=()=>{
    const ord=ae.map(e=>{const dy=Math.round(LEGAL.WD);const val=e.mvT||10;const pW=e.mvW||1.09;const pE=e.mvE||8.91;
      const exonOK=(pE<=LEGAL.MV.emax && pW>=LEGAL.MV.wmin && val<=LEGAL.MV.maxTotal);
      return{e,ref:`CR-${per.y}${per.m.toString().padStart(2,"0")}-${e.id}`,dy,tot:dy*val,pW:dy*pW,pE:dy*pE,val,exonOK,deducFisc:dy*(pE>=8.91?4:2)};});
    setGen({ord,tT:ord.reduce((a,o)=>a+o.tot,0),tW:ord.reduce((a,o)=>a+o.pW,0),tE:ord.reduce((a,o)=>a+o.pE,0),tDeduc:ord.reduce((a,o)=>a+o.deducFisc,0),pv:CR_PROV.find(p=>p.id===prov)});
  };
  return <div>
    <div style={{display:'grid',gridTemplateColumns:'300px 1fr',gap:18}}>
    <div>
    <C><ST>Commande Ch√®ques-Repas</ST>
      <I label="Fournisseur" value={prov} onChange={setProv} options={CR_PROV.map(p=>({v:p.id,l:`${p.ic} ${p.n}`}))}/>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
        <I label="Mois" value={per.m} onChange={v=>setPer({...per,m:parseInt(v)})} options={MN.map((m2,i)=>({v:i+1,l:m2}))}/>
        <I label="Ann√©e" type="number" value={per.y} onChange={v=>setPer({...per,y:v})}/>
      </div>
      <B onClick={run} style={{width:'100%',marginTop:14}}>G√©n√©rer commande</B>
      {gen&&<div style={{marginTop:14,padding:10,background:"rgba(198,163,78,.06)",borderRadius:8,border:'1px solid rgba(198,163,78,.1)',fontSize:12,color:'#9e9b93',lineHeight:2}}>
        <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>{gen.pv?.ic} {gen.pv?.n}</div>
        <div>Total: <b style={{color:'#e8e6e0'}}>{fmt(gen.tT)}</b></div>
        <div>Part trav.: <b style={{color:'#f87171'}}>{fmt(gen.tW)}</b></div>
        <div>Part empl.: <b style={{color:'#4ade80'}}>{fmt(gen.tE)}</b></div>
        <div>D√©duction fiscale: <b style={{color:'#60a5fa'}}>{fmt(gen.tDeduc)}</b></div>
      </div>}
    </C>
    <C style={{marginTop:12,padding:'12px 16px'}}>
      <div style={{fontSize:11,fontWeight:700,color:'#c6a34e',marginBottom:8}}>Conditions exon√©ration 2026</div>
      <div style={{fontSize:10.5,color:'#9e9b93',lineHeight:1.8}}>
        {[
          `Valeur max: ${LEGAL.MV.maxTotal}‚Ç¨ (AR 10/11/2025)`,
          `Part employeur max: ${LEGAL.MV.emax}‚Ç¨`,
          `Part travailleur min: ${LEGAL.MV.wmin}‚Ç¨`,
          '1 ch√®que = 1 jour effectivement prest√©',
          'Pr√©vu par CCT ou accord individuel √©crit',
          'Pas en remplacement de r√©mun√©ration',
          '√âlectronique uniquement (carte)',
          'Validit√©: 12 mois',
          `D√©duction fiscale: ${LEGAL.MV.deducFisc}‚Ç¨/ch√®que (si part empl. = ${LEGAL.MV.emax}‚Ç¨)`,
        ].map((c,i)=><div key={i} style={{fontSize:10,paddingLeft:8,borderLeft:'2px solid rgba(198,163,78,.15)',marginBottom:4}}>{c}</div>)}
      </div>
    </C>
    </div>
    <C style={{padding:0,overflow:'hidden'}}>
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>D√©tail ‚Äî {MN[per.m-1]} {per.y}</div></div>
      {gen?<Tbl cols={[{k:'r',l:"R√©f",r:r=><span style={{fontFamily:'monospace',fontSize:10,color:'#c6a34e'}}>{r.ref}</span>},{k:'n',l:"Travailleur",r:r=>`${r.e.first||r.e.fn||'Emp'} ${r.e.last||''}`},{k:'d',l:"Jours",a:'right',r:r=>r.dy},{k:'v',l:"Valeur",a:'right',r:r=>fmt(r.val)},{k:'t',l:"Total",a:'right',b:1,r:r=>fmt(r.tot)},{k:'w',l:"Trav.",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.pW)}</span>},{k:'e',l:"Empl.",a:'right',r:r=><span style={{color:'#4ade80'}}>{fmt(r.pE)}</span>},{k:'x',l:"Exon.",a:'center',r:r=>r.exonOK?<span style={{color:'#4ade80'}}>‚úÖ</span>:<span style={{color:'#ef4444'}}>‚ö†</span>}]} data={gen?.ord||[]}/>:<div style={{padding:40,textAlign:'center',color:'#5e5c56',fontSize:13}}>G√©n√©rez une commande</div>}
    </C>
    </div>
  </div>;
}

function EnvoiMod({s,d}){
  const ae=s.emps||[];const [envois,setEnvois]=useState([]);
  const [f,setF]=useState({type:"fiche",mois:MN[new Date().getMonth()],annee:new Date().getFullYear(),mode:'email'});
  const add=()=>{const ts=Date.now();setEnvois(p=>[{...f,id:"ENV-"+ts,date:new Date().toISOString().split('T')[0],count:ae.length,status:'sent'},...p]);};
  
  return <div>
    <PH title="Envoi Documents" sub="Fiches de paie, attestations ‚Äî Email, portail, courrier"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Envois ce mois",v:envois.length,c:'#60a5fa'},{l:"Travailleurs",v:ae.length,c:'#c6a34e'},{l:"Mode principal",v:"Email",c:'#4ade80'},{l:"Taux d√©livr√©",v:"100%",c:'#a78bfa'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'300px 1fr',gap:18}}>
      <C><ST>Nouvel envoi</ST>
        <I label="Type" value={f.type} onChange={v=>setF({...f,type:v})} options={[{v:"fiche",l:"Fiches de paie"},{v:"fiscal",l:"Fiches fiscales 281.10"},{v:"attestation",l:"Attestations"},{v:"info",l:"Communication RH"}]}/>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
          <I label="Mois" value={f.mois} onChange={v=>setF({...f,mois:v})} options={MN.map(m=>({v:m,l:m}))}/>
          <I label="Ann√©e" type="number" value={f.annee} onChange={v=>setF({...f,annee:+v})}/>
        </div>
        <I label="Mode" value={f.mode} onChange={v=>setF({...f,mode:v})} style={{marginTop:9}} options={[{v:"email",l:"Email individuel"},{v:"portail",l:"Portail self-service"},{v:"courrier",l:"Courrier postal"}]}/>
        <B onClick={add} style={{width:'100%',marginTop:14}}>Envoyer √† {ae.length} travailleurs</B>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Historique envois</div></div>
        {envois.length>0?<Tbl cols={[
          {k:'t',l:"Type",b:1,r:r=>r.type},
          {k:'p',l:"P√©riode",r:r=>`${r.mois} ${r.annee}`},
          {k:'m',l:"Mode",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:"rgba(74,222,128,.1)",color:'#4ade80'}}>{r.mode}</span>},
          {k:'n',l:"Destinataires",a:'right',r:r=>r.count},
          {k:'d',l:"Date",r:r=>r.date},
          {k:'s',l:"Statut",r:r=><span style={{color:'#4ade80'}}>‚úì Envoy√©</span>},
        ]} data={envois}/>:<div style={{padding:40,textAlign:'center',color:'#5e5c56'}}>Aucun envoi</div>}
      </C>
    </div>
  </div>;
}


function DRSMod({s,d}){
  const ae=s.emps||[];const [tab,setTab]=useState('generate');
  const [sector,setSector]=useState('chomage');
  const sectors=[{v:"chomage",l:"Ch√¥mage (C1)",d:"Situation familiale, historique emploi"},{v:"inami",l:"INAMI (L1)",d:"Incapacit√© travail, maternit√©"},{v:"pension",l:"Pension (P1)",d:"Carri√®re, droits pension"},{v:"vacances",l:"Vacances annuelles",d:"Attestation de vacances"},{v:"allocations",l:"Allocations familiales",d:"Composition m√©nage"}];
  
  return <div>
    <PH title="DRS ‚Äî D√©clarations Risques Sociaux" sub="Flux √©lectroniques ONSS ‚Äî Ch√¥mage, INAMI, Pension"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:18}}>
      {sectors.map((sec,i)=>
        <div key={i} onClick={()=>setSector(sec.v)} style={{padding:'14px 12px',background:sector===sec.v?'rgba(198,163,78,.12)':'rgba(198,163,78,.04)',borderRadius:10,border:sector===sec.v?'2px solid rgba(198,163,78,.4)':'1px solid rgba(198,163,78,.08)',cursor:'pointer',textAlign:'center'}}>
          <div style={{fontSize:12,fontWeight:600,color:sector===sec.v?'#c6a34e':'#e8e6e0'}}>{sec.l}</div>
          <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{sec.d}</div>
        </div>
      )}
    </div>
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"generate",l:"G√©n√©rer DRS"},{v:"history",l:"Historique"},{v:"scenarios",l:"Sc√©narios ASR"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    {tab==='generate'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>D√©claration {sectors.find(s2=>s2.v===sector)?.l}</ST>
        <I label="Travailleur" value="" onChange={()=>{}} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <I label="Date √©v√©nement" type="date" value="" onChange={()=>{}} style={{marginTop:9}}/>
        {sector==='chomage'&&<I label="Sc√©nario" value="5" onChange={()=>{}} style={{marginTop:9}} options={[{v:"1",l:"Sc√©nario 1 ‚Äî Ch√¥mage complet"},{v:"2",l:"Sc√©nario 2 ‚Äî Ch√¥mage temporaire"},{v:"3",l:"Sc√©nario 3 ‚Äî Pr√©pension/RCC"},{v:"5",l:"Sc√©nario 5 ‚Äî Mensuel CT"},{v:"6",l:"Sc√©nario 6 ‚Äî Mensuel CT √©co"}]}/>}
        {sector==='inami'&&<I label="Type" value="incap" onChange={()=>{}} style={{marginTop:9}} options={[{v:"incap",l:"Incapacit√© de travail"},{v:"mat",l:"Repos de maternit√©"},{v:"pat",l:"Cong√© de paternit√©"},{v:"adop",l:"Cong√© d\'adoption"}]}/>}
        <B style={{width:'100%',marginTop:14}}>G√©n√©rer flux DRS</B>
      </C>
      <C><ST>Informations</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{l:"Canal",v:"Batch ou portail s√©curit√© sociale"},{l:"Format",v:"XML structur√© (sch√©ma ONSS)"},{l:"D√©lai",v:"Dans les 5 jours ouvrables"},{l:"Accus√©",v:"Ticket de r√©ception automatique"},{l:"Correction",v:"Annulation + nouvelle d√©claration"}].map((r,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <span>{r.l}</span><span style={{fontWeight:600,color:'#e8e6e0'}}>{r.v}</span>
            </div>
          )}
        </div>
      </C>
    </div>}
    {tab==='history'&&<C><div style={{padding:20,textAlign:'center',color:'#5e5c56'}}>Aucune DRS g√©n√©r√©e dans cette session</div></C>}
    {tab==='scenarios'&&<C><ST>Sc√©narios ASR (Application Sociale Risque)</ST>
      {[{s:'Sc√©nario 1',d:"D√©but ch√¥mage complet apr√®s fin de contrat",t:'C4 obligatoire'},{s:'Sc√©nario 2',d:"Ch√¥mage temporaire ‚Äî d√©claration initiale",t:'Notification ONEM'},{s:'Sc√©nario 3',d:"RCC/Pr√©pension ‚Äî d√©but p√©riode",t:'C4-RCC'},{s:'Sc√©nario 5',d:"D√©claration mensuelle ch√¥mage temporaire",t:'Mensuel'},{s:'Sc√©nario 6',d:"D√©claration mensuelle CT √©conomique",t:'Mensuel'},{s:'Sc√©nario 10',d:"Incapacit√© de travail > 28 jours",t:'Mutuelle/INAMI'}].map((r,i)=>
        <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
          <div><b style={{color:'#c6a34e'}}>{r.s}</b><div style={{fontSize:10.5,color:'#9e9b93'}}>{r.d}</div></div>
          <span style={{fontSize:10,padding:'2px 8px',borderRadius:4,background:"rgba(96,165,250,.1)",color:'#60a5fa'}}>{r.t}</span>
        </div>
      )}
    </C>}
  </div>;
}


function FichesMod({s,d}){
  const ae=s.emps||[];const [mois,setMois]=useState(new Date().getMonth());const [yr,setYr]=useState(new Date().getFullYear());
  const data=ae.map(e=>{const p=calc(e,DPER,s.co);return{e,p};});
  const totGross=data.reduce((a,r)=>a+r.p.gross,0);const totNet=data.reduce((a,r)=>a+r.p.net,0);
  
  return <div>
    <PH title="Fiches de Paie" sub="G√©n√©ration mensuelle ‚Äî Consultation et envoi"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Fiches √† g√©n√©rer",v:ae.length,c:'#60a5fa'},{l:"Brut total",v:fmt(totGross),c:'#e8e6e0'},{l:"Net total",v:fmt(totNet),c:'#4ade80'},{l:"P√©riode",v:MN[mois]+' '+yr,c:'#c6a34e'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'flex',gap:9,marginBottom:16}}>
      <I label="Mois" value={mois} onChange={v=>setMois(+v)} options={MN.map((m,i)=>({v:i,l:m}))}/>
      <I label="Ann√©e" type="number" value={yr} onChange={v=>setYr(+v)}/>
    </div>
    <C style={{padding:0,overflow:'hidden'}}>
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)',display:'flex',justifyContent:'space-between'}}>
        <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Fiches {MN[mois]} {yr}</div>
        <B>G√©n√©rer toutes les fiches</B>
      </div>
      <Tbl cols={[
        {k:'n',l:"Travailleur",b:1,r:r=>`${r.e.first||r.e.fn||'Emp'} ${r.e.last||''}`},
        {k:'st',l:"Statut",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:r.e.statut==='ouvrier'?'rgba(248,113,113,.1)':'rgba(96,165,250,.1)',color:r.e.statut==='ouvrier'?'#f87171':'#60a5fa'}}>{r.e.statut||'employ√©'}</span>},
        {k:'g',l:"Brut",a:'right',r:r=>fmt(r.p.gross)},
        {k:'o',l:"ONSS",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.p.onssNet)}</span>},
        {k:'t',l:"PP",a:'right',r:r=><span style={{color:'#a78bfa'}}>{fmt(r.p.tax)}</span>},
        {k:'ne',l:"Net",a:'right',r:r=><span style={{fontWeight:600,color:'#4ade80'}}>{fmt(r.p.net)}</span>},
        {k:'a',l:"",r:r=><span style={{color:'#60a5fa',cursor:'pointer',fontSize:10}}>üìÑ</span>},
      ]} data={data}/>
      <div style={{padding:'12px 18px',borderTop:'1px solid rgba(139,115,60,.1)',display:'flex',justifyContent:'flex-end',gap:16,fontSize:12}}>
        <span>Total brut: <b style={{color:'#e8e6e0'}}>{fmt(totGross)}</b></span>
        <span>Total net: <b style={{color:'#4ade80'}}>{fmt(totNet)}</b></span>
      </div>
    </C>
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INTERFACE POINTAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function PointageMod({s,d}){
  const [tab,setTab]=useState('pointage');
  const [source,setSource]=useState('aureus_pointage');
  const [per,setPer]=useState({m:new Date().getMonth()+1,y:new Date().getFullYear()});
  const [imported,setImported]=useState([]);
  const [selEmp,setSelEmp]=useState(null);
  const [dailyView,setDailyView]=useState(false);
  const ae=s.emps.filter(e=>e.status==='active');
  const sources=[
    {v:"aureus_pointage",l:"Aureus Pointage ‚Äî Enregistrement des entr√©es et sorties (ateliers, bureaux, chantiers)"},
    {v:"aureus_titres_services",l:"Aureus Titres-Services ‚Äî Gestion des soci√©t√©s de titres-services (agendas, prestations, feuilles de route)"},
    {v:"aureus_aide_domicile",l:"Aureus Aide √† Domicile ‚Äî Gestion des aides m√©nag√®res et soins √† domicile (plannings, prestations, km)"},
    {v:"aureus_paie",l:"Aureus Paie ‚Äî Calcul complet des salaires (ONSS, pr√©compte, DMFA, Belcotax, documents sociaux)"},
    {v:"aureus_portail",l:"Aureus Portail ‚Äî Espace en ligne pour employeurs et travailleurs (self-service, demandes, documents)"},
    {v:"aureus_mobile",l:"Aureus Mobile ‚Äî Application smartphone pour travailleurs itin√©rants (pointage GPS, absences)"},
    {v:"aureus_chantier",l:"Aureus Chantier ‚Äî Borne de pointage sur chantier (entr√©e/sortie en temps r√©el)"},
    {v:"aureus_tableau_bord",l:"Aureus Tableau de Bord ‚Äî Chiffres cl√©s de votre entreprise (graphiques, KPI, reporting)"},
    {v:"horloge",l:"Horloge pointeuse ‚Äî Appareil de pointage physique (badge, empreinte, reconnaissance)"},
    {v:"tachy",l:"Tachygraphe ‚Äî Donn√©es de conduite pour le transport routier"},
    {v:"csv",l:"Fichier externe ‚Äî Import CSV, TXT ou XML depuis un autre logiciel"},
    {v:"manual",l:"Saisie manuelle ‚Äî Encodage direct des prestations √† la main"},
  ];

  // Generate realistic daily punch data
  const genDaily=(emp)=>{
    const daysInMonth=new Date(per.y,per.m,0).getDate();
    const days=[];
    for(let i=1;i<=daysInMonth;i++){
      const dt=new Date(per.y,per.m-1,i);
      const dow=dt.getDay();
      const isWE=dow===0||dow===6;
      const isFerie=[1,21].includes(i)&&per.m===7; // example
      if(isWE){days.push({d:i,dow,type:"we",in1:'',out1:'',in2:'',out2:'',h:0,pause:0,note:"Week-end"});continue;}
      if(isFerie){days.push({d:i,dow,type:"ferie",in1:'',out1:'',in2:'',out2:'',h:0,pause:0,note:"Jour f√©ri√©"});continue;}
      const sick=Math.random()<0.04;const conge=Math.random()<0.06;
      if(sick){days.push({d:i,dow,type:"maladie",in1:'',out1:'',in2:'',out2:'',h:0,pause:0,note:"Certificat m√©dical"});continue;}
      if(conge){days.push({d:i,dow,type:"conge",in1:'',out1:'',in2:'',out2:'',h:7.6,pause:0,note:"Cong√© annuel"});continue;}
      const hIn=7+Math.floor(Math.random()*2);const mIn=Math.floor(Math.random()*60);
      const pauseS=12;const pauseE=13;
      const hOut=15+Math.floor(Math.random()*3);const mOut=Math.floor(Math.random()*60);
      const totH=((pauseS-hIn)+(hOut-pauseE)+(mOut-mIn)/60);
      const sup=Math.max(0,totH-7.6);
      days.push({d:i,dow,type:sup>0.5?'sup':'normal',
        in1:`${String(hIn).padStart(2,"0")}:${String(mIn).padStart(2,"0")}`,
        out1:`${pauseS}:00`,
        in2:`${pauseE}:00`,
        out2:`${String(hOut).padStart(2,"0")}:${String(mOut).padStart(2,"0")}`,
        h:Math.round(totH*100)/100,pause:60,sup:Math.round(sup*100)/100,
        note:sup>0.5?`${sup.toFixed(1)}h sup.`:''});
    }
    return days;
  };

  const run=()=>{
    const data=ae.map(emp=>{
      const daily=genDaily(emp);
      const jrs=daily.filter(d=>['normal',"sup","conge"].includes(d.type)).length;
      const hN=daily.reduce((a,d)=>a+Math.min(d.h,7.6),0);
      const hS=daily.reduce((a,d)=>a+(d.sup||0),0);
      const abs=daily.filter(d=>d.type==='maladie').length;
      const conges=daily.filter(d=>d.type==='conge').length;
      return{id:uid(),emp:`${emp.first} ${emp.last}`,eid:emp.id,source:sources.find(x=>x.v===source)?.l,
        period:`${MN[per.m-1]} ${per.y}`,jrs,hN:Math.round(hN),hS:Math.round(hS*10)/10,
        hNu:Math.floor(Math.random()*4),hD:Math.floor(Math.random()*3),
        ret:Math.floor(Math.random()*3),abs,conges,daily,
        status:Math.random()>0.2?'valid√©':'en_attente',at:new Date().toISOString()};
    });
    setImported([...data,...imported]);
  };

  const DOWS=['Dim',"Lun","Mar","Mer","Jeu","Ven","Sam"];
  const typeColors={normal:"#4ade80",sup:'#c6a34e',maladie:'#f87171',conge:'#60a5fa',ferie:'#a78bfa',we:'#3a3930'};
  const typeLabels={normal:"Prest√©",sup:'H.Sup',maladie:'Maladie',conge:'Cong√©',ferie:'F√©ri√©',we:'W-E'};
  
  const selectedData=selEmp?imported.find(r=>r.eid===selEmp):null;

  return <div>
    {/* Tabs */}
    <div style={{display:'flex',gap:4,marginBottom:14}}>
      {[{id:"pointage",l:"‚è± Pointage & Import"},{id:"daily",l:"üìÖ D√©tail journalier"},{id:"anomalies",l:"‚ö† Anomalies"},{id:"portail",l:"üè¢ Portail Employeur"},{id:"stats",l:"üìä Statistiques"}].map(t=>
        <button key={t.id} onClick={()=>setTab(t.id)} style={{padding:'8px 16px',borderRadius:8,fontSize:11.5,fontWeight:tab===t.id?600:400,
          background:tab===t.id?'rgba(198,163,78,.15)':'rgba(255,255,255,.02)',color:tab===t.id?'#c6a34e':'#9e9b93',
          border:tab===t.id?'1px solid rgba(198,163,78,.3)':'1px solid rgba(255,255,255,.04)',cursor:'pointer'}}>{t.l}</button>
      )}
    </div>

    {/* ‚îÄ‚îÄ TAB: POINTAGE & IMPORT ‚îÄ‚îÄ */}
    {tab==='pointage'&&<div style={{display:'grid',gridTemplateColumns:'320px 1fr',gap:18}}>
      <div>
      <C><ST>Import Pointage</ST>
        <I label="Source" value={source} onChange={setSource} options={sources}/>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
          <I label="Mois" value={per.m} onChange={v=>setPer({...per,m:parseInt(v)})} options={MN.map((m,i)=>({v:i+1,l:m}))}/>
          <I label="Ann√©e" type="number" value={per.y} onChange={v=>setPer({...per,y:v})}/>
        </div>
        <B onClick={run} style={{width:'100%',marginTop:14}}>Importer {ae.length} travailleur(s)</B>
        {imported.length>0&&<B v="outline" onClick={()=>{
          imported.forEach(p=>{if(p.status==='en_attente')p.status='valid√©';});
          setImported([...imported]);
          alert('Tous les pointages valid√©s !');
        }} style={{width:'100%',marginTop:8}}>‚úì Valider tous</B>}
        {imported.length>0&&<B v="ghost" onClick={()=>alert('Pointages appliqu√©s aux fiches de paie !')} style={{width:'100%',marginTop:8}}>‚Üí Appliquer aux fiches de paie</B>}
      </C>
      <C style={{marginTop:14}}>
        <div style={{fontSize:11,fontWeight:600,color:'#c6a34e',marginBottom:8}}>R√âSUM√â {MN[per.m-1]} {per.y}</div>
        {imported.length>0?<div style={{fontSize:11.5,color:'#9e9b93',lineHeight:2.2}}>
          <div>Travailleurs: <b style={{color:'#e8e6e0'}}>{imported.filter(p=>p.period===`${MN[per.m-1]} ${per.y}`).length}</b></div>
          <div>Jours prest√©s: <b style={{color:'#4ade80'}}>{imported.filter(p=>p.period===`${MN[per.m-1]} ${per.y}`).reduce((a,p)=>a+p.jrs,0)}</b></div>
          <div>Heures normales: <b style={{color:'#e8e6e0'}}>{imported.filter(p=>p.period===`${MN[per.m-1]} ${per.y}`).reduce((a,p)=>a+p.hN,0)}h</b></div>
          <div>Heures sup.: <b style={{color:'#c6a34e'}}>{imported.filter(p=>p.period===`${MN[per.m-1]} ${per.y}`).reduce((a,p)=>a+p.hS,0).toFixed(1)}h</b></div>
          <div>Absences maladie: <b style={{color:'#f87171'}}>{imported.filter(p=>p.period===`${MN[per.m-1]} ${per.y}`).reduce((a,p)=>a+p.abs,0)}j</b></div>
          <div>Cong√©s: <b style={{color:'#60a5fa'}}>{imported.filter(p=>p.period===`${MN[per.m-1]} ${per.y}`).reduce((a,p)=>a+p.conges,0)}j</b></div>
          <div style={{borderTop:'1px solid rgba(255,255,255,.05)',paddingTop:4}}>Valid√©s: <b style={{color:'#4ade80'}}>{imported.filter(p=>p.status==='valid√©').length}</b> | En attente: <b style={{color:'#c6a34e'}}>{imported.filter(p=>p.status==='en_attente').length}</b></div>
        </div>:<div style={{color:'#5e5c56',fontSize:11}}>Aucun pointage import√©</div>}
      </C>
      <C style={{marginTop:14}}>
        <div style={{fontSize:10.5,color:'#c6a34e',fontWeight:600,marginBottom:6}}>Sources support√©es</div>
        {sources.map(x=><div key={x.v} style={{fontSize:10.5,color:'#9e9b93',padding:'2px 0'}}>‚Ä¢ {x.l}</div>)}
        <div style={{marginTop:10,fontSize:10,color:'#60a5fa',lineHeight:1.5,padding:8,background:"rgba(96,165,250,.04)",borderRadius:6}}>
          <b>Formats accept√©s :</b> CSV, TXT, XML (Aureus Pointage, Aureus Titres-Services, Aureus Aide √† Domicile), horloge pointeuse, tachygraphe, application mobile. Les jours prest√©s, heures suppl√©mentaires, nuit, dimanche et absences sont calcul√©s automatiquement.
        </div>
      </C>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Pointages ‚Äî {MN[per.m-1]} {per.y}</div>
          <div style={{fontSize:10,color:'#5e5c56'}}>{imported.length} enregistrement(s)</div>
        </div>
        <Tbl cols={[
          {k:'e',l:"Travailleur",b:1,r:r=>r.emp},
          {k:'st',l:"Statut",r:r=><span style={{fontSize:10,padding:'2px 7px',borderRadius:4,fontWeight:600,
            background:r.status==='valid√©'?'rgba(74,222,128,.1)':'rgba(198,163,78,.1)',
            color:r.status==='valid√©'?'#4ade80':'#c6a34e'}}>{r.status==='valid√©'?'‚úì Valid√©':'‚è≥ Attente'}</span>},
          {k:'s',l:"Source",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:"rgba(96,165,250,.1)",color:'#60a5fa'}}>{r.source}</span>},
          {k:'j',l:"Jours",a:'right',r:r=><b>{r.jrs}</b>},
          {k:'h',l:"H.norm",a:'right',r:r=>`${r.hN}h`},
          {k:'hs',l:"H.sup",a:'right',r:r=>r.hS>0?<span style={{color:'#c6a34e',fontWeight:600}}>{r.hS}h</span>:'‚Äî'},
          {k:'hn',l:"Nuit",a:'right',r:r=>r.hNu>0?<span style={{color:'#a78bfa'}}>{r.hNu}h</span>:'‚Äî'},
          {k:'a',l:"Maladie",a:'right',r:r=>r.abs>0?<span style={{color:'#f87171',fontWeight:600}}>{r.abs}j</span>:'0'},
          {k:'c',l:"Cong√©s",a:'right',r:r=>r.conges>0?<span style={{color:'#60a5fa'}}>{r.conges}j</span>:'0'},
          {k:'v',l:"",a:'right',r:r=><B v="ghost" style={{padding:'3px 8px',fontSize:10}} onClick={()=>{setSelEmp(r.eid);setTab('daily');}}>D√©tail</B>},
        ]} data={imported}/>
      </C>
    </div>}

    {/* ‚îÄ‚îÄ TAB: D√âTAIL JOURNALIER ‚îÄ‚îÄ */}
    {tab==='daily'&&<div>
      <div style={{display:'flex',gap:12,marginBottom:14,alignItems:'center'}}>
        <I label="" value={selEmp||''} onChange={setSelEmp} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))} style={{width:250}}/>
        <div style={{fontSize:12,color:'#9e9b93'}}>{MN[per.m-1]} {per.y}</div>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)',display:'flex',justifyContent:'space-between'}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Feuille de pointage d√©taill√©e</div>
          {selectedData&&<div style={{fontSize:11,color:'#c6a34e'}}>{selectedData.jrs}j ‚Äî {selectedData.hN}h norm. ‚Äî {selectedData.hS}h sup.</div>}
        </div>
        {selectedData?<div style={{overflowX:'auto'}}>
          <table style={{width:'100%',borderCollapse:'collapse',fontSize:11.5}}>
            <thead><tr style={{background:"rgba(198,163,78,.05)"}}>
              {['Jour',"Date","Arriv√©e 1","D√©part 1","Arriv√©e 2","D√©part 2","Pause","Heures","Type","Note"].map(h=>
                <th key={h} style={{textAlign:'left',padding:'10px 12px',fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px',fontWeight:600}}>{h}</th>)}
            </tr></thead>
            <tbody>
              {selectedData.daily.map((day,i)=><tr key={i} style={{background:day.type==='we'?'rgba(255,255,255,.01)':'transparent',borderBottom:'1px solid rgba(255,255,255,.02)',opacity:day.type==='we'?0.4:1}}>
                <td style={{padding:'8px 12px',fontWeight:500}}>{DOWS[day.dow]}</td>
                <td style={{padding:'8px 12px'}}>{String(day.d).padStart(2,"0")}/{String(per.m).padStart(2,"0")}</td>
                <td style={{padding:'8px 12px',color:day.in1?'#4ade80':'#3a3930',fontFamily:'monospace'}}>{day.in1||'‚Äî'}</td>
                <td style={{padding:'8px 12px',color:day.out1?'#e8e6e0':'#3a3930',fontFamily:'monospace'}}>{day.out1||'‚Äî'}</td>
                <td style={{padding:'8px 12px',color:day.in2?'#4ade80':'#3a3930',fontFamily:'monospace'}}>{day.in2||'‚Äî'}</td>
                <td style={{padding:'8px 12px',color:day.out2?'#f87171':'#3a3930',fontFamily:'monospace'}}>{day.out2||'‚Äî'}</td>
                <td style={{padding:'8px 12px',color:'#5e5c56'}}>{day.pause?`${day.pause}min`:'‚Äî'}</td>
                <td style={{padding:'8px 12px',fontWeight:day.h>0?600:400,color:day.h>7.6?'#c6a34e':day.h>0?'#e8e6e0':'#3a3930'}}>{day.h>0?`${day.h.toFixed(1)}h`:'‚Äî'}</td>
                <td style={{padding:'8px 12px'}}><span style={{fontSize:10,padding:'2px 8px',borderRadius:4,background:`${typeColors[day.type]}15`,color:typeColors[day.type],fontWeight:600}}>{typeLabels[day.type]}</span></td>
                <td style={{padding:'8px 12px',fontSize:10.5,color:'#9e9b93'}}>{day.note}</td>
              </tr>)}
            </tbody>
            <tfoot>
              <tr style={{borderTop:'2px solid rgba(198,163,78,.2)',background:"rgba(198,163,78,.04)"}}>
                <td colSpan={7} style={{padding:'12px',fontWeight:700,color:'#c6a34e'}}>TOTAL</td>
                <td style={{padding:'12px',fontWeight:700,color:'#c6a34e'}}>{selectedData.daily.reduce((a,d)=>a+d.h,0).toFixed(1)}h</td>
                <td colSpan={2} style={{padding:'12px',fontSize:11,color:'#9e9b93'}}>
                  {selectedData.daily.filter(d=>d.type==='normal').length} norm. | {selectedData.daily.filter(d=>d.type==='sup').length} sup. | {selectedData.daily.filter(d=>d.type==='maladie').length} mal. | {selectedData.daily.filter(d=>d.type==='conge').length} cng.
                </td>
              </tr>
            </tfoot>
          </table>
        </div>:<div style={{padding:60,textAlign:'center',color:'#5e5c56',fontSize:13}}>S√©lectionnez un travailleur et importez les pointages</div>}
      </C>
      {selectedData&&<div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:10,marginTop:14}}>
        {[{l:"Jours prest√©s",v:selectedData.jrs,c:'#4ade80'},{l:"H. normales",v:`${selectedData.hN}h`,c:'#e8e6e0'},{l:"H. suppl√©mentaires",v:`${selectedData.hS}h`,c:'#c6a34e'},{l:"Maladie",v:`${selectedData.abs}j`,c:'#f87171'},{l:"Cong√©s",v:`${selectedData.conges}j`,c:'#60a5fa'},{l:"R√©gime",v:`${ae.find(e=>e.id===selEmp)?.whWeek||38}h/sem`,c:'#a78bfa'}].map((x,i)=>
          <C key={i} style={{padding:'12px',textAlign:'center'}}><div style={{fontSize:9,color:'#5e5c56',textTransform:'uppercase'}}>{x.l}</div><div style={{fontSize:18,fontWeight:700,color:x.c,marginTop:4}}>{x.v}</div></C>
        )}
      </div>}
    </div>}

    {/* ‚îÄ‚îÄ TAB: ANOMALIES ‚îÄ‚îÄ */}
    {tab==='anomalies'&&<div>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>‚ö† Anomalies d√©tect√©es ‚Äî {MN[per.m-1]} {per.y}</div></div>
        {imported.length>0?<div style={{padding:14}}>
          {imported.filter(p=>p.daily).flatMap(p=>{
            const anomalies=[];
            p.daily.forEach(day=>{
              if(day.h>10)anomalies.push({emp:p.emp,day:`${day.d}/${per.m}`,type:"duree",msg:`Dur√©e ${day.h.toFixed(1)}h > 10h max l√©gal`,sev:"high"});
              if(day.type==='normal'&&day.h<7&&day.h>0)anomalies.push({emp:p.emp,day:`${day.d}/${per.m}`,type:"incomplet",msg:`Seulement ${day.h.toFixed(1)}h (r√©gime 7.6h)`,sev:"medium"});
              if(day.in1&&!day.out2)anomalies.push({emp:p.emp,day:`${day.d}/${per.m}`,type:"pointage",msg:'Pointage sortie manquant',sev:"high"});
              if(day.pause>0&&day.pause<30&&day.h>6)anomalies.push({emp:p.emp,day:`${day.d}/${per.m}`,type:"pause",msg:`Pause ${day.pause}min < 30min obligatoire (>6h)`,sev:"medium"});
            });
            const weekHours={};
            p.daily.forEach(day=>{const wk=Math.ceil(day.d/7);weekHours[wk]=(weekHours[wk]||0)+day.h;});
            Object.entries(weekHours).forEach(([wk,h])=>{if(h>50)anomalies.push({emp:p.emp,day:`Sem.${wk}`,type:"hebdo",msg:`${h.toFixed(1)}h > 50h max absolu hebdo`,sev:"high"});
              else if(h>45)anomalies.push({emp:p.emp,day:`Sem.${wk}`,type:"hebdo",msg:`${h.toFixed(1)}h > 45h (seuil attention)`,sev:"medium"});
            });
            return anomalies;
          }).map((a,i)=><div key={i} style={{display:'flex',gap:12,alignItems:'center',padding:'10px 14px',marginBottom:4,borderRadius:8,
            background:a.sev==='high'?'rgba(248,113,113,.06)':'rgba(198,163,78,.04)',
            border:`1px solid ${a.sev==='high'?'rgba(248,113,113,.15)':'rgba(198,163,78,.1)'}`}}>
            <span style={{fontSize:14}}>{a.sev==='high'?'üî¥':'üü°'}</span>
            <div style={{flex:1}}>
              <div style={{fontWeight:600,fontSize:12,color:'#e8e6e0'}}>{a.emp} ‚Äî {a.day}</div>
              <div style={{fontSize:11,color:'#9e9b93',marginTop:2}}>{a.msg}</div>
            </div>
            <span style={{fontSize:10,padding:'3px 8px',borderRadius:4,background:"rgba(255,255,255,.03)",color:'#5e5c56'}}>{a.type}</span>
          </div>)}
          {imported.filter(p=>p.daily).flatMap(p=>p.daily.filter(d=>d.h>10||d.pause<30&&d.h>6&&d.pause>0)).length===0&&
            <div style={{padding:40,textAlign:'center'}}><span style={{fontSize:36}}>‚úÖ</span><div style={{fontSize:14,color:'#4ade80',marginTop:10}}>Aucune anomalie d√©tect√©e</div></div>}
        </div>:<div style={{padding:60,textAlign:'center',color:'#5e5c56',fontSize:13}}>Importez des pointages pour d√©tecter les anomalies</div>}
      </C>
      <C style={{marginTop:14,padding:'14px 18px'}}>
        <div style={{fontSize:11,fontWeight:600,color:'#c6a34e',marginBottom:8}}>R√®gles de contr√¥le appliqu√©es</div>
        {[
          {r:'Dur√©e journali√®re max',v:"10h (11h max d√©rogation CT)",s:'Loi travail 16/03/1971 art.27'},
          {r:'Dur√©e hebdomadaire max',v:"50h absolue / 38h moyenne",s:'Loi travail art.26bis'},
          {r:'Pause obligatoire',v:"15min apr√®s 6h continu",s:'AR 18/01/1984'},
          {r:'Repos journalier',v:"11h min. entre 2 prestations",s:'Loi travail art.38ter'},
          {r:'Repos hebdomadaire',v:"35h cons√©cutives (24h+11h)",s:'Loi travail art.11'},
          {r:'Heures suppl√©mentaires',v:"D√©passement au-del√† de 9h/j ou 40h/sem",s:'Loi travail art.29'},
          {r:'Enregistrement obligatoire',v:"Pointage entr√©e/sortie pour tous les travailleurs",s:'CJUE C-55/18 du 14/05/2019 + Loi 5/03/2024'},
        ].map((x,i)=><div key={i} style={{display:'grid',gridTemplateColumns:'200px 1fr 200px',gap:8,padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.02)',fontSize:11}}>
          <span style={{color:'#e8e6e0',fontWeight:500}}>{x.r}</span>
          <span style={{color:'#9e9b93'}}>{x.v}</span>
          <span style={{color:'#60a5fa',fontSize:10}}>{x.s}</span>
        </div>)}
      </C>
    </div>}

    {/* ‚îÄ‚îÄ TAB: PORTAIL EMPLOYEUR ‚îÄ‚îÄ */}
    {tab==='portail'&&<PortailEmployeurMod s={s} d={d} per={per}/>}

    {/* ‚îÄ‚îÄ TAB: STATISTIQUES ‚îÄ‚îÄ */}
    {tab==='stats'&&<div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12}}>
        {[
          {l:"Taux de pr√©sence",v:imported.length>0?`${Math.round(imported.reduce((a,p)=>a+p.jrs,0)/(imported.length*21.67)*100)}%`:'‚Äî',c:'#4ade80',ic:'üìä'},
          {l:"Taux absent√©isme",v:imported.length>0?`${(imported.reduce((a,p)=>a+p.abs,0)/(imported.length*21.67)*100).toFixed(1)}%`:'‚Äî',c:'#f87171',ic:'üìâ'},
          {l:"Heures sup. moy.",v:imported.length>0?`${(imported.reduce((a,p)=>a+p.hS,0)/imported.length).toFixed(1)}h`:'‚Äî',c:'#c6a34e',ic:'‚è±'},
          {l:"Pointages en attente",v:`${imported.filter(p=>p.status==='en_attente').length}`,c:'#c6a34e',ic:'‚è≥'},
        ].map((x,i)=><C key={i} style={{padding:'16px',textAlign:'center'}}>
          <div style={{fontSize:22,marginBottom:6}}>{x.ic}</div>
          <div style={{fontSize:22,fontWeight:700,color:x.c}}>{x.v}</div>
          <div style={{fontSize:10,color:'#5e5c56',marginTop:4,textTransform:'uppercase'}}>{x.l}</div>
        </C>)}
      </div>
      {imported.length>0&&<C style={{marginTop:14,padding:'14px 18px'}}>
        <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:12}}>R√©partition par travailleur</div>
        {imported.filter(p=>p.period===`${MN[per.m-1]} ${per.y}`).map((p,i)=><div key={i} style={{marginBottom:10}}>
          <div style={{display:'flex',justifyContent:'space-between',marginBottom:4}}>
            <span style={{fontSize:12,fontWeight:500}}>{p.emp}</span>
            <span style={{fontSize:11,color:'#9e9b93'}}>{p.hN+p.hS}h total</span>
          </div>
          <div style={{display:'flex',height:14,borderRadius:7,overflow:'hidden',background:"rgba(255,255,255,.03)"}}>
            <div style={{width:`${p.hN/(p.hN+p.hS+p.hNu+p.abs*7.6||1)*100}%`,background:"#4ade80",transition:'width .3s'}} title={`Normales: ${p.hN}h`}/>
            <div style={{width:`${p.hS/(p.hN+p.hS+p.hNu+p.abs*7.6||1)*100}%`,background:"#c6a34e",transition:'width .3s'}} title={`Sup: ${p.hS}h`}/>
            <div style={{width:`${p.hNu/(p.hN+p.hS+p.hNu+p.abs*7.6||1)*100}%`,background:"#a78bfa",transition:'width .3s'}} title={`Nuit: ${p.hNu}h`}/>
            <div style={{width:`${p.abs*7.6/(p.hN+p.hS+p.hNu+p.abs*7.6||1)*100}%`,background:"#f87171",transition:'width .3s'}} title={`Absence: ${p.abs}j`}/>
          </div>
          <div style={{display:'flex',gap:14,marginTop:4,fontSize:10,color:'#5e5c56'}}>
            <span><span style={{display:'inline-block',width:8,height:8,borderRadius:'50%',background:"#4ade80",marginRight:4}}/>Norm. {p.hN}h</span>
            <span><span style={{display:'inline-block',width:8,height:8,borderRadius:'50%',background:"#c6a34e",marginRight:4}}/>Sup. {p.hS}h</span>
            <span><span style={{display:'inline-block',width:8,height:8,borderRadius:'50%',background:"#a78bfa",marginRight:4}}/>Nuit {p.hNu}h</span>
            <span><span style={{display:'inline-block',width:8,height:8,borderRadius:'50%',background:"#f87171",marginRight:4}}/>Abs. {p.abs}j</span>
          </div>
        </div>)}
      </C>}
      {imported.length===0&&<C style={{marginTop:14,padding:50,textAlign:'center'}}>
        <div style={{fontSize:36,marginBottom:12}}>üìä</div>
        <div style={{fontSize:14,color:'#5e5c56'}}>Importez des pointages pour voir les statistiques</div>
      </C>}
    </div>}
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PORTAIL EMPLOYEUR ‚Äî Interface client s√©par√©e
//  Acc√®s restreint: l'employeur ne voit QUE ses donn√©es
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function PortailEmployeurMod({s,d,per}){
  const [clientView,setClientView]=useState('accueil');
  const [encodMode,setEncodMode]=useState('mensuel');
  const [selectedMonth,setSelectedMonth]=useState(per?.m||new Date().getMonth()+1);
  const [selectedYear,setSelectedYear]=useState(per?.y||new Date().getFullYear());
  const [encodData,setEncodData]=useState({});
  const [demandes,setDemandes]=useState([]);
  const [msgs,setMsgs]=useState([]);
  const [accessCodes,setAccessCodes]=useState([]);
  const ae=s.emps.filter(e=>e.status==='active');

  // Simulate access code generation for client
  const genAccess=()=>{
    const code={id:uid(),client:s.co.name,login:`client_${s.co.name?.toLowerCase().replace(/\s/g,"_")||'demo'}`,
      pwd:`ASP${Math.random().toString(36).substring(2,8).toUpperCase()}`,
      url:`https://portail.aureus-social.be/client/${uid().substring(0,8)}`,
      created:new Date().toISOString(),perms:['encodage',"consultation","demandes","messages"],active:true};
    setAccessCodes([code,...accessCodes]);
  };

  // Absence types
  const absTypes=[
    {v:"conge_annuel",l:"Cong√© annuel",ic:'üèñ'},
    {v:"maladie",l:"Maladie (certificat)",ic:'üè•'},
    {v:"petit_chomage",l:"Petit ch√¥mage",ic:'üìã'},
    {v:"sans_solde",l:"Cong√© sans solde",ic:'‚è∏'},
    {v:"formation",l:"Cong√© formation",ic:'üéì'},
    {v:"maternite",l:"Maternit√©",ic:'üë∂'},
    {v:"paternite",l:"Paternit√© / Naissance",ic:'üë®‚Äçüëß'},
    {v:"credit_temps",l:"Cr√©dit-temps",ic:'‚è±'},
    {v:"accident_travail",l:"Accident de travail",ic:'‚ö†'},
    {v:"chomage_eco",l:"Ch√¥mage √©conomique",ic:'üìâ'},
  ];

  const toggleEncod=(eid,day,type)=>{
    const key=`${eid}_${day}`;
    setEncodData(prev=>{
      const n={...prev};
      if(n[key]===type)delete n[key]; else n[key]=type;
      return n;
    });
  };

  const submitDemande=(emp,type,dateFrom,dateTo,note)=>{
    setDemandes([{id:uid(),emp,type:absTypes.find(a=>a.v===type)?.l||type,ic:absTypes.find(a=>a.v===type)?.ic||'üìã',from:dateFrom,to:dateTo,note,status:'en_attente',at:new Date().toISOString()},...demandes]);
  };

  const daysInMonth=new Date(selectedYear,selectedMonth,0).getDate();

  return <div>
    {/* ‚îÄ‚îÄ Admin view: manage client portal access ‚îÄ‚îÄ */}
    <C style={{padding:'14px 18px',marginBottom:14}}>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
        <div>
          <div style={{fontWeight:700,fontSize:15,color:'#e8e6e0'}}>üè¢ Portail Employeur ‚Äî {s.co.name}</div>
          <div style={{fontSize:11,color:'#5e5c56',marginTop:2}}>Interface d'acc√®s pour votre client ‚Ä¢ Donn√©es isol√©es de votre back-office</div>
        </div>
        <div style={{display:'flex',gap:8}}>
          <B v="outline" onClick={genAccess}>üîë G√©n√©rer acc√®s client</B>
          <B onClick={()=>d({type:"MODAL",m:{w:700,c:<div>
            <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 14px',fontFamily:"'Cormorant Garamond',serif"}}>üîê Architecture de s√©curit√©</h2>
            <div style={{fontSize:12,color:'#9e9b93',lineHeight:1.8}}>
              {[
                {t:'Isolation des donn√©es',d:"Chaque client acc√®de uniquement √† son dossier via un identifiant unique. Aucun acc√®s aux donn√©es des autres clients ni √† votre back-office bureau social."},
                {t:'Authentification',d:"Login + mot de passe auto-g√©n√©r√© + lien unique par client. Authentification √† 2 facteurs recommand√©e (SMS/email)."},
                {t:'Permissions granulaires',d:"L'employeur peut: encoder prestations, soumettre demandes d'absence, consulter fiches de paie, envoyer messages. Il ne peut PAS: modifier salaires, acc√©der aux calculs, voir les tarifs bureau social."},
                {t:'Tra√ßabilit√©',d:"Toute action du client est horodat√©e et trac√©e. Vous voyez en temps r√©el ce qu'il a encod√© et quand."},
                {t:'RGPD',d:"Donn√©es h√©berg√©es en Belgique, chiffr√©es en transit (TLS 1.3) et au repos (AES-256). Politique de r√©tention conforme RGPD. DPO: Aureus IA SPRL."},
              ].map((x,i)=><div key={i} style={{marginBottom:12,padding:10,background:"rgba(198,163,78,.03)",borderRadius:6}}>
                <div style={{fontWeight:600,color:'#c6a34e',fontSize:12}}>{x.t}</div>
                <div style={{fontSize:11,color:'#9e9b93',marginTop:3}}>{x.d}</div>
              </div>)}
            </div>
            <B v="outline" onClick={()=>d({type:"MODAL",m:null})} style={{marginTop:10}}>Fermer</B>
          </div>}})}>üîê Architecture s√©curit√©</B>
        </div>
      </div>
    </C>

    {/* Access codes panel */}
    {accessCodes.length>0&&<C style={{padding:'14px 18px',marginBottom:14}}>
      <div style={{fontSize:11,fontWeight:600,color:'#c6a34e',marginBottom:8}}>üîë Acc√®s client g√©n√©r√©s</div>
      {accessCodes.map((ac,i)=><div key={i} style={{display:'grid',gridTemplateColumns:'200px 180px 120px 1fr 80px',gap:12,padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',alignItems:'center',fontSize:11.5}}>
        <div><span style={{color:'#9e9b93'}}>URL:</span> <span style={{color:'#60a5fa',fontFamily:'monospace',fontSize:10}}>{ac.url.substring(0,35)}...</span></div>
        <div><span style={{color:'#9e9b93'}}>Login:</span> <b style={{color:'#e8e6e0'}}>{ac.login}</b></div>
        <div><span style={{color:'#9e9b93'}}>Pwd:</span> <b style={{color:'#c6a34e',fontFamily:'monospace'}}>{ac.pwd}</b></div>
        <div style={{fontSize:10,color:'#5e5c56'}}>Perms: {ac.perms.join(', ')}</div>
        <span style={{fontSize:10,padding:'2px 8px',borderRadius:4,background:"rgba(74,222,128,.1)",color:'#4ade80',fontWeight:600,textAlign:'center'}}>Actif</span>
      </div>)}
    </C>}

    {/* Client portal preview tabs */}
    <div style={{display:'flex',gap:4,marginBottom:14}}>
      {[{id:"accueil",l:"üè† Accueil client"},{id:"encodage",l:"üìù Encodage prestations"},{id:"absences",l:"üèñ Demandes absences"},{id:"fiches",l:"üìÑ Fiches de paie"},{id:"messages",l:"üí¨ Messages"},{id:"suivi",l:"üìä Suivi bureau social"}].map(t=>
        <button key={t.id} onClick={()=>setClientView(t.id)} style={{padding:'7px 14px',borderRadius:7,fontSize:10.5,fontWeight:clientView===t.id?600:400,
          background:clientView===t.id?'rgba(96,165,250,.12)':'rgba(255,255,255,.02)',color:clientView===t.id?'#60a5fa':'#9e9b93',
          border:clientView===t.id?'1px solid rgba(96,165,250,.25)':'1px solid rgba(255,255,255,.04)',cursor:'pointer'}}>{t.l}</button>
      )}
    </div>

    {/* Simulated client portal */}
    <C style={{padding:0,overflow:'hidden',border:'1px solid rgba(96,165,250,.15)'}}>
      <div style={{padding:'12px 18px',background:"linear-gradient(135deg,rgba(96,165,250,.08),rgba(198,163,78,.05))",borderBottom:'1px solid rgba(96,165,250,.1)',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
        <div style={{display:'flex',alignItems:'center',gap:10}}>
          <span style={{fontSize:16}}>üè¢</span>
          <div>
            <div style={{fontWeight:600,fontSize:13,color:'#e8e6e0'}}>{s.co.name} ‚Äî Portail Employeur</div>
            <div style={{fontSize:9.5,color:'#5e5c56'}}>Vue client ‚Ä¢ Donn√©es isol√©es ‚Ä¢ Aureus Social Pro</div>
          </div>
        </div>
        <div style={{fontSize:10,color:'#60a5fa',padding:'3px 10px',borderRadius:4,background:"rgba(96,165,250,.1)"}}>üë§ {s.co.name}</div>
      </div>

      <div style={{padding:18}}>
        {/* ‚îÄ‚îÄ Accueil client ‚îÄ‚îÄ */}
        {clientView==='accueil'&&<div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
            {[
              {l:"Travailleurs actifs",v:ae.length,c:'#4ade80',ic:'üë•'},
              {l:"Prestations √† encoder",v:`${MN[selectedMonth-1]}`,c:'#c6a34e',ic:'üìù'},
              {l:"Demandes en cours",v:demandes.filter(d=>d.status==='en_attente').length,c:'#60a5fa',ic:'üìã'},
              {l:"Messages non lus",v:0,c:'#a78bfa',ic:'üí¨'},
            ].map((x,i)=><div key={i} style={{padding:14,background:"rgba(255,255,255,.02)",borderRadius:8,textAlign:'center',border:'1px solid rgba(255,255,255,.04)'}}>
              <div style={{fontSize:22,marginBottom:4}}>{x.ic}</div>
              <div style={{fontSize:20,fontWeight:700,color:x.c}}>{x.v}</div>
              <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{x.l}</div>
            </div>)}
          </div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14}}>
            <div style={{padding:14,background:"rgba(198,163,78,.04)",borderRadius:8,border:'1px solid rgba(198,163,78,.08)'}}>
              <div style={{fontWeight:600,fontSize:12,color:'#c6a34e',marginBottom:8}}>üìÖ √âch√©ances</div>
              {[
                {d:"Avant le 5",l:`Encodage prestations ${MN[selectedMonth-1]}`,u:true},
                {d:"Le 25",l:"Dernier d√©lai modifications paie"},
                {d:"Fin du mois",l:"Fiches de paie disponibles"},
              ].map((x,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:11.5}}>
                <span style={{color:'#9e9b93'}}>{x.d}</span>
                <span style={{color:x.u?'#c6a34e':'#e8e6e0',fontWeight:x.u?600:400}}>{x.l}</span>
              </div>)}
            </div>
            <div style={{padding:14,background:"rgba(96,165,250,.04)",borderRadius:8,border:'1px solid rgba(96,165,250,.08)'}}>
              <div style={{fontWeight:600,fontSize:12,color:'#60a5fa',marginBottom:8}}>üìã Actions rapides</div>
              {[
                {l:"Encoder les prestations du mois",a:()=>setClientView('encodage')},
                {l:"Demander un cong√© / absence",a:()=>setClientView('absences')},
                {l:"Consulter les fiches de paie",a:()=>setClientView('fiches')},
                {l:"Envoyer un message",a:()=>setClientView('messages')},
              ].map((x,i)=><div key={i} onClick={x.a} style={{padding:'7px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:11.5,color:'#60a5fa',cursor:'pointer'}}>{x.l} ‚Üí</div>)}
            </div>
          </div>
        </div>}

        {/* ‚îÄ‚îÄ Encodage prestations ‚îÄ‚îÄ */}
        {clientView==='encodage'&&<div>
          <div style={{display:'flex',gap:12,marginBottom:14,alignItems:'center'}}>
            <I label="" value={selectedMonth} onChange={v=>setSelectedMonth(parseInt(v))} options={MN.map((m,i)=>({v:i+1,l:m}))} style={{width:140}}/>
            <I label="" type="number" value={selectedYear} onChange={v=>setSelectedYear(v)} style={{width:100}}/>
            <I label="" value={encodMode} onChange={setEncodMode} options={[{v:"mensuel",l:"Vue mensuelle (r√©sum√©)"},{v:"journalier",l:"Vue journali√®re (d√©tail)"}]} style={{width:250}}/>
          </div>

          {encodMode==='mensuel'&&<div style={{overflowX:'auto'}}>
            <table style={{width:'100%',borderCollapse:'collapse',fontSize:11.5}}>
              <thead><tr style={{background:"rgba(198,163,78,.05)"}}>
                {['Travailleur',"Jours prest√©s","H. normales","H. sup.","H. nuit","H. dim/JF","Maladie","Cong√©","Autre abs.","Note"].map(h=>
                  <th key={h} style={{textAlign:'left',padding:'10px 10px',fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px',fontWeight:600}}>{h}</th>)}
              </tr></thead>
              <tbody>
                {ae.map((emp,i)=>{
                  const k=`${emp.id}_${selectedMonth}`;
                  const data=encodData[k]||{jrs:21,hN:159.6,hS:0,hNu:0,hD:0,mal:0,cng:0,autr:0,note:""};
                  return <tr key={i} style={{borderBottom:'1px solid rgba(255,255,255,.03)'}}>
                    <td style={{padding:'8px 10px',fontWeight:500}}>{emp.first} {emp.last}</td>
                    {['jrs',"hN","hS","hNu","hD","mal","cng","autr"].map(f=><td key={f} style={{padding:'4px 6px'}}>
                      <input type="number" value={data[f]||0} onChange={e=>{const nd={...data,[f]:parseFloat(e.target.value)||0};setEncodData({...encodData,[k]:nd});}}
                        style={{width:60,padding:'5px 6px',borderRadius:4,border:'1px solid rgba(255,255,255,.08)',background:"rgba(255,255,255,.03)",color:'#e8e6e0',fontSize:11.5,textAlign:'right'}}/>
                    </td>)}
                    <td style={{padding:'4px 6px'}}><input type="text" value={data.note||''} onChange={e=>{const nd={...data,note:e.target.value};setEncodData({...encodData,[k]:nd});}}
                      style={{width:'100%',padding:'5px 6px',borderRadius:4,border:'1px solid rgba(255,255,255,.08)',background:"rgba(255,255,255,.03)",color:'#e8e6e0',fontSize:11}}
                      placeholder="Remarque..."/></td>
                  </tr>;
                })}
              </tbody>
            </table>
          </div>}

          {encodMode==='journalier'&&<div style={{overflowX:'auto'}}>
            <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:8}}>Grille journali√®re ‚Äî {MN[selectedMonth-1]} {selectedYear}</div>
            <table style={{width:'100%',borderCollapse:'collapse',fontSize:10}}>
              <thead><tr style={{background:"rgba(198,163,78,.05)"}}>
                <th style={{padding:'8px 6px',textAlign:'left',fontSize:9.5,color:'#5e5c56',fontWeight:600,position:'sticky',left:0,background:"#0a0d17",zIndex:1}}>Travailleur</th>
                {Array.from({length:daysInMonth},(_,i)=>{
                  const dt=new Date(selectedYear,selectedMonth-1,i+1);
                  const dow=dt.getDay();const isWE=dow===0||dow===6;
                  return <th key={i} style={{padding:'8px 3px',textAlign:'center',fontSize:9,color:isWE?'#3a3930':'#5e5c56',fontWeight:600,minWidth:24,background:isWE?'rgba(255,255,255,.01)':'transparent'}}>
                    <div>{DOWS[dow].charAt(0)}</div><div>{i+1}</div>
                  </th>;
                })}
                <th style={{padding:'8px 6px',textAlign:'right',fontSize:9.5,color:'#c6a34e',fontWeight:600}}>Total</th>
              </tr></thead>
              <tbody>
                {ae.map((emp,ei)=><tr key={ei} style={{borderBottom:'1px solid rgba(255,255,255,.02)'}}>
                  <td style={{padding:'6px',fontWeight:500,fontSize:11,whiteSpace:'nowrap',position:'sticky',left:0,background:"#0a0d17",zIndex:1}}>{emp.first} {emp.last.charAt(0)}.</td>
                  {Array.from({length:daysInMonth},(_,di)=>{
                    const dt=new Date(selectedYear,selectedMonth-1,di+1);
                    const dow=dt.getDay();const isWE=dow===0||dow===6;
                    const key=`${emp.id}_${di+1}`;
                    const val=encodData[key];
                    const colors={P:'#4ade80',M:'#f87171',C:'#60a5fa',F:'#a78bfa',S:'#c6a34e'};
                    return <td key={di} style={{padding:'2px',textAlign:'center',background:isWE?'rgba(255,255,255,.01)':'transparent'}}>
                      {isWE?<span style={{color:'#2a2920',fontSize:9}}>‚Äî</span>:
                      <button onClick={()=>{const types=['P',"M","C","F","S",undefined];const ci=types.indexOf(val);toggleEncod(emp.id,di+1,types[(ci+1)%types.length]);}}
                        style={{width:22,height:22,borderRadius:4,border:'none',fontSize:9,fontWeight:700,cursor:'pointer',
                          background:val?`${colors[val]}20`:'rgba(255,255,255,.03)',color:val?colors[val]:'#3a3930'}}>
                        {val||'¬∑'}
                      </button>}
                    </td>;
                  })}
                  <td style={{padding:'6px',textAlign:'right',fontWeight:600,color:'#c6a34e',fontSize:11}}>
                    {Object.entries(encodData).filter(([k])=>k.startsWith(emp.id+'_')&&encodData[k]==='P').length||0}j
                  </td>
                </tr>)}
              </tbody>
            </table>
            <div style={{display:'flex',gap:16,marginTop:10,fontSize:10}}>
              {[{c:'P',l:"Prest√©",cl:"#4ade80"},{c:'M',l:"Maladie",cl:"#f87171"},{c:'C',l:"Cong√©",cl:"#60a5fa"},{c:'F',l:"F√©ri√©/Formation",cl:"#a78bfa"},{c:'S',l:"H.Sup",cl:"#c6a34e"}].map(x=>
                <span key={x.c} style={{display:'flex',alignItems:'center',gap:4}}>
                  <span style={{display:'inline-block',width:14,height:14,borderRadius:3,background:`${x.cl}20`,color:x.cl,textAlign:'center',fontWeight:700,fontSize:8,lineHeight:'14px'}}>{x.c}</span>
                  <span style={{color:'#9e9b93'}}>{x.l}</span>
                </span>
              )}
              <span style={{color:'#5e5c56',marginLeft:8}}>Cliquez pour cycler les types</span>
            </div>
          </div>}

          <div style={{display:'flex',gap:10,marginTop:14}}>
            <B onClick={()=>alert(`Prestations ${MN[selectedMonth-1]} ${selectedYear} envoy√©es √† votre bureau social ! Vous recevrez une confirmation.`)}>‚úÖ Envoyer au bureau social</B>
            <B v="outline" onClick={()=>alert('Brouillon sauvegard√© !')}>üíæ Sauvegarder brouillon</B>
          </div>
        </div>}

        {/* ‚îÄ‚îÄ Demandes d'absence ‚îÄ‚îÄ */}
        {clientView==='absences'&&<div>
          <div style={{display:'grid',gridTemplateColumns:'350px 1fr',gap:18}}>
            <div>
              <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:10}}>Nouvelle demande</div>
              {(()=>{
                const [absEmp,setAbsEmp]=[ae[0]?.id||'',()=>{}]; // simplified
                return <div>
                  <I label="Travailleur" value={ae[0]?.id||''} onChange={()=>{}} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
                  <I label="Type d'absence" value="conge_annuel" onChange={()=>{}} style={{marginTop:8}} options={absTypes.map(a=>({v:a.v,l:`${a.ic} ${a.l}`}))}/>
                  <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8,marginTop:8}}>
                    <I label="Du" type="date" value={new Date().toISOString().split('T')[0]} onChange={()=>{}}/>
                    <I label="Au" type="date" value={new Date().toISOString().split('T')[0]} onChange={()=>{}}/>
                  </div>
                  <I label="Remarque" type="text" value="" onChange={()=>{}} style={{marginTop:8}}/>
                  <B onClick={()=>submitDemande(`${ae[0]?.first} ${ae[0]?.last}`,"conge_annuel",new Date().toISOString().split('T')[0],new Date().toISOString().split('T')[0],"")} style={{width:'100%',marginTop:12}}>üì§ Soumettre la demande</B>
                </div>;
              })()}
              <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.04)",borderRadius:6,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
                La demande sera transmise √† votre bureau social pour validation. Vous recevrez une notification de confirmation.
              </div>
            </div>
            <div>
              <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:10}}>Historique des demandes</div>
              {demandes.length>0?demandes.map((dem,i)=><div key={i} style={{display:'flex',gap:12,alignItems:'center',padding:'10px 14px',marginBottom:6,borderRadius:8,
                background:dem.status==='en_attente'?'rgba(198,163,78,.04)':dem.status==='approuv√©'?'rgba(74,222,128,.04)':'rgba(248,113,113,.04)',
                border:`1px solid ${dem.status==='en_attente'?'rgba(198,163,78,.1)':dem.status==='approuv√©'?'rgba(74,222,128,.1)':'rgba(248,113,113,.1)'}`}}>
                <span style={{fontSize:18}}>{dem.ic}</span>
                <div style={{flex:1}}>
                  <div style={{fontWeight:600,fontSize:12,color:'#e8e6e0'}}>{dem.emp} ‚Äî {dem.type}</div>
                  <div style={{fontSize:10.5,color:'#9e9b93',marginTop:2}}>{dem.from} ‚Üí {dem.to}</div>
                </div>
                <span style={{fontSize:10,padding:'3px 10px',borderRadius:4,fontWeight:600,
                  background:dem.status==='en_attente'?'rgba(198,163,78,.15)':'rgba(74,222,128,.15)',
                  color:dem.status==='en_attente'?'#c6a34e':'#4ade80'}}>{dem.status==='en_attente'?'‚è≥ En attente':'‚úì Approuv√©'}</span>
                {dem.status==='en_attente'&&<B v="ghost" style={{padding:'3px 8px',fontSize:10}} onClick={()=>{dem.status='approuv√©';setDemandes([...demandes]);}}>Approuver</B>}
              </div>):<div style={{padding:30,textAlign:'center',color:'#5e5c56',fontSize:12}}>Aucune demande</div>}
            </div>
          </div>
        </div>}

        {/* ‚îÄ‚îÄ Fiches de paie consultables ‚îÄ‚îÄ */}
        {clientView==='fiches'&&<div>
          <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:10}}>Fiches de paie ‚Äî Consultation employeur</div>
          {s.pays.length>0?<Tbl cols={[
            {k:'e',l:"Travailleur",b:1,r:r=>r.ename||'‚Äî'},
            {k:'p',l:"P√©riode",r:r=>r.period||'‚Äî'},
            {k:'g',l:"Brut",a:'right',r:r=>fmt(r.gross||0)},
            {k:'n',l:"Net",a:'right',r:r=><span style={{color:'#4ade80',fontWeight:600}}>{fmt(r.net||0)}</span>},
            {k:'c',l:"Co√ªt total",a:'right',r:r=><span style={{color:'#c6a34e'}}>{fmt(r.costTotal||0)}</span>},
          ]} data={s.pays}/>:<div>
            {ae.length>0?<div>
              {ae.map((emp,i)=>{const p=calc(emp,DPER,s.co);return <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'10px 14px',borderBottom:'1px solid rgba(255,255,255,.03)',alignItems:'center'}}>
                <div style={{fontWeight:500}}>{emp.first} {emp.last}</div>
                <div style={{display:'flex',gap:20,fontSize:12}}>
                  <span style={{color:'#9e9b93'}}>Brut: <b style={{color:'#e8e6e0'}}>{fmt(p.gross)}</b></span>
                  <span style={{color:'#9e9b93'}}>Net: <b style={{color:'#4ade80'}}>{fmt(p.net)}</b></span>
                  <span style={{color:'#9e9b93'}}>Co√ªt: <b style={{color:'#c6a34e'}}>{fmt(p.costTotal)}</b></span>
                </div>
                <B v="ghost" style={{padding:'3px 8px',fontSize:10}}>üìÑ PDF</B>
              </div>;})}
            </div>:<div style={{padding:40,textAlign:'center',color:'#5e5c56'}}>Aucune fiche disponible</div>}
          </div>}
          <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.04)",borderRadius:6,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
            <b>Note:</b> L'employeur voit les montants (brut, net, co√ªt total) mais <b>pas le d√©tail des calculs</b> (taux ONSS, bar√®mes, formule PP). Seul le bureau social a acc√®s aux param√®tres de calcul.
          </div>
        </div>}

        {/* ‚îÄ‚îÄ Messages ‚îÄ‚îÄ */}
        {clientView==='messages'&&<div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 350px',gap:18}}>
            <div>
              <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:10}}>Messagerie bureau social</div>
              <div style={{minHeight:300,maxHeight:400,overflowY:'auto',padding:14,background:"rgba(255,255,255,.01)",borderRadius:8,border:'1px solid rgba(255,255,255,.04)'}}>
                {msgs.length>0?msgs.map((m,i)=><div key={i} style={{display:'flex',flexDirection:'column',alignItems:m.from==='client'?'flex-end':'flex-start',marginBottom:10}}>
                  <div style={{maxWidth:'70%',padding:'10px 14px',borderRadius:12,fontSize:12,lineHeight:1.5,
                    background:m.from==='client'?'rgba(96,165,250,.12)':'rgba(198,163,78,.08)',
                    color:m.from==='client'?'#60a5fa':'#c6a34e'}}>
                    {m.text}
                  </div>
                  <div style={{fontSize:9,color:'#3a3930',marginTop:3}}>{m.from==='client'?'Vous':'Bureau social'} ¬∑ {new Date(m.at).toLocaleTimeString('fr-BE',{hour:'2-digit',minute:'2-digit'})}</div>
                </div>):<div style={{textAlign:'center',color:'#3a3930',padding:40}}>Aucun message</div>}
              </div>
              <div style={{display:'flex',gap:8,marginTop:10}}>
                <input id="msgInput" type="text" placeholder="√âcrivez votre message..." style={{flex:1,padding:'10px 14px',borderRadius:8,border:'1px solid rgba(255,255,255,.08)',background:"rgba(255,255,255,.03)",color:'#e8e6e0',fontSize:12}}/>
                <B onClick={()=>{const inp=document.getElementById('msgInput');if(inp?.value){setMsgs([...msgs,{from:'client',text:inp.value,at:new Date().toISOString()}]);inp.value='';
                  setTimeout(()=>setMsgs(p=>[...p,{from:'bureau',text:'Bien re√ßu ! Nous traitons votre demande.',at:new Date().toISOString()}]),1500);
                }}}>Envoyer</B>
              </div>
            </div>
            <div>
              <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:10}}>Messages types</div>
              {[
                'Les prestations du mois sont envoy√©es.',
                'Quand les fiches de paie seront-elles pr√™tes ?',
                'Un employ√© est en maladie depuis aujourd\'hui.',
                'Nouveau travailleur √† d√©clarer.',
                'Question sur le co√ªt d\'un engagement.',
              ].map((m,i)=><div key={i} onClick={()=>{setMsgs(prev=>[...prev,{from:'client',text:m,at:new Date().toISOString()}]);
                setTimeout(()=>setMsgs(p=>[...p,{from:'bureau',text:'Bien re√ßu, nous nous en occupons rapidement !',at:new Date().toISOString()}]),1500);
              }} style={{padding:'8px 12px',marginBottom:4,borderRadius:6,background:"rgba(255,255,255,.02)",border:'1px solid rgba(255,255,255,.04)',fontSize:11,color:'#9e9b93',cursor:'pointer'}}>{m}</div>)}
            </div>
          </div>
        </div>}

        {/* ‚îÄ‚îÄ Suivi bureau social ‚îÄ‚îÄ */}
        {clientView==='suivi'&&<div>
          <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:14}}>üìä Tableau de suivi ‚Äî Tous vos clients</div>
          <div style={{padding:10,background:"rgba(248,113,113,.04)",borderRadius:8,border:'1px solid rgba(248,113,113,.1)',marginBottom:14,fontSize:11.5,color:'#f87171'}}>
            ‚ö† Cette vue est r√©serv√©e au <b>bureau social</b> ‚Äî jamais visible par l'employeur.
          </div>
          <Tbl cols={[
            {k:'c',l:"Client",b:1,r:r=>r.company?.name||r.name||'‚Äî'},
            {k:'e',l:"Travailleurs",a:'right',r:r=>r.emps?.length||0},
            {k:'s',l:"Encodage",r:r=>{const statuses=['‚úÖ Re√ßu',"‚è≥ En attente","‚ùå En retard"];return <span style={{fontSize:10,fontWeight:600,color:Math.random()>0.5?'#4ade80':'#c6a34e'}}>{statuses[Math.floor(Math.random()*3)]}</span>;}},
            {k:'d',l:"Deadline",r:r=>'05/' + String(selectedMonth+1>12?1:selectedMonth+1).padStart(2,"0")},
            {k:'p',l:"Fiches",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:"rgba(74,222,128,.1)",color:'#4ade80'}}>Pr√™tes</span>},
            {k:'m',l:"Messages",a:'right',r:r=><span style={{color:'#a78bfa'}}>{Math.floor(Math.random()*5)}</span>},
          ]} data={s.clients.length>0?s.clients:[{name:s.co.name,emps:ae,company:s.co}]}/>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:12,marginTop:14}}>
            {[
              {l:"Clients ayant encod√©",v:`${Math.floor((s.clients.length||1)*0.6)}/${s.clients.length||1}`,c:'#4ade80',ic:'‚úÖ'},
              {l:"En retard (>5 du mois)",v:Math.ceil((s.clients.length||1)*0.2),c:'#f87171',ic:'‚è∞'},
              {l:"Demandes en attente",v:demandes.filter(d=>d.status==='en_attente').length,c:'#c6a34e',ic:'üìã'},
            ].map((x,i)=><C key={i} style={{padding:'14px',textAlign:'center'}}>
              <div style={{fontSize:20,marginBottom:4}}>{x.ic}</div>
              <div style={{fontSize:20,fontWeight:700,color:x.c}}>{x.v}</div>
              <div style={{fontSize:10,color:'#5e5c56'}}>{x.l}</div>
            </C>)}
          </div>
        </div>}
      </div>
    </C>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PRIMES SYNDICALES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function SyndicalesMod({s,d}){
  const ae=s.emps||[];const [tab,setTab]=useState('calc');
  const [montant,setMontant]=useState(145);
  const n=ae.length;const totAn=n*montant;
  
  return <div>
    <PH title="Primes Syndicales" sub="Cotisation employeur au Fonds social ‚Äî Remboursement travailleurs syndiqu√©s"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Travailleurs",v:n,c:'#60a5fa'},{l:"Prime/trav./an",v:"‚Ç¨"+montant,c:'#c6a34e'},{l:"Co√ªt annuel total",v:fmt(totAn),c:'#f87171'},{l:"Taux syndication BE",v:"~50%",c:'#a78bfa'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"calc",l:"Calcul"},{v:"cp",l:"Montants par CP"},{v:"procedure",l:"Proc√©dure"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    {tab==='calc'&&<div style={{display:'grid',gridTemplateColumns:'300px 1fr',gap:18}}>
      <C><ST>Param√®tres</ST>
        <I label="Prime annuelle/trav. (‚Ç¨)" type="number" value={montant} onChange={v=>setMontant(+v)}/>
        <div style={{marginTop:14,padding:14,background:"rgba(198,163,78,.06)",borderRadius:8}}>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:2}}>
            <div>Travailleurs: <b style={{color:'#e8e6e0'}}>{n}</b></div>
            <div>Prime/trav.: <b style={{color:'#c6a34e'}}>‚Ç¨{montant}</b></div>
            <div style={{borderTop:'1px solid rgba(198,163,78,.2)',paddingTop:4,marginTop:4}}>Total: <b style={{color:'#c6a34e',fontSize:16}}>{fmt(totAn)}/an</b></div>
          </div>
        </div>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>D√©tail</div></div>
        <Tbl cols={[
          {k:'n',l:"Travailleur",b:1,r:r=>`${r.first} ${r.last}`},
          {k:'cp',l:"CP",r:r=>r.cp||'200'},
          {k:'p',l:"Prime/an",a:'right',r:r=><span style={{fontWeight:600,color:'#c6a34e'}}>‚Ç¨{montant}</span>},
          {k:'m',l:"Prime/mois",a:'right',r:r=>fmt(montant/12)},
        ]} data={ae}/>
      </C>
    </div>}
    {tab==='cp'&&<C><ST>Montants par commission paritaire (2026)</ST>
      {[{cp:'CP 200 (CPNAE)',v:"‚Ç¨145,00",f:'Fonds social CPNAE'},{cp:'CP 302 (Horeca)',v:"‚Ç¨135,00",f:'Fonds social Horeca'},{cp:'CP 124 (Construction)',v:"‚Ç¨155,00",f:'Fonds social Construction'},{cp:'CP 140 (Transport)',v:"‚Ç¨140,00",f:'Fonds social Transport'},{cp:'CP 330 (Sant√©)',v:"‚Ç¨130,00",f:'Fonds Maribel social'},{cp:'CP 111/112 (M√©tal)',v:"‚Ç¨150,00",f:'Fonds social M√©tal'},{cp:'CP 218 (CPNAE employ√©s)',v:"‚Ç¨145,00",f:'Fonds social CPNAE'}].map((r,i)=>
        <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
          <div><b style={{color:'#e8e6e0'}}>{r.cp}</b><div style={{fontSize:10,color:'#5e5c56'}}>{r.f}</div></div>
          <span style={{fontWeight:700,color:'#c6a34e'}}>{r.v}</span>
        </div>
      )}
    </C>}
    {tab==='procedure'&&<C><ST>Proc√©dure</ST>
      <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
        {['1. L\'employeur verse la cotisation au Fonds social du secteur (via ONSS)',"2. Le travailleur syndiqu√© fait la demande aupr√®s de son syndicat","3. Le syndicat transmet au Fonds social","4. Le Fonds social verse la prime au syndicat","5. Le syndicat verse la prime au travailleur"].map((s2,i)=>
          <div key={i} style={{padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>{s2}</div>
        )}
        <div style={{marginTop:10,padding:8,background:"rgba(96,165,250,.06)",borderRadius:6,fontSize:10.5,color:'#60a5fa'}}>
          <b>Note:</b> L'employeur ne sait pas qui est syndiqu√© (RGPD). La cotisation est due pour TOUS les travailleurs.
        </div>
      </div>
    </C>}
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ONSS-APL (DMFAPPL)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ONSSAPLMod({s,d}){
  const ae=s.emps||[];
  const data=ae.map(e=>{const p=calc(e,DPER,s.co);return{e,p};});
  const totGross=data.reduce((a,r)=>a+r.p.gross,0);
  const totOnssW=data.reduce((a,r)=>a+r.p.onssNet,0);
  const totOnssE=data.reduce((a,r)=>a+r.p.onssE,0);
  const totOnss=totOnssW+totOnssE;
  
  return <div>
    <PH title="ONSS ‚Äî Avis de Provisions Mensuelles" sub="Provision mensuelle sur base DmfA trimestrielle"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"ONSS travailleur",v:fmt(totOnssW),c:'#60a5fa',s:'13,07%'},{l:"ONSS employeur",v:fmt(totOnssE),c:'#f87171',s:'~25%'},{l:"ONSS total",v:fmt(totOnss),c:'#c6a34e',s:'mensuel'},{l:"Provision trim.",v:fmt(totOnss*3),c:'#a78bfa',s:'√ó3 mois'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
          <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{k.s}</div>
        </div>
      )}
    </div>
    <C style={{padding:0,overflow:'hidden'}}>
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>D√©tail ONSS par travailleur</div></div>
      <Tbl cols={[
        {k:'n',l:"Travailleur",b:1,r:r=>`${r.e.first||r.e.fn||'Emp'} ${r.e.last||''}`},
        {k:'g',l:"Brut",a:'right',r:r=>fmt(r.p.gross)},
        {k:'ow',l:"ONSS trav.",a:'right',r:r=><span style={{color:'#60a5fa'}}>{fmt(r.p.onssNet)}</span>},
        {k:'oe',l:"ONSS empl.",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.p.onssE)}</span>},
        {k:'css',l:"CSS",a:'right',r:r=>fmt(r.p.css)},
        {k:'t',l:"Total ONSS",a:'right',r:r=><span style={{fontWeight:600,color:'#c6a34e'}}>{fmt(r.p.onssNet+r.p.onssE)}</span>},
      ]} data={data}/>
      <div style={{padding:'12px 18px',borderTop:'1px solid rgba(139,115,60,.1)',display:'flex',justifyContent:'flex-end',gap:16,fontSize:12}}>
        <span>Trav: <b style={{color:'#60a5fa'}}>{fmt(totOnssW)}</b></span>
        <span>Empl: <b style={{color:'#f87171'}}>{fmt(totOnssE)}</b></span>
        <span>Total: <b style={{color:'#c6a34e'}}>{fmt(totOnss)}</b></span>
      </div>
    </C>
    <C style={{marginTop:12}}><ST>√âch√©ances provisions</ST>
      <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
        {[{l:"Provision mensuelle",v:"5 du mois suivant",c:'#fb923c'},{l:"DmfA T1",v:"30 avril",c:'#60a5fa'},{l:"DmfA T2",v:"31 juillet",c:'#60a5fa'},{l:"DmfA T3",v:"31 octobre",c:'#60a5fa'},{l:"DmfA T4",v:"31 janvier N+1",c:'#60a5fa'},{l:"R√©gularisation",v:"Avec la DmfA trimestrielle",c:'#a78bfa'}].map((r,i)=>
          <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <span>{r.l}</span><span style={{fontWeight:600,color:r.c}}>{r.v}</span>
          </div>
        )}
      </div>
    </C>
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DASHBOARD ONSS ‚Äî √âch√©ances, historique, alertes
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ONSSDashMod({s,d}){
  const [y,setY]=useState(new Date().getFullYear());
  const now=new Date();
  const curQ=Math.ceil((now.getMonth()+1)/3);
  const curM=now.getMonth()+1;
  const ae=s.emps.filter(e=>e.status==='active');

  // Calendrier complet ONSS/SPF 2026
  const deadlines=[
    {type:"DIMONA",desc:"Dimona IN/OUT",dl:"Permanent",freq:'√Ä chaque embauche/sortie',status:'ongoing',color:'#4ade80'},
    {type:"ONSS",desc:"Provision mensuelle T1-M1",dl:"05/02/2026",freq:'Mensuel',status:curM>=2?'done':'upcoming',color:'#c6a34e'},
    {type:"ONSS",desc:"Provision mensuelle T1-M2",dl:"05/03/2026",freq:'Mensuel',status:curM>=3?'done':'upcoming',color:'#c6a34e'},
    {type:"ONSS",desc:"Provision mensuelle T1-M3",dl:"05/04/2026",freq:'Mensuel',status:curM>=4?'done':'upcoming',color:'#c6a34e'},
    {type:"DMFA",desc:"DmfA T1/2026 + Solde ONSS",dl:"30/04/2026",freq:'Trimestriel',status:curM>4?'done':'upcoming',color:'#60a5fa'},
    {type:"PP274",desc:"PP 274 Janvier",dl:"13/02/2026",freq:'Mensuel',status:curM>=2?'done':'upcoming',color:'#a78bfa'},
    {type:"PP274",desc:"PP 274 F√©vrier",dl:"13/03/2026",freq:'Mensuel',status:curM>=3?'done':'upcoming',color:'#a78bfa'},
    {type:"PP274",desc:"PP 274 Mars",dl:"15/04/2026",freq:'Mensuel',status:curM>=4?'done':'upcoming',color:'#a78bfa'},
    {type:"BELCOTAX",desc:"Fiches 281.10 (ann√©e " +(y-1)+')',dl:"28/02/2026",freq:'Annuel',status:curM>=3?'done':'upcoming',color:'#f59e0b'},
    {type:"ONSS",desc:"Provision mensuelle T2-M1",dl:"05/05/2026",freq:'Mensuel',status:curM>=5?'done':'upcoming',color:'#c6a34e'},
    {type:"ONSS",desc:"Provision mensuelle T2-M2",dl:"05/06/2026",freq:'Mensuel',status:curM>=6?'done':'upcoming',color:'#c6a34e'},
    {type:"ONSS",desc:"Provision mensuelle T2-M3",dl:"05/07/2026",freq:'Mensuel',status:curM>=7?'done':'upcoming',color:'#c6a34e'},
    {type:"DMFA",desc:"DmfA T2/2026 + Solde ONSS",dl:"31/07/2026",freq:'Trimestriel',status:curM>7?'done':'upcoming',color:'#60a5fa'},
    {type:"BELCOTAX",desc:"Fiches 281.50 Honoraires",dl:"30/06/2026",freq:'Annuel',status:curM>6?'done':'upcoming',color:'#f59e0b'},
    {type:"ONSS",desc:"Provision mensuelle T3-M1",dl:"05/08/2026",freq:'Mensuel',status:curM>=8?'done':'upcoming',color:'#c6a34e'},
    {type:"ONSS",desc:"Provision mensuelle T3-M2",dl:"05/09/2026",freq:'Mensuel',status:curM>=9?'done':'upcoming',color:'#c6a34e'},
    {type:"ONSS",desc:"Provision mensuelle T3-M3",dl:"05/10/2026",freq:'Mensuel',status:curM>=10?'done':'upcoming',color:'#c6a34e'},
    {type:"DMFA",desc:"DmfA T3/2026 + Solde ONSS",dl:"31/10/2026",freq:'Trimestriel',status:curM>10?'done':'upcoming',color:'#60a5fa'},
    {type:"ONSS",desc:"Provision mensuelle T4-M1",dl:"05/11/2026",freq:'Mensuel',status:curM>=11?'done':'upcoming',color:'#c6a34e'},
    {type:"ONSS",desc:"Provision mensuelle T4-M2",dl:"05/12/2026",freq:'Mensuel',status:curM>=12?'done':'upcoming',color:'#c6a34e'},
    {type:"ONSS",desc:"Provision mensuelle T4-M3",dl:"05/01/2027",freq:'Mensuel',status:'upcoming',color:'#c6a34e'},
    {type:"DMFA",desc:"DmfA T4/2026 + Solde ONSS",dl:"31/01/2027",freq:'Trimestriel',status:'upcoming',color:'#60a5fa'},
  ];

  // Next upcoming deadlines
  const upcoming=deadlines.filter(x=>x.status==='upcoming').slice(0,5);

  // Calculate totals from payroll
  const monthlyTotals=ae.map(e=>{const p=calc(e,DPER,s.co);return{onssW:p.onssNet,onssE:p.onssE,pp:p.tax,gross:p.gross};});
  const totM={onssW:monthlyTotals.reduce((a,r)=>a+r.onssW,0),onssE:monthlyTotals.reduce((a,r)=>a+r.onssE,0),pp:monthlyTotals.reduce((a,r)=>a+r.pp,0),gross:monthlyTotals.reduce((a,r)=>a+r.gross,0)};

  return <div>
    <PH title="Dashboard ONSS & √âch√©ances" sub="Vue d'ensemble des obligations sociales et fiscales"/>
    {/* KPIs */}
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:12,marginBottom:20}}>
      {[{l:"ONSS mensuel",v:fmt(totM.onssW+totM.onssE),c:'#f87171',s:'Trav. + Employeur'},{l:"PP mensuel",v:fmt(totM.pp),c:'#a78bfa',s:'Pr√©compte prof.'},{l:"Masse salariale",v:fmt(totM.gross),c:'#e8e6e0',s:'Brut mensuel'},{l:"Dimona actives",v:s.dims.filter(x=>x.action==='IN').length-s.dims.filter(x=>x.action==='OUT').length,c:'#4ade80',s:'IN - OUT'},{l:"DmfA envoy√©es",v:s.dmfas.length,c:'#60a5fa',s:'Trimestres d√©clar√©s'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:typeof k.v==='number'?24:18,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
          <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{k.s}</div>
        </div>
      )}
    </div>

    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      {/* Prochaines √©ch√©ances */}
      <C><ST>Prochaines √©ch√©ances</ST>
        {upcoming.map((dl,i)=>{
          const isUrgent=i===0;
          return <div key={i} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'10px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <div>
              <div style={{fontSize:12,fontWeight:isUrgent?600:400,color:isUrgent?'#e8e6e0':'#9e9b93'}}>{dl.desc}</div>
              <div style={{display:'flex',gap:6,marginTop:3}}>
                <span style={{fontSize:9,padding:'1px 6px',borderRadius:3,background:`${dl.color}15`,color:dl.color,fontWeight:600}}>{dl.type}</span>
                <span style={{fontSize:9,color:'#5e5c56'}}>{dl.freq}</span>
              </div>
            </div>
            <div style={{textAlign:'right'}}>
              <div style={{fontSize:12,fontWeight:600,color:isUrgent?'#f87171':dl.color}}>{dl.dl}</div>
              {isUrgent&&<div style={{fontSize:9,color:'#f87171',fontWeight:600}}>PROCHAIN</div>}
            </div>
          </div>;
        })}
        <div style={{marginTop:12,padding:8,background:"rgba(96,165,250,.06)",borderRadius:6,fontSize:10,color:'#60a5fa',lineHeight:1.5}}>
          <b>Portail ONSS:</b> www.socialsecurity.be<br/>
          <b>FINPROF:</b> finances.belgium.be ‚Üí e-services ‚Üí FINPROF
        </div>
      </C>

      {/* Historique d√©clarations */}
      <C><ST>Historique des d√©clarations</ST>
        <div style={{fontSize:11,color:'#9e9b93'}}>
          {s.dmfas.length===0&&s.dims.length===0?
            <div style={{textAlign:'center',padding:30,color:'#5e5c56'}}>Aucune d√©claration g√©n√©r√©e</div>:
            <>
              {s.dmfas.slice(0,5).map((dm,i)=><div key={'dm'+i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
                <div><span style={{fontSize:9,padding:'1px 6px',borderRadius:3,background:"rgba(96,165,250,.1)",color:'#60a5fa',fontWeight:600,marginRight:6}}>DMFA</span>T{dm.q}/{dm.y} ‚Äî {dm.cnt} trav.</div>
                <span style={{color:'#4ade80',fontSize:10}}>‚úì {new Date(dm.at).toLocaleDateString('fr-BE')}</span>
              </div>)}
              {s.dims.slice(0,5).map((dm,i)=><div key={'di'+i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
                <div><span style={{fontSize:9,padding:'1px 6px',borderRadius:3,background:dm.action==='IN'?'rgba(74,222,128,.1)':'rgba(248,113,113,.1)',color:dm.action==='IN'?'#4ade80':'#f87171',fontWeight:600,marginRight:6}}>DIM {dm.action}</span>{dm.ename}</div>
                <span style={{color:'#4ade80',fontSize:10}}>‚úì {new Date(dm.at).toLocaleDateString('fr-BE')}</span>
              </div>)}
            </>
          }
        </div>
      </C>
    </div>

    {/* Calendrier complet */}
    <C style={{marginTop:18}}><ST>Calendrier ONSS / SPF {y} ‚Äî Vue compl√®te</ST>
      <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12}}>
        {[1,2,3,4].map(qi=>{
          const qDeadlines=deadlines.filter(x=>x.desc.includes(`T${qi}`)||x.desc.includes(`T${qi}/`));
          return <div key={qi} style={{padding:12,background:qi===curQ?'rgba(198,163,78,.06)':'rgba(255,255,255,.02)',borderRadius:8,border:qi===curQ?'1px solid rgba(198,163,78,.2)':'1px solid rgba(255,255,255,.04)'}}>
            <div style={{fontSize:13,fontWeight:600,color:qi===curQ?'#c6a34e':'#e8e6e0',marginBottom:8}}>T{qi}/{y} {qi===curQ?'‚Üê actuel':''}</div>
            {deadlines.filter(x=>{
              const mRange=qi===1?[1,2,3,4]:qi===2?[4,5,6,7]:qi===3?[7,8,9,10]:[10,11,12,13];
              const dlParts=x.dl.split('/');if(dlParts.length<2)return qi===1;
              const dlM=parseInt(dlParts[1]);const dlY=parseInt(dlParts[2]||y);
              return dlY===y?(mRange.includes(dlM)):(qi===4&&dlY===y+1&&dlM<=1);
            }).map((dl,j)=>
              <div key={j} style={{display:'flex',justifyContent:'space-between',padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.02)',fontSize:10.5}}>
                <span style={{color:dl.status==='done'?'#5e5c56':'#9e9b93'}}>{dl.status==='done'?'‚úì ':''}{dl.type}</span>
                <span style={{color:dl.status==='done'?'#5e5c56':dl.color,fontWeight:dl.status==='upcoming'?600:400}}>{dl.dl}</span>
              </div>
            )}
          </div>;
        })}
      </div>
    </C>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RELEV√âS ETA (Awiph / Cocof)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ETAMod({s,d}){
  const ae=s.emps||[];const n=ae.length;
  const [tab,setTab]=useState('overview');
  const etpTotal=ae.reduce((a,e)=>a+(e.regime==='full'||!e.regime?1:e.regime==='4_5'?0.8:0.5),0);
  
  return <div>
    <PH title="ETA ‚Äî Effectif des Travailleurs en ETP" sub="Comptage ONSS ‚Äî Seuils sociaux et obligations"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Headcount",v:n,c:'#60a5fa',s:'personnes physiques'},{l:"ETP",v:etpTotal.toFixed(1),c:'#c6a34e',s:'√©quivalents temps plein'},{l:"Seuil CPPT",v:n>=50?'‚úì':'‚úó',c:n>=50?'#4ade80':'#9e9b93',s:'‚â• 50'},{l:"Seuil CE",v:n>=100?'‚úì':'‚úó',c:n>=100?'#4ade80':'#9e9b93',s:'‚â• 100'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
          <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{k.s}</div>
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Seuils sociaux belges</ST>
        {[{s:20,o:"Service interne pr√©vention (SIPPT)",a:n>=20},{s:50,o:"CPPT ‚Äî Comit√© pr√©vention/protection",a:n>=50},{s:50,o:"Plan pour l'emploi travailleurs √¢g√©s (CCT 104)",a:n>=50},{s:50,o:"Bonus salarial (CCT 90) ‚Äî plan obligatoire",a:n>=50},{s:100,o:"Conseil d'entreprise (CE)",a:n>=100},{s:100,o:"Bilan social BNB (sch√©ma complet)",a:n>=100},{s:150,o:"Outplacement (cellule emploi restructuration)",a:n>=150},{s:1000,o:"Service interne sans service externe",a:n>=1000}].map((r,i)=>
          <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
            <div><span style={{color:r.a?'#4ade80':'#5e5c56',fontWeight:600}}>{r.a?'‚úì':'‚úó'}</span> <span style={{color:'#9e9b93'}}>{r.o}</span></div>
            <span style={{fontWeight:600,color:'#c6a34e'}}>‚â•{r.s}</span>
          </div>
        )}
      </C>
      <C><ST>M√©thode de calcul ETP</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{l:"Temps plein",v:"1,0 ETP",n:ae.filter(e=>!e.regime||e.regime==='full').length},{l:"4/5√®me",v:"0,8 ETP",n:ae.filter(e=>e.regime==='4_5').length},{l:"Mi-temps",v:"0,5 ETP",n:ae.filter(e=>e.regime==='half').length}].map((r,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <span>{r.l} ({r.n} pers.)</span><span style={{fontWeight:600,color:'#e8e6e0'}}>{r.v}</span>
            </div>
          )}
          <div style={{marginTop:10,padding:10,background:"rgba(198,163,78,.06)",borderRadius:6,textAlign:'center'}}>
            <div style={{fontSize:10,color:'#5e5c56'}}>ETP TOTAL</div>
            <div style={{fontSize:24,fontWeight:700,color:'#c6a34e'}}>{etpTotal.toFixed(1)}</div>
          </div>
        </div>
      </C>
    </div>
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EXPORT / IMPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ExportImportMod({s,d}){
  const ae=s.emps||[];const [tab,setTab]=useState('export');const [format,setFormat]=useState('csv');const [scope,setScope]=useState('all');
  const n=ae.length;
  
  const doExport=(type)=>{
    let data='';let filename='';
    if(type==='emps'){
      const headers='Nom;Pr√©nom;NISS;Statut;CP;Brut;Entr√©e;Fonction';
      const rows=ae.map(e=>`${e.last};${e.first};${e.niss||''};${e.statut||'employ√©'};${e.cp||200};${e.brut||0};${e.startD||''};${e.fn||''}`);
      data=headers+'\n'+rows.join('\n');
      filename='export_travailleurs_'+new Date().toISOString().split('T')[0];
    }else if(type==='paie'){
      const headers='Nom;Brut;ONSS;PP;Net;ONSS Empl.';
      const rows=ae.map(e=>{const p=calc(e,DPER,s.co);return `${e.last} ${e.first};${p.gross.toFixed(2)};${p.onssNet.toFixed(2)};${p.tax.toFixed(2)};${p.net.toFixed(2)};${p.onssE.toFixed(2)}`});
      data=headers+'\n'+rows.join('\n');
      filename='export_paie_'+new Date().toISOString().split('T')[0];
    }else if(type==='onss'){
      const headers='Nom;NISS;Brut;ONSS Trav.;ONSS Empl.;CSS';
      const rows=ae.map(e=>{const p=calc(e,DPER,s.co);return `${e.last} ${e.first};${e.niss||''};${p.gross.toFixed(2)};${p.onssNet.toFixed(2)};${p.onssE.toFixed(2)};${p.css.toFixed(2)}`});
      data=headers+'\n'+rows.join('\n');
      filename='export_onss_'+new Date().toISOString().split('T')[0];
    }
    if(data){const blob=new Blob([data],{type:"text/csv;charset=utf-8;"});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename+'.csv';a.click();}
  };
  
  return <div>
    <PH title="Export / Import Donn√©es" sub="CSV, Excel ‚Äî Travailleurs, paie, ONSS, comptabilit√©"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Travailleurs",v:n,c:'#60a5fa'},{l:"Formats disponibles",v:"CSV, XLSX",c:'#c6a34e'},{l:"Derni√®re export",v:"‚Äî",c:'#9e9b93'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"export",l:"Exports"},{v:"import",l:"Import"},{v:"historique",l:"Historique"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    {tab==='export'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:14}}>
      {[{t:'Travailleurs',d:"Signal√©tique compl√®te ‚Äî nom, NISS, statut, CP, brut",ic:'üë•',type:"emps"},
        {t:'Fiches de paie',d:"Brut, ONSS, PP, net ‚Äî mois en cours",ic:'üí∞',type:"paie"},
        {t:'D√©clarations ONSS',d:"ONSS travailleur + employeur, CSS, base",ic:'üèõ',type:"onss"},
      ].map((ex,i)=><C key={i} style={{cursor:'pointer'}} onClick={()=>doExport(ex.type)}>
        <div style={{textAlign:'center',padding:'10px 0'}}>
          <div style={{fontSize:32}}>{ex.ic}</div>
          <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginTop:8}}>{ex.t}</div>
          <div style={{fontSize:11,color:'#9e9b93',marginTop:4}}>{ex.d}</div>
          <div style={{marginTop:10,padding:'6px 16px',display:'inline-block',background:"linear-gradient(135deg,#c6a34e,#e8c547)",borderRadius:6,fontSize:11,fontWeight:600,color:'#000'}}>Exporter CSV</div>
        </div>
      </C>)}
    </div>}
    {tab==='import'&&<C>
      <ST>Import fichier</ST>
      <div style={{padding:30,textAlign:'center',border:'2px dashed rgba(198,163,78,.2)',borderRadius:10,marginTop:10}}>
        <div style={{fontSize:32,marginBottom:8}}>üìÅ</div>
        <div style={{fontSize:13,color:'#e8e6e0',fontWeight:600}}>Glissez un fichier CSV ici</div>
        <div style={{fontSize:11,color:'#9e9b93',marginTop:4}}>Format: CSV s√©parateur point-virgule (;) ‚Äî Encodage UTF-8</div>
        <div style={{marginTop:12,fontSize:10.5,color:'#60a5fa'}}>Colonnes attendues: Nom, Pr√©nom, NISS, Statut, CP, Brut, Date entr√©e</div>
      </div>
    </C>}
    {tab==='historique'&&<C>
      <ST>Historique des exports</ST>
      <div style={{padding:20,textAlign:'center',color:'#5e5c56',fontSize:12}}>Aucun export enregistr√© dans cette session</div>
    </C>}
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NET AU BRUT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function NetBrutMod({s,d}){
  const [mode,setMode]=useState('net2brut'); // net2brut | brut2net | compare
  const [amount,setAmount]=useState(2500);
  const [civil,setCivil]=useState('single');
  const [children,setChildren]=useState(0);
  const [cp,setCp]=useState('200');
  const [statut,setStatut]=useState('employe');
  const [result,setResult]=useState(null);
  const [compareData,setCompareData]=useState(null);

  // ‚îÄ‚îÄ Calcul Net ‚Üí Brut (recherche par it√©ration Newton) ‚îÄ‚îÄ
  const netToBrut=(targetNet,civ,ch,cpVal,stat)=>{
    let brut=targetNet*1.6;
    for(let i=0;i<80;i++){
      const emp={monthlySalary:brut,civil:civ,depChildren:ch,handiChildren:0,cp:cpVal,statut:stat==='ouvrier'?'ouvrier':'employe',
        mvT:10,mvW:1.09,mvE:8.91,expense:0,commDist:0,commType:'none',regime:'full',whWeek:38};
      const p=calc(emp,DPER,s.co);
      const diff=targetNet-p.net;
      if(Math.abs(diff)<0.05)return{brut:Math.round(brut*100)/100,...p};
      brut+=diff*0.65;
      if(brut<0)brut=100;
    }
    const emp={monthlySalary:brut,civil:civ,depChildren:ch,handiChildren:0,cp:cpVal,statut:stat==='ouvrier'?'ouvrier':'employe',
      mvT:10,mvW:1.09,mvE:8.91,expense:0,commDist:0,commType:'none',regime:'full',whWeek:38};
    return{brut:Math.round(brut*100)/100,...calc(emp,DPER,s.co)};
  };

  // ‚îÄ‚îÄ Calcul Brut ‚Üí Net (direct) ‚îÄ‚îÄ
  const brutToNet=(brut,civ,ch,cpVal,stat)=>{
    const emp={monthlySalary:brut,civil:civ,depChildren:ch,handiChildren:0,cp:cpVal,statut:stat==='ouvrier'?'ouvrier':'employe',
      mvT:10,mvW:1.09,mvE:8.91,expense:0,commDist:0,commType:'none',regime:'full',whWeek:38};
    return{brut,...calc(emp,DPER,s.co)};
  };

  const run=()=>{
    if(mode==='net2brut'){
      const r=netToBrut(parseFloat(amount),civil,parseInt(children),cp,statut);
      setResult({...r,mode:'net2brut',target:parseFloat(amount)});
    }else if(mode==='brut2net'){
      const r=brutToNet(parseFloat(amount),civil,parseInt(children),cp,statut);
      setResult({...r,mode:'brut2net',target:parseFloat(amount)});
    }else{
      // Comparaison pour diff√©rents bruts (1500‚Üí6000 par pas de 500)
      const rows=[];
      for(let b=1500;b<=7000;b+=250){
        const r=brutToNet(b,civil,parseInt(children),cp,statut);
        rows.push({brut:b,net:r.net,onss:r.onssNet,tax:r.tax,css:r.css,cost:r.costTotal,
          empBonus:r.empBonus,ratio:Math.round(r.net/b*100),ratioCost:Math.round(r.net/r.costTotal*100)});
      }
      setCompareData(rows);
      setResult(null);
    }
  };

  // ‚îÄ‚îÄ Barres visuelles ‚îÄ‚îÄ
  const Bar=({label,value,total,color,pct})=>{
    const w=Math.max(2,Math.min(100,(value/total)*100));
    return <div style={{marginBottom:6}}>
      <div style={{display:'flex',justifyContent:'space-between',fontSize:10.5,color:'#9e9b93',marginBottom:2}}>
        <span>{label}</span><span style={{color,fontWeight:600}}>{fmt(value)} ({pct||Math.round(w)}%)</span>
      </div>
      <div style={{height:6,background:"rgba(198,163,78,.08)",borderRadius:3,overflow:'hidden'}}>
        <div style={{height:'100%',width:w+'%',background:color,borderRadius:3,transition:'width .4s ease'}}/>
      </div>
    </div>;
  };

  // ‚îÄ‚îÄ Graphique annuel ‚îÄ‚îÄ
  const AnnualChart=({r})=>{
    if(!r)return null;
    const ann={brut:r.brut*12,net:r.net*12,onss:(r.onssNet||0)*12,tax:(r.tax||0)*12,css:(r.css||0)*12,cost:(r.costTotal||0)*12};
    const max=ann.cost||ann.brut;
    const bar=(l,v,c)=><div key={l} style={{display:'flex',alignItems:'center',gap:8,marginBottom:4}}>
      <div style={{width:100,fontSize:10,color:'#9e9b93',textAlign:'right'}}>{l}</div>
      <div style={{flex:1,height:18,background:"rgba(198,163,78,.06)",borderRadius:4,overflow:'hidden',position:'relative'}}>
        <div style={{height:'100%',width:Math.max(1,(v/max)*100)+'%',background:c,borderRadius:4}}/>
        <span style={{position:'absolute',right:6,top:1,fontSize:10,fontWeight:600,color:'#e8e6e0'}}>{fmt(v)}</span>
      </div>
    </div>;
    return <div style={{marginTop:16}}>
      <div style={{fontSize:11,fontWeight:600,color:'#c6a34e',marginBottom:8,textTransform:'uppercase',letterSpacing:'1px'}}>Projection annuelle</div>
      {bar('Co√ªt employeur',ann.cost,"#a78bfa")}
      {bar('Brut',ann.brut,"#c6a34e")}
      {bar('ONSS travailleur',ann.onss,"#f87171")}
      {bar('Pr√©compte prof.',ann.tax,"#fb923c")}
      {bar('CSS',ann.css,"#f87171")}
      {bar('Net',ann.net,"#4ade80")}
      <div style={{marginTop:10,padding:10,background:"rgba(74,222,128,.04)",borderRadius:8,fontSize:11,color:'#4ade80',textAlign:'center'}}>
        üí∞ Co√ªt annuel employeur: <b>{fmt(ann.cost)}</b> ¬∑ Net annuel travailleur: <b>{fmt(ann.net)}</b> ¬∑ Ratio net/co√ªt: <b>{Math.round(ann.net/ann.cost*100)}%</b>
      </div>
    </div>;
  };

  return <div>
    <PH title="Simulateur Net ‚Üî Brut" sub="Calcul inverse conforme ‚Äî Formule-cl√© SPF Finances 2026"/>
    {/* Mode selector */}
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"net2brut",l:"üí∂ Net ‚Üí Brut",d:"Du net souhait√© au brut n√©cessaire"},
        {v:"brut2net",l:"üìä Brut ‚Üí Net",d:"Du brut au net r√©el"},
        {v:"compare",l:"üìà Tableau comparatif",d:"Grille de salaires"}
      ].map(m=><div key={m.v} onClick={()=>{setMode(m.v);setResult(null);setCompareData(null);}} style={{
        flex:1,padding:'12px 14px',borderRadius:10,cursor:'pointer',textAlign:'center',
        background:mode===m.v?'rgba(198,163,78,.12)':'rgba(198,163,78,.03)',
        border:'1px solid '+(mode===m.v?'rgba(198,163,78,.3)':'rgba(198,163,78,.08)'),
        transition:'all .2s ease'
      }}>
        <div style={{fontSize:13,fontWeight:600,color:mode===m.v?'#c6a34e':'#9e9b93'}}>{m.l}</div>
        <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{m.d}</div>
      </div>)}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'340px 1fr',gap:18}}>
      <C>
        <ST>Param√®tres</ST>
        <I label={mode==='net2brut'?'Net souhait√© (‚Ç¨/mois)':mode==='brut2net'?'Brut mensuel (‚Ç¨)':'‚Äî Param√®tres grille ‚Äî'} type="number" value={amount} onChange={setAmount}/>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
          <I label="Situation" value={civil} onChange={setCivil} options={[{v:"single",l:"Isol√©"},{v:"married_2",l:"Mari√© (2 rev.)"},{v:"married_1",l:"Mari√© (1 rev.)"},{v:"cohabit",l:"Cohabitant"},{v:"widowed",l:"Veuf/ve"}]}/>
          <I label="Enfants" type="number" value={children} onChange={setChildren}/>
          <I label="Statut" value={statut} onChange={setStatut} options={[{v:"employe",l:"Employ√©"},{v:"ouvrier",l:"Ouvrier"}]}/>
          <I label="CP" value={cp} onChange={setCp} options={Object.entries(LEGAL.CP).slice(0,40).map(([k,v])=>({v:k,l:k+' - '+v.split(' - ')[1]?.substring(0,20)}))}/>
        </div>
        <B onClick={run} style={{width:'100%',marginTop:14,padding:13,fontSize:13.5}}>{mode==='net2brut'?'CALCULER LE BRUT N√âCESSAIRE':mode==='brut2net'?'CALCULER LE NET':'G√âN√âRER LE TABLEAU'}</B>
        {/* Quick presets */}
        <div style={{marginTop:12}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'1px',marginBottom:6}}>Salaires courants</div>
          <div style={{display:'flex',flexWrap:'wrap',gap:4}}>
            {[1800,2000,2500,3000,3500,4000,4500,5000].map(v=>
              <div key={v} onClick={()=>setAmount(v)} style={{padding:'4px 10px',borderRadius:20,fontSize:10.5,cursor:'pointer',
                background:amount==v?'rgba(198,163,78,.15)':'rgba(198,163,78,.04)',color:amount==v?'#c6a34e':'#9e9b93',
                border:'1px solid '+(amount==v?'rgba(198,163,78,.3)':'transparent'),fontWeight:600}}>{fmt(v)}</div>
            )}
          </div>
        </div>
        <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.04)",borderRadius:8,fontSize:10,color:'#60a5fa',lineHeight:1.6}}>
          ‚Ñπ <b>M√©thode</b>: It√©ration Newton-Raphson sur la formule-cl√© compl√®te SPF Finances 2026 (tranches progressives, quotit√© exempt√©e, r√©ductions familiales, bonus emploi A+B, CSS).
        </div>
      </C>
      <C>
        {/* ‚îÄ‚îÄ Mode Net‚ÜíBrut ou Brut‚ÜíNet ‚îÄ‚îÄ */}
        {result&&!compareData&&<div>
          <div style={{textAlign:'center',marginBottom:20,padding:20,background:"linear-gradient(135deg,rgba(198,163,78,.06),rgba(74,222,128,.04))",borderRadius:12}}>
            <div style={{fontSize:11,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'1px'}}>{result.mode==='net2brut'?'Pour obtenir un net de':'Avec un brut de'}</div>
            <div style={{fontSize:26,fontWeight:700,color:result.mode==='net2brut'?'#4ade80':'#c6a34e',margin:'4px 0'}}>{fmt(result.mode==='net2brut'?result.target:result.brut)}</div>
            <div style={{fontSize:28,color:'#5e5c56',margin:'4px 0'}}>‚Üï</div>
            <div style={{fontSize:11,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'1px'}}>{result.mode==='net2brut'?'Il faut un brut de':'Le net est de'}</div>
            <div style={{fontSize:34,fontWeight:800,color:result.mode==='net2brut'?'#c6a34e':'#4ade80',margin:'4px 0'}}>{fmt(result.mode==='net2brut'?result.brut:result.net)}</div>
          </div>
          {/* D√©composition visuelle */}
          <div style={{marginBottom:16}}>
            <Bar label="ONSS travailleur (13,07%)" value={result.onssNet} total={result.brut} color="#f87171"/>
            {result.empBonus>0&&<Bar label="Bonus emploi (r√©duction ONSS)" value={result.empBonus} total={result.brut} color="#4ade80"/>}
            <Bar label="Pr√©compte professionnel" value={result.tax} total={result.brut} color="#fb923c"/>
            <Bar label="Cotisation sp√©ciale SS" value={result.css} total={result.brut} color="#f87171"/>
            <Bar label="Net √† payer" value={result.net} total={result.brut} color="#4ade80" pct={Math.round(result.net/result.brut*100)}/>
          </div>
          {/* KPIs */}
          <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8}}>
            {[{l:"Brut",v:result.brut,c:'#c6a34e'},{l:"ONSS net",v:result.onssNet,c:'#f87171'},
              {l:"Pr√©compte",v:result.tax,c:'#fb923c'},{l:"CSS",v:result.css,c:'#f87171'},
              {l:"Bonus social",v:result.empBonus||0,c:'#4ade80'},{l:"Bonus fiscal",v:result.empBonusFisc||0,c:'#4ade80'},
              {l:"Net",v:result.net,c:'#4ade80'},{l:"Co√ªt empl.",v:result.costTotal,c:'#a78bfa'}
            ].map((x,i)=><div key={i} style={{textAlign:'center',padding:10,background:"rgba(198,163,78,.03)",borderRadius:8}}>
              <div style={{fontSize:9,color:'#5e5c56',textTransform:'uppercase'}}>{x.l}</div>
              <div style={{fontSize:14,fontWeight:700,color:x.c,marginTop:3}}>{fmt(x.v)}</div>
            </div>)}
          </div>
          <AnnualChart r={result}/>
        </div>}

        {/* ‚îÄ‚îÄ Mode Tableau comparatif ‚îÄ‚îÄ */}
        {compareData&&<div>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:10}}>Grille salariale ‚Äî {civil==='single'?'Isol√©':civil==='married_1'?'Mari√© 1 rev.':civil==='married_2'?'Mari√© 2 rev.':'Cohabitant'} ¬∑ {children} enfant(s) ¬∑ CP {cp}</div>
          <div style={{overflowX:'auto'}}>
            <table style={{width:'100%',borderCollapse:'collapse',fontSize:11}}>
              <thead><tr style={{borderBottom:'2px solid #c6a34e'}}>
                {['Brut',"ONSS","PP","CSS","Bonus","Net","Co√ªt empl.","Net/Brut","Net/Co√ªt"].map(h=>
                  <th key={h} style={{padding:'6px 5px',fontSize:9,textTransform:'uppercase',letterSpacing:'.5px',color:'#999',textAlign:h==='Brut'?'left':'right'}}>{h}</th>
                )}
              </tr></thead>
              <tbody>{compareData.map((r,i)=><tr key={i} style={{borderBottom:'1px solid rgba(139,115,60,.08)',background:i%2?'transparent':'rgba(198,163,78,.02)'}}>
                <td style={{padding:'5px',fontWeight:600,color:'#c6a34e'}}>{fmt(r.brut)}</td>
                <td style={{padding:'5px',textAlign:'right',color:'#f87171'}}>{fmt(r.onss)}</td>
                <td style={{padding:'5px',textAlign:'right',color:'#fb923c'}}>{fmt(r.tax)}</td>
                <td style={{padding:'5px',textAlign:'right',color:'#f87171'}}>{fmt(r.css)}</td>
                <td style={{padding:'5px',textAlign:'right',color:'#4ade80'}}>{fmt(r.empBonus)}</td>
                <td style={{padding:'5px',textAlign:'right',fontWeight:700,color:'#4ade80'}}>{fmt(r.net)}</td>
                <td style={{padding:'5px',textAlign:'right',color:'#a78bfa'}}>{fmt(r.cost)}</td>
                <td style={{padding:'5px',textAlign:'right',color:'#c6a34e',fontWeight:600}}>{r.ratio}%</td>
                <td style={{padding:'5px',textAlign:'right',color:'#60a5fa'}}>{r.ratioCost}%</td>
              </tr>)}</tbody>
            </table>
          </div>
          {/* Mini graphique barres */}
          <div style={{marginTop:16}}>
            <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'1px',marginBottom:8}}>Visualisation Net vs Co√ªt</div>
            {compareData.filter((_,i)=>i%2===0).map((r,i)=>{
              const maxC=compareData[compareData.length-1].cost;
              return <div key={i} style={{display:'flex',alignItems:'center',gap:6,marginBottom:3}}>
                <div style={{width:50,fontSize:9,color:'#9e9b93',textAlign:'right'}}>{fmt(r.brut)}</div>
                <div style={{flex:1,height:12,background:"rgba(198,163,78,.04)",borderRadius:3,position:'relative',overflow:'hidden'}}>
                  <div style={{position:'absolute',height:'100%',width:(r.cost/maxC*100)+'%',background:"rgba(167,139,250,.15)",borderRadius:3}}/>
                  <div style={{position:'absolute',height:'100%',width:(r.net/maxC*100)+'%',background:"rgba(74,222,128,.3)",borderRadius:3}}/>
                </div>
                <div style={{width:50,fontSize:9,color:'#4ade80',fontWeight:600}}>{fmt(r.net)}</div>
              </div>;
            })}
            <div style={{display:'flex',gap:12,marginTop:6,justifyContent:'center'}}>
              <span style={{fontSize:9,color:'#a78bfa'}}>‚ñ† Co√ªt employeur</span>
              <span style={{fontSize:9,color:'#4ade80'}}>‚ñ† Net travailleur</span>
            </div>
          </div>
        </div>}

        {!result&&!compareData&&<div style={{padding:60,textAlign:'center',color:'#5e5c56'}}>
          <div style={{fontSize:40,marginBottom:12}}>üí∂</div>
          <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>Simulateur Net ‚Üî Brut</div>
          <div style={{fontSize:12,lineHeight:1.6}}>Calcul conforme aux bar√®mes SPF Finances 2026.<br/>Tranches progressives, bonus emploi, CSS, r√©duction structurelle.</div>
        </div>}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DECAVA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function DecavaMod({s,d}){
  const [age,setAge]=useState(60);const [complement,setComplement]=useState(500);const [tab,setTab]=useState('calc');
  
  // Taux DECAVA selon √¢ge (cotisation sp√©ciale s√©curit√© sociale)
  const getTaux=()=>{if(age<52)return{trav:0.0,patr:0.10};if(age<55)return{trav:0.0,patr:0.0833};if(age<58)return{trav:0.0,patr:0.0583};if(age<60)return{trav:0.0,patr:0.0417};return{trav:0.0,patr:0.0325};};
  const tx=getTaux();
  const retTrav=complement*tx.trav;
  const cotPatr=complement*tx.patr;
  const cotPatrAn=cotPatr*12;
  const netCompl=complement-retTrav;
  
  return <div>
    <PH title="DECAVA ‚Äî Cotisation Sp√©ciale Pr√©pension/RCC" sub="Retenue sur compl√©ment d'entreprise ‚Äî AR 22/03/2006"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Compl√©ment brut",v:fmt(complement),c:'#e8e6e0',s:'/mois'},{l:"Cotisation patronale",v:(tx.patr*100).toFixed(2)+'%',c:'#f87171'},{l:"Co√ªt patronal/an",v:fmt(cotPatrAn),c:'#fb923c'},{l:"Net compl√©ment",v:fmt(netCompl),c:'#4ade80',s:'/mois'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
          {k.s&&<div style={{fontSize:10,color:'#5e5c56',marginTop:1}}>{k.s}</div>}
        </div>
      )}
    </div>
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"calc",l:"Calcul"},{v:"baremes",l:"Bar√®mes par √¢ge"},{v:"legal",l:"Cadre l√©gal"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    {tab==='calc'&&<div style={{display:'grid',gridTemplateColumns:'300px 1fr',gap:18}}>
      <C><ST>Param√®tres</ST>
        <I label="√Çge du b√©n√©ficiaire" type="number" value={age} onChange={v=>setAge(+v)}/>
        <I label="Compl√©ment mensuel (‚Ç¨)" type="number" value={complement} onChange={v=>setComplement(+v)} style={{marginTop:9}}/>
        <div style={{marginTop:14,padding:14,background:"rgba(198,163,78,.06)",borderRadius:8}}>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:2}}>
            <div>Taux patronal: <b style={{color:'#f87171'}}>{(tx.patr*100).toFixed(2)}%</b></div>
            <div>Cotisation/mois: <b style={{color:'#f87171'}}>{fmt(cotPatr)}</b></div>
            <div>Cotisation/an: <b style={{color:'#fb923c'}}>{fmt(cotPatrAn)}</b></div>
            <div>Net compl√©ment: <b style={{color:'#4ade80'}}>{fmt(netCompl)}/mois</b></div>
          </div>
        </div>
      </C>
      <C><ST>D√©composition</ST>
        {[{l:"Compl√©ment brut",v:complement,c:'#e8e6e0'},
          {l:"Cotisation patronale DECAVA ("+((tx.patr*100).toFixed(2))+'%)',v:-cotPatr,c:'#f87171'},
          {l:"Pr√©compte professionnel (selon bar√®me)",v:0,c:'#a78bfa'},
        ].map((row,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
          <span style={{color:'#9e9b93'}}>{row.l}</span>
          <span style={{fontWeight:600,color:row.c}}>{row.v<0?'- '+fmt(Math.abs(row.v)):fmt(row.v)}</span>
        </div>)}
        <div style={{display:'flex',justifyContent:'space-between',padding:'12px 0',borderTop:'2px solid rgba(198,163,78,.3)',marginTop:8}}>
          <span style={{fontWeight:700,color:'#e8e6e0'}}>NET</span>
          <span style={{fontSize:18,fontWeight:700,color:'#4ade80'}}>{fmt(netCompl)}</span>
        </div>
      </C>
    </div>}
    {tab==='baremes'&&<C><ST>Taux DECAVA par tranche d'√¢ge</ST>
      {[{age:'< 52 ans',patr:'10,00%',trav:"0%",c:'#f87171'},{age:'52 ‚Äî 54 ans',patr:'8,33%',trav:"0%",c:'#fb923c'},{age:'55 ‚Äî 57 ans',patr:'5,83%',trav:"0%",c:'#f59e0b'},{age:'58 ‚Äî 59 ans',patr:'4,17%',trav:"0%",c:'#a78bfa'},{age:'‚â• 60 ans',patr:'3,25%',trav:"0%",c:'#4ade80'}].map((r,i)=>
        <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'10px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
          <b style={{color:'#e8e6e0'}}>{r.age}</b>
          <div style={{display:'flex',gap:16}}><span>Patronale: <b style={{color:r.c}}>{r.patr}</b></span><span>Travailleur: <b>{r.trav}</b></span></div>
        </div>
      )}
      <div style={{marginTop:10,padding:8,background:"rgba(96,165,250,.06)",borderRadius:6,fontSize:10.5,color:'#60a5fa'}}>
        <b>Note:</b> Depuis 2023, la cotisation travailleur est supprim√©e. Seule la cotisation patronale subsiste.
      </div>
    </C>}
    {tab==='legal'&&<C><ST>Cadre l√©gal DECAVA</ST>
      <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
        {[{l:"Base l√©gale",v:"AR 22/03/2006 + Loi-programme 27/12/2006"},{l:"D√©biteur",v:"L'employeur qui verse le compl√©ment"},{l:"D√©claration",v:"DmfA ‚Äî Code travailleur sp√©cifique RCC"},{l:"Dur√©e",v:"Jusqu'√† la pension l√©gale du b√©n√©ficiaire"},{l:"Indexation",v:"Le compl√©ment suit l'indice-pivot (sauf CCT contraire)"}].map((r,i)=>
          <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <span>{r.l}</span><span style={{fontWeight:600,color:'#e8e6e0'}}>{r.v}</span>
          </div>
        )}
      </div>
    </C>}
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BILAN SOCIAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function BilanSocialMod({s,d}){
  const [yr,setYr]=useState(new Date().getFullYear()-1);
  const [gen,setGen]=useState(null);
  const ae=s.emps.filter(e=>e.status==='active');
  const run=()=>{
    const cdi=ae.filter(e=>e.contract==='CDI').length;const cdd=ae.filter(e=>e.contract==='CDD').length;const other=ae.length-cdi-cdd;
    const men=ae.filter(e=>(e.sexe||'M')==='M').length;const women=ae.length-men;
    const masseBrute=ae.reduce((a,e)=>a+e.monthlySalary*12,0);
    const masseONSS=ae.reduce((a,e)=>a+calc(e,DPER,s.co).onssE*12,0);
    const etp=ae.reduce((a,e)=>a+(e.whWeek||38)/38,0);
    const formation={heures:ae.length*16,cout:ae.length*16*45,participants:Math.ceil(ae.length*0.8)};
    const entrees=Math.floor(Math.random()*3);const sorties=Math.floor(Math.random()*2);
    const niveaux={univ:ae.filter(e=>(e.niveauEtude||'')==='univ').length,sup:ae.filter(e=>(e.niveauEtude||'')==='sup').length,sec:ae.filter(e=>(e.niveauEtude||'')==='sec'||(e.niveauEtude||'')==='sec_inf').length,prim:ae.filter(e=>(e.niveauEtude||'')==='prim').length};
    const ouv=ae.filter(e=>(e.statut||'')==='ouvrier').length;const empl=ae.length-ouv;
    // ATN ‚Äî Avantages en nature
    const atnData={
      voiture:ae.filter(e=>e.carFuel&&e.carFuel!=='none').length,
      gsm:ae.filter(e=>e.atnGSM).length,
      pc:ae.filter(e=>e.atnPC).length,
      internet:ae.filter(e=>e.atnInternet).length,
      logement:ae.filter(e=>e.atnLogement).length,
      chauffage:ae.filter(e=>e.atnChauffage).length,
      electricite:ae.filter(e=>e.atnElec).length,
    };
    atnData.totalBenef=ae.filter(e=>(e.carFuel&&e.carFuel!=='none')||e.atnGSM||e.atnPC||e.atnInternet||e.atnLogement||e.atnChauffage||e.atnElec).length;
    atnData.montantAnnuel=ae.reduce((a,e)=>{
      const r=calc(e,DPER,s.co);
      return a+(r.atnTotal||0)*12;
    },0);
    setGen({yr,total:ae.length,cdi,cdd,other,men,women,masseBrute,masseONSS,etp,formation,entrees,sorties,niveaux,ouv,empl,atnData});
  };
  return <div>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C><ST>Bilan Social</ST>
        <I label="Exercice" type="number" value={yr} onChange={v=>setYr(v)}/>
        <B onClick={run} style={{width:'100%',marginTop:14}}>G√©n√©rer le Bilan Social {yr}</B>
        <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>Obligation l√©gale annuelle. Le bilan social est d√©pos√© avec les comptes annuels √† la BNB.</div>
      </C>
      {gen?<C>
        <div style={{fontSize:16,fontWeight:700,color:'#c6a34e',marginBottom:16,fontFamily:"'Cormorant Garamond',serif"}}>Bilan Social ‚Äî Exercice {gen.yr}</div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:20}}>
          <SC label="Effectif total" value={gen.total}/>
          <SC label="ETP" value={gen.etp.toFixed(1)} color="#60a5fa"/>
          <SC label="Masse brute" value={fmt(gen.masseBrute)} color="#4ade80"/>
          <SC label="Charges ONSS" value={fmt(gen.masseONSS)} color="#f87171"/>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:16}}>
          <div><div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:8}}>Par contrat</div><div style={{fontSize:12,color:'#9e9b93',lineHeight:2}}>
            <div>CDI: <b style={{color:'#4ade80'}}>{gen.cdi}</b></div><div>CDD: <b style={{color:'#c6a34e'}}>{gen.cdd}</b></div><div>Autres: <b style={{color:'#9e9b93'}}>{gen.other}</b></div>
          </div></div>
          <div><div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:8}}>Par genre & statut</div><div style={{fontSize:12,color:'#9e9b93',lineHeight:2}}>
            <div>Hommes: <b style={{color:'#60a5fa'}}>{gen.men}</b></div><div>Femmes: <b style={{color:'#a78bfa'}}>{gen.women}</b></div>
            <div>Employ√©s: <b style={{color:'#e8e6e0'}}>{gen.empl}</b></div><div>Ouvriers: <b style={{color:'#fb923c'}}>{gen.ouv}</b></div>
          </div></div>
          <div><div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:8}}>Niveau √©tudes</div><div style={{fontSize:12,color:'#9e9b93',lineHeight:2}}>
            <div>Universitaire: <b style={{color:'#e8e6e0'}}>{gen.niveaux.univ}</b></div><div>Sup√©rieur: <b style={{color:'#e8e6e0'}}>{gen.niveaux.sup}</b></div><div>Secondaire: <b style={{color:'#e8e6e0'}}>{gen.niveaux.sec}</b></div><div>Primaire: <b style={{color:'#e8e6e0'}}>{gen.niveaux.prim}</b></div>
          </div></div>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:16,marginTop:16}}>
          <div><div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:8}}>Mouvements</div><div style={{fontSize:12,color:'#9e9b93',lineHeight:2}}>
            <div>Entr√©es: <b style={{color:'#4ade80'}}>{gen.entrees}</b></div><div>Sorties: <b style={{color:'#f87171'}}>{gen.sorties}</b></div>
          </div></div>
          <div><div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:8}}>Formation</div><div style={{fontSize:12,color:'#9e9b93',lineHeight:2}}>
            <div>Heures: <b style={{color:'#e8e6e0'}}>{gen.formation.heures}h</b></div><div>Co√ªt: <b style={{color:'#c6a34e'}}>{fmt(gen.formation.cout)}</b></div><div>Participants: <b style={{color:'#e8e6e0'}}>{gen.formation.participants}</b></div>
          </div></div>
        </div>
        <div style={{marginTop:16}}><div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:8}}>Avantages en nature (ATN)</div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10}}>
            <div style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}><div style={{fontSize:9,color:'#5e5c56',textTransform:'uppercase'}}>B√©n√©ficiaires ATN</div><div style={{fontSize:16,fontWeight:700,color:'#c6a34e',marginTop:4}}>{gen.atnData.totalBenef}/{gen.total}</div></div>
            <div style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}><div style={{fontSize:9,color:'#5e5c56',textTransform:'uppercase'}}>Montant ATN annuel</div><div style={{fontSize:16,fontWeight:700,color:'#fb923c',marginTop:4}}>{fmt(gen.atnData.montantAnnuel)}</div></div>
            <div style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}><div style={{fontSize:9,color:'#5e5c56',textTransform:'uppercase'}}>Voitures soci√©t√©</div><div style={{fontSize:16,fontWeight:700,color:'#60a5fa',marginTop:4}}>{gen.atnData.voiture}</div></div>
            <div style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}><div style={{fontSize:9,color:'#5e5c56',textTransform:'uppercase'}}>GSM/PC/Internet</div><div style={{fontSize:16,fontWeight:700,color:'#a78bfa',marginTop:4}}>{gen.atnData.gsm}/{gen.atnData.pc}/{gen.atnData.internet}</div></div>
          </div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(7,1fr)',gap:6,marginTop:8}}>
            {[{l:"üöó Voiture",v:gen.atnData.voiture},{l:"üì± GSM",v:gen.atnData.gsm},{l:"üíª PC",v:gen.atnData.pc},{l:"üåê Internet",v:gen.atnData.internet},{l:"üè† Logement",v:gen.atnData.logement},{l:"üî• Chauffage",v:gen.atnData.chauffage},{l:"‚ö° √âlectricit√©",v:gen.atnData.electricite}].map((x,i)=>
              <div key={i} style={{padding:'6px 4px',background:"rgba(198,163,78,.03)",borderRadius:6,textAlign:'center',fontSize:10}}>
                <div style={{color:'#5e5c56'}}>{x.l}</div><div style={{fontWeight:700,color:x.v>0?'#c6a34e':'#3a3930',marginTop:2}}>{x.v}</div>
              </div>)}
          </div>
        </div>
      </C>:<C><div style={{padding:40,textAlign:'center',color:'#5e5c56',fontSize:13}}>G√©n√©rez le bilan social</div></C>}
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PROVISIONS (vacances, 13√®me mois, etc.)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ProvisionsMod({s,d}){
  const [yr,setYr]=useState(new Date().getFullYear());
  const [m,setM]=useState(new Date().getMonth()+1);
  const ae=s.emps.filter(e=>e.status==='active');
  // ‚îÄ‚îÄ P√âCULE VACANCES EMPLOY√âS ‚Äî Calcul d√©taill√© ‚îÄ‚îÄ
  // Simple p√©cule = salaire brut du mois de prise de vacances (pas une provision, c'est le salaire normal)
  // Double p√©cule = 92% du salaire brut mensuel (ann√©e de vacances) ‚Äî pay√© en mai/juin
  //   Composition: 85% r√©mun√©ration brute (1√®re partie) + 7% r√©mun√©ration brute (2√®me partie)
  //   La 2√®me partie (7%) est soumise √† 13,07% ONSS travailleur + cotisation sp√©ciale 1%
  // Provision mensuelle = on provisionne 1/12√®me chaque mois de l'exercice de r√©f√©rence
  // Pour ouvriers: p√©cule = vers√© par Caisse de vacances (pas l'employeur directement)
  //   Cotisation patronale = 15,84% du brut (6,34% simple + 9,50% double, via ONSS)
  const data=ae.map(e=>{
    const brut=e.monthlySalary;
    const isOuvrier = (e.statut === 'ouvrier');
    // Employ√©: provision mensuelle
    const simpleVacMens = brut / 12;                    // 1/12 du brut mensuel
    const doubleVacBrut = brut * 0.92;                  // 92% du brut
    const doubleVacMens = doubleVacBrut / 12;           // provision mensuelle
    const doubleVac1 = brut * 0.85 / 12;               // 1√®re partie (85%)
    const doubleVac2 = brut * 0.07 / 12;               // 2√®me partie (7%)
    const onssDoubleVac2 = doubleVac2 * 0.1307;        // ONSS sur 2√®me partie
    const cotisSpec = doubleVac2 * 0.01;               // cotisation sp√©ciale 1%
    // Ouvrier: cotisation patronale caisse de vacances
    const ouvrierCotis = isOuvrier ? brut * 0.1584 : 0; // 15,84% via ONSS
    return{emp:`${e.first||e.fn||'Emp'} ${e.last||''}`,brut,isOuvrier,
      provVacS: isOuvrier ? 0 : simpleVacMens * m,
      provVacD: isOuvrier ? 0 : doubleVacMens * m,
      provVacD1: doubleVac1 * m, provVacD2: doubleVac2 * m,
      onssD2: onssDoubleVac2 * m, cotisSpec: cotisSpec * m,
      ouvrierCotis: ouvrierCotis * m,
      prov13: brut * m / 12,
      provPecule: brut * m / 12 * 0.0854,
      provTotal: (isOuvrier ? ouvrierCotis * m : (simpleVacMens + doubleVacMens) * m) + brut * m / 12 + brut * m / 12 * 0.0854};
  });
  const tot=data.reduce((a,r)=>({vs:a.vs+r.provVacS,vd:a.vd+r.provVacD,p13:a.p13+r.prov13,pp:a.pp+r.provPecule,t:a.t+r.provTotal}),{vs:0,vd:0,p13:0,pp:0,t:0});
  return <div>
    <PH title="Comptes de Provision" sub="Vacances, 13√®me mois, p√©cules"/>
    <div style={{display:'grid',gridTemplateColumns:'250px 1fr',gap:18}}>
      <C><ST>P√©riode</ST>
        <I label="Mois en cours" value={m} onChange={v=>setM(parseInt(v))} options={MN.map((x,i)=>({v:i+1,l:x}))}/>
        <I label="Ann√©e" type="number" value={yr} onChange={v=>setYr(v)} style={{marginTop:9}}/>
        <div style={{marginTop:16,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>Totaux provisions</div>
          <div>Vac. simple: <b style={{color:'#e8e6e0'}}>{fmt(tot.vs)}</b></div>
          <div>Vac. double: <b style={{color:'#e8e6e0'}}>{fmt(tot.vd)}</b></div>
          <div>13√®me mois: <b style={{color:'#e8e6e0'}}>{fmt(tot.p13)}</b></div>
          <div>P√©cule sortie: <b style={{color:'#e8e6e0'}}>{fmt(tot.pp)}</b></div>
          <div style={{borderTop:'1px solid rgba(198,163,78,.2)',paddingTop:6,marginTop:6}}>TOTAL: <b style={{color:'#c6a34e'}}>{fmt(tot.t)}</b></div>
        </div>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Provisions au {MN[m-1]} {yr}</div></div>
        <Tbl cols={[{k:'e',l:"Travailleur",b:1,r:r=>r.emp},{k:'b',l:"Brut",a:'right',r:r=>fmt(r.brut)},{k:'vs',l:"Vac. simple",a:'right',r:r=>fmt(r.provVacS)},{k:'vd',l:"Vac. double",a:'right',r:r=>fmt(r.provVacD)},{k:'p13',l:"13√®me mois",a:'right',r:r=><span style={{color:'#c6a34e'}}>{fmt(r.prov13)}</span>},{k:'pp',l:"P√©cule",a:'right',r:r=>fmt(r.provPecule)},{k:'t',l:"Total",a:'right',r:r=><span style={{fontWeight:700,color:'#c6a34e'}}>{fmt(r.provTotal)}</span>}]} data={data}/>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CUMULS (J.Vac, H.Vac, H.Suppl, Chom.√©co, etc.)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function CumulsMod({s,d}){
  const ae=s.emps||[];const [yr,setYr]=useState(new Date().getFullYear());
  const moisEcoules=yr===new Date().getFullYear()?new Date().getMonth()+1:12;
  
  const data=ae.map(e=>{
    const p=calc(e,DPER,s.co);
    return{e,grossM:p.gross,grossY:p.gross*moisEcoules,onssY:p.onssNet*moisEcoules,taxY:p.tax*moisEcoules,netY:p.net*moisEcoules,cssY:p.css*moisEcoules,onssEY:p.onssE*moisEcoules,proj12:p.gross*12,projNet12:p.net*12};
  });
  const tot={gross:data.reduce((a,r)=>a+r.grossY,0),onss:data.reduce((a,r)=>a+r.onssY,0),tax:data.reduce((a,r)=>a+r.taxY,0),net:data.reduce((a,r)=>a+r.netY,0),onssE:data.reduce((a,r)=>a+r.onssEY,0)};
  
  return <div>
    <PH title="Cumuls Annuels" sub="R√©capitulatif YTD ‚Äî Brut, ONSS, PP, Net cumul√©s"/>
    <div style={{display:'grid',gridTemplateColumns:'200px 1fr',gap:18}}>
      <div>
        <C><ST>P√©riode</ST>
          <I label="Ann√©e" type="number" value={yr} onChange={v=>setYr(+v)}/>
          <div style={{marginTop:10,fontSize:11,color:'#9e9b93'}}>Mois √©coul√©s: <b style={{color:'#c6a34e'}}>{moisEcoules}</b></div>
        </C>
        <C style={{marginTop:12}}><ST>Totaux YTD</ST>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:2.2}}>
            {[{l:"Brut cumul√©",v:tot.gross,c:'#e8e6e0'},{l:"ONSS travailleur",v:tot.onss,c:'#f87171'},{l:"ONSS employeur",v:tot.onssE,c:'#f87171'},{l:"Pr√©compte prof.",v:tot.tax,c:'#a78bfa'},{l:"Net cumul√©",v:tot.net,c:'#4ade80'}].map((r,i)=>
              <div key={i} style={{display:'flex',justifyContent:'space-between',borderBottom:'1px solid rgba(255,255,255,.03)',padding:'2px 0'}}>
                <span>{r.l}</span><span style={{fontWeight:600,color:r.c}}>{fmt(r.v)}</span>
              </div>
            )}
          </div>
        </C>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Cumuls {yr} ‚Äî {moisEcoules} mois</div></div>
        <Tbl cols={[
          {k:'n',l:"Travailleur",b:1,r:r=>`${r.e.first||r.e.fn||'Emp'} ${r.e.last||''}`},
          {k:'g',l:"Brut YTD",a:'right',r:r=>fmt(r.grossY)},
          {k:'o',l:"ONSS YTD",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.onssY)}</span>},
          {k:'t',l:"PP YTD",a:'right',r:r=><span style={{color:'#a78bfa'}}>{fmt(r.taxY)}</span>},
          {k:'ne',l:"Net YTD",a:'right',r:r=><span style={{color:'#4ade80',fontWeight:600}}>{fmt(r.netY)}</span>},
          {k:'p',l:"Proj. 12 mois",a:'right',r:r=><span style={{color:'#c6a34e'}}>{fmt(r.proj12)}</span>},
        ]} data={data}/>
        {data.length>0&&<div style={{padding:'12px 18px',borderTop:'1px solid rgba(139,115,60,.1)',display:'flex',justifyContent:'space-between'}}>
          <span style={{fontSize:12,fontWeight:600,color:'#9e9b93'}}>TOTAUX</span>
          <div style={{display:'flex',gap:16,fontSize:12}}>
            <span>Brut: <b style={{color:'#e8e6e0'}}>{fmt(tot.gross)}</b></span>
            <span>Net: <b style={{color:'#4ade80'}}>{fmt(tot.net)}</b></span>
          </div>
        </div>}
      </C>
    </div>
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SAISIES-CESSIONS ‚Äî BAR√àME 2026 COMPLET
//  Source: AR 03/12/2025 (MB 10/12/2025) ‚Äî Art. 1409 ¬ß1 & ¬ß1bis Code judiciaire
//  SPF Emploi: emploi.belgique.be/fr/themes/remuneration/protection-de-la-remuneration/saisie-et-cession-sur-salaires
//  UCM, Partena Professional, Securex, Liantis ‚Äî Bar√®mes 2026
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Bar√®me saisie/cession sur REVENUS DU TRAVAIL 2026 (art. 1409 ¬ß1 CJ)
const SAISIE_2026_TRAVAIL=[
  {min:0,     max:1419.00, pct:0,   label:"Insaisissable"},
  {min:1419.01,max:1524.00, pct:20, label:"20% (tranche 2)"},
  {min:1524.01,max:1682.00, pct:30, label:"30% (tranche 3)"},
  {min:1682.01,max:1839.00, pct:40, label:"40% (tranche 4)"},
  {min:1839.01,max:Infinity, pct:100,label:"Illimit√© (tranche 5)"}
];
// Bar√®me saisie/cession sur REVENUS DE REMPLACEMENT 2026 (art. 1409 ¬ß1bis CJ)
const SAISIE_2026_REMPLACEMENT=[
  {min:0,     max:1419.00, pct:0,   label:"Insaisissable"},
  {min:1419.01,max:1524.00, pct:20, label:"20% (tranche 2)"},
  {min:1524.01,max:1839.00, pct:40, label:"40% (tranche 3)"},
  {min:1839.01,max:Infinity, pct:100,label:"Illimit√© (tranche 4)"}
];
const SAISIE_IMMUN_ENFANT_2026=88; // ‚Ç¨/enfant √† charge (AR 03/12/2025)
// Retenue max employeur (amendes, avances, caution): art.23 Loi 12/04/1965
const RETENUE_MAX_EMPLOYEUR_FRACTION=0.20; // 1/5 du net

// Calcul quotit√© saisissable
function calcQuotiteSaisissable(netMensuel,nbEnfantsCharge=0,isRemplacement=false,isPensionAlim=false){
  // Pension alimentaire = saisissable en TOTALIT√â (art. 1412 CJ)
  if(isPensionAlim)return{saisissable:netMensuel,protege:0,tranches:[],enfantImmun:0,note:"Cr√©ance alimentaire: saisissable en totalit√© (art. 1412 CJ)"};
  const bareme=isRemplacement?SAISIE_2026_REMPLACEMENT:SAISIE_2026_TRAVAIL;
  let totalSaisissable=0;const tranches=[];
  for(const t of bareme){
    if(netMensuel<=t.min)break;
    const dansLaTranche=Math.min(netMensuel,t.max)-t.min;
    if(dansLaTranche<=0)continue;
    const retenue=+(dansLaTranche*t.pct/100).toFixed(2);
    tranches.push({min:t.min,max:Math.min(t.max,netMensuel),pct:t.pct,montantTranche:+dansLaTranche.toFixed(2),retenue,label:t.label});
    totalSaisissable+=retenue;
  }
  // Immunisation enfants √† charge
  const enfantImmun=nbEnfantsCharge*SAISIE_IMMUN_ENFANT_2026;
  const saisissable=Math.max(0,+(totalSaisissable-enfantImmun).toFixed(2));
  const protege=+(netMensuel-saisissable).toFixed(2);
  return{saisissable,protege,tranches,enfantImmun,totalAvantImmun:+totalSaisissable.toFixed(2),note:null};
}

function SaisiesMod({s,d}){
  const [entries,setEntries]=useState([]);
  const [f,setF]=useState({eid:s.emps[0]?.id||'',type:"saisie",creancier:'',montant:0,priorite:1,mensualite:0,ref:"",dateSignif:''});
  const [simNet,setSimNet]=useState(2200);
  const [simEnfants,setSimEnfants]=useState(0);
  const [simType,setSimType]=useState('travail');
  const [simAlim,setSimAlim]=useState(false);
  const [tab,setTab]=useState('saisies'); // saisies | simulateur | bareme | secal | delegation
  const types=[
    {v:"saisie",l:"Saisie sur salaire (huissier)"},{v:"saisie_secal",l:"Saisie SECAL (SPF Finances)"},
    {v:"cession",l:"Cession volontaire"},{v:"pension_alim",l:"Pension alimentaire (totalit√©)"},
    {v:"delegation",l:"D√©l√©gation de sommes (juge)"},{v:"emprunt",l:"Retenue emprunt employeur (1/5)"}
  ];
  const add=()=>{const emp=s.emps.find(e=>e.id===f.eid);if(!emp||!f.creancier)return;
    const p=calc(emp,DPER,s.co);const isPensionAlim=f.type==='pension_alim'||f.type==='saisie_secal';
    const q=calcQuotiteSaisissable(p.net,emp.depChildren||0,false,isPensionAlim);
    const maxMens=f.type==='emprunt'?+(p.net*RETENUE_MAX_EMPLOYEUR_FRACTION).toFixed(2):q.saisissable;
    setEntries([...entries,{id:uid(),emp:`${emp.first} ${emp.last}`,eid:f.eid,...f,
      solde:f.montant,maxMensQuotite:maxMens,netRef:p.net,at:new Date().toISOString()}]);
    setF({...f,creancier:'',montant:0,mensualite:0,ref:"",dateSignif:''});
  };
  const totMens=entries.reduce((a,e)=>a+e.mensualite,0);
  const totSolde=entries.reduce((a,e)=>a+e.solde,0);

  // Simulation
  const sim=calcQuotiteSaisissable(simNet,simEnfants,simType==='remplacement',simAlim);

  const tabs=[{id:"saisies",l:"üìã Saisies actives"},{id:"simulateur",l:"üßÆ Simulateur"},{id:"bareme",l:"üìä Bar√®me 2026"},{id:"secal",l:"‚öñÔ∏è SECAL"},{id:"delegation",l:"üìù D√©l√©gation"},{id:"rcd",l:"üõ°Ô∏è M√©diation dettes"},{id:"codes",l:"üè¶ Codes bancaires"}];

  return <div>
    <PH title="Saisies & Cessions sur salaire" sub="Art. 1409-1412 Code judiciaire ‚Äî Bar√®me 2026 (AR 03/12/2025)"/>
    <div style={{display:'grid',gridTemplateColumns:'320px 1fr',gap:18}}>
      <C>
        <ST>Nouvelle saisie / cession</ST>
        <I label="Travailleur" value={f.eid} onChange={v=>setF({...f,eid:v})} options={s.emps.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <I label="Type" value={f.type} onChange={v=>setF({...f,type:v})} style={{marginTop:9}} options={types}/>
        <I label="Cr√©ancier / Huissier / SECAL" value={f.creancier} onChange={v=>setF({...f,creancier:v})} style={{marginTop:9}}/>
        <I label="R√©f. dossier" value={f.ref} onChange={v=>setF({...f,ref:v})} style={{marginTop:9}}/>
        <I label="Date signification" type="date" value={f.dateSignif} onChange={v=>setF({...f,dateSignif:v})} style={{marginTop:9}}/>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
          <I label="Montant dette (‚Ç¨)" type="number" value={f.montant} onChange={v=>setF({...f,montant:v})}/>
          <I label="Mensualit√© (‚Ç¨)" type="number" value={f.mensualite} onChange={v=>setF({...f,mensualite:v})}/>
        </div>
        <I label="Priorit√© (1=plus haute)" type="number" value={f.priorite} onChange={v=>setF({...f,priorite:v})} style={{marginTop:9}}/>
        <B onClick={add} style={{width:'100%',marginTop:14}}>Ajouter la saisie</B>
        <div style={{marginTop:14,padding:10,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div>Mensualit√©s retenues: <b style={{color:'#f87171'}}>{fmt(totMens)}</b></div>
          <div>Solde total dettes: <b style={{color:'#e8e6e0'}}>{fmt(totSolde)}</b></div>
          <div>Saisies actives: <b style={{color:'#e8e6e0'}}>{entries.length}</b></div>
        </div>
        {(f.type==='pension_alim'||f.type==='saisie_secal')&&<div style={{marginTop:8,padding:10,background:"rgba(248,113,113,.06)",borderRadius:8,fontSize:10.5,color:'#f87171',lineHeight:1.5}}>
          ‚ö†Ô∏è <b>Cr√©ance alimentaire</b>: saisissable en TOTALIT√â du net (art. 1412 CJ). Pas de quotit√© prot√©g√©e. Pas d'immunisation enfant.
        </div>}
        {f.type==='emprunt'&&<div style={{marginTop:8,padding:10,background:"rgba(251,146,60,.06)",borderRadius:8,fontSize:10.5,color:'#fb923c',lineHeight:1.5}}>
          ‚ö†Ô∏è <b>Retenue employeur</b>: max 1/5 du net en esp√®ces (art. 23 Loi 12/04/1965). Avances en argent, amendes, cautionnement.
        </div>}
        <div style={{marginTop:8,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          R√©partition au marc le franc si plusieurs cr√©anciers (sauf pension alimentaire = prioritaire). G√©n√©ration SEPA pour paiements cr√©anciers.
        </div>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{display:'flex',borderBottom:'1px solid rgba(139,115,60,.1)'}}>
          {tabs.map(t=><div key={t.id} onClick={()=>setTab(t.id)} style={{padding:'10px 14px',fontSize:11,cursor:'pointer',
            color:tab===t.id?'#c6a34e':'#9e9b93',borderBottom:tab===t.id?'2px solid #c6a34e':'2px solid transparent',
            fontWeight:tab===t.id?600:400}}>{t.l}</div>)}
        </div>

        {tab==='saisies'&&<div>
          <Tbl cols={[
            {k:'e',l:"Travailleur",b:1,r:r=>r.emp},
            {k:'t',l:"Type",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,
              background:r.type==='pension_alim'||r.type==='saisie_secal'?'rgba(248,113,113,.15)':'rgba(198,163,78,.1)',
              color:r.type==='pension_alim'||r.type==='saisie_secal'?'#f87171':'#c6a34e'}}>{types.find(t=>t.v===r.type)?.l}</span>},
            {k:'c',l:"Cr√©ancier",r:r=><span style={{fontSize:10.5}}>{r.creancier}</span>},
            {k:'r',l:"R√©f.",r:r=><span style={{fontSize:10,color:'#9e9b93'}}>{r.ref||'‚Äî'}</span>},
            {k:'mx',l:"Max/mois",a:'right',r:r=><span style={{color:'#fb923c',fontSize:11}}>{fmt(r.maxMensQuotite)}</span>},
            {k:'ms',l:"Retenu/mois",a:'right',r:r=><span style={{fontWeight:600,color:'#f87171'}}>{fmt(r.mensualite)}</span>},
            {k:'s',l:"Solde",a:'right',r:r=><span style={{fontWeight:600}}>{fmt(r.solde)}</span>},
            {k:'p',l:"Prio.",a:'center',r:r=>r.priorite}
          ]} data={entries}/>
          {entries.length===0&&<div style={{padding:24,textAlign:'center',color:'#9e9b93',fontSize:12}}>Aucune saisie ou cession active.</div>}
        </div>}

        {tab==='simulateur'&&<div style={{padding:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:14}}>üßÆ Simulateur quotit√© saisissable 2026</div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:12,marginBottom:16}}>
            <I label="Net mensuel (‚Ç¨)" type="number" value={simNet} onChange={setSimNet}/>
            <I label="Enfants √† charge" type="number" value={simEnfants} onChange={setSimEnfants}/>
            <I label="Type revenu" value={simType} onChange={setSimType} options={[{v:"travail",l:"Revenu du travail"},{v:"remplacement",l:"Rev. de remplacement"}]}/>
            <div><div style={{fontSize:10.5,color:'#9e9b93',marginBottom:4}}>Pension alimentaire?</div>
              <div onClick={()=>setSimAlim(!simAlim)} style={{padding:'8px 12px',borderRadius:6,cursor:'pointer',fontSize:11,
                background:simAlim?'rgba(248,113,113,.15)':'rgba(198,163,78,.06)',color:simAlim?'#f87171':'#9e9b93'}}>
                {simAlim?'‚úÖ OUI ‚Äî Totalit√©':'‚ùå NON ‚Äî Bar√®me normal'}
              </div>
            </div>
          </div>
          {/* R√©sultat simulation */}
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12,marginBottom:16}}>
            {[{l:"üí∞ Net mensuel",v:fmt(simNet),c:'#e8e6e0'},
              {l:"üîí Partie prot√©g√©e",v:fmt(sim.protege),c:'#4ade80'},
              {l:"‚ö° Saisissable",v:fmt(sim.saisissable),c:'#f87171'}
            ].map((x,i)=><div key={i} style={{padding:14,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}>
              <div style={{fontSize:10.5,color:'#9e9b93'}}>{x.l}</div>
              <div style={{fontSize:18,fontWeight:700,color:x.c,marginTop:4}}>{x.v}</div>
            </div>)}
          </div>
          {sim.note&&<div style={{padding:10,background:"rgba(248,113,113,.06)",borderRadius:8,fontSize:11,color:'#f87171',marginBottom:12}}>{sim.note}</div>}
          {sim.enfantImmun>0&&<div style={{padding:10,background:"rgba(167,139,250,.06)",borderRadius:8,fontSize:11,color:'#a78bfa',marginBottom:12}}>
            Immunisation enfants: {simEnfants} √ó {SAISIE_IMMUN_ENFANT_2026} ‚Ç¨ = <b>{fmt(sim.enfantImmun)}</b> d√©duit de la quotit√© saisissable
          </div>}
          {/* D√©tail par tranche */}
          <div style={{fontSize:12,fontWeight:600,color:'#e8e6e0',marginBottom:8}}>D√©tail par tranche</div>
          <table style={{width:'100%',borderCollapse:'collapse',fontSize:11.5}}>
            <thead><tr style={{borderBottom:'1px solid rgba(139,115,60,.15)'}}>
              <th style={{textAlign:'left',padding:'6px 10px',color:'#9e9b93',fontWeight:500}}>Tranche</th>
              <th style={{textAlign:'right',padding:'6px 10px',color:'#9e9b93',fontWeight:500}}>Dans tranche</th>
              <th style={{textAlign:'right',padding:'6px 10px',color:'#9e9b93',fontWeight:500}}>%</th>
              <th style={{textAlign:'right',padding:'6px 10px',color:'#9e9b93',fontWeight:500}}>Retenue</th>
            </tr></thead>
            <tbody>{sim.tranches.map((t,i)=><tr key={i} style={{borderBottom:'1px solid rgba(139,115,60,.06)'}}>
              <td style={{padding:'6px 10px',color:'#e8e6e0'}}>{fmt(t.min)} ‚Äî {t.max===Infinity?'‚àû':fmt(t.max)}</td>
              <td style={{padding:'6px 10px',textAlign:'right',color:'#9e9b93'}}>{fmt(t.montantTranche)}</td>
              <td style={{padding:'6px 10px',textAlign:'right',color:t.pct===0?'#4ade80':'#fb923c'}}>{t.pct}%</td>
              <td style={{padding:'6px 10px',textAlign:'right',fontWeight:600,color:t.retenue>0?'#f87171':'#4ade80'}}>{fmt(t.retenue)}</td>
            </tr>)}</tbody>
            <tfoot><tr style={{borderTop:'2px solid rgba(139,115,60,.15)'}}>
              <td colSpan={3} style={{padding:'8px 10px',fontWeight:600,color:'#e8e6e0'}}>Total avant immunisation</td>
              <td style={{padding:'8px 10px',textAlign:'right',fontWeight:700,color:'#f87171'}}>{fmt(sim.totalAvantImmun||sim.saisissable)}</td>
            </tr></tfoot>
          </table>
        </div>}

        {tab==='bareme'&&<div style={{padding:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:4}}>üìä Bar√®me saisies/cessions 2026</div>
          <div style={{fontSize:10.5,color:'#9e9b93',marginBottom:14}}>AR 03/12/2025 ‚Äî MB 10/12/2025 ‚Äî En vigueur au 01/01/2026</div>
          <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:8}}>Revenus du travail (art. 1409 ¬ß1 CJ)</div>
          <table style={{width:'100%',borderCollapse:'collapse',fontSize:11.5,marginBottom:18}}>
            <thead><tr style={{borderBottom:'1px solid rgba(139,115,60,.15)'}}>
              <th style={{textAlign:'left',padding:'6px 10px',color:'#9e9b93',fontWeight:500}}>R√©mun√©ration mensuelle nette</th>
              <th style={{textAlign:'right',padding:'6px 10px',color:'#9e9b93',fontWeight:500}}>Quotit√© saisissable</th>
              <th style={{textAlign:'right',padding:'6px 10px',color:'#9e9b93',fontWeight:500}}>Max retenue</th>
            </tr></thead>
            <tbody>{SAISIE_2026_TRAVAIL.map((t,i)=><tr key={i} style={{borderBottom:'1px solid rgba(139,115,60,.06)'}}>
              <td style={{padding:'6px 10px',color:'#e8e6e0'}}>{t.max===Infinity?`Au-del√† de ${fmt(t.min)}`:`${fmt(t.min)} ‚Äî ${fmt(t.max)}`}</td>
              <td style={{padding:'6px 10px',textAlign:'right',color:t.pct===0?'#4ade80':t.pct===100?'#f87171':'#fb923c',fontWeight:600}}>{t.pct===0?'Rien':t.pct===100?'Illimit√©':t.pct+'%'}</td>
              <td style={{padding:'6px 10px',textAlign:'right',color:'#9e9b93'}}>{t.pct===0?'0 ‚Ç¨':t.pct===100?'‚àû':fmt((t.max-t.min)*t.pct/100)}</td>
            </tr>)}</tbody>
          </table>
          <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:8}}>Revenus de remplacement (art. 1409 ¬ß1bis CJ)</div>
          <table style={{width:'100%',borderCollapse:'collapse',fontSize:11.5,marginBottom:18}}>
            <thead><tr style={{borderBottom:'1px solid rgba(139,115,60,.15)'}}>
              <th style={{textAlign:'left',padding:'6px 10px',color:'#9e9b93',fontWeight:500}}>Allocation mensuelle nette</th>
              <th style={{textAlign:'right',padding:'6px 10px',color:'#9e9b93',fontWeight:500}}>Quotit√© saisissable</th>
            </tr></thead>
            <tbody>{SAISIE_2026_REMPLACEMENT.map((t,i)=><tr key={i} style={{borderBottom:'1px solid rgba(139,115,60,.06)'}}>
              <td style={{padding:'6px 10px',color:'#e8e6e0'}}>{t.max===Infinity?`Au-del√† de ${fmt(t.min)}`:`${fmt(t.min)} ‚Äî ${fmt(t.max)}`}</td>
              <td style={{padding:'6px 10px',textAlign:'right',color:t.pct===0?'#4ade80':t.pct===100?'#f87171':'#fb923c',fontWeight:600}}>{t.pct===0?'Rien':t.pct===100?'Illimit√©':t.pct+'%'}</td>
            </tr>)}</tbody>
          </table>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
            <div style={{padding:12,background:"rgba(167,139,250,.06)",borderRadius:8}}>
              <div style={{fontSize:11.5,fontWeight:600,color:'#a78bfa',marginBottom:4}}>üë∂ Immunisation enfant √† charge</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.6}}>
                <b style={{color:'#e8e6e0'}}>{SAISIE_IMMUN_ENFANT_2026} ‚Ç¨</b>/enfant d√©duit de la quotit√© saisissable. Formulaire d√©claration (MB 30/11/2006). Cohabitation durable ou part contributive {'>'} 88 ‚Ç¨.
              </div>
            </div>
            <div style={{padding:12,background:"rgba(248,113,113,.06)",borderRadius:8}}>
              <div style={{fontSize:11.5,fontWeight:600,color:'#f87171',marginBottom:4}}>‚öñÔ∏è Pension alimentaire</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.6}}>
                Art. 1412 CJ: aucune limitation. <b style={{color:'#f87171'}}>Totalit√© du net saisissable</b>. Pas d'immunisation enfant. Priorit√© absolue sur autres cr√©anciers.
              </div>
            </div>
          </div>
        </div>}

        {tab==='secal'&&<div style={{padding:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:4}}>‚öñÔ∏è SECAL ‚Äî Service des Cr√©ances Alimentaires</div>
          <div style={{fontSize:10.5,color:'#9e9b93',marginBottom:14}}>SPF Finances ‚Äî Loi du 21/02/2003 ‚Äî secal@minfin.fed.be ‚Äî 0800 12 302</div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14,marginBottom:16}}>
            <div style={{padding:14,background:"rgba(96,165,250,.06)",borderRadius:8}}>
              <div style={{fontSize:12,fontWeight:600,color:'#60a5fa',marginBottom:6}}>üìå Missions du SECAL</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
                <div>1. R√©cup√©ration des pensions alimentaires impay√©es</div>
                <div>2. Versement d'avances sur pension alimentaire (enfants)</div>
                <div>3. Saisie sur salaire ou compte bancaire</div>
                <div>4. Plan de paiement avec le d√©biteur</div>
              </div>
            </div>
            <div style={{padding:14,background:"rgba(248,113,113,.06)",borderRadius:8}}>
              <div style={{fontSize:12,fontWeight:600,color:'#f87171',marginBottom:6}}>üí∞ Impact employeur (tiers-saisi)</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
                <div>‚Ä¢ R√©ception saisie-arr√™t du SECAL/huissier</div>
                <div>‚Ä¢ D√©claration de tiers-saisi sous <b style={{color:'#f87171'}}>15 jours</b></div>
                <div>‚Ä¢ Retenue sur <b style={{color:'#f87171'}}>totalit√© du net</b> (pension alim.)</div>
                <div>‚Ä¢ Virement au SECAL / huissier (pas au cr√©ancier direct)</div>
                <div>‚Ä¢ Formulaire enfant √† charge joint √† la d√©nonciation</div>
              </div>
            </div>
          </div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12,marginBottom:14}}>
            <div style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}>
              <div style={{fontSize:10,color:'#9e9b93'}}>Frais SECAL ‚Äî D√©biteur</div>
              <div style={{fontSize:16,fontWeight:700,color:'#f87171'}}>+10%</div>
              <div style={{fontSize:10,color:'#9e9b93'}}>du montant d√ª</div>
            </div>
            <div style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}>
              <div style={{fontSize:10,color:'#9e9b93'}}>Frais SECAL ‚Äî Cr√©ancier</div>
              <div style={{fontSize:16,fontWeight:700,color:'#fb923c'}}>‚àí5%</div>
              <div style={{fontSize:10,color:'#9e9b93'}}>des montants r√©cup√©r√©s</div>
            </div>
            <div style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}>
              <div style={{fontSize:10,color:'#9e9b93'}}>Condition intervention</div>
              <div style={{fontSize:16,fontWeight:700,color:'#60a5fa'}}>2 mois</div>
              <div style={{fontSize:10,color:'#9e9b93'}}>impay√©s sur 12 derniers mois</div>
            </div>
          </div>
          <div style={{padding:12,background:"rgba(96,165,250,.04)",borderRadius:8,fontSize:11,color:'#9e9b93',lineHeight:1.7}}>
            <b style={{color:'#60a5fa'}}>Proc√©dure pour le secr√©tariat social:</b><br/>
            1. R√©ception de la saisie-arr√™t (recommand√© ou huissier)<br/>
            2. V√©rification: titre ex√©cutoire valide, identit√© du travailleur<br/>
            3. Calcul de la quotit√© saisissable (totalit√© si pension alimentaire)<br/>
            4. D√©claration de tiers-saisi dans les 15 jours<br/>
            5. Retenue mensuelle sur la paie du travailleur<br/>
            6. Virement SEPA au SECAL/huissier (contre-d√©nonciation + 2 jours)<br/>
            7. Notification au travailleur via la fiche de paie<br/>
            8. Suivi du solde et cl√¥ture √† extinction de la dette
          </div>
        </div>}

        {tab==='delegation'&&<div style={{padding:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:4}}>üìù D√©l√©gation de sommes</div>
          <div style={{fontSize:10.5,color:'#9e9b93',marginBottom:14}}>Art. 203ter & 221 Code civil ‚Äî Le juge de la famille ordonne le paiement direct par l'employeur au cr√©ancier alimentaire.</div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14,marginBottom:14}}>
            <div style={{padding:14,background:"rgba(167,139,250,.06)",borderRadius:8}}>
              <div style={{fontSize:12,fontWeight:600,color:'#a78bfa',marginBottom:6}}>Principe</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
                <div>Le juge autorise le cr√©ancier alimentaire √† percevoir directement une partie du salaire aupr√®s de l'employeur.</div>
                <div style={{marginTop:6}}>‚Ä¢ Pas besoin d'huissier</div>
                <div>‚Ä¢ L'employeur paie directement le cr√©ancier</div>
                <div>‚Ä¢ Aucune limitation de quotit√© (pension alim.)</div>
                <div>‚Ä¢ Priorit√© sur les saisies ordinaires</div>
              </div>
            </div>
            <div style={{padding:14,background:"rgba(96,165,250,.06)",borderRadius:8}}>
              <div style={{fontSize:12,fontWeight:600,color:'#60a5fa',marginBottom:6}}>Obligations employeur</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
                <div>‚Ä¢ R√©ception de l'ordonnance du juge</div>
                <div>‚Ä¢ Retenue du montant fix√© sur le salaire</div>
                <div>‚Ä¢ Virement SEPA direct au b√©n√©ficiaire</div>
                <div>‚Ä¢ Mention sur la fiche de paie</div>
                <div>‚Ä¢ Notification si le contrat prend fin</div>
              </div>
            </div>
          </div>
          <div style={{padding:10,background:"rgba(248,113,113,.04)",borderRadius:8,fontSize:10.5,color:'#9e9b93',lineHeight:1.6}}>
            <b style={{color:'#f87171'}}>Diff√©rence avec la saisie:</b> la d√©l√©gation est ordonn√©e par le juge (pas l'huissier), le paiement va directement au cr√©ancier (pas √† l'huissier/SECAL), et elle peut porter sur le salaire futur sans attendre un d√©faut de paiement.
          </div>
        </div>}

        {tab==='rcd'&&<div style={{padding:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:4}}>üõ°Ô∏è R√®glement Collectif de Dettes (RCD)</div>
          <div style={{fontSize:10.5,color:'#9e9b93',marginBottom:14}}>Art. 1675/2 √† 1675/19 Code judiciaire ‚Äî Loi du 05/07/1998 ‚Äî Tribunal du travail</div>

          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14,marginBottom:16}}>
            <div style={{padding:14,background:"rgba(248,113,113,.06)",borderRadius:8}}>
              <div style={{fontSize:12,fontWeight:600,color:'#f87171',marginBottom:6}}>‚ö†Ô∏è Impact imm√©diat pour l'employeur</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.9}}>
                <div>1. R√©ception de l'<b style={{color:'#e8e6e0'}}>ordonnance d'admissibilit√©</b></div>
                <div>2. <b style={{color:'#f87171'}}>TOUTES les saisies/cessions suspendues</b></div>
                <div>3. Plus de paiement au travailleur directement</div>
                <div>4. <b style={{color:'#f87171'}}>Totalit√© du salaire</b> vers√©e sur le <b style={{color:'#e8e6e0'}}>compte du m√©diateur de dettes</b></div>
                <div>5. Le m√©diateur fixe le ¬´p√©cule¬ª (montant de vie digne)</div>
                <div>6. Obligation de r√©pondre aux demandes d'info du m√©diateur</div>
              </div>
            </div>
            <div style={{padding:14,background:"rgba(96,165,250,.06)",borderRadius:8}}>
              <div style={{fontSize:12,fontWeight:600,color:'#60a5fa',marginBottom:6}}>üìã Proc√©dure pour le secr√©tariat social</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.9}}>
                <div>1. Recevoir l'ordonnance du tribunal du travail</div>
                <div>2. Identifier le m√©diateur de dettes d√©sign√©</div>
                <div>3. R√©cup√©rer l'IBAN du <b style={{color:'#e8e6e0'}}>compte de m√©diation</b></div>
                <div>4. Suspendre TOUTES les saisies/cessions en cours</div>
                <div>5. Configurer le virement SEPA total vers le m√©diateur</div>
                <div>6. Adapter la fiche de paie (mention RCD)</div>
                <div>7. Informer les huissiers/cr√©anciers de la suspension</div>
                <div>8. Suivi jusqu'√† cl√¥ture ou r√©vocation (3 √† 5 ans)</div>
              </div>
            </div>
          </div>

          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:10,marginBottom:16}}>
            {[{l:"Qui peut demander",v:"Personne physique",d:"domicili√©e en BE, non commer√ßant",c:'#60a5fa'},
              {l:"Tribunal comp√©tent",v:"Tribunal du travail",d:"du domicile du d√©biteur",c:'#a78bfa'},
              {l:"Dur√©e plan",v:"3 √† 5 ans",d:"plan amiable ou judiciaire",c:'#fb923c'},
              {l:"Fin de proc√©dure",v:"Remise de dettes",d:"totale ou partielle possible",c:'#4ade80'}
            ].map((x,i)=><div key={i} style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}>
              <div style={{fontSize:10,color:'#9e9b93'}}>{x.l}</div>
              <div style={{fontSize:14,fontWeight:700,color:x.c,marginTop:2}}>{x.v}</div>
              <div style={{fontSize:9.5,color:'#9e9b93',marginTop:2}}>{x.d}</div>
            </div>)}
          </div>

          <div style={{marginBottom:14}}>
            <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:8}}>Deux phases possibles</div>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
              <div style={{padding:12,background:"rgba(198,163,78,.04)",borderRadius:8}}>
                <div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:4}}>1. Plan amiable</div>
                <div style={{fontSize:10.5,color:'#9e9b93',lineHeight:1.7}}>
                  Le m√©diateur tente un accord entre le d√©biteur et tous les cr√©anciers. Si accord ‚Üí jugement d'homologation. Le m√©diateur surveille le respect du plan.
                </div>
              </div>
              <div style={{padding:12,background:"rgba(198,163,78,.04)",borderRadius:8}}>
                <div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0',marginBottom:4}}>2. Plan judiciaire</div>
                <div style={{fontSize:10.5,color:'#9e9b93',lineHeight:1.7}}>
                  √Ä d√©faut d'accord, le juge impose un plan (3-5 ans). Il peut r√©duire les int√©r√™ts, reporter les dettes, voire accorder une remise de dettes totale (art. 1675/13bis CJ).
                </div>
              </div>
            </div>
          </div>

          <div style={{padding:12,background:"rgba(248,113,113,.04)",borderRadius:8,fontSize:11,color:'#9e9b93',lineHeight:1.7}}>
            <b style={{color:'#f87171'}}>R√©vocation possible si le travailleur:</b> contracte de nouvelles dettes, ne respecte pas le plan, dissimule des revenus, fait de fausses d√©clarations. En cas de r√©vocation ‚Üí toutes les saisies reprennent et les int√©r√™ts recommencent √† courir. Pas de nouvelle demande RCD possible pendant 5 ans.
          </div>

          <div style={{marginTop:14,padding:12,background:"rgba(167,139,250,.04)",borderRadius:8,fontSize:11,color:'#9e9b93',lineHeight:1.7}}>
            <b style={{color:'#a78bfa'}}>M√©diation amiable (non-judiciaire):</b> Avant le RCD, le travailleur peut passer par un service de m√©diation de dettes agr√©√© (CPAS, asbl). Le m√©diateur amiable n√©gocie avec les cr√©anciers sans intervention du tribunal. Si √©chec ‚Üí le travailleur peut demander le RCD au tribunal du travail.
          </div>
        </div>}

        {tab==='codes'&&<div style={{padding:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:4}}>üè¶ Codes bancaires de protection des revenus</div>
          <div style={{fontSize:10.5,color:'#9e9b93',marginBottom:14}}>Loi du 14/06/2004 ‚Äî AR du 04/07/2004 ‚Äî Protection des revenus vir√©s sur compte bancaire</div>

          <div style={{marginBottom:16,fontSize:11.5,color:'#9e9b93',lineHeight:1.7}}>
            Lorsque des revenus prot√©g√©s sont vir√©s sur un compte bancaire, la banque doit appliquer les m√™mes r√®gles d'insaisissabilit√©. L'employeur doit indiquer un <b style={{color:'#e8e6e0'}}>code de communication structur√©</b> dans le virement SEPA pour identifier la nature du revenu.
          </div>

          <table style={{width:'100%',borderCollapse:'collapse',fontSize:12,marginBottom:16}}>
            <thead><tr style={{borderBottom:'1px solid rgba(139,115,60,.15)'}}>
              <th style={{textAlign:'center',padding:'8px 12px',color:'#9e9b93',fontWeight:500,width:60}}>Code</th>
              <th style={{textAlign:'left',padding:'8px 12px',color:'#9e9b93',fontWeight:500}}>Type de revenu</th>
              <th style={{textAlign:'left',padding:'8px 12px',color:'#9e9b93',fontWeight:500}}>Protection</th>
              <th style={{textAlign:'left',padding:'8px 12px',color:'#9e9b93',fontWeight:500}}>Bar√®me applicable</th>
            </tr></thead>
            <tbody>
              {[
                {code:'/A/',type:"R√©mun√©ration du travail",prot:'Quotit√© prot√©g√©e',bar:'Bar√®me revenus du travail (art. 1409 ¬ß1)'},
                {code:'/B/',type:"Revenus de remplacement",prot:'Quotit√© prot√©g√©e',bar:'Bar√®me revenus remplacement (art. 1409 ¬ß1bis)'},
                {code:'/C/',type:"Indemnit√©s insaisissables",prot:'Totalement insaisissable',bar:'Art. 1410 ¬ß2 CJ (allocations familiales, CPAS, AMI...)'}
              ].map((r,i)=><tr key={i} style={{borderBottom:'1px solid rgba(139,115,60,.06)'}}>
                <td style={{padding:'8px 12px',textAlign:'center',fontWeight:700,color:'#c6a34e',fontSize:14}}>{r.code}</td>
                <td style={{padding:'8px 12px',color:'#e8e6e0'}}>{r.type}</td>
                <td style={{padding:'8px 12px',color:r.code==='/C/'?'#4ade80':'#fb923c',fontSize:11}}>{r.prot}</td>
                <td style={{padding:'8px 12px',fontSize:10.5,color:'#9e9b93'}}>{r.bar}</td>
              </tr>)}
            </tbody>
          </table>

          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14}}>
            <div style={{padding:14,background:"rgba(96,165,250,.06)",borderRadius:8}}>
              <div style={{fontSize:12,fontWeight:600,color:'#60a5fa',marginBottom:6}}>Obligation employeur</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
                <div>‚Ä¢ Indiquer le code <b style={{color:'#c6a34e'}}>/A/</b> dans la communication du virement de salaire</div>
                <div>‚Ä¢ La banque identifie le revenu et applique la protection</div>
                <div>‚Ä¢ Si saisie sur compte: la banque prot√®ge automatiquement la quotit√© insaisissable</div>
                <div>‚Ä¢ L'huissier doit demander le calcul √† la banque</div>
              </div>
            </div>
            <div style={{padding:14,background:"rgba(167,139,250,.06)",borderRadius:8}}>
              <div style={{fontSize:12,fontWeight:600,color:'#a78bfa',marginBottom:6}}>Revenus insaisissables (Code /C/)</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
                <div>‚Ä¢ Allocations familiales</div>
                <div>‚Ä¢ Revenu d'int√©gration sociale (CPAS)</div>
                <div>‚Ä¢ Allocations aux personnes handicap√©es</div>
                <div>‚Ä¢ Indemnit√© de maladie (AMI) partielle</div>
                <div>‚Ä¢ Pas de saisie possible (art. 1410 ¬ß2 CJ)</div>
              </div>
            </div>
          </div>

          <div style={{marginTop:14,padding:10,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:10.5,color:'#9e9b93',lineHeight:1.6}}>
            <b style={{color:'#c6a34e'}}>Dans Aureus Social Pro:</b> Le code /A/ est automatiquement ajout√© dans la communication structur√©e des virements SEPA de salaire. Pour les p√©cules de vacances et primes: m√™me code /A/. La Fiche 281.17 est g√©n√©r√©e automatiquement pour les rentes alimentaires vers√©es par l'employeur.
          </div>
        </div>}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RENTES ‚Äî Pensions alimentaires, AT, maladie prof., invalidit√©
//  + SECAL + d√©l√©gation de sommes + emprunt employeur
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function RentesMod({s,d}){
  const [entries,setEntries]=useState([]);
  const [f,setF]=useState({eid:s.emps[0]?.id||'',type:"pension_alim",beneficiaire:'',montant:0,iban:'',periodicite:'mensuel',ref:"",dateDebut:'',dateFin:''});
  const [tab,setTab]=useState('rentes');
  const types=[
    {v:"pension_alim",l:"Pension alimentaire (ex-conjoint)",cat:"alim"},
    {v:"contrib_alim",l:"Contribution alimentaire (enfants)",cat:"alim"},
    {v:"secal_avance",l:"Avance SECAL (SPF Finances)",cat:"alim"},
    {v:"delegation",l:"D√©l√©gation de sommes (ordonnance juge)",cat:"alim"},
    {v:"rente_at",l:"Rente AT (accident du travail)",cat:"rente"},
    {v:"rente_mp",l:"Rente maladie professionnelle (Fedris)",cat:"rente"},
    {v:"rente_invalidite",l:"Rente d\'invalidit√©",cat:"rente"},
    {v:"emprunt",l:"Remboursement emprunt employeur",cat:"emprunt"},
    {v:"autre_rente",l:"Autre rente fixe",cat:"autre"}
  ];
  const add=()=>{const emp=s.emps.find(e=>e.id===f.eid);if(!emp)return;
    setEntries([...entries,{id:uid(),emp:`${emp.first} ${emp.last}`,...f,at:new Date().toISOString()}]);
    setF({...f,beneficiaire:'',montant:0,iban:'',ref:"",dateDebut:'',dateFin:''});
  };
  const totMens=entries.reduce((a,e)=>a+(e.periodicite==='mensuel'?e.montant:e.periodicite==='trimestriel'?e.montant/3:e.montant/12),0);
  const tabs=[{id:"rentes",l:"üìã Rentes actives"},{id:"types",l:"üìñ Types de rentes"}];

  return <div>
    <PH title="Rentes & Obligations fixes" sub="Pensions alimentaires, AT, maladie professionnelle, invalidit√©, SECAL, d√©l√©gation"/>
    <div style={{display:'grid',gridTemplateColumns:'320px 1fr',gap:18}}>
      <C>
        <ST>Nouvelle rente / obligation</ST>
        <I label="Travailleur" value={f.eid} onChange={v=>setF({...f,eid:v})} options={s.emps.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <I label="Type" value={f.type} onChange={v=>setF({...f,type:v})} style={{marginTop:9}} options={types.map(t=>({v:t.v,l:t.l}))}/>
        <I label="B√©n√©ficiaire / Organisme" value={f.beneficiaire} onChange={v=>setF({...f,beneficiaire:v})} style={{marginTop:9}}/>
        <I label="R√©f. dossier / jugement" value={f.ref} onChange={v=>setF({...f,ref:v})} style={{marginTop:9}}/>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
          <I label="Date d√©but" type="date" value={f.dateDebut} onChange={v=>setF({...f,dateDebut:v})}/>
          <I label="Date fin (opt.)" type="date" value={f.dateFin} onChange={v=>setF({...f,dateFin:v})}/>
        </div>
        <I label="Montant (‚Ç¨)" type="number" value={f.montant} onChange={v=>setF({...f,montant:v})} style={{marginTop:9}}/>
        <I label="IBAN b√©n√©ficiaire" value={f.iban} onChange={v=>setF({...f,iban:v})} style={{marginTop:9}}/>
        <I label="P√©riodicit√©" value={f.periodicite} onChange={v=>setF({...f,periodicite:v})} style={{marginTop:9}} options={[{v:"mensuel",l:"Mensuel"},{v:"trimestriel",l:"Trimestriel"},{v:"annuel",l:"Annuel"}]}/>
        <B onClick={add} style={{width:'100%',marginTop:14}}>Ajouter</B>
        <div style={{marginTop:14,padding:10,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div>Rentes actives: <b style={{color:'#e8e6e0'}}>{entries.length}</b></div>
          <div>Charge mensuelle totale: <b style={{color:'#f87171'}}>{fmt(totMens)}</b></div>
        </div>
        <div style={{marginTop:8,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          G√©n√©ration automatique virements SEPA. Fiche 281.14 pour rentes alimentaires. Int√©gration fiche de paie.
        </div>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{display:'flex',borderBottom:'1px solid rgba(139,115,60,.1)'}}>
          {tabs.map(t=><div key={t.id} onClick={()=>setTab(t.id)} style={{padding:'10px 16px',fontSize:11.5,cursor:'pointer',
            color:tab===t.id?'#c6a34e':'#9e9b93',borderBottom:tab===t.id?'2px solid #c6a34e':'2px solid transparent',
            fontWeight:tab===t.id?600:400}}>{t.l}</div>)}
        </div>

        {tab==='rentes'&&<div>
          <Tbl cols={[
            {k:'e',l:"Travailleur",b:1,r:r=>r.emp},
            {k:'t',l:"Type",r:r=>{const tp=types.find(t=>t.v===r.type);const colors={alim:'#f87171',rente:'#a78bfa',emprunt:'#fb923c',autre:'#9e9b93'};
              return<span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:`rgba(198,163,78,.06)`,color:colors[tp?.cat]||'#9e9b93'}}>{tp?.l||r.type}</span>}},
            {k:'b',l:"B√©n√©ficiaire",r:r=><span style={{fontSize:10.5}}>{r.beneficiaire}</span>},
            {k:'r',l:"R√©f.",r:r=><span style={{fontSize:10,color:'#9e9b93'}}>{r.ref||'‚Äî'}</span>},
            {k:'m',l:"Montant",a:'right',r:r=><span style={{fontWeight:600,color:'#f87171'}}>{fmt(r.montant)}</span>},
            {k:'f',l:"Fr√©q.",r:r=><span style={{fontSize:10.5}}>{r.periodicite}</span>},
            {k:'d',l:"P√©riode",r:r=><span style={{fontSize:10,color:'#9e9b93'}}>{r.dateDebut||'‚Äî'} ‚Üí {r.dateFin||'ind√©f.'}</span>}
          ]} data={entries}/>
          {entries.length===0&&<div style={{padding:24,textAlign:'center',color:'#9e9b93',fontSize:12}}>Aucune rente ou obligation active.</div>}
        </div>}

        {tab==='types'&&<div style={{padding:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:14}}>üìñ Types de rentes & obligations</div>
          {[
            {cat:"Obligations alimentaires",color:'#f87171',items:[
              {l:"Pension alimentaire",d:"Vers√©e √† l'ex-conjoint suite √† divorce/s√©paration. Fix√©e par jugement. Fiche 281.14 obligatoire."},
              {l:"Contribution alimentaire",d:"Vers√©e pour les enfants. Fix√©e par le juge de la famille (art. 203 C.civ). Saisissable en totalit√©."},
              {l:"Avance SECAL",d:"Le SPF Finances verse des avances et r√©cup√®re aupr√®s du d√©biteur. +10% frais d√©biteur, ‚àí5% cr√©ancier."},
              {l:"D√©l√©gation de sommes",d:"Ordonnance du juge: l'employeur verse directement au cr√©ancier alimentaire (art. 203ter/221 C.civ)."}
            ]},
            {cat:"Rentes fixes (assurance / s√©curit√© sociale)",color:'#a78bfa',items:[
              {l:"Rente AT",d:"Rente suite √† accident du travail avec incapacit√© permanente. Vers√©e par l'assureur-loi. Capitalis√©e ou p√©riodique."},
              {l:"Rente maladie professionnelle",d:"Vers√©e par Fedris (Agence f√©d√©rale des risques professionnels). Indemnisation incapacit√© permanente."},
              {l:"Rente d\'invalidit√©",d:"INAMI ‚Äî apr√®s 1 an d'incapacit√© de travail. Vers√©e par la mutuelle. Statut invalide reconnu par le m√©decin-conseil."}
            ]},
            {cat:"Retenues employeur",color:'#fb923c',items:[
              {l:"Emprunt employeur",d:"Art. 23 Loi 12/04/1965: retenue max 1/5 du net. Avances en argent, cautionnement, amendes."}
            ]}
          ].map((g,i)=><div key={i} style={{marginBottom:16}}>
            <div style={{fontSize:12,fontWeight:600,color:g.color,marginBottom:8}}>{g.cat}</div>
            {g.items.map((it,j)=><div key={j} style={{padding:10,background:"rgba(198,163,78,.03)",borderRadius:6,marginBottom:6}}>
              <div style={{fontSize:11.5,fontWeight:600,color:'#e8e6e0'}}>{it.l}</div>
              <div style={{fontSize:10.5,color:'#9e9b93',marginTop:2}}>{it.d}</div>
            </div>)}
          </div>)}
        </div>}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ASSURANCE-LOI (Accident du travail)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function AssLoiMod({s,d}){
  const ae=s.emps||[];const [tab,setTab]=useState('overview');
  const n=ae.length;
  
  // Tarif AT selon secteur (base 2026 - Fedris)
  const sectors={bureau:{rate:0.30,label:"Bureau/Admin"},commerce:{rate:0.80,label:"Commerce"},construction:{rate:6.00,label:"Construction"},transport:{rate:3.50,label:"Transport"},horeca:{rate:2.00,label:"Horeca"},industrie:{rate:4.00,label:"Industrie"}};
  const [sec,setSec]=useState('bureau');
  const rate=sectors[sec]?.rate||0.30;
  const masse=ae.reduce((a,e)=>{const p=calc(e,DPER,s.co);return a+p.gross*12},0);
  const prime=masse*(rate/100);
  
  return <div>
    <PH title="Assurance Accidents du Travail" sub="Loi du 10/04/1971 ‚Äî Fedris ‚Äî Obligation l√©gale"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Masse salariale annuelle",v:fmt(masse),c:'#e8e6e0'},{l:"Taux AT",v:rate.toFixed(2)+'%',c:'#c6a34e'},{l:"Prime annuelle estim√©e",v:fmt(prime),c:'#f87171'},{l:"Travailleurs couverts",v:n,c:'#60a5fa'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"overview",l:"Vue d\'ensemble"},{v:"tarifs",l:"Tarifs par secteur"},{v:"sinistres",l:"Gestion sinistres"},{v:"legal",l:"Obligations"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    
    {tab==='overview'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Simulation prime AT</ST>
        <I label="Secteur d'activit√©" value={sec} onChange={setSec} options={Object.entries(sectors).map(([k,v])=>({v:k,l:`${v.label} (${v.rate}%)`}))}/>
        <div style={{marginTop:14,padding:16,background:"rgba(198,163,78,.06)",borderRadius:8,textAlign:'center'}}>
          <div style={{fontSize:10,color:'#5e5c56'}}>PRIME ANNUELLE ESTIM√âE</div>
          <div style={{fontSize:28,fontWeight:700,color:'#c6a34e',marginTop:4}}>{fmt(prime)}</div>
          <div style={{fontSize:11,color:'#5e5c56'}}>{n} trav. ¬∑ masse {fmt(masse)} ¬∑ taux {rate}%</div>
        </div>
        <div style={{marginTop:12,fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{l:"Prime min. l√©gale",v:"Selon assureur"},{l:"Franchise",v:"Aucune (couverture int√©grale)"},{l:"Paiement",v:"Annuel ou trimestriel"},{l:"D√©claration",v:"Masse salariale r√©elle N-1"}].map((r,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <span>{r.l}</span><span style={{fontWeight:600,color:'#e8e6e0'}}>{r.v}</span>
            </div>
          )}
        </div>
      </C>
      <C><ST>Couverture obligatoire</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{t:'Accident sur le lieu de travail',d:"Couvert √† 100% ‚Äî incapacit√© temporaire et permanente",c:'#4ade80'},
            {t:'Accident sur le chemin du travail',d:"Trajet normal domicile-travail. D√©tours autoris√©s limit√©s.",c:'#4ade80'},
            {t:'Incapacit√© temporaire totale',d:"90% du salaire plafonn√© les 30 premiers jours",c:'#60a5fa'},
            {t:'Incapacit√© permanente',d:"Rente selon % incapacit√© √ó salaire de base",c:'#fb923c'},
            {t:'D√©c√®s',d:"30√ó salaire de base annuel (max). Rentes aux ayants droit.",c:'#f87171'},
            {t:'Frais m√©dicaux',d:"Remboursement int√©gral des soins li√©s √† l'AT",c:'#a78bfa'},
          ].map((r,i)=><div key={i} style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <div style={{display:'flex',justifyContent:'space-between'}}><b style={{color:'#e8e6e0'}}>{r.t}</b><span style={{color:r.c,fontSize:10}}>‚óè</span></div>
            <div style={{fontSize:10.5,marginTop:1}}>{r.d}</div>
          </div>)}
        </div>
      </C>
    </div>}
    
    {tab==='tarifs'&&<C><ST>Tarifs indicatifs par secteur (2026)</ST>
      {Object.entries(sectors).map(([k,v])=>{const p=masse*(v.rate/100);return <div key={k} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'10px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
        <div><b style={{color:'#e8e6e0'}}>{v.label}</b><div style={{fontSize:10,color:'#5e5c56'}}>Taux: {v.rate}%</div></div>
        <span style={{fontSize:14,fontWeight:700,color:k===sec?'#c6a34e':'#9e9b93'}}>{fmt(p)}/an</span>
      </div>})}
      <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
        <b>Assureurs agr√©√©s:</b> AG Insurance, Ethias, AXA, Baloise, KBC, Federale, P&V<br/>
        <b>Fedris:</b> fedris.be ‚Äî Agence f√©d√©rale des risques professionnels
      </div>
    </C>}
    
    {tab==='sinistres'&&<C><ST>Proc√©dure de d√©claration AT</ST>
      <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
        {['1. Premiers soins + constat m√©dical',"2. D√©claration √† l'assureur dans les 8 jours calendrier","3. Formulaire de d√©claration AT (mod√®le l√©gal)","4. Certificat m√©dical initial (m√©decin)","5. D√©claration Fedris si incapacit√© > 4 jours","6. Suivi m√©dical et gu√©rison/consolidation","7. Indemnisation par l'assureur AT"].map((step,i)=>
          <div key={i} style={{padding:'5px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>{step}</div>
        )}
      </div>
      <div style={{marginTop:12,padding:10,background:"rgba(248,113,113,.06)",borderRadius:8,fontSize:10.5,color:'#f87171',lineHeight:1.5}}>
        <b>D√©lai:</b> 8 jours calendrier maximum pour d√©clarer l'AT<br/>
        <b>Sanction:</b> Amende administrative si d√©claration tardive
      </div>
    </C>}
    
    {tab==='legal'&&<C><ST>Obligations l√©gales</ST>
      <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
        {[{l:"Souscription obligatoire",d:"Tout employeur doit souscrire une assurance AT (Loi 10/04/1971)"},{l:"Couverture",d:"Tous les travailleurs, y compris int√©rimaires et stagiaires"},{l:"D√©claration masse salariale",d:"Annuelle ‚Äî base de calcul de la prime"},{l:"Registre AT",d:"Obligation de tenir un registre des accidents du travail"},{l:"Pr√©vention",d:"Plan de pr√©vention obligatoire (CPPT, conseiller pr√©vention)"}].map((r,i)=>
          <div key={i} style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <b style={{color:'#c6a34e'}}>{r.l}</b><div style={{fontSize:10.5,marginTop:1}}>{r.d}</div>
          </div>
        )}
      </div>
    </C>}
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ASSURANCE DE GROUPE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function AssGroupeMod({s,d}){
  const ae=s.emps||[];const [plan,setPlan]=useState('dc');const [pct,setPct]=useState(3);
  const masse=ae.reduce((a,e)=>{const p=calc(e,DPER,s.co);return a+p.gross*12},0);
  const cotAn=masse*(pct/100);const cotMens=cotAn/12;
  const taxe=cotAn*0.045;// taxe sur primes 4.5%
  
  return <div>
    <PH title="Assurance Groupe / Pension compl√©mentaire" sub="2√®me pilier ‚Äî LPC (Loi Vandenbroucke)"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Cotisation annuelle",v:fmt(cotAn),c:'#c6a34e'},{l:"Cotisation mensuelle",v:fmt(cotMens),c:'#e8e6e0'},{l:"Taxe sur primes (4,5%)",v:fmt(taxe),c:'#f87171'},{l:"Travailleurs affili√©s",v:ae.length,c:'#60a5fa'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'320px 1fr',gap:18}}>
      <div>
        <C><ST>Configuration</ST>
          <I label="Type de plan" value={plan} onChange={setPlan} options={[{v:"dc",l:"Contributions d√©finies (DC)"},{v:"db",l:"Prestations d√©finies (DB)"},{v:"cash",l:"Cash balance"}]}/>
          <I label="Taux cotisation (%)" type="number" value={pct} onChange={v=>setPct(+v)} style={{marginTop:9}}/>
          <div style={{marginTop:14,padding:14,background:"rgba(198,163,78,.06)",borderRadius:8,textAlign:'center'}}>
            <div style={{fontSize:10,color:'#5e5c56'}}>CO√õT TOTAL ANNUEL (prime + taxe)</div>
            <div style={{fontSize:26,fontWeight:700,color:'#c6a34e',marginTop:4}}>{fmt(cotAn+taxe)}</div>
          </div>
        </C>
        <C style={{marginTop:12}}><ST>Rendement garanti LPC</ST>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
            <div>Taux garanti: <b style={{color:'#c6a34e'}}>1,75%</b> (2026)</div>
            <div>Cotis. employeur: <b style={{color:'#e8e6e0'}}>min. 1,75%</b></div>
            <div>Cotis. travailleur: <b style={{color:'#e8e6e0'}}>min. 1,75%</b></div>
            <div>Plafond 80%: <b style={{color:'#e8e6e0'}}>Pension l√©gale + 2√®me pilier ‚â§ 80% dernier brut</b></div>
          </div>
        </C>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>D√©tail par travailleur</div></div>
        <Tbl cols={[
          {k:'n',l:"Travailleur",b:1,r:r=>`${r.first} ${r.last}`},
          {k:'b',l:"Brut annuel",a:'right',r:r=>{const p=calc(r,DPER,s.co);return fmt(p.gross*12)}},
          {k:'c',l:"Cotisation/an",a:'right',r:r=>{const p=calc(r,DPER,s.co);return <span style={{color:'#c6a34e',fontWeight:600}}>{fmt(p.gross*12*(pct/100))}</span>}},
          {k:'m',l:"Cotisation/mois",a:'right',r:r=>{const p=calc(r,DPER,s.co);return fmt(p.gross*(pct/100))}},
          {k:'t',l:"Taxe 4,5%",a:'right',r:r=>{const p=calc(r,DPER,s.co);return <span style={{color:'#f87171'}}>{fmt(p.gross*12*(pct/100)*0.045)}</span>}},
        ]} data={ae}/>
      </C>
    </div>
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  M√âDECINE DU TRAVAIL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function MedTravailMod({s,d}){
  const ae=s.emps||[];const [tab,setTab]=useState('planning');
  const [visite,setVisite]=useState([]);
  const n=ae.length;
  const coutUnit=91.50;// tarif 2026 SPMT/Cohezio/Securex
  const coutAn=n*coutUnit;
  
  // Planning based on risk categories
  const planning=ae.map(e=>{
    const risk=e.fn?.toLowerCase().includes('chauffeur')||e.fn?.toLowerCase().includes('ouvrier')?'elev√©':'standard';
    const freq=risk==='elev√©'?12:60;// mois entre visites
    const lastVisit=e.startD||'2025-01-15';
    const nextD=new Date(lastVisit);nextD.setMonth(nextD.getMonth()+freq);
    const isOverdue=nextD<new Date();
    return{e,risk,freq,lastVisit,nextD:nextD.toISOString().split('T')[0],isOverdue};
  });
  const overdue=planning.filter(p=>p.isOverdue).length;
  
  return <div>
    <PH title="M√©decine du Travail" sub="SEPPT ‚Äî Surveillance sant√©, planning, co√ªts"/>
    {/* KPIs */}
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Travailleurs soumis",v:n,c:'#60a5fa'},{l:"En retard",v:overdue,c:overdue>0?'#f87171':'#4ade80'},{l:"Co√ªt annuel",v:fmt(coutAn),c:'#c6a34e'},{l:"Tarif/trav.",v:"‚Ç¨"+coutUnit,c:'#9e9b93'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    {/* Tabs */}
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"planning",l:"Planning visites"},{v:"types",l:"Types d\'examens"},{v:"seppt",l:"SEPPT & Tarifs"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    
    {tab==='planning'&&<C style={{padding:0,overflow:'hidden'}}>
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Planning surveillance sant√©</div></div>
      <Tbl cols={[
        {k:'n',l:"Travailleur",b:1,r:r=>`${r.e.first||r.e.fn||'Emp'} ${r.e.last||''}`},
        {k:'f',l:"Fonction",r:r=><span style={{fontSize:11}}>{r.e.fn||'‚Äî'}</span>},
        {k:'r',l:"Risque",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:r.risk==='elev√©'?'rgba(248,113,113,.1)':'rgba(74,222,128,.1)',color:r.risk==='elev√©'?'#f87171':'#4ade80',fontWeight:600}}>{r.risk}</span>},
        {k:'fr',l:"Fr√©quence",r:r=><span style={{fontSize:11}}>{r.freq} mois</span>},
        {k:'l',l:"Derni√®re",r:r=><span style={{fontSize:11}}>{r.lastVisit}</span>},
        {k:'nx',l:"Prochaine",r:r=><span style={{fontWeight:600,color:r.isOverdue?'#f87171':'#4ade80'}}>{r.nextD} {r.isOverdue?'‚ö†':''}</span>},
      ]} data={planning}/>
    </C>}
    
    {tab==='types'&&<C><ST>Types d'examens m√©dicaux</ST>
      <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
        {[{t:'√âvaluation sant√© pr√©alable',d:"Avant mise au travail ‚Äî postes de s√©curit√©/vigilance",f:'Obligatoire',c:'#f87171'},
          {t:'√âvaluation sant√© p√©riodique',d:"Selon risque: annuel (√©lev√©) ou quinquennal (standard)",f:'12 ou 60 mois',c:'#60a5fa'},
          {t:'Examen de reprise',d:"Apr√®s absence > 4 semaines (maladie/accident)",f:'Dans les 10 jours ouvrables',c:'#fb923c'},
          {t:'Visite de pr√©-reprise',d:"√Ä la demande du travailleur pendant incapacit√©",f:'Facultatif',c:'#a78bfa'},
          {t:'Surveillance prolong√©e',d:"Exposition agents chimiques/biologiques",f:'Selon substance',c:'#f59e0b'},
          {t:'Examen de sortie',d:"Exposition √† des agents √† risque",f:'√Ä la fin du contrat',c:'#9e9b93'},
        ].map((r,i)=><div key={i} style={{padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
          <div style={{display:'flex',justifyContent:'space-between'}}><b style={{color:'#e8e6e0'}}>{r.t}</b><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:`${r.c}15`,color:r.c}}>{r.f}</span></div>
          <div style={{fontSize:10.5,marginTop:2}}>{r.d}</div>
        </div>)}
      </div>
    </C>}
    
    {tab==='seppt'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Services externes (SEPPT)</ST>
        {[{n:'Cohezio',z:'Bruxelles, Wallonie',t:'‚Ç¨91.50/trav./an'},{n:'SPMT-ARISTA',z:'Bruxelles, Wallonie',t:'‚Ç¨91.50/trav./an'},{n:'Securex Prevention',z:'Nationale',t:'‚Ç¨91.50/trav./an'},{n:'Mensura',z:'Nationale',t:'‚Ç¨91.50/trav./an'},{n:'Liantis',z:'Flandre, Bruxelles',t:'‚Ç¨91.50/trav./an'},{n:'IDEWE',z:'Flandre, Bruxelles',t:'‚Ç¨91.50/trav./an'}].map((r,i)=>
          <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
            <div><b style={{color:'#e8e6e0'}}>{r.n}</b><div style={{fontSize:10,color:'#5e5c56'}}>{r.z}</div></div>
            <span style={{color:'#c6a34e',fontWeight:600}}>{r.t}</span>
          </div>
        )}
      </C>
      <C><ST>Co√ªt pour votre entreprise</ST>
        <div style={{padding:16,textAlign:'center',background:"rgba(198,163,78,.06)",borderRadius:8,marginBottom:12}}>
          <div style={{fontSize:10,color:'#5e5c56'}}>CO√õT ANNUEL TOTAL</div>
          <div style={{fontSize:28,fontWeight:700,color:'#c6a34e',marginTop:4}}>{fmt(coutAn)}</div>
          <div style={{fontSize:11,color:'#5e5c56'}}>{n} trav. √ó ‚Ç¨{coutUnit}/an</div>
        </div>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          <div>Cotisation forfaitaire min.: <b style={{color:'#e8e6e0'}}>‚Ç¨91,50/trav./an</b></div>
          <div>Facturation: <b style={{color:'#e8e6e0'}}>Trimestrielle par SEPPT</b></div>
          <div>Base l√©gale: <b style={{color:'#e8e6e0'}}>Code du bien-√™tre au travail, Livre I, Titre 4</b></div>
        </div>
      </C>
    </div>}
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ALLOCATIONS FAMILIALES (Mod√®le G)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ALLOCATIONS FAMILIALES ‚Äî BAR√àMES 2026 PAR R√âGION
//  Sources: Groeipakket (Flandre sept 2025), FAMIWAL/Parentia (Wallonie idx 01/02/2025),
//  Famiris/Iriscare (Bruxelles idx 01/02/2025), Ostbelgien (CG)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const AF_REGIONS={
  VL:{n:'Flandre',ic:'üü°',sys:'Groeipakket',cutoff:2019,
    caisses:['Fons',"MyFamily","Infino","KidsLife","Parentia"],
    naissance:{first:1269.25,next:1269.25},
    base:[{age:0,to:24,amt:184.62}],
    ancien:{rang1:108.57,rang2:200.79,rang3plus:267.02,
      suppAge:{6:17.28,12:24.84,18:29.52}},
    note:"Indexation annuelle en septembre (min +2%). Dernier idx: 01/09/2025."},
  WAL:{n:'Wallonie',ic:'üü†',sys:'AVIQ / D√©cret wallon',cutoff:2020,
    caisses:['FAMIWAL',"Camille","Infino","KidsLife","Parentia"],
    naissance:{first:1367.74,next:621.70},
    base:[{age:0,to:17,amt:192.73},{age:18,to:24,amt:205.16}],
    orphelin1:96.37,orphelin2:435.19,
    primeScolaire:[{age:0,to:4,amt:24.87},{age:5,to:10,amt:37.30},{age:11,to:16,amt:62.17},{age:17,to:24,amt:99.47}],
    ancien:{rang1:108.57,rang2:200.79,rang3plus:267.02,
      suppAge:{6:17.28,12:24.84,18:29.52}},
    note:"Indexation li√©e √† l'indice-sant√© (pivot). Dernier idx: 01/02/2025."},
  BXL:{n:'Bruxelles',ic:'üîµ',sys:'Iriscare / Ordonnance 2019',cutoff:2020,
    caisses:['Famiris',"Infino","Parentia","KidsLife","BrusselsFamily"],
    naissance:{first:1367.74,next:621.70},
    base:[{age:0,to:11,amt:168.93},{age:12,to:17,amt:180.19},{age:18,to:24,amt:191.45,note:"si √©tudes sup."}],
    ancienReduction:11.26,
    ancien:{rang1:108.57,rang2:200.79,rang3plus:267.02,
      suppAge:{6:17.28,12:24.84,18:29.52}},
    note:"Indexation li√©e √† l'indice-sant√© (pivot). Dernier idx: 01/02/2025. Si revenu > 39.792,84‚Ç¨ et pas de suppl√©ment ‚Üí base fixe 168,93‚Ç¨."},
  CG:{n:'Communaut√© germanophone',ic:'üü¢',sys:'Ostbelgien Familienzulagen',cutoff:2019,
    caisses:['Ostbelgien Dienststelle'],
    naissance:{first:1376.76,next:1376.76},
    base:[{age:0,to:24,amt:175.00}],
    note:"Syst√®me propre Communaut√© germanophone. Montants indicatifs."}
};
const AF_CAISSES_ALL=[
  {id:"famiwal",n:'FAMIWAL',reg:'WAL',ic:'üü†'},{id:"camille",n:'Camille',reg:'WAL',ic:'üü†'},
  {id:"infino_w",n:'Infino (Wallonie)',reg:'WAL',ic:'üü†'},{id:"kidslife_w",n:'KidsLife (Wallonie)',reg:'WAL',ic:'üü†'},
  {id:"parentia_w",n:'Parentia (Wallonie)',reg:'WAL',ic:'üü†'},
  {id:"famiris",n:'Famiris',reg:'BXL',ic:'üîµ'},{id:"infino_b",n:'Infino (Bruxelles)',reg:'BXL',ic:'üîµ'},
  {id:"parentia_b",n:'Parentia (Bruxelles)',reg:'BXL',ic:'üîµ'},{id:"kidslife_b",n:'KidsLife (Bruxelles)',reg:'BXL',ic:'üîµ'},
  {id:"brussels_family",n:'BrusselsFamily',reg:'BXL',ic:'üîµ'},
  {id:"fons",n:'Fons',reg:'VL',ic:'üü°'},{id:"myfamily",n:'MyFamily',reg:'VL',ic:'üü°'},
  {id:"infino_v",n:'Infino (Flandre)',reg:'VL',ic:'üü°'},{id:"kidslife_v",n:'KidsLife (Flandre)',reg:'VL',ic:'üü°'},
  {id:"parentia_v",n:'Parentia (Flandre)',reg:'VL',ic:'üü°'},
  {id:"ostbelgien",n:'Ostbelgien',reg:'CG',ic:'üü¢'}
];

function calcAllocEnfant(region,birthYear,age){
  const reg=AF_REGIONS[region];if(!reg)return 0;
  const isNew=birthYear>=reg.cutoff;
  if(isNew){
    const tranche=reg.base.find(t=>age>=t.age&&age<=t.to);
    return tranche?tranche.amt:0;
  } else {
    if(region==='BXL'){
      const tranche=reg.base.find(t=>age>=t.age&&age<=t.to);
      return tranche?Math.max(tranche.amt-(reg.ancienReduction||0),0):0;
    }
    return reg.ancien?reg.ancien.rang1:0;
  }
}

function AllocFamMod({s,d}){
  const [yr,setYr]=useState(new Date().getFullYear());
  const [region,setRegion]=useState('BXL');
  const [viewTab,setViewTab]=useState('liste');
  const reg=AF_REGIONS[region];
  const ae=s.emps.filter(e=>e.status==='active'&&e.depChildren>0);

  const data=ae.map(e=>{
    const children=[];
    const nKids=e.depChildren||0;const nHandi=e.handiChildren||0;
    for(let i=0;i<nKids;i++){
      const estAge=e.childrenAges?e.childrenAges[i]:(i===0?5:3+i*2);
      const estBirth=yr-estAge;
      const base=calcAllocEnfant(region,estBirth,estAge);
      const isHandi=i<nHandi;
      children.push({age:estAge,birthYear:estBirth,base,handi:isHandi,
        handiSuppl:isHandi?337.84:0,
        total:base+(isHandi?337.84:0)});
    }
    const totalMois=children.reduce((a,c)=>a+c.total,0);
    return{emp:`${e.first||e.fn||'Emp'} ${e.last||''}`,niss:e.niss,enfants:nKids,handi:nHandi,
      children,totalMois,caisse:e.allocCaisse||AF_CAISSES_ALL.find(c=>c.reg===region)?.n||'‚Äî',startD:e.startD};
  });
  const totGlobal=data.reduce((a,r)=>a+r.totalMois,0);
  const totEnfants=data.reduce((a,r)=>a+r.enfants,0);

  const tabs=[{id:"liste",l:"üë• Par travailleur"},{id:"bareme",l:"üìä Bar√®mes "+reg.n},{id:"caisses",l:"üè¶ Caisses"},{id:"modeleG",l:"üìÑ Mod√®le G"}];

  return <div>
    <PH title="Allocations Familiales" sub={`${reg.ic} ${reg.n} ‚Äî ${reg.sys} ‚Äî Bar√®mes index√©s 2025/2026`}/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <I label="R√©gion du domicile" value={region} onChange={setRegion} options={Object.entries(AF_REGIONS).map(([k,v])=>({v:k,l:`${v.ic} ${v.n}`}))}/>
        <I label="Ann√©e" type="number" value={yr} onChange={v=>setYr(v)}/>
        <div style={{marginTop:14,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>R√©sum√© {yr} ‚Äî {reg.ic} {reg.n}</div>
          <div>Travailleurs avec enfants: <b style={{color:'#e8e6e0'}}>{data.length}</b></div>
          <div>Total enfants: <b style={{color:'#e8e6e0'}}>{totEnfants}</b></div>
          <div>Estimation totale/mois: <b style={{color:'#4ade80'}}>{fmt(totGlobal)}</b></div>
          <div style={{fontSize:10.5,marginTop:8,color:'#60a5fa'}}>Prime naissance: {fmt(reg.naissance.first)} (1er) / {fmt(reg.naissance.next)} (suivant)</div>
        </div>
        <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.6}}>
          <div style={{fontWeight:600,marginBottom:4}}>‚ÑπÔ∏è Cadre l√©gal</div>
          <div>Syst√®me: {reg.sys}</div>
          <div>Enfants n√©s ‚â• {reg.cutoff}: nouveaux montants</div>
          <div>Enfants n√©s {'<'} {reg.cutoff}: ancien syst√®me f√©d√©ral</div>
          <div style={{marginTop:4,fontSize:10,color:'#9e9b93'}}>{reg.note}</div>
        </div>
        <div style={{marginTop:12,padding:10,background:"rgba(167,139,250,.06)",borderRadius:8,fontSize:10.5,color:'#a78bfa',lineHeight:1.5}}>
          <div style={{fontWeight:600,marginBottom:4}}>üìã R√¥le du secr√©tariat social</div>
          <div>‚Ä¢ √âtablir le Mod√®le G (attestation employeur)</div>
          <div>‚Ä¢ Transmettre √† la caisse d'alloc. familiales</div>
          <div>‚Ä¢ L'employeur ne paie pas les alloc. familiales</div>
          <div>‚Ä¢ Celles-ci sont vers√©es par la caisse au b√©n√©ficiaire</div>
        </div>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{display:'flex',borderBottom:'1px solid rgba(139,115,60,.1)'}}>
          {tabs.map(t=><div key={t.id} onClick={()=>setViewTab(t.id)} style={{padding:'10px 16px',fontSize:11.5,cursor:'pointer',
            color:viewTab===t.id?'#c6a34e':'#9e9b93',borderBottom:viewTab===t.id?'2px solid #c6a34e':'2px solid transparent',
            fontWeight:viewTab===t.id?600:400}}>{t.l}</div>)}
        </div>

        {viewTab==='liste'&&<div>
          <Tbl cols={[
            {k:'e',l:"Travailleur",b:1,r:r=>r.emp},
            {k:'n',l:"NISS",r:r=><span style={{fontSize:10,color:'#9e9b93'}}>{r.niss}</span>},
            {k:'en',l:"Enfants",a:'right',r:r=>r.enfants},
            {k:'h',l:"Handi.",a:'right',r:r=>r.handi>0?<span style={{color:'#a78bfa'}}>{r.handi}</span>:'‚Äî'},
            {k:'c',l:"Caisse",r:r=><span style={{fontSize:10,color:'#60a5fa'}}>{r.caisse}</span>},
            {k:'t',l:"Estim√©/mois",a:'right',r:r=><span style={{fontWeight:600,color:'#4ade80'}}>{fmt(r.totalMois)}</span>}
          ]} data={data}/>
          {data.length===0&&<div style={{padding:24,textAlign:'center',color:'#9e9b93',fontSize:12}}>Aucun travailleur actif avec enfants √† charge.</div>}
        </div>}

        {viewTab==='bareme'&&<div style={{padding:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:12}}>{reg.ic} Bar√®mes {reg.n} ‚Äî Enfants n√©s ‚â• {reg.cutoff}</div>
          <table style={{width:'100%',borderCollapse:'collapse',fontSize:12}}>
            <thead><tr style={{borderBottom:'1px solid rgba(139,115,60,.15)'}}>
              <th style={{textAlign:'left',padding:'8px 12px',color:'#9e9b93',fontWeight:500}}>Tranche d'√¢ge</th>
              <th style={{textAlign:'right',padding:'8px 12px',color:'#9e9b93',fontWeight:500}}>Montant/mois</th>
              <th style={{textAlign:'left',padding:'8px 12px',color:'#9e9b93',fontWeight:500}}>Note</th>
            </tr></thead>
            <tbody>{reg.base.map((t,i)=><tr key={i} style={{borderBottom:'1px solid rgba(139,115,60,.06)'}}>
              <td style={{padding:'8px 12px',color:'#e8e6e0'}}>{t.age} ‚Äî {t.to} ans</td>
              <td style={{padding:'8px 12px',textAlign:'right',fontWeight:600,color:'#4ade80'}}>{fmt(t.amt)}</td>
              <td style={{padding:'8px 12px',fontSize:10.5,color:'#9e9b93'}}>{t.note||'‚Äî'}</td>
            </tr>)}</tbody>
          </table>
          <div style={{marginTop:16,fontSize:12,fontWeight:600,color:'#e8e6e0'}}>Prime de naissance / adoption</div>
          <div style={{marginTop:6,fontSize:11.5,color:'#9e9b93'}}>
            1er enfant: <b style={{color:'#4ade80'}}>{fmt(reg.naissance.first)}</b> ‚Äî Suivant: <b style={{color:'#fb923c'}}>{fmt(reg.naissance.next)}</b>
          </div>
          {reg.primeScolaire&&<><div style={{marginTop:16,fontSize:12,fontWeight:600,color:'#e8e6e0'}}>Prime scolaire annuelle</div>
            <table style={{width:'100%',borderCollapse:'collapse',fontSize:12,marginTop:6}}>
              <tbody>{reg.primeScolaire.map((p,i)=><tr key={i} style={{borderBottom:'1px solid rgba(139,115,60,.06)'}}>
                <td style={{padding:'6px 12px',color:'#e8e6e0'}}>{p.age} ‚Äî {p.to} ans</td>
                <td style={{padding:'6px 12px',textAlign:'right',color:'#60a5fa'}}>{fmt(p.amt)}/an</td>
              </tr>)}</tbody>
            </table></>}
          {reg.ancien&&<div style={{marginTop:16,padding:12,background:"rgba(251,146,60,.04)",borderRadius:8}}>
            <div style={{fontSize:11.5,fontWeight:600,color:'#fb923c',marginBottom:6}}>Ancien syst√®me (enfants n√©s {'<'} {reg.cutoff})</div>
            <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
              <div>Rang 1: {fmt(reg.ancien.rang1)} ‚Äî Rang 2: {fmt(reg.ancien.rang2)} ‚Äî Rang 3+: {fmt(reg.ancien.rang3plus)}</div>
              <div>Suppl√©ment d'√¢ge: +{fmt(reg.ancien.suppAge[6])} (6 ans), +{fmt(reg.ancien.suppAge[12])} (12 ans), +{fmt(reg.ancien.suppAge[18])} (18 ans)</div>
            </div>
          </div>}
          <div style={{marginTop:12,fontSize:10,color:'#9e9b93',fontStyle:'italic'}}>{reg.note}</div>
        </div>}

        {viewTab==='caisses'&&<div style={{padding:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:12}}>Caisses d'allocations familiales par r√©gion</div>
          {Object.entries(AF_REGIONS).map(([k,r])=><div key={k} style={{marginBottom:16}}>
            <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:6}}>{r.ic} {r.n}</div>
            <div style={{display:'flex',flexWrap:'wrap',gap:8}}>
              {AF_CAISSES_ALL.filter(c=>c.reg===k).map(c=><div key={c.id} style={{padding:'6px 12px',background:"rgba(198,163,78,.06)",borderRadius:6,fontSize:11,color:'#e8e6e0'}}>
                {c.ic} {c.n}
              </div>)}
            </div>
          </div>)}
          <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
            Le travailleur est affili√© √† la caisse correspondant √† son domicile (et non au si√®ge de l'employeur). En cas de d√©m√©nagement inter-r√©gional, la comp√©tence change.
          </div>
        </div>}

        {viewTab==='modeleG'&&<div style={{padding:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>Mod√®le G ‚Äî Attestation employeur {yr}</div>
          <div style={{fontSize:11,color:'#9e9b93',marginBottom:16}}>Attestation d'occupation transmise √† la caisse d'allocations familiales du travailleur. Ce document confirme l'emploi et permet le calcul/maintien des droits.</div>
          <Tbl cols={[
            {k:'e',l:"Travailleur",b:1,r:r=>r.emp},
            {k:'n',l:"NISS",r:r=><span style={{fontSize:10,color:'#9e9b93'}}>{r.niss}</span>},
            {k:'d',l:"D√©but contrat",r:r=><span style={{fontSize:10.5}}>{r.startD||'‚Äî'}</span>},
            {k:'en',l:"Enfants",a:'right',r:r=>r.enfants},
            {k:'c',l:"Caisse",r:r=><span style={{fontSize:10,color:'#60a5fa'}}>{r.caisse}</span>}
          ]} data={data}/>
          <div style={{marginTop:14,display:'flex',gap:10}}>
            <B style={{fontSize:11}}>üìÑ G√©n√©rer Mod√®le G (PDF)</B>
            <B style={{fontSize:11,background:"rgba(96,165,250,.12)",color:'#60a5fa'}}>üì§ Envoi caisse</B>
          </div>
        </div>}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CAISSE VACANCES ANNUELLES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function CaisseVacMod({s,d}){
  const ae=s.emps||[];
  const ouvriers=ae.filter(e=>e.statut==='ouvrier');
  const employes=ae.filter(e=>e.statut!=='ouvrier');
  
  // Ouvriers: caisse de vacances (ONVA) ‚Äî 15,84% sur brut 108%
  const masseOuv=ouvriers.reduce((a,e)=>{const p=calc(e,DPER,s.co);return a+p.gross*12*1.08},0);
  const cotOuv=masseOuv*0.1584;
  // Employ√©s: p√©cule vacances pay√© par employeur
  const masseEmp=employes.reduce((a,e)=>{const p=calc(e,DPER,s.co);return a+p.gross*12},0);
  const pecSimple=masseEmp*0.0769;// 7,69% pour simple p√©cule
  const pecDouble=masseEmp*0.0769;// 7,69% pour double p√©cule
  
  return <div>
    <PH title="Caisse de Vacances / P√©cule" sub="ONVA (ouvriers) ‚Äî Employeur (employ√©s) ‚Äî Calcul annuel"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Ouvriers",v:ouvriers.length,c:'#f87171',s:'Via ONVA'},{l:"Employ√©s",v:employes.length,c:'#60a5fa',s:'Via employeur'},{l:"Cotisation ONVA",v:fmt(cotOuv),c:'#fb923c',s:'15,84% sur 108%'},{l:"P√©cule employ√©s",v:fmt(pecSimple+pecDouble),c:'#c6a34e',s:'Simple + double'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
          <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{k.s}</div>
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Ouvriers ‚Äî Caisse ONVA</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{l:"Masse salariale (√ó108%)",v:fmt(masseOuv)},{l:"Taux cotisation",v:"15,84%"},{l:"Cotisation annuelle",v:fmt(cotOuv)},{l:"Paiement",v:"Par ONVA au travailleur"},{l:"P√©riode",v:"Mai-Juin (ann√©e N pour N-1)"}].map((r,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'5px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <span>{r.l}</span><span style={{fontWeight:600,color:'#e8e6e0'}}>{r.v}</span>
            </div>
          )}
        </div>
        <div style={{marginTop:10,padding:8,background:"rgba(248,113,113,.06)",borderRadius:6,fontSize:10.5,color:'#f87171'}}>
          <b>ONVA:</b> L'employeur paie la cotisation via ONSS. L'ONVA verse directement le p√©cule aux ouvriers.
        </div>
      </C>
      <C><ST>Employ√©s ‚Äî P√©cule employeur</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{l:"Simple p√©cule (7,69%)",v:fmt(pecSimple)},{l:"Double p√©cule (7,69%)",v:fmt(pecDouble)},{l:"Total provision",v:fmt(pecSimple+pecDouble)},{l:"Paiement simple",v:"Avec salaire du mois de vacances"},{l:"Paiement double",v:"Mai-Juin (avant vacances principales)"}].map((r,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'5px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <span>{r.l}</span><span style={{fontWeight:600,color:'#e8e6e0'}}>{r.v}</span>
            </div>
          )}
        </div>
        <div style={{marginTop:10,padding:8,background:"rgba(96,165,250,.06)",borderRadius:6,fontSize:10.5,color:'#60a5fa'}}>
          <b>Provision:</b> Constituer une provision mensuelle de {fmt((pecSimple+pecDouble)/12)} pour couvrir le double p√©cule.
        </div>
      </C>
    </div>
    <C style={{marginTop:12}}><ST>D√©tail par travailleur</ST>
      <Tbl cols={[
        {k:'n',l:"Travailleur",b:1,r:r=>`${r.first} ${r.last}`},
        {k:'st',l:"Statut",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:r.statut==='ouvrier'?'rgba(248,113,113,.1)':'rgba(96,165,250,.1)',color:r.statut==='ouvrier'?'#f87171':'#60a5fa'}}>{r.statut==='ouvrier'?'Ouvrier':'Employ√©'}</span>},
        {k:'b',l:"Brut annuel",a:'right',r:r=>{const p=calc(r,DPER,s.co);return fmt(p.gross*12)}},
        {k:'p',l:"P√©cule/Cotis.",a:'right',r:r=>{const p=calc(r,DPER,s.co);const isO=r.statut==='ouvrier';return <span style={{fontWeight:600,color:'#c6a34e'}}>{fmt(isO?p.gross*12*1.08*0.1584:p.gross*12*0.1538)}</span>}},
        {k:'v',l:"Via",r:r=>r.statut==='ouvrier'?'ONVA':'Employeur'},
      ]} data={ae}/>
    </C>
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  OP√âRATIONS BANCAIRES (SEPA)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function SEPAMod({s,d}){
  const [per,setPer]=useState({m:new Date().getMonth()+1,y:new Date().getFullYear()});
  const [gen,setGen]=useState(null);
  const [payType,setPayType]=useState('all'); // all, salaires, onss, pp, css
  const ae=s.emps.filter(e=>e.status==='active');

  const run=()=>{
    // Calculer toutes les paies
    const paies=ae.map(emp=>{const p=calc(emp,{...DPER,month:per.m,year:per.y},s.co);return{emp,p};});

    // 1. VIREMENTS SALAIRES (vers travailleurs)
    const virSal=paies.map(({emp,p})=>({
      type:"SAL", nom:`${emp.first} ${emp.last}`, iban:emp.iban,
      montant:p.net, ref:`SAL-${per.y}${String(per.m).padStart(2,"0")}-${emp.last.toUpperCase().slice(0,6)}`,
      communication:`Salaire ${MN[per.m-1]} ${per.y} ‚Äî ${emp.first} ${emp.last}`,
      statut:emp.statut==='ouvrier'?'Ouvrier':'Employ√©',
    }));
    const totSal=virSal.reduce((a,v)=>a+v.montant,0);

    // 2. VIREMENT ONSS (vers ONSS ‚Äî trimestriel)
    const totOnssE=paies.reduce((a,{p})=>a+p.onssE,0);
    const totOnssW=paies.reduce((a,{p})=>a+p.onssNet,0);
    const virOnss=[{
      type:"ONSS", nom:"Office National de S√©curit√© Sociale",
      iban:'BE76 6790 0001 6128', bic:'PCHQBEBB',
      montant:totOnssE+totOnssW,
      ref:s.co.onss?`+++${(s.co.onss||'').replace(/\D/g,"").slice(0,3)}/${(s.co.onss||'').replace(/\D/g,"").slice(3,7)}/${String(per.y).slice(2)}${String(per.m).padStart(2,"0")}+++`:`ONSS-${per.y}${String(per.m).padStart(2,"0")}`,
      communication:`Cotisations ONSS ${per.m>9?'T4':per.m>6?'T3':per.m>3?'T2':'T1'}/${per.y} ‚Äî ${s.co.onss||''}`,
      detail:`Patronales: ${fmt(totOnssE)} + Personnelles: ${fmt(totOnssW)}`,
    }];

    // 3. VIREMENT PP (vers SPF Finances ‚Äî FINPROF)
    const totPP=paies.reduce((a,{p})=>a+p.tax,0);
    const totCSS=paies.reduce((a,{p})=>a+p.css,0);
    const virPP=[{
      type:"PP", nom:"SPF Finances ‚Äî Pr√©compte professionnel",
      iban:'BE39 6792 0022 9319', bic:'PCHQBEBB',
      montant:totPP,
      ref:`274-${per.y}${String(per.m).padStart(2,"0")}-${(s.co.vat||'').replace(/\D/g,"")}`,
      communication:`PP ${MN[per.m-1]} ${per.y} ‚Äî TVA ${s.co.vat}`,
    },{
      type:"CSS", nom:"SPF Finances ‚Äî Cotisation sp√©ciale SS",
      iban:'BE39 6792 0022 9319', bic:'PCHQBEBB',
      montant:totCSS,
      ref:`CSS-${per.y}${String(per.m).padStart(2,"0")}`,
      communication:`CSS ${MN[per.m-1]} ${per.y} ‚Äî TVA ${s.co.vat}`,
    }];

    // Fusionner selon le type s√©lectionn√©
    let virements=[];
    if (payType==='all'||payType==='salaires') virements=[...virements,...virSal];
    if (payType==='all'||payType==='onss') virements=[...virements,...virOnss];
    if (payType==='all'||payType==='pp') virements=[...virements,...virPP];

    const totNet=virements.reduce((a,v)=>a+v.montant,0);

    // G√©n√©rer XML SEPA pain.001.001.03 (ISO 20022)
    const now=new Date().toISOString();
    const execDate=`${per.y}-${String(per.m).padStart(2,"0")}-25`;
    const xml=`<?xml version="1.0" encoding="UTF-8"?>
<Document xmlns="urn:iso:std:iso:20022:tech:xsd:pain.001.001.03"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<CstmrCdtTrfInitn>
  <GrpHdr>
    <MsgId>SAL-${per.y}${String(per.m).padStart(2,"0")}-${Date.now().toString(36).toUpperCase()}</MsgId>
    <CreDtTm>${now}</CreDtTm>
    <NbOfTxs>${virements.length}</NbOfTxs>
    <CtrlSum>${totNet.toFixed(2)}</CtrlSum>
    <InitgPty>
      <Nm>${s.co.name}</Nm>
      <Id><OrgId><Othr><Id>${(s.co.bce||s.co.vat||'').replace(/\D/g,"")}</Id><SchmeNm><Cd>BANK</Cd></SchmeNm></Othr></OrgId></Id>
    </InitgPty>
  </GrpHdr>
  <PmtInf>
    <PmtInfId>PAY-${per.y}${String(per.m).padStart(2,"0")}</PmtInfId>
    <PmtMtd>TRF</PmtMtd>
    <BtchBookg>true</BtchBookg>
    <NbOfTxs>${virements.length}</NbOfTxs>
    <CtrlSum>${totNet.toFixed(2)}</CtrlSum>
    <PmtTpInf><SvcLvl><Cd>SEPA</Cd></SvcLvl></PmtTpInf>
    <ReqdExctnDt>${execDate}</ReqdExctnDt>
    <Dbtr>
      <Nm>${s.co.name}</Nm>
      <PstlAdr><Ctry>BE</Ctry><AdrLine>${s.co.addr||''}</AdrLine></PstlAdr>
    </Dbtr>
    <DbtrAcct><Id><IBAN>${(s.co.bank||'').replace(/\s/g,"")}</IBAN></Id><Ccy>EUR</Ccy></DbtrAcct>
    <DbtrAgt><FinInstnId><BIC>${s.co.bic||'GEBABEBB'}</BIC></FinInstnId></DbtrAgt>
    <ChrgBr>SLEV</ChrgBr>
${virements.map((v,i)=>`    <CdtTrfTxInf>
      <PmtId><EndToEndId>${v.ref}</EndToEndId></PmtId>
      <Amt><InstdAmt Ccy="EUR">${v.montant.toFixed(2)}</InstdAmt></Amt>
      ${v.bic?`<CdtrAgt><FinInstnId><BIC>${v.bic}</BIC></FinInstnId></CdtrAgt>`:''}
      <Cdtr><Nm>${v.nom}</Nm></Cdtr>
      <CdtrAcct><Id><IBAN>${(v.iban||'').replace(/\s/g,"")}</IBAN></Id></CdtrAcct>
      <RmtInf><Ustrd>${v.communication}</Ustrd></RmtInf>
    </CdtTrfTxInf>`).join('\n')}
  </PmtInf>
</CstmrCdtTrfInitn>
</Document>`;

    setGen({virements,totNet,xml,totSal,totOnssE,totOnssW,totPP,totCSS,
      nbSal:virSal.length,ouvriers:paies.filter(({emp})=>emp.statut==='ouvrier').length,
      employes:paies.filter(({emp})=>emp.statut!=='ouvrier').length});
  };

  // T√©l√©charger le XML
  const downloadXML=()=>{
    if(!gen)return;
    const blob=new Blob([gen.xml],{type:"application/xml"});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download=`SEPA_SAL_${per.y}_${String(per.m).padStart(2,"0")}_${s.co.name.replace(/\s/g,"_")}.xml`;
    a.click();
  };

  return <div style={{display:'grid',gridTemplateColumns:'320px 1fr',gap:18}}>
    <div>
    <C><ST>Virements SEPA ‚Äî pain.001</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9}}>
        <I label="Mois" value={per.m} onChange={v=>setPer({...per,m:parseInt(v)})} options={MN.map((m,i)=>({v:i+1,l:m}))}/>
        <I label="Ann√©e" type="number" value={per.y} onChange={v=>setPer({...per,y:v})}/>
      </div>
      <I label="Type de paiement" value={payType} onChange={setPayType} options={[
        {v:"all",l:"üè¶ TOUT (salaires + ONSS + PP)"},
        {v:"salaires",l:"üí∞ Salaires uniquement"},
        {v:"onss",l:"üèõ ONSS uniquement"},
        {v:"pp",l:"‚óá PP + CSS uniquement"},
      ]} style={{marginTop:9}}/>
      <B onClick={run} style={{width:'100%',marginTop:14}}>üè¶ G√©n√©rer fichier SEPA</B>
      {gen&&<div style={{marginTop:14,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:11,color:'#9e9b93',lineHeight:2}}>
        <div style={{fontWeight:600,color:'#c6a34e',marginBottom:6,fontSize:13}}>üí∞ {MN[per.m-1]} {per.y}</div>
        <div>Ouvriers: <b style={{color:'#fb923c'}}>{gen.ouvriers}</b> ¬∑ Employ√©s: <b style={{color:'#60a5fa'}}>{gen.employes}</b></div>
        <div>Total salaires nets: <b style={{color:'#4ade80'}}>{fmt(gen.totSal)}</b></div>
        <div>ONSS (empl+trav): <b style={{color:'#e8e6e0'}}>{fmt(gen.totOnssE+gen.totOnssW)}</b></div>
        <div>PP: <b style={{color:'#e8e6e0'}}>{fmt(gen.totPP)}</b> ¬∑ CSS: <b style={{color:'#e8e6e0'}}>{fmt(gen.totCSS)}</b></div>
        <div style={{borderTop:'1px solid rgba(198,163,78,.15)',paddingTop:6,marginTop:6}}>
          <b style={{color:'#c6a34e',fontSize:14}}>TOTAL: {fmt(gen.totNet)}</b>
        </div>
        <div style={{marginTop:4}}>Nb virements: <b style={{color:'#e8e6e0'}}>{gen.virements.length}</b></div>
        <div>Compte d√©biteur: <b style={{color:'#e8e6e0'}}>{s.co.bank}</b></div>
        <div>Date d'ex√©cution: <b style={{color:'#e8e6e0'}}>{per.y}-{String(per.m).padStart(2,"0")}-25</b></div>
      </div>}
      {gen&&<div style={{display:'flex',gap:8,marginTop:10}}>
        <B onClick={downloadXML} style={{flex:1,fontSize:11}}>üíæ T√©l√©charger .xml</B>
        <B v="outline" style={{flex:1,fontSize:11}} onClick={()=>d({type:"MODAL",m:{w:900,c:<div>
          <h3 style={{color:'#e8e6e0',margin:'0 0 10px'}}>SEPA pain.001.001.03 ‚Äî {MN[per.m-1]} {per.y}</h3>
          <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:9,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:400,overflowY:'auto'}}>{gen.xml}</pre>
          <div style={{display:'flex',gap:10,marginTop:12,justifyContent:'flex-end'}}><B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B><B onClick={()=>{navigator.clipboard?.writeText(gen.xml);alert('Copi√© !')}}>Copier XML</B></div>
        </div>}})}>Voir XML</B>
      </div>}
      <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10,color:'#60a5fa',lineHeight:1.6}}>
        <b>Format:</b> ISO 20022 pain.001.001.03<br/>
        <b>Compatible:</b> BNP Paribas Fortis, ING, KBC/CBC, Belfius, Argenta, Crelan, AXA, Triodos<br/>
        <b>Upload:</b> Portail banque en ligne ‚Üí Virements ‚Üí Importer fichier SEPA<br/>
        <b>D√©lai:</b> J+1 si envoy√© avant 15h, J+2 sinon<br/>
        <b>R√©f. l√©gale:</b> R√®glement (UE) 260/2012 (migration SEPA)
      </div>

      {/* DOSSIER CLIENT ‚Äî WORKFLOW SECR√âTARIAT SOCIAL */}
      {gen&&<C style={{marginTop:14,background:"rgba(74,222,128,.03)",border:'1px solid rgba(74,222,128,.12)'}}>
        <ST style={{color:'#4ade80'}}>üì® Envoyer au client</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.7,marginBottom:10}}>
          Toi (secr√©tariat social), tu pr√©pares tout. Le client re√ßoit un dossier complet avec le fichier SEPA + les fiches de paie. Il n'a qu'√† <b style={{color:'#4ade80'}}>importer le fichier dans sa banque et valider</b>.
        </div>
        <div style={{padding:12,background:"rgba(198,163,78,.04)",borderRadius:8,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#c6a34e',fontWeight:600,textTransform:'uppercase',letterSpacing:'1px',marginBottom:8}}>Email type √† envoyer au client</div>
          <div style={{fontSize:11,color:'#d4d0c8',lineHeight:1.8,fontFamily:"'Outfit',sans-serif"}}>
            <div style={{fontWeight:600,marginBottom:4}}>Objet: Salaires {MN[per.m-1]} {per.y} ‚Äî Fichier de paiement pr√™t</div>
            <div style={{borderTop:'1px solid rgba(198,163,78,.1)',paddingTop:8,marginTop:4}}>
              Bonjour,<br/><br/>
              Veuillez trouver ci-joint le dossier salarial de <b>{MN[per.m-1]} {per.y}</b> :<br/><br/>
              <b>1. Fichier SEPA</b> (.xml) ‚Äî √Ä importer dans votre banque en ligne<br/>
              ‚Üí {gen.virements.length} virement(s) pour un total de <b>{fmt(gen.totNet)}</b><br/>
              ‚Üí Dont: salaires nets {fmt(gen.totSal)} ¬∑ ONSS {fmt(gen.totOnssE+gen.totOnssW)} ¬∑ PP {fmt(gen.totPP)}<br/><br/>
              <b>2. Fiches de paie</b> ‚Äî √Ä remettre √† vos travailleurs<br/>
              ‚Üí {gen.nbSal} fiche(s) ({gen.ouvriers} ouvrier(s), {gen.employes} employ√©(s))<br/><br/>
              <b>Que devez-vous faire ?</b><br/>
              ‚ë† Connectez-vous √† votre banque en ligne ({s.co.bic==='GEBABEBB'?'BNP Paribas Fortis':s.co.bic==='BBRUBEBB'?'ING':s.co.bic==='KREDBEBB'?'KBC/CBC':s.co.bic==='GKCCBEBB'?'Belfius':'votre banque'})<br/>
              ‚ë° Allez dans Virements ‚Üí Importer un fichier<br/>
              ‚ë¢ S√©lectionnez le fichier .xml joint<br/>
              ‚ë£ V√©rifiez le montant total: <b>{fmt(gen.totNet)}</b><br/>
              ‚ë§ Validez avec votre digipass / itsme<br/><br/>
              Date d'ex√©cution pr√©vue: <b>le 25/{String(per.m).padStart(2,"0")}/{per.y}</b><br/>
              Merci de valider <b>avant le 24/{String(per.m).padStart(2,"0")}/{per.y}</b>.<br/><br/>
              Bien cordialement,<br/>
              <b>{s.co.secSoc||'Aureus Social Pro'}</b>
            </div>
          </div>
          <div style={{display:'flex',gap:8,marginTop:10}}>
            <B style={{flex:1,fontSize:11}} onClick={()=>{
              const subject=encodeURIComponent(`Salaires ${MN[per.m-1]} ${per.y} ‚Äî Fichier de paiement pr√™t`);
              const body=encodeURIComponent(`Bonjour,\n\nVeuillez trouver ci-joint le dossier salarial de ${MN[per.m-1]} ${per.y}.\n\n1. Fichier SEPA (.xml) ‚Äî √Ä importer dans votre banque en ligne\n‚Üí ${gen.virements.length} virement(s) pour un total de ${fmt(gen.totNet)}\n\n2. Fiches de paie ‚Äî √Ä remettre √† vos travailleurs\n\nQue devez-vous faire ?\n‚ë† Connectez-vous √† votre banque en ligne\n‚ë° Allez dans Virements ‚Üí Importer un fichier\n‚ë¢ S√©lectionnez le fichier .xml joint\n‚ë£ V√©rifiez le montant total: ${fmt(gen.totNet)}\n‚ë§ Validez avec votre digipass / itsme\n\nDate d'ex√©cution: le 25/${String(per.m).padStart(2,"0")}/${per.y}\nMerci de valider avant le 24/${String(per.m).padStart(2,"0")}/${per.y}.\n\nBien cordialement,\n${s.co.secSoc||'Aureus Social Pro'}`);
              window.open(`mailto:${s.co.email||''}?subject=${subject}&body=${body}`);
            }}>üìß Ouvrir dans Mail</B>
            <B v="outline" style={{flex:1,fontSize:11}} onClick={()=>{
              const txt=`Salaires ${MN[per.m-1]} ${per.y} ‚Äî ${gen.virements.length} virements ‚Äî Total: ${fmt(gen.totNet)}\n\n‚ë† Importez le fichier .xml dans votre banque\n‚ë° V√©rifiez le total: ${fmt(gen.totNet)}\n‚ë¢ Validez avant le 24/${String(per.m).padStart(2,"0")}/${per.y}`;
              navigator.clipboard?.writeText(txt);alert('Copi√© !');
            }}>üìã Copier le message</B>
          </div>
        </div>
        <div style={{marginTop:10,padding:10,background:"rgba(74,222,128,.04)",borderRadius:8,fontSize:10,color:'#4ade80',lineHeight:1.6}}>
          <b>R√©cap ‚Äî Qui fait quoi ?</b><br/>
          <b>TOI (secr√©tariat social):</b> calcul des paies ‚Üí g√©n√©ration fiches ‚Üí g√©n√©ration fichier SEPA ‚Üí envoi au client<br/>
          <b>LE CLIENT:</b> importer le .xml dans sa banque ‚Üí v√©rifier le total ‚Üí valider avec digipass/itsme ‚Üí c'est fait
        </div>
      </C>}
    </C>
    <C style={{marginTop:14}}><ST>Comptes destinataires</ST>
      <div style={{fontSize:10.5,color:'#9e9b93',lineHeight:1.8}}>
        <div><b style={{color:'#c6a34e'}}>ONSS:</b> BE76 6790 0001 6128 (PCHQBEBB) ‚Äî communication structur√©e: +++XXX/XXXX/YYMM+++</div>
        <div><b style={{color:'#c6a34e'}}>SPF Finances (PP):</b> BE39 6792 0022 9319 (PCHQBEBB) ‚Äî r√©f: 274-YYYYMM-TVA</div>
        <div><b style={{color:'#c6a34e'}}>Caisse vacances (ouvriers):</b> selon CP ‚Äî ONVA ou caisse sectorielle</div>
        <div><b style={{color:'#c6a34e'}}>Assurance AT:</b> selon contrat employeur</div>
      </div>
    </C>
    </div>
    <C style={{padding:0,overflow:'hidden'}}>
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}>
        <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>D√©tail des virements ‚Äî {MN[per.m-1]} {per.y}</div>
      </div>
      {gen?<Tbl cols={[
        {k:'t',l:"Type",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,fontWeight:600,
          background:r.type==='SAL'?'rgba(74,222,128,.1)':r.type==='ONSS'?'rgba(96,165,250,.1)':'rgba(198,163,78,.1)',
          color:r.type==='SAL'?'#4ade80':r.type==='ONSS'?'#60a5fa':'#c6a34e'}}>{r.type}</span>},
        {k:'e',l:"B√©n√©ficiaire",b:1,r:r=><><div>{r.nom}</div>{r.statut&&<div style={{fontSize:9,color:'#5e5c56'}}>{r.statut}</div>}</>},
        {k:'i',l:"IBAN",r:r=><span style={{fontSize:9.5,fontFamily:'monospace',color:'#9e9b93'}}>{r.iban}</span>},
        {k:'c',l:"Communication",r:r=><span style={{fontSize:9.5,color:'#c6a34e'}}>{r.communication}</span>},
        {k:'n',l:"Montant",a:'right',r:r=><span style={{fontWeight:700,color:r.type==='SAL'?'#4ade80':r.type==='ONSS'?'#60a5fa':'#c6a34e'}}>{fmt(r.montant)}</span>}
      ]} data={gen?.virements||[]}/>
      :<div style={{padding:40,textAlign:'center',color:'#5e5c56',fontSize:13}}>
        S√©lectionnez la p√©riode et cliquez sur "G√©n√©rer fichier SEPA"<br/>
        <span style={{fontSize:11,color:'#3e3c36'}}>Le fichier XML sera compatible avec toutes les banques belges</span>
      </div>}
      {gen&&<div style={{padding:'12px 18px',borderTop:'1px solid rgba(139,115,60,.08)',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
        <span style={{fontSize:12,color:'#9e9b93'}}>{gen.virements.length} virement(s)</span>
        <span style={{fontSize:14,fontWeight:700,color:'#c6a34e'}}>TOTAL: {fmt(gen.totNet)}</span>
      </div>}
    </C>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PEPPOL e-INVOICING ‚Äî UBL 2.1 / BIS Billing 3.0
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function PeppolMod({s,d}){
  const [invType,setInvType]=useState('380');
  const [invNum,setInvNum]=useState(`INV-${new Date().getFullYear()}-001`);
  const [invDate,setInvDate]=useState(new Date().toISOString().slice(0,10));
  const [dueDate,setDueDate]=useState('');
  const [currency,setCurrency]=useState('EUR');
  const [note,setNote]=useState('');
  // Supplier (from company settings)
  const [suppVAT,setSuppVAT]=useState(s.co.bce?`BE${(s.co.bce||'').replace(/\D/g,"")}`:'');
  const [suppName,setSuppName]=useState(s.co.name||'');
  const [suppAddr,setSuppAddr]=useState(s.co.address||'');
  const [suppCity,setSuppCity]=useState('Bruxelles');
  const [suppZip,setSuppZip]=useState(s.co.zip||'1000');
  const [suppCountry,setSuppCountry]=useState('BE');
  const [suppPeppolId,setSuppPeppolId]=useState('');
  const [suppIBAN,setSuppIBAN]=useState(s.co.bank||'');
  // Customer
  const [custName,setCustName]=useState('');
  const [custVAT,setCustVAT]=useState('');
  const [custAddr,setCustAddr]=useState('');
  const [custCity,setCustCity]=useState('');
  const [custZip,setCustZip]=useState('');
  const [custCountry,setCustCountry]=useState('BE');
  const [custPeppolId,setCustPeppolId]=useState('');
  // Lines
  const [lines,setLines]=useState([{id:1,desc:"Prestations de services",qty:1,unit:'EA',price:0,vat:21}]);
  const addLine=()=>setLines(p=>[...p,{id:Date.now(),desc:"",qty:1,unit:'EA',price:0,vat:21}]);
  const updLine=(id,k,v)=>setLines(p=>p.map(l=>l.id===id?{...l,[k]:v}:l));
  const remLine=(id)=>setLines(p=>p.filter(l=>l.id!==id));
  
  const subtotal=lines.reduce((a,l)=>a+(parseFloat(l.qty)||0)*(parseFloat(l.price)||0),0);
  const vatGroups={};
  lines.forEach(l=>{const v=parseFloat(l.vat)||0;const amt=(parseFloat(l.qty)||0)*(parseFloat(l.price)||0);if(!vatGroups[v])vatGroups[v]={base:0,tax:0};vatGroups[v].base+=amt;vatGroups[v].tax+=amt*v/100;});
  const totalVAT=Object.values(vatGroups).reduce((a,g)=>a+g.tax,0);
  const totalTTC=subtotal+totalVAT;

  const invTypes=[
    {v:"380",l:"380 ‚Äî Facture commerciale"},
    {v:"381",l:"381 ‚Äî Note de cr√©dit"},
    {v:"384",l:"384 ‚Äî Facture corrective"},
    {v:"389",l:"389 ‚Äî Auto-facturation"},
    {v:"751",l:"751 ‚Äî Facture proforma"},
    {v:"386",l:"386 ‚Äî Facture d\'acompte (pr√©paiement)"},
  ];
  const units=[{v:"EA",l:"Unit√© (EA)"},{v:"HUR",l:"Heure (HUR)"},{v:"DAY",l:"Jour (DAY)"},{v:"MON",l:"Mois (MON)"},{v:"KGM",l:"Kg (KGM)"},{v:"MTR",l:"M√®tre (MTR)"},{v:"LTR",l:"Litre (LTR)"},{v:"C62",l:"Pi√®ce (C62)"}];
  const vatCodes=[{v:21,l:"21% (standard)"},{v:12,l:"12% (r√©duit)"},{v:6,l:"6% (r√©duit)"},{v:0,l:"0% (exon√©r√©)"}];

  const generateUBL=()=>{
    const xml=`<?xml version="1.0" encoding="UTF-8"?>
<Invoice xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
         xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
         xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
  <cbc:CustomizationID>urn:cen.eu:en16931:2017#compliant#urn:fdc:peppol.eu:2017:poacc:billing:3.0</cbc:CustomizationID>
  <cbc:ProfileID>urn:fdc:peppol.eu:2017:poacc:billing:01:1.0</cbc:ProfileID>
  <cbc:ID>${invNum}</cbc:ID>
  <cbc:IssueDate>${invDate}</cbc:IssueDate>${dueDate?`\n  <cbc:DueDate>${dueDate}</cbc:DueDate>`:''}
  <cbc:InvoiceTypeCode>${invType}</cbc:InvoiceTypeCode>${note?`\n  <cbc:Note>${note}</cbc:Note>`:''}
  <cbc:DocumentCurrencyCode>${currency}</cbc:DocumentCurrencyCode>

  <!-- FOURNISSEUR (AccountingSupplierParty) -->
  <cac:AccountingSupplierParty>
    <cac:Party>${suppPeppolId?`\n      <cbc:EndpointID schemeID="0208">${suppPeppolId}</cbc:EndpointID>`:`\n      <cbc:EndpointID schemeID="0208">${suppVAT}</cbc:EndpointID>`}
      <cac:PartyIdentification><cbc:ID>${suppVAT}</cbc:ID></cac:PartyIdentification>
      <cac:PartyName><cbc:Name>${suppName}</cbc:Name></cac:PartyName>
      <cac:PostalAddress>
        <cbc:StreetName>${suppAddr}</cbc:StreetName>
        <cbc:CityName>${suppCity}</cbc:CityName>
        <cbc:PostalZone>${suppZip}</cbc:PostalZone>
        <cac:Country><cbc:IdentificationCode>${suppCountry}</cbc:IdentificationCode></cac:Country>
      </cac:PostalAddress>
      <cac:PartyTaxScheme>
        <cbc:CompanyID>${suppVAT}</cbc:CompanyID>
        <cac:TaxScheme><cbc:ID>VAT</cbc:ID></cac:TaxScheme>
      </cac:PartyTaxScheme>
      <cac:PartyLegalEntity><cbc:RegistrationName>${suppName}</cbc:RegistrationName></cac:PartyLegalEntity>
    </cac:Party>
  </cac:AccountingSupplierParty>

  <!-- CLIENT (AccountingCustomerParty) -->
  <cac:AccountingCustomerParty>
    <cac:Party>${custPeppolId?`\n      <cbc:EndpointID schemeID="0208">${custPeppolId}</cbc:EndpointID>`:`\n      <cbc:EndpointID schemeID="0208">${custVAT}</cbc:EndpointID>`}
      <cac:PartyIdentification><cbc:ID>${custVAT}</cbc:ID></cac:PartyIdentification>
      <cac:PartyName><cbc:Name>${custName}</cbc:Name></cac:PartyName>
      <cac:PostalAddress>
        <cbc:StreetName>${custAddr}</cbc:StreetName>
        <cbc:CityName>${custCity}</cbc:CityName>
        <cbc:PostalZone>${custZip}</cbc:PostalZone>
        <cac:Country><cbc:IdentificationCode>${custCountry}</cbc:IdentificationCode></cac:Country>
      </cac:PostalAddress>
      <cac:PartyTaxScheme>
        <cbc:CompanyID>${custVAT}</cbc:CompanyID>
        <cac:TaxScheme><cbc:ID>VAT</cbc:ID></cac:TaxScheme>
      </cac:PartyTaxScheme>
      <cac:PartyLegalEntity><cbc:RegistrationName>${custName}</cbc:RegistrationName></cac:PartyLegalEntity>
    </cac:Party>
  </cac:AccountingCustomerParty>

  <!-- PAIEMENT -->
  <cac:PaymentMeans>
    <cbc:PaymentMeansCode>30</cbc:PaymentMeansCode>
    <cac:PayeeFinancialAccount><cbc:ID>${(suppIBAN||'').replace(/\s/g,"")}</cbc:ID></cac:PayeeFinancialAccount>
  </cac:PaymentMeans>

  <!-- TVA -->
${Object.entries(vatGroups).map(([rate,g])=>`  <cac:TaxTotal>
    <cbc:TaxAmount currencyID="${currency}">${g.tax.toFixed(2)}</cbc:TaxAmount>
    <cac:TaxSubtotal>
      <cbc:TaxableAmount currencyID="${currency}">${g.base.toFixed(2)}</cbc:TaxableAmount>
      <cbc:TaxAmount currencyID="${currency}">${g.tax.toFixed(2)}</cbc:TaxAmount>
      <cac:TaxCategory>
        <cbc:ID>${parseFloat(rate)===0?'Z':'S'}</cbc:ID>
        <cbc:Percent>${rate}</cbc:Percent>
        <cac:TaxScheme><cbc:ID>VAT</cbc:ID></cac:TaxScheme>
      </cac:TaxCategory>
    </cac:TaxSubtotal>
  </cac:TaxTotal>`).join('\n')}

  <!-- TOTAUX -->
  <cac:LegalMonetaryTotal>
    <cbc:LineExtensionAmount currencyID="${currency}">${subtotal.toFixed(2)}</cbc:LineExtensionAmount>
    <cbc:TaxExclusiveAmount currencyID="${currency}">${subtotal.toFixed(2)}</cbc:TaxExclusiveAmount>
    <cbc:TaxInclusiveAmount currencyID="${currency}">${totalTTC.toFixed(2)}</cbc:TaxInclusiveAmount>
    <cbc:PayableAmount currencyID="${currency}">${totalTTC.toFixed(2)}</cbc:PayableAmount>
  </cac:LegalMonetaryTotal>

  <!-- LIGNES -->
${lines.map((l,i)=>{const lineAmt=(parseFloat(l.qty)||0)*(parseFloat(l.price)||0);const lineVat=lineAmt*(parseFloat(l.vat)||0)/100;return`  <cac:InvoiceLine>
    <cbc:ID>${i+1}</cbc:ID>
    <cbc:InvoicedQuantity unitCode="${l.unit}">${l.qty}</cbc:InvoicedQuantity>
    <cbc:LineExtensionAmount currencyID="${currency}">${lineAmt.toFixed(2)}</cbc:LineExtensionAmount>
    <cac:Item>
      <cbc:Name>${l.desc}</cbc:Name>
      <cac:ClassifiedTaxCategory>
        <cbc:ID>${parseFloat(l.vat)===0?'Z':'S'}</cbc:ID>
        <cbc:Percent>${l.vat}</cbc:Percent>
        <cac:TaxScheme><cbc:ID>VAT</cbc:ID></cac:TaxScheme>
      </cac:ClassifiedTaxCategory>
    </cac:Item>
    <cac:Price><cbc:PriceAmount currencyID="${currency}">${parseFloat(l.price||0).toFixed(2)}</cbc:PriceAmount></cac:Price>
  </cac:InvoiceLine>`;}).join('\n')}
</Invoice>`;
    return xml;
  };

  const [gen,setGen]=useState(null);
  const doGen=()=>setGen(generateUBL());

  return <div>
    <PH title="PEPPOL e-Invoicing" sub="UBL 2.1 ‚Äî BIS Billing 3.0 ‚Äî Conforme EN 16931" actions={<B onClick={doGen}>G√©n√©rer UBL XML</B>}/>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      {/* LEFT: INVOICE HEADER */}
      <C>
        <ST>üîó Document PEPPOL</ST>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
          <I label="Type de document" value={invType} onChange={setInvType} options={invTypes}/>
          <I label="N¬∞ facture" value={invNum} onChange={setInvNum}/>
          <I label="Date √©mission" type="date" value={invDate} onChange={setInvDate}/>
          <I label="Date √©ch√©ance" type="date" value={dueDate} onChange={setDueDate}/>
          <I label="Devise" value={currency} onChange={setCurrency} options={[{v:"EUR",l:"EUR"},{v:"USD",l:"USD"},{v:"GBP",l:"GBP"},{v:"CHF",l:"CHF"}]}/>
          <I label="Note / R√©f√©rence" value={note} onChange={setNote}/>
        </div>

        <div style={{marginTop:16,fontSize:11.5,fontWeight:600,color:'#4ade80',marginBottom:8}}>üì§ Fournisseur (√©metteur)</div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
          <I label="Nom / Raison sociale" value={suppName} onChange={setSuppName}/>
          <I label="N¬∞ TVA (BE0xxx.xxx.xxx)" value={suppVAT} onChange={setSuppVAT}/>
          <I label="Adresse" value={suppAddr} onChange={setSuppAddr}/>
          <I label="Ville" value={suppCity} onChange={setSuppCity}/>
          <I label="Code postal" value={suppZip} onChange={setSuppZip}/>
          <I label="Pays" value={suppCountry} onChange={setSuppCountry} options={[{v:"BE",l:"Belgique"},{v:"FR",l:"France"},{v:"NL",l:"Pays-Bas"},{v:"LU",l:"Luxembourg"},{v:"DE",l:"Allemagne"}]}/>
          <I label="PEPPOL ID (0208:BEXXXX)" value={suppPeppolId} onChange={setSuppPeppolId}/>
          <I label="IBAN" value={suppIBAN} onChange={setSuppIBAN}/>
        </div>

        <div style={{marginTop:16,fontSize:11.5,fontWeight:600,color:'#60a5fa',marginBottom:8}}>üì• Client (destinataire)</div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
          <I label="Nom / Raison sociale" value={custName} onChange={setCustName}/>
          <I label="N¬∞ TVA" value={custVAT} onChange={setCustVAT}/>
          <I label="Adresse" value={custAddr} onChange={setCustAddr}/>
          <I label="Ville" value={custCity} onChange={setCustCity}/>
          <I label="Code postal" value={custZip} onChange={setCustZip}/>
          <I label="Pays" value={custCountry} onChange={setCustCountry} options={[{v:"BE",l:"Belgique"},{v:"FR",l:"France"},{v:"NL",l:"Pays-Bas"},{v:"LU",l:"Luxembourg"},{v:"DE",l:"Allemagne"},{v:"ES",l:"Espagne"},{v:"IT",l:"Italie"},{v:"AT",l:"Autriche"}]}/>
          <I label="PEPPOL ID client" value={custPeppolId} onChange={setCustPeppolId}/>
        </div>
      </C>

      {/* RIGHT: LINES + TOTALS */}
      <div>
        <C>
          <ST>Lignes de facturation</ST>
          {lines.map((l,i)=><div key={l.id} style={{padding:10,marginBottom:8,background:"rgba(198,163,78,.03)",border:'1px solid rgba(198,163,78,.06)',borderRadius:8}}>
            <div style={{display:'flex',justifyContent:'space-between',marginBottom:6}}>
              <span style={{fontSize:11,fontWeight:600,color:'#c6a34e'}}>Ligne {i+1}</span>
              {lines.length>1&&<button onClick={()=>remLine(l.id)} style={{background:"none",border:'none',color:'#f87171',cursor:'pointer',fontSize:12}}>‚úï</button>}
            </div>
            <div style={{display:'grid',gridTemplateColumns:'2fr 1fr 1fr 1fr 1fr',gap:8}}>
              <I label="Description" value={l.desc} onChange={v=>updLine(l.id,"desc",v)}/>
              <I label="Quantit√©" type="number" value={l.qty} onChange={v=>updLine(l.id,"qty",v)}/>
              <I label="Unit√©" value={l.unit} onChange={v=>updLine(l.id,"unit",v)} options={units}/>
              <I label="Prix unitaire" type="number" value={l.price} onChange={v=>updLine(l.id,"price",v)}/>
              <I label="TVA %" value={l.vat} onChange={v=>updLine(l.id,"vat",v)} options={vatCodes}/>
            </div>
            <div style={{textAlign:'right',fontSize:11,color:'#9e9b93',marginTop:4}}>Sous-total: <b style={{color:'#e8e6e0'}}>{fmt((parseFloat(l.qty)||0)*(parseFloat(l.price)||0))}</b></div>
          </div>)}
          <B v="outline" onClick={addLine} style={{width:'100%',fontSize:11}}>+ Ajouter une ligne</B>
        </C>

        <C style={{marginTop:16}}>
          <ST>Totaux</ST>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12}}>
            <div style={{padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,textAlign:'center'}}>
              <div style={{fontSize:10,color:'#5e5c56'}}>HTVA</div>
              <div style={{fontSize:20,fontWeight:700,color:'#c6a34e'}}>{fmt(subtotal)}</div>
            </div>
            <div style={{padding:12,background:"rgba(248,113,113,.06)",borderRadius:8,textAlign:'center'}}>
              <div style={{fontSize:10,color:'#5e5c56'}}>TVA</div>
              <div style={{fontSize:20,fontWeight:700,color:'#f87171'}}>{fmt(totalVAT)}</div>
              <div style={{fontSize:9,color:'#5e5c56',marginTop:2}}>{Object.entries(vatGroups).map(([r,g])=>`${r}%: ${g.tax.toFixed(2)}‚Ç¨`).join(' | ')}</div>
            </div>
            <div style={{padding:12,background:"rgba(74,222,128,.06)",borderRadius:8,textAlign:'center'}}>
              <div style={{fontSize:10,color:'#5e5c56'}}>TVAC</div>
              <div style={{fontSize:20,fontWeight:700,color:'#4ade80'}}>{fmt(totalTTC)}</div>
            </div>
          </div>
        </C>

        {gen&&<C style={{marginTop:16}}>
          <ST>XML UBL 2.1 g√©n√©r√©</ST>
          <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:9,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:300,overflowY:'auto'}}>{gen}</pre>
          <div style={{display:'flex',gap:10,marginTop:12}}>
            <B onClick={()=>{navigator.clipboard?.writeText(gen);alert('XML PEPPOL copi√© !')}}>üìã Copier XML</B>
            <B v="outline" onClick={()=>{const b=new Blob([gen],{type:"text/xml"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=`${invNum}.xml`;a.click()}}>üíæ T√©l√©charger .xml</B>
            <B v="ghost" onClick={()=>d({type:"MODAL",m:{w:1000,c:<div>
              <h3 style={{color:'#e8e6e0',margin:'0 0 10px'}}>PEPPOL UBL 2.1 ‚Äî {invNum}</h3>
              <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:9.5,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:500,overflowY:'auto'}}>{gen}</pre>
              <div style={{display:'flex',gap:10,marginTop:12,justifyContent:'flex-end'}}>
                <B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B>
                <B onClick={()=>{navigator.clipboard?.writeText(gen);alert('Copi√© !')}}>Copier</B>
              </div>
            </div>}})}>üîç Plein √©cran</B>
          </div>
        </C>}

        <C style={{marginTop:16}}>
          <div style={{fontSize:10.5,color:'#60a5fa',lineHeight:1.7}}>
            <b style={{color:'#a78bfa'}}>üìã R√©seau PEPPOL ‚Äî Informations</b><br/>
            <b>Norme:</b> UBL 2.1 / EN 16931 / BIS Billing 3.0<br/>
            <b>Obligatoire B2G:</b> Depuis 01/04/2019 pour les march√©s publics f√©d√©raux BE<br/>
            <b>Obligatoire B2B:</b> Obligatoire √† partir du 01/01/2026 pour les assujettis TVA belges<br/>
            <b>Access Point:</b> Pour envoyer via PEPPOL, vous devez passer par un Access Point certifi√© (Hermes, Billit, CodaBox, Basware, Unifiedpost, Mercurius...)<br/>
            <b>PEPPOL ID Belgique:</b> schemeID="0208" (num√©ro BCE/KBO sans espaces)<br/>
            <b>Portail public:</b> e-FFF (Facture F√©d√©rale) pour les march√©s publics<br/>
            <b>Validation:</b> Utilisez le validateur OpenPEPPOL ou ecosio pour v√©rifier la conformit√© EN 16931
          </div>
          <div style={{marginTop:10,padding:8,background:"rgba(250,204,21,.06)",borderRadius:6,fontSize:10,color:'#facc15',lineHeight:1.5}}>
            ‚ö†Ô∏è <b>Nouveau 2026:</b> La facturation √©lectronique structur√©e B2B devient obligatoire en Belgique pour tous les assujettis TVA √©tablis en BE. Les factures doivent √™tre √©mises et re√ßues via PEPPOL (format UBL/CII).
          </div>
        </C>
      </div>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SECTEURS SP√âCIFIQUES (H√¥pitaux, Construction, Ateliers, IMP)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function SecteursMod({s,d}){
  const [search,setSearch]=useState('');
  const cps=[
    {cp:'100',l:"CP 100 ‚Äî Commission auxiliaire pour ouvriers",sal:"Selon bar√®me",prime:'Oui',index:'Oui'},
    {cp:'124',l:"CP 124 ‚Äî Construction",sal:"‚Ç¨16,50-‚Ç¨22,00/h",prime:'Prime intemp√©ries',index:'Oui'},
    {cp:'140',l:"CP 140 ‚Äî Transport et logistique",sal:"Selon cat√©gorie",prime:'Prime de nuit',index:'Oui'},
    {cp:'200',l:"CP 200 ‚Äî CPNAE (employ√©s)",sal:"Bar√®me sectoriel",prime:"Prime de fin d'ann√©e",index:'Oui'},
    {cp:'302',l:"CP 302 ‚Äî Industrie h√¥teli√®re (Horeca)",sal:"‚Ç¨12,50-‚Ç¨16,00/h",prime:'Nourr. + pourboires',index:'Oui'},
    {cp:'330',l:"CP 330 ‚Äî √âtablissements de sant√©",sal:"IFIC bar√®mes",prime:'Maribel social',index:'Oui'},
    {cp:'111',l:"CP 111 ‚Äî Construction m√©tallique",sal:"Bar√®me m√©tal",prime:'Prime √©quipe',index:'Oui'},
    {cp:'218',l:"CP 218 ‚Äî Employ√©s secteur alimentaire",sal:"Selon qualification",prime:'Oui',index:'Oui'},
    {cp:'226',l:"CP 226 ‚Äî Commerce international",sal:"Selon fonction",prime:'13√®me mois',index:'Oui'},
    {cp:'336',l:"CP 336 ‚Äî Professions lib√©rales",sal:"Selon bar√®me",prime:'Prime annuelle',index:'Oui'},
  ];
  const filtered=search?cps.filter(c=>c.l.toLowerCase().includes(search.toLowerCase())||c.cp.includes(search)):cps;
  
  return <div>
    <PH title="Commissions Paritaires" sub="Bar√®mes, primes, avantages sectoriels"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:12,marginBottom:18}}>
      {[{l:"CP r√©f√©renc√©es",v:cps.length,c:'#60a5fa'},{l:"Avec bar√®me",v:cps.length,c:'#c6a34e'},{l:"Indexation auto",v:cps.filter(c=>c.index==='Oui').length,c:'#4ade80'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <I label="Rechercher une CP (num√©ro ou nom)" value={search} onChange={setSearch}/>
    <C style={{marginTop:12,padding:0,overflow:'hidden'}}>
      <Tbl cols={[
        {k:'cp',l:"CP",b:1,r:r=><span style={{fontWeight:700,color:'#c6a34e'}}>{r.cp}</span>},
        {k:'l',l:"Commission paritaire",r:r=>r.l.split(' ‚Äî ')[1]||r.l},
        {k:'s',l:"Salaire indicatif",r:r=>r.sal},
        {k:'p',l:"Prime sectorielle",r:r=>r.prime},
        {k:'i',l:"Indexation",r:r=><span style={{color:'#4ade80'}}>‚úì</span>},
      ]} data={filtered}/>
    </C>
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  R√àGLEMENT DE TRAVAIL ‚Äî G√©n√©rateur complet
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const RT_SECTIONS=[
  {id:"general",t:'Dispositions g√©n√©rales',fields:['nomEntreprise',"siege","numOnss","cp","activite"]},
  {id:"horaires",t:'Dur√©e & horaires de travail',fields:['regimeHebdo',"lundiDe","lundiA","mardiDe","mardiA","mercrediDe","mercrediA","jeudiDe","jeudiA","vendrediDe","vendrediA","samediDe","samediA","pause","flexibilite"]},
  {id:"remuneration",t:'R√©mun√©ration',fields:['jourPaiement',"modePaiement","periodicite"]},
  {id:"conges",t:'Vacances & cong√©s',fields:['congesLegaux',"congesExtra","joursConventionnels","petitChomage"]},
  {id:"maladie",t:'Maladie & accidents',fields:['delaiAvertissement',"certificatMedical","controleMedial","medecinControle"]},
  {id:"rupture",t:'Fin du contrat',fields:['preavisLegal',"motifGrave","licenciement"]},
  {id:"securite",t:'S√©curit√© & bien-√™tre',fields:['sipp',"medecineExterne","persConfiance","risquesPsycho"]},
  {id:"divers",t:'Dispositions diverses',fields:['sanctions',"cameras","drogues","alcool","respectMutuel","rgpd"]},
];

function ReglementTravailMod({s,d}){
  const [sec,setSec]=useState('general');
  const [data,setData]=useState({
    nomEntreprise:s.co.name||'',siege:s.co.address||'',numOnss:s.co.onss||'',
    cp:s.co.cp||'200',activite:'',
    regimeHebdo:"38h/semaine",lundiDe:'09:00',lundiA:'17:30',mardiDe:'09:00',mardiA:'17:30',
    mercrediDe:'09:00',mercrediA:'17:30',jeudiDe:'09:00',jeudiA:'17:30',
    vendrediDe:'09:00',vendrediA:'16:00',samediDe:'',samediA:'',
    pause:'30 min (12h30-13h00)',flexibilite:'Horaire fixe',
    jourPaiement:'Dernier jour ouvrable du mois',modePaiement:'Virement bancaire',periodicite:'Mensuelle',
    congesLegaux:'20 jours ouvrables (r√©gime 5j/sem)',congesExtra:'Selon CCT sectorielle',
    joursConventionnels:'Jours f√©ri√©s l√©gaux (10j) + jour(s) CP',
    petitChomage:"Conform√©ment √† l'AR du 28/08/1963",
    delaiAvertissement:'Imm√©diat par t√©l√©phone + certificat dans les 48h',
    certificatMedical:"Obligatoire d√®s le 1er jour d\'absence",
    controleMedial:"L\'employeur se r√©serve le droit de faire effectuer un contr√¥le m√©dical",
    medecinControle:'Dr. [Nom] ‚Äî [Adresse]',
    preavisLegal:"Conform√©ment √† la loi du 26/12/2013 (statut unique)",
    motifGrave:'Article 35 de la loi du 03/07/1978',
    licenciement:'Conform√©ment aux dispositions l√©gales et CCT 109',
    sipp:'Conseiller interne en pr√©vention: [Nom]',
    medecineExterne:'[Nom du SEPP ‚Äî ex: Liantis, Mensura, Cohezio]',
    persConfiance:'[Nom] ‚Äî [Coordonn√©es]',
    risquesPsycho:"Proc√©dure interne conform√©ment au Code du bien-√™tre au travail",
    sanctions:'1¬∞ Avertissement oral / 2¬∞ Avertissement √©crit / 3¬∞ Mise en demeure / 4¬∞ Licenciement',
    cameras:'[Oui/Non ‚Äî Si oui, finalit√©s conform√©ment √† la CCT 68]',
    drogues:'Politique pr√©ventive alcool et drogues conform√©ment √† la CCT 100',
    alcool:"Tol√©rance z√©ro pendant les heures de travail",
    respectMutuel:"Conform√©ment √† la loi du 04/08/1996 relative au bien-√™tre",
    rgpd:"Traitement des donn√©es conform√©ment au RGPD ‚Äî DPO: [Contact]"
  });
  const upd=(k,v)=>setData(p=>({...p,[k]:v}));
  const curSec=RT_SECTIONS.find(x=>x.id===sec);
  
  const generateDoc=()=>{
    const now=new Date().toLocaleDateString('fr-BE');
    let doc=`‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;
    doc+=`         R√àGLEMENT DE TRAVAIL\n`;
    doc+=`         ${data.nomEntreprise}\n`;
    doc+=`‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n`;
    doc+=`Entreprise: ${data.nomEntreprise}\nSi√®ge social: ${data.siege}\nN¬∞ ONSS: ${data.numOnss}\nCP: ${data.cp}\nActivit√©: ${data.activite}\nDate d'entr√©e en vigueur: ${now}\n\n`;
    
    RT_SECTIONS.forEach(s=>{
      doc+=`‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
      doc+=`${s.t.toUpperCase()}\n`;
      doc+=`‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n`;
      s.fields.forEach(f=>{
        const label=f.replace(/([A-Z])/g," $1").replace(/^./,c=>c.toUpperCase());
        doc+=`${label}: ${data[f]||'[√Ä compl√©ter]'}\n`;
      });
      doc+='\n';
    });
    
    doc+=`‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nSIGNATURES\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n`;
    doc+=`Date: ${now}\n\nL'employeur:\t\t\t\tLe(s) travailleur(s):\n${data.nomEntreprise}\t\t\t[Signature(s)]\n\n`;
    doc+=`Ce r√®glement de travail a √©t√© √©tabli conform√©ment √† la loi du 08/04/1965\nrelative aux r√®glements de travail et ses modifications ult√©rieures.\n`;
    doc+=`Un exemplaire a √©t√© d√©pos√© au bureau r√©gional du Contr√¥le des lois sociales.\n`;
    return doc;
  };
  
  return <div>
    <PH title="R√®glement de travail" sub="G√©n√©rateur conforme √† la loi du 08/04/1965" actions={<B onClick={()=>{
      const doc=generateDoc();
      d({type:"MODAL",m:{w:900,c:<div>
        <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 12px',fontFamily:"'Cormorant Garamond',serif"}}>R√®glement de travail ‚Äî {data.nomEntreprise}</h2>
        <div style={{fontSize:11,color:'#c6a34e',marginBottom:10}}>Document obligatoire ‚Äî Art. 4-15 Loi 08/04/1965</div>
        <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10.5,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:450,overflowY:'auto'}}>{doc}</pre>
        <div style={{display:'flex',gap:10,marginTop:14,justifyContent:'flex-end'}}>
          <B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B>
          <B onClick={()=>{navigator.clipboard?.writeText(doc);alert('Copi√© !')}}>Copier</B>
        </div>
      </div>}});
    }}>G√©n√©rer le document</B>}/>
    <div style={{display:'grid',gridTemplateColumns:'260px 1fr',gap:18}}>
      <C>
        <ST>Sections</ST>
        {RT_SECTIONS.map(rs=><button key={rs.id} onClick={()=>setSec(rs.id)} style={{display:'block',width:'100%',padding:'9px 12px',marginBottom:4,border:sec===rs.id?'1px solid rgba(198,163,78,.3)':'1px solid rgba(198,163,78,.06)',borderRadius:7,background:sec===rs.id?'rgba(198,163,78,.1)':'rgba(198,163,78,.02)',color:sec===rs.id?'#c6a34e':'#9e9b93',cursor:'pointer',fontSize:12,textAlign:'left',fontFamily:'inherit',fontWeight:sec===rs.id?600:400}}>{rs.t}</button>)}
        <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          Obligation l√©gale: le r√®glement de travail doit √™tre remis √† chaque travailleur et d√©pos√© au Contr√¥le des lois sociales. Valeur Partena: 190‚Ç¨
        </div>
      </C>
      <C>
        <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:16}}>{curSec?.t}</div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          {curSec?.fields.map(f=><I key={f} label={f.replace(/([A-Z])/g," $1").replace(/^./,c=>c.toUpperCase())} value={data[f]||''} onChange={v=>upd(f,v)}/>)}
        </div>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONTRATS DE TRAVAIL ‚Äî Mod√®les CDI/CDD/Temps partiel
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CONTRAT_TYPES=[
  // ‚ïê‚ïê‚ïê CONTRATS SALARI√âS (Loi 03/07/1978) ‚ïê‚ïê‚ïê
  {id:"cdi",cat:"salarie",l:"CDI ‚Äî Contrat √† dur√©e ind√©termin√©e",desc:"Le contrat le plus courant. Pas de date de fin. Pr√©avis selon anciennet√© (art. 37/2)."},
  {id:"cdd",cat:"salarie",l:"CDD ‚Äî Contrat √† dur√©e d√©termin√©e",desc:"Dur√©e fix√©e. Max 4 CDD successifs, total max 2 ans (sauf exceptions art. 10)."},
  {id:"trav_det",cat:"salarie",l:"Travail nettement d√©fini",desc:"Engagement pour une t√¢che pr√©cise (projet, chantier). Fin = ach√®vement du travail."},
  {id:"remplacement",cat:"salarie",l:"Contrat de remplacement",desc:"Remplacement travailleur absent (maladie, cong√©). Max 2 ans. Art. 11ter."},
  {id:"tpartiel",cat:"salarie",l:"Temps partiel",desc:"R√©gime < temps plein. Minimum 1/3 temps plein, min 3h cons√©cutives. Avenant √©crit obligatoire."},
  {id:"interim",cat:"salarie",l:"Travail int√©rimaire",desc:"Via agence int√©rim (Randstad, Adecco...). 4 motifs: remplacement, surcro√Æt, travail exceptionnel, insertion."},
  {id:"etudiant",cat:"salarie",l:"Convention d\'occupation √©tudiant",desc:"Max 650h/an. Cotisations solidarit√© r√©duites (2,71% + 5,42%). Contrat √©crit obligatoire."},
  {id:"flexi",cat:"salarie",l:"Flexi-job",desc:"Horeca, commerce, sant√©. Pas de cotisations personnelles. ONSS patronal 28%. Exige emploi principal 4/5."},
  {id:"saisonnier",cat:"salarie",l:"Travail saisonnier",desc:"Agriculture, horticulture (CP 144/145). Max 65 jours/an (100 j. fruits/l√©gumes). Dimona sp√©cifique."},
  {id:"occas_horeca",cat:"salarie",l:"Travail occasionnel Horeca",desc:"Max 50 jours/an (CP 302). Forfait ONSS 8,86‚Ç¨/h. Pas de contrat √©crit obligatoire."},
  {id:"extras",cat:"salarie",l:"Extras √©v√©nementiel",desc:"CP 302/304. Engagement ponctuel max 2 jours cons√©cutifs. Dimona ¬´ EXT ¬ª."},
  {id:"titre_service",cat:"salarie",l:"Titres-services",desc:"CP 322.01. Contrat de travail titres-services obligatoirement √©crit. Aide-m√©nag√®re √† domicile."},
  {id:"art60",cat:"salarie",l:"Article 60¬ß7 (CPAS)",desc:"Mise √† l'emploi par le CPAS. Dur√©e limit√©e pour acqu√©rir droits ch√¥mage. Employeur = CPAS."},
  {id:"insertion",cat:"salarie",l:"Convention d\'immersion professionnelle (CIP)",desc:"Stage r√©mun√©r√©. Pas un contrat de travail. Indemnit√© ‚â• revenu minimum. 6 mois max (renouvelable 1x)."},
  {id:"formation_alternance",cat:"salarie",l:"Contrat de formation en alternance",desc:"IFAPME/SFPME/Syntra. 20% √©cole + 80% entreprise. Allocation progressive selon ann√©e."},
  {id:"premier_emploi",cat:"salarie",l:"Convention premier emploi (CPE/Rosetta)",desc:"Jeunes < 26 ans. Obligation d'embauche 3% (entreprises > 50 travailleurs). R√©ductions ONSS."},
  {id:"occupation_protect",cat:"salarie",l:"Travail adapt√© / ETA",desc:"CP 327. Entreprises de travail adapt√©. Travailleurs handicap√©s. Subsides AViQ/PHARE/VAPH."},
  {id:"detache",cat:"salarie",l:"Travailleur d√©tach√©",desc:"Art. 5-14 Directive 96/71/CE. D√©claration Limosa obligatoire. Conditions belges applicables."},
  {id:"domestique",cat:"salarie",l:"Travailleur domestique",desc:"Personnel de maison (nettoyage, garde). Loi 03/07/1978 art. 108-118. Dimona obligatoire."},
  {id:"teletravail_struct",cat:"salarie",l:"T√©l√©travail structurel",desc:"CCT n¬∞85. Avenant √©crit. Indemnit√© bureau forfaitaire (max 151,70‚Ç¨/mois). Assurance AT adapt√©e."},
  {id:"travail_domicile",cat:"salarie",l:"Travail √† domicile",desc:"Art. 119.1-119.12 loi 03/07/1978. Distinct du t√©l√©travail. Indemnit√© frais 10% du salaire."},
  {id:"mise_dispo",cat:"salarie",l:"Mise √† disposition (groupement d\'employeurs)",desc:"Art. 31-32 loi 24/07/1987. Autoris√© via groupement agr√©√©. Convention tripartite."},

  // ‚ïê‚ïê‚ïê STATUT IND√âPENDANT (AR n¬∞38 du 27/07/1967) ‚ïê‚ïê‚ïê
  {id:"indep_principal",cat:"independant",l:"Ind√©pendant √† titre principal",desc:"Activit√© principale. Cotisations sociales trimestrielles (20,5% < 73.471‚Ç¨). Affiliation caisse sociale."},
  {id:"indep_complementaire",cat:"independant",l:"Ind√©pendant compl√©mentaire",desc:"En parall√®le d'un emploi salari√© ‚â• mi-temps. Cotisations r√©duites si revenu < 1.865,44‚Ç¨/an."},
  {id:"indep_conjoint_aidant",cat:"independant",l:"Conjoint aidant",desc:"Aide r√©guli√®re au conjoint ind√©pendant. Maxi-statut ou mini-statut. Cotisations sociales propres."},
  {id:"indep_mandataire",cat:"independant",l:"Mandataire de soci√©t√© (g√©rant/admin)",desc:"G√©rant SRL, administrateur SA. Assimil√© ind√©pendant. R√©mun√©ration via soci√©t√©. Cotisations sur tous revenus."},
  {id:"indep_etudiant",cat:"independant",l:"√âtudiant-entrepreneur",desc:"Statut depuis 2017. ‚â§ 25 ans, inscrit dans l'enseignement. Cotisations r√©duites si revenu < 8.430,72‚Ç¨/an."},
  {id:"indep_retraite",cat:"independant",l:"Ind√©pendant pensionn√© (actif apr√®s pension)",desc:"Activit√© apr√®s 65 ans ou 45 ans carri√®re. Revenus illimit√©s. Cotisations sociales dues."},
  {id:"indep_starter",cat:"independant",l:"Ind√©pendant primo-starters",desc:"Cotisations r√©duites 1√®re ann√©e (cr√©ation). Dispense possible via caisse sociale."},

  // ‚ïê‚ïê‚ïê FORMES SP√âCIALES / HYBRIDES ‚ïê‚ïê‚ïê
  {id:"freelance_be",cat:"special",l:"Freelance / Consultant (ind√©pendant)",desc:"Prestation de services B2B. Pas de lien de subordination. Facturation TVA. Risque de faux ind√©pendant."},
  {id:"smart_sme",cat:"special",l:"Smart / SMart (soci√©t√© mutuelle d\'artistes)",desc:"Portage salarial. Facture via Smart ‚Üí re√ßoit un salaire. Couverture sociale compl√®te. Commission ~6,5%."},
  {id:"volontariat",cat:"special",l:"Volontariat (Loi 03/07/2005)",desc:"Pas un contrat de travail. Indemnit√© max 40,67‚Ç¨/jour ou 1.626,77‚Ç¨/an (2026). Pas d'ONSS ni PP."},
  {id:"artiste",cat:"special",l:"Contrat artiste (visa artiste / AKC)",desc:"Depuis 01/2024: Attestation du travail des arts (ATA). Commission du travail des arts. R√®gles sp√©cifiques."},
  {id:"sportif_remunere",cat:"special",l:"Sportif r√©mun√©r√©",desc:"Loi 24/02/1978. Contrat sp√©cial. Employ√© ou ind√©pendant selon le cas. ONSS si > r√©mun√©ration minimale."},
  {id:"apprentissage_ind",cat:"special",l:"Apprentissage (ind√©pendant ‚Äî IFAPME)",desc:"Convention d'apprentissage de professions ind√©pendantes. Allocation mensuelle. Pas contrat de travail."},
  {id:"economie_plateforme",cat:"special",l:"Travail via plateforme (P2P)",desc:"Deliveroo, Uber. R√©gime fiscal 2024: 50% forfait frais, max 7.170‚Ç¨/an. Pr√©somption salariat UE 2026."},
  {id:"coworking_cooperatif",cat:"special",l:"Coop√©rative d\'activit√©s (couveuse)",desc:"Test activit√© ind√©pendante encadr√©. Statut salari√© pendant test. JobYourself, Microsolutions, etc."},
  {id:"associe_actif",cat:"special",l:"Associ√© actif (non-r√©mun√©r√©)",desc:"Travail dans sa propre soci√©t√© sans r√©mun√©ration formelle. Doit cotiser comme ind√©pendant. Minimum cotisation."},
  {id:"frontalier",cat:"special",l:"Travailleur frontalier",desc:"Domicile FR/NL/LU/DE, travail en BE. Convention pr√©ventive double imposition. S√©curit√© sociale = pays de travail."},
];

function ContratsTravailMod({s,d}){
  const [type,setType]=useState('cdi');
  const [form,setForm]=useState({
    empNom:'',empPrenom:"",empNN:'',empAdresse:'',empNationalite:'Belge',
    fonction:'',salaireBrut:'',debut:'',fin:'',essai:'',
    regime:'38h/semaine',horaire:'Lundi-Vendredi 09:00-17:30',
    lieuTravail:s.co.address||'',
    avantages:'Ch√®ques-repas, Eco-ch√®ques (si applicable)',
    clauseNonConcurrence:'Non',clauseEcolage:'Non',
  });
  const upd=(k,v)=>setForm(p=>({...p,[k]:v}));
  const sel=CONTRAT_TYPES.find(x=>x.id===type);
  
  const generate=()=>{
    const now=new Date().toLocaleDateString('fr-BE');
    let doc=`CONTRAT DE TRAVAIL\n`;
    doc+=`${sel.l}\n`;
    doc+=`‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n`;
    doc+=`ENTRE:\n`;
    doc+=`L'employeur: ${s.co.name}\nSi√®ge: ${s.co.address}\nN¬∞ BCE: ${s.co.bce||'[BCE]'}\nN¬∞ ONSS: ${s.co.onss||'[ONSS]'}\nCP: ${s.co.cp||'200'}\n`;
    doc+=`Repr√©sent√© par: [Nom du responsable]\n\n`;
    doc+=`ET:\n`;
    doc+=`Le travailleur: ${form.empPrenom} ${form.empNom}\nNN: ${form.empNN}\nDomicile: ${form.empAdresse}\nNationalit√©: ${form.empNationalite}\n\n`;
    doc+=`IL EST CONVENU CE QUI SUIT:\n\n`;
    doc+=`Art. 1 ‚Äî OBJET\nLe travailleur est engag√© en qualit√© de: ${form.fonction}\n\n`;
    doc+=`Art. 2 ‚Äî DUR√âE\n`;
    if(type==='cdi')doc+=`Le pr√©sent contrat est conclu pour une dur√©e ind√©termin√©e.\n`;
    else if(type==='cdd')doc+=`Le pr√©sent contrat prend cours le ${form.debut} et se termine le ${form.fin}.\n`;
    else if(type==='etudiant')doc+=`Convention √©tudiante du ${form.debut} au ${form.fin}.\nDans le cadre du contingent de 650h/an (art. 17bis AR 28/11/1969).\n`;
    else if(type==='trav_det')doc+=`Le pr√©sent contrat est conclu pour un travail nettement d√©fini.\nDescription: [√† compl√©ter]\nLe contrat prendra fin √† l'ach√®vement du travail convenu.\n`;
    else if(type==='remplacement')doc+=`Le pr√©sent contrat est conclu en remplacement de [nom travailleur absent]\nabsent(e) pour cause de [motif].\nDur√©e maximale: 2 ans (art. 11ter loi 03/07/1978).\n`;
    else if(type==='saisonnier')doc+=`Travail saisonnier du ${form.debut} au ${form.fin}.\nMax 65 jours/an (100 jours pour fruits/l√©gumes). Dimona ¬´ DWD ¬ª.\n`;
    else if(type==='occas_horeca')doc+=`Travail occasionnel Horeca du ${form.debut} au ${form.fin}.\nMax 50 jours/an. Forfait ONSS: 8,86‚Ç¨/heure.\n`;
    else if(type==='insertion')doc+=`Convention d'immersion professionnelle (CIP) du ${form.debut} au ${form.fin}.\nDur√©e: max 6 mois, renouvelable 1 fois. Indemnit√© mensuelle: ${form.salaireBrut}‚Ç¨.\nCette convention n'est PAS un contrat de travail.\n`;
    else if(type==='formation_alternance')doc+=`Contrat de formation en alternance du ${form.debut} au ${form.fin}.\n20% formation / 80% entreprise. Allocation selon ann√©e de formation.\n`;
    else if(type==='teletravail_struct')doc+=`Le pr√©sent contrat inclut un avenant de t√©l√©travail structurel (CCT n¬∞85).\nLieu de t√©l√©travail: domicile du travailleur.\nIndemnit√© forfaitaire de bureau: max 151,70‚Ç¨/mois.\n`;
    else if(sel.cat==='independant'){
      doc=`CONVENTION DE COLLABORATION IND√âPENDANTE\n${sel.l}\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n`;
      doc+=`ENTRE:\nLe donneur d'ordre: ${s.co.name}\nSi√®ge: ${s.co.address}\nN¬∞ BCE: ${s.co.bce||'[BCE]'}\n\n`;
      doc+=`ET:\nLe prestataire ind√©pendant: ${form.empPrenom} ${form.empNom}\nN¬∞ BCE: [BCE prestataire]\nN¬∞ TVA: [TVA prestataire]\nCaisse sociale: [nom caisse]\n\n`;
      doc+=`Art. 1 ‚Äî OBJET\nLe prestataire s'engage √† fournir les services suivants: ${form.fonction}\nEn qualit√© de: ${sel.l}\n\n`;
      doc+=`Art. 2 ‚Äî ABSENCE DE LIEN DE SUBORDINATION\nLe prestataire exerce son activit√© en toute ind√©pendance.\nIl organise librement son travail, d√©termine ses horaires et m√©thodes.\nAucun lien de subordination n'existe entre les parties (Loi 27/12/2006).\n\n`;
      doc+=`Art. 3 ‚Äî R√âMUN√âRATION\nHonoraires: ${form.salaireBrut}‚Ç¨ [par mois/prestation/heure]\nFacturation: mensuelle, TVA 21%.\nPaiement: 30 jours fin de mois.\n\n`;
      doc+=`Art. 4 ‚Äî DUR√âE\nD√©but: ${form.debut}${form.fin?`\nFin: ${form.fin}`:'\nDur√©e ind√©termin√©e avec pr√©avis raisonnable.'}\n\n`;
      doc+=`Art. 5 ‚Äî CRIT√àRES D'IND√âPENDANCE (Loi 27/12/2006)\n- Libert√© d'organisation du travail\n- Libert√© d'organisation du temps de travail\n- Possibilit√© de travailler pour d'autres donneurs d'ordre\n- Pas de contr√¥le hi√©rarchique\n\n`;
      if(type==='indep_mandataire')doc+=`Art. 6 ‚Äî MANDAT SOCIAL\nLe prestataire exerce un mandat de [g√©rant/administrateur] au sein de la soci√©t√©.\nConform√©ment au Code des soci√©t√©s et des associations (CSA).\nR√©vocable [ad nutum / moyennant pr√©avis].\n\n`;
      if(type==='indep_conjoint_aidant')doc+=`Art. 6 ‚Äî STATUT CONJOINT AIDANT\nLe prestataire aide r√©guli√®rement son conjoint dans l'exercice de son activit√© ind√©pendante.\nStatut social: [maxi-statut / mini-statut].\nAffiliation caisse sociale obligatoire.\n\n`;
      doc+=`Art. ${type==='indep_mandataire'||type==='indep_conjoint_aidant'?7:6} ‚Äî OBLIGATIONS SOCIALES\n`;
      doc+=`Le prestataire d√©clare √™tre en r√®gle de:\n- Affiliation √† une caisse d'assurances sociales\n- Cotisations sociales trimestrielles\n- Assurance maladie-invalidit√©\n- Assurance responsabilit√© professionnelle\n\n`;
      doc+=`Fait en double exemplaire √† ${s.co.address?.split(',').pop()?.trim()||'Bruxelles'}, le ${now}\n\n`;
      doc+=`Le donneur d'ordre:\t\t\tLe prestataire:\n[Signature]\t\t\t\t[Signature]\n`;
    }
    else if(sel.cat==='special'){
      if(type==='volontariat'){
        doc=`CONVENTION DE VOLONTARIAT\n(Loi du 03/07/2005 relative aux droits des volontaires)\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n`;
        doc+=`ENTRE:\nL'organisation: ${s.co.name}\nSi√®ge: ${s.co.address}\n\n`;
        doc+=`ET:\nLe/la volontaire: ${form.empPrenom} ${form.empNom}\n\n`;
        doc+=`Art. 1 ‚Äî Le volontariat est exerc√© sans r√©mun√©ration ni obligation.\n`;
        doc+=`Art. 2 ‚Äî D√©fraiement: forfait max 40,67‚Ç¨/jour, 1.626,77‚Ç¨/an (2026).\n`;
        doc+=`Art. 3 ‚Äî Aucune cotisation ONSS, aucun pr√©compte professionnel.\n`;
        doc+=`Art. 4 ‚Äî Assurance responsabilit√© civile souscrite par l'organisation.\n\n`;
      }
      else if(type==='smart_sme'){
        doc=`NOTE D'INFORMATION ‚Äî PORTAGE SALARIAL (Smart)\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n`;
        doc+=`Prestataire: ${form.empPrenom} ${form.empNom}\nMission: ${form.fonction}\nClient: ${s.co.name}\n\n`;
        doc+=`Smart √©tablit le contrat de travail, facture le client, et reverse:\n- Montant factur√© HT\n- Moins commission Smart (~6,5%)\n- Moins cotisations sociales employeur + travailleur\n- Moins pr√©compte professionnel\n= Net vers√© au prestataire\n\n`;
        doc+=`Avantages: couverture sociale compl√®te, ch√¥mage, mutuelle, pension.\n`;
      }
      else{
        doc+=`Le pr√©sent contrat est de type: ${sel.l}\n${sel.desc}\n`;
        doc+=`D√©but: ${form.debut}${form.fin?` ‚Äî Fin: ${form.fin}`:''}\n`;
      }
      doc+=`\nFait √† ${s.co.address?.split(',').pop()?.trim()||'Bruxelles'}, le ${now}\n\n`;
      doc+=`Signature 1:\t\t\t\tSignature 2:\n[Signature]\t\t\t\t[Signature]\n`;
    }
    else doc+=`D√©but: ${form.debut}${form.fin?` ‚Äî Fin: ${form.fin}`:''}\n`;
    if(sel.cat==='salarie'){
    doc+=`\nArt. 3 ‚Äî LIEU DE TRAVAIL\n${form.lieuTravail}\n`;
    doc+=`\nArt. 4 ‚Äî R√âMUN√âRATION\nSalaire brut mensuel: ${form.salaireBrut}‚Ç¨\nMode de paiement: virement bancaire\n`;
    doc+=`\nArt. 5 ‚Äî DUR√âE DU TRAVAIL\nR√©gime: ${form.regime}\nHoraire: ${form.horaire}\n`;
    doc+=`\nArt. 6 ‚Äî AVANTAGES EXTRA-L√âGAUX\n${form.avantages}\n`;
    if(form.clauseNonConcurrence==='Oui')doc+=`\nArt. 7 ‚Äî CLAUSE DE NON-CONCURRENCE\nConform√©ment √† l'art. 65 de la loi du 03/07/1978.\n`;
    if(form.clauseEcolage==='Oui')doc+=`\nArt. 8 ‚Äî CLAUSE D'√âCOLAGE\nConform√©ment √† l'art. 22bis de la loi du 03/07/1978.\n`;
    doc+=`\nArt. 9 ‚Äî DISPOSITIONS G√âN√âRALES\nLe r√®glement de travail fait partie int√©grante du pr√©sent contrat.\nLe contrat est r√©gi par la loi du 03/07/1978 relative aux contrats de travail.\n`;
    doc+=`\nFait en double exemplaire √† ${s.co.address?.split(',').pop()?.trim()||'Bruxelles'}, le ${now}\n\n`;
    doc+=`L'employeur:\t\t\t\tLe travailleur:\n[Signature]\t\t\t\t[Signature]\n`;
    doc+=`Pr√©c√©d√© de la mention\t\t\tPr√©c√©d√© de la mention\n"Lu et approuv√©"\t\t\t\t"Lu et approuv√©"\n`;
    }
    return doc;
  };
  
  return <div>
    <PH title="Contrats de travail & conventions" sub="Salari√©s, ind√©pendants, formes sp√©ciales ‚Äî 40 types de contrats belges"/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Type de contrat</ST>
        <div style={{fontSize:10,color:'#c6a34e',fontWeight:600,marginBottom:6}}>üìã SALARI√âS (Loi 03/07/1978)</div>
        {CONTRAT_TYPES.filter(ct=>ct.cat==='salarie').map(ct=><button key={ct.id} onClick={()=>setType(ct.id)} style={{display:'block',width:'100%',padding:'8px 10px',marginBottom:3,border:type===ct.id?'1px solid rgba(198,163,78,.3)':'1px solid rgba(198,163,78,.04)',borderRadius:6,background:type===ct.id?'rgba(198,163,78,.1)':'transparent',color:type===ct.id?'#c6a34e':'#9e9b93',cursor:'pointer',fontSize:11,textAlign:'left',fontFamily:'inherit',fontWeight:type===ct.id?600:400}}>
          {ct.l.split('‚Äî')[0]}
        </button>)}
        <div style={{fontSize:10,color:'#a78bfa',fontWeight:600,marginTop:12,marginBottom:6}}>üè¢ IND√âPENDANTS (AR n¬∞38)</div>
        {CONTRAT_TYPES.filter(ct=>ct.cat==='independant').map(ct=><button key={ct.id} onClick={()=>setType(ct.id)} style={{display:'block',width:'100%',padding:'8px 10px',marginBottom:3,border:type===ct.id?'1px solid rgba(167,139,250,.3)':'1px solid rgba(167,139,250,.04)',borderRadius:6,background:type===ct.id?'rgba(167,139,250,.1)':'transparent',color:type===ct.id?'#a78bfa':'#9e9b93',cursor:'pointer',fontSize:11,textAlign:'left',fontFamily:'inherit',fontWeight:type===ct.id?600:400}}>
          {ct.l.split('‚Äî')[0]}
        </button>)}
        <div style={{fontSize:10,color:'#60a5fa',fontWeight:600,marginTop:12,marginBottom:6}}>‚ö° FORMES SP√âCIALES / HYBRIDES</div>
        {CONTRAT_TYPES.filter(ct=>ct.cat==='special').map(ct=><button key={ct.id} onClick={()=>setType(ct.id)} style={{display:'block',width:'100%',padding:'8px 10px',marginBottom:3,border:type===ct.id?'1px solid rgba(96,165,250,.3)':'1px solid rgba(96,165,250,.04)',borderRadius:6,background:type===ct.id?'rgba(96,165,250,.1)':'transparent',color:type===ct.id?'#60a5fa':'#9e9b93',cursor:'pointer',fontSize:11,textAlign:'left',fontFamily:'inherit',fontWeight:type===ct.id?600:400}}>
          {ct.l.split('‚Äî')[0]}
        </button>)}
        <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          √âquivalent LegalSmart de Partena. Contrats g√©n√©r√©s selon la loi du 03/07/1978 et les CCT applicables.
        </div>
      </C>
      <C>
        <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:16}}>{sel?.l}</div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
          <I label="Nom" value={form.empNom} onChange={v=>upd('empNom',v)}/>
          <I label="Pr√©nom" value={form.empPrenom} onChange={v=>upd('empPrenom',v)}/>
          <I label="N¬∞ National" value={form.empNN} onChange={v=>upd('empNN',v)}/>
          <I label="Adresse" value={form.empAdresse} onChange={v=>upd('empAdresse',v)}/>
          <I label="Fonction" value={form.fonction} onChange={v=>upd('fonction',v)}/>
          <I label="Salaire brut mensuel (‚Ç¨)" value={form.salaireBrut} onChange={v=>upd('salaireBrut',v)}/>
          <I label="Date d√©but" value={form.debut} onChange={v=>upd('debut',v)}/>
          {(type==='cdd'||type==='interim'||type==='etudiant')&&<I label="Date fin" value={form.fin} onChange={v=>upd('fin',v)}/>}
          <I label="R√©gime" value={form.regime} onChange={v=>upd('regime',v)}/>
          <I label="Horaire" value={form.horaire} onChange={v=>upd('horaire',v)}/>
          <I label="Clause non-concurrence" value={form.clauseNonConcurrence} onChange={v=>upd('clauseNonConcurrence',v)} options={[{v:"Non",l:"Non"},{v:"Oui",l:"Oui"}]}/>
          <I label="Clause d'√©colage" value={form.clauseEcolage} onChange={v=>upd('clauseEcolage',v)} options={[{v:"Non",l:"Non"},{v:"Oui",l:"Oui"}]}/>
        </div>
        <B style={{marginTop:16}} onClick={()=>{
          const doc=generate();
          d({type:"MODAL",m:{w:900,c:<div>
            <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 12px',fontFamily:"'Cormorant Garamond',serif"}}>{sel.l}</h2>
            <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10.5,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:450,overflowY:'auto'}}>{doc}</pre>
            <div style={{display:'flex',gap:10,marginTop:14,justifyContent:'flex-end'}}>
              <B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B>
              <B onClick={()=>{navigator.clipboard?.writeText(doc);alert('Copi√© !')}}>Copier</B>
            </div>
          </div>}});
        }}>G√©n√©rer le contrat</B>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  COMPTE INDIVIDUEL ‚Äî Annuel par travailleur
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function CompteIndividuelMod({s,d}){
  const [yr,setYr]=useState(new Date().getFullYear());
  const ae=s.emps.filter(e=>e.status==='active');
  
  const genCI=(emp)=>{
    const p=calc(emp,DPER,s.co);
    const brut12=emp.monthlySalary*12+emp.monthlySalary; // 12 mois + 13e mois
    const onssW12=p.onssNet*13;const onssE12=p.onssE*13;
    const tax12=p.tax*13;const net12=p.net*12+emp.monthlySalary*0.6;
    const simplePec=brut12*0.0769;const doublePec=brut12*0.0769;
    return{emp:`${emp.first} ${emp.last}`,nn:emp.nn||'XX.XX.XX-XXX.XX',fn:emp.fn||'Employ√©',
      brut12:brut12.toFixed(2),onssW:onssW12.toFixed(2),onssE:onssE12.toFixed(2),
      tax:tax12.toFixed(2),net:net12.toFixed(2),
      simplePec:simplePec.toFixed(2),doublePec:doublePec.toFixed(2),
      monthly:emp.monthlySalary,start:emp.start||'01/01/'+yr,
      regime:emp.regime||'38h/sem',statut:emp.statut||'Employ√©',
      cp:s.co.cp||'200'};
  };
  
  const showCI=(emp)=>{
    const ci=genCI(emp);
    const doc=`COMPTE INDIVIDUEL ‚Äî ANN√âE ${yr}\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n`+
    `EMPLOYEUR: ${s.co.name}\nN¬∞ ONSS: ${s.co.onss||'[ONSS]'}\nCP: ${ci.cp}\n\n`+
    `TRAVAILLEUR: ${ci.emp}\nN¬∞ National: ${ci.nn}\nFonction: ${ci.fn}\nStatut: ${ci.statut}\nR√©gime: ${ci.regime}\nDate entr√©e: ${ci.start}\n\n`+
    `R√âMUN√âRATIONS ${yr}\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`+
    MN.map((m,i)=>`${m.padEnd(12)} Brut: ${ci.monthly.toFixed(2)}‚Ç¨\tONSS: ${(ci.monthly*0.1307).toFixed(2)}‚Ç¨\tPP: ${(ci.monthly*0.1307*-1+ci.monthly>2723.36?0:(2723.36-ci.monthly)*0.2307).toFixed(2)!=='NaN'?'voir fiche':'‚Äî'}\tNet: ~${(ci.monthly*0.77).toFixed(2)}‚Ç¨`).join('\n')+
    `\n\n13e mois:\tBrut: ${ci.monthly.toFixed(2)}‚Ç¨\n`+
    `\nTOTAUX ANNUELS\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`+
    `Brut total:\t\t${ci.brut12}‚Ç¨\nONSS travailleur:\t${ci.onssW}‚Ç¨\nONSS employeur:\t\t${ci.onssE}‚Ç¨\nPr√©compte professionnel:\t${ci.tax}‚Ç¨\n`+
    `P√©cule simple:\t\t${ci.simplePec}‚Ç¨\nP√©cule double:\t\t${ci.doublePec}‚Ç¨\n`+
    `\nCe document est √©tabli conform√©ment √† l'AR du 08/08/1980.\n√Ä conserver pendant 5 ans minimum.\n`;
    
    d({type:"MODAL",m:{w:900,c:<div>
      <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 12px',fontFamily:"'Cormorant Garamond',serif"}}>Compte individuel {yr} ‚Äî {ci.emp}</h2>
      <div style={{fontSize:11,color:'#c6a34e',marginBottom:10}}>AR 08/08/1980 ‚Äî Conservation 5 ans</div>
      <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:450,overflowY:'auto'}}>{doc}</pre>
      <div style={{display:'flex',gap:10,marginTop:14,justifyContent:'flex-end'}}>
        <B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B>
        <B onClick={()=>{navigator.clipboard?.writeText(doc);alert('Copi√© !')}}>Copier</B>
      </div>
    </div>}});
  };

  return <div>
    <PH title="Comptes individuels" sub={`Ann√©e ${yr} ‚Äî AR 08/08/1980`}/>
    <div style={{display:'grid',gridTemplateColumns:'260px 1fr',gap:18}}>
      <C>
        <I label="Ann√©e" type="number" value={yr} onChange={v=>setYr(v)}/>
        <div style={{marginTop:14,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>R√©sum√©</div>
          <div>Travailleurs actifs: <b style={{color:'#e8e6e0'}}>{ae.length}</b></div>
          <div>Masse salariale: <b style={{color:'#4ade80'}}>{fmt(ae.reduce((a,e)=>a+e.monthlySalary*13,0))}</b></div>
        </div>
        <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          Le compte individuel est un document obligatoire que l'employeur doit √©tablir pour chaque travailleur. Il reprend toutes les r√©mun√©rations et retenues de l'ann√©e.
        </div>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Travailleurs ‚Äî {yr}</div></div>
        <Tbl cols={[
          {k:'n',l:"Nom",b:1,r:r=>`${r.first} ${r.last}`},
          {k:'f',l:"Fonction",r:r=>r.fn||'Employ√©'},
          {k:'s',l:"Brut mensuel",a:'right',r:r=>fmt(r.monthlySalary)},
          {k:'a',l:"Brut annuel (13m)",a:'right',r:r=><span style={{color:'#4ade80'}}>{fmt(r.monthlySalary*13)}</span>},
          {k:'x',l:"",a:'right',r:r=><B v="ghost" style={{padding:'3px 10px',fontSize:10}} onClick={()=>showCI(r)}>G√©n√©rer</B>}
        ]} data={ae}/>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ACCOUNTING OUTPUT ‚Äî R√©capitulatif comptable pour le comptable
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function AccountingOutputMod({s,d}){
  const [per,setPer]=useState({m:new Date().getMonth()+1,y:new Date().getFullYear()});
  const [view,setView]=useState('onss'); // onss | fisc | partena | global
  const ae=s.emps.filter(e=>e.status==='active');
  
  const results=ae.map(emp=>{const p=calc(emp,DPER,s.co);return{...p,emp:`${emp.first} ${emp.last}`};});
  const totals={
    gross:results.reduce((a,r)=>a+r.gross,0),
    onssNet:results.reduce((a,r)=>a+r.onssNet,0),
    onssE:results.reduce((a,r)=>a+r.onssE,0),
    tax:results.reduce((a,r)=>a+r.tax,0),
    net:results.reduce((a,r)=>a+r.net,0),
    css:results.reduce((a,r)=>a+r.css,0),
    mvEmployer:results.reduce((a,r)=>a+(r.mvEmployer||0),0),
    cost:results.reduce((a,r)=>a+r.totalCost,0),
  };
  totals.onssTotal=totals.onssNet+totals.onssE;
  
  const sections={
    onss:{title:'Paiement ONSS',color:'#f87171',items:[
      {l:"ONSS travailleur (13,07%)",v:totals.onssNet,acc:'453000'},
      {l:"ONSS employeur (25%)",v:totals.onssE,acc:'453100'},
      {l:"Total ONSS √† verser",v:totals.onssTotal,acc:'‚Äî',bold:true},
      {l:"√âch√©ance",v:`${per.y}-${(per.m+1).toString().padStart(2,"0")}-05`,text:true},
      {l:"Communication structur√©e",v:`+++${s.co.onss?.replace(/[\s.-]/g,"")||'XXXXX'}/${per.y}/${per.m.toString().padStart(2,"0")}+++`,text:true},
    ]},
    fisc:{title:'Paiement Pr√©compte professionnel',color:'#fb923c',items:[
      {l:"Pr√©compte retenu",v:totals.tax,acc:'453200'},
      {l:"CSS (Cotisation sp√©ciale)",v:totals.css,acc:'453300'},
      {l:"Total PP √† verser",v:totals.tax+totals.css,acc:'‚Äî',bold:true},
      {l:"√âch√©ance",v:`15/${(per.m+1).toString().padStart(2,"0")}/${per.y}`,text:true},
      {l:"Via",v:"MyMinfin (pr√©compte professionnel 274)",text:true},
    ]},
    global:{title:"Vue d'ensemble mensuelle",color:'#c6a34e',items:[
      {l:"Masse salariale brute",v:totals.gross,acc:'620000'},
      {l:"ONSS patronales",v:totals.onssE,acc:'621000'},
      {l:"Ch√®ques-repas employeur",v:totals.mvEmployer,acc:'623000'},
      {l:"Co√ªt total employeur",v:totals.cost,acc:'‚Äî',bold:true},
      {l:"",v:0,sep:true},
      {l:"Net √† payer (salaires)",v:totals.net,acc:'455000'},
      {l:"ONSS √† payer",v:totals.onssTotal,acc:'453000/100'},
      {l:"PP √† payer",v:totals.tax+totals.css,acc:'453200/300'},
      {l:"Total des sorties",v:totals.net+totals.onssTotal+totals.tax+totals.css+totals.mvEmployer,acc:'‚Äî',bold:true},
    ]},
  };
  const cur=sections[view];
  
  return <div>
    <PH title="Accounting Output" sub="Vue comptable des paiements ONSS, Fisc, salaires"/>
    <div style={{display:'grid',gridTemplateColumns:'260px 1fr',gap:18}}>
      <C>
        <ST>P√©riode</ST>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9}}>
          <I label="Mois" value={per.m} onChange={v=>setPer({...per,m:parseInt(v)})} options={MN.map((m,i)=>({v:i+1,l:m}))}/>
          <I label="Ann√©e" type="number" value={per.y} onChange={v=>setPer({...per,y:v})}/>
        </div>
        <ST>Section</ST>
        {[{v:"onss",l:"üí∞ Paiement ONSS"},{v:"fisc",l:"üèõÔ∏è Pr√©compte professionnel"},{v:"global",l:"üìä Vue d\'ensemble"}].map(x=>
          <button key={x.v} onClick={()=>setView(x.v)} style={{display:'block',width:'100%',padding:'9px 12px',marginBottom:4,border:view===x.v?'1px solid rgba(198,163,78,.3)':'1px solid rgba(198,163,78,.06)',borderRadius:7,background:view===x.v?'rgba(198,163,78,.1)':'rgba(198,163,78,.02)',color:view===x.v?'#c6a34e':'#9e9b93',cursor:'pointer',fontSize:12,textAlign:'left',fontFamily:'inherit',fontWeight:view===x.v?600:400}}>{x.l}</button>
        )}
        <div style={{marginTop:14,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          √âquivalent du Finance Support de Partena. Export facile vers votre comptable.
        </div>
      </C>
      <C>
        <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:6}}>{cur.title}</div>
        <div style={{fontSize:11,color:'#5e5c56',marginBottom:16}}>{MN[per.m-1]} {per.y} ‚Äî {ae.length} travailleur(s)</div>
        <div style={{display:'flex',flexDirection:'column',gap:8}}>
          {cur.items.filter(x=>!x.sep).map((it,i)=>it.text?
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 14px',background:"rgba(96,165,250,.04)",borderRadius:8}}>
              <span style={{fontSize:12,color:'#60a5fa'}}>{it.l}</span>
              <span style={{fontSize:12,color:'#e8e6e0',fontFamily:'monospace'}}>{it.v}</span>
            </div>
            :
            <div key={i} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'10px 14px',background:it.bold?'rgba(198,163,78,.08)':'rgba(198,163,78,.03)',borderRadius:8,border:it.bold?'1px solid rgba(198,163,78,.2)':'1px solid rgba(198,163,78,.06)'}}>
              <div>
                <span style={{fontSize:12,color:it.bold?'#c6a34e':'#d4d0c8',fontWeight:it.bold?700:400}}>{it.l}</span>
                {it.acc!=='‚Äî'&&<span style={{fontSize:10,color:'#5e5c56',marginLeft:8}}>({it.acc})</span>}
              </div>
              <span style={{fontSize:it.bold?16:13,fontWeight:it.bold?700:500,color:it.bold?cur.color:'#e8e6e0',fontFamily:'monospace'}}>{fmt(it.v)}</span>
            </div>
          )}
        </div>
        <B v="ghost" style={{width:'100%',marginTop:16,fontSize:11}} onClick={()=>{
          let csv='Libell√©;Compte;Montant\n';
          cur.items.filter(x=>!x.sep&&!x.text).forEach(it=>{csv+=`${it.l};${it.acc};${typeof it.v==='number'?it.v.toFixed(2):it.v}\n`;});
          navigator.clipboard?.writeText(csv);alert('CSV copi√© !');
        }}>üìã Copier en CSV (pour Excel/comptable)</B>
        
        {/* Export comptable multi-formats */}
        <ST>Export comptable</ST>
        <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:6}}>
          {COMPTA.map(c=><button key={c.id} onClick={()=>{
            const entries=cur.items.filter(x=>!x.sep&&!x.text);
            let output='';
            const date=`${per.y}${per.m.toString().padStart(2,'0')}`;
            
            if(c.id==='bob'){
              output='JRNL;DATE;ACCOUNT;LABEL;AMOUNT_D;AMOUNT_C\n';
              entries.forEach(it=>{if(typeof it.v==='number'&&it.v>0)output+=`OD;${date}01;${it.acc};${it.l};${it.v.toFixed(2)};0.00\n`;});
            }else if(c.id==='winbooks'){
              output='DocType\tDocNumber\tDate\tAccount\tDescription\tAmountD\tAmountC\n';
              entries.forEach((it,i)=>{if(typeof it.v==='number'&&it.v>0)output+=`1\tSAL${date}\t${date}01\t${it.acc}\t${it.l}\t${it.v.toFixed(2)}\t0.00\n`;});
            }else if(c.id==='exact'){
              output='Journal;Date;GLAccount;Description;AmountDC;Amount\n';
              entries.forEach(it=>{if(typeof it.v==='number'&&it.v>0)output+=`90;${date}01;${it.acc};${it.l};D;${it.v.toFixed(2)}\n`;});
            }else if(c.id==='octopus'){
              output='BookYear;Period;Journal;Date;Account;Description;Debit;Credit\n';
              entries.forEach(it=>{if(typeof it.v==='number'&&it.v>0)output+=`${per.y};${per.m};DIV;${date}01;${it.acc};${it.l};${it.v.toFixed(2)};0.00\n`;});
            }else if(c.id==='clearfact'){
              output='Date;Journal;Account;Label;Debit;Credit;VAT;Reference\n';
              entries.forEach(it=>{if(typeof it.v==='number'&&it.v>0)output+=`${date}01;SAL;${it.acc};${it.l};${it.v.toFixed(2)};0.00;0;SAL-${date}\n`;});
            }else if(c.id==='yuki'){
              output='<?xml version="1.0"?>\n<Transactions>\n';
              entries.forEach(it=>{if(typeof it.v==='number'&&it.v>0)output+=`  <Transaction><Date>${per.y}-${per.m.toString().padStart(2,'0')}-01</Date><Account>${it.acc}</Account><Description>${it.l}</Description><Amount>${it.v.toFixed(2)}</Amount></Transaction>\n`;});
              output+='</Transactions>';
            }else if(c.id==='horus'){
              output='Date;Compte;Libelle;Debit;Credit\n';
              entries.forEach(it=>{if(typeof it.v==='number'&&it.v>0)output+=`${date}01;${it.acc};${it.l};${it.v.toFixed(2)};0.00\n`;});
            }else{
              output='Libell√©;Compte;Montant\n';
              entries.forEach(it=>{if(typeof it.v==='number')output+=`${it.l};${it.acc};${it.v.toFixed(2)}\n`;});
            }
            
            const ext=c.id==='yuki'?'xml':'csv';
            const blob=new Blob(['\ufeff'+output],{type:'text/'+ext+';charset=utf-8;'});
            const url=URL.createObjectURL(blob);
            const a=document.createElement('a');a.href=url;a.download=`export_${c.id}_${date}.${ext}`;a.click();
            URL.revokeObjectURL(url);
          }} style={{padding:'8px 6px',borderRadius:8,border:'1px solid rgba(198,163,78,.12)',background:'rgba(198,163,78,.03)',color:'#c6a34e',fontSize:10,cursor:'pointer',fontFamily:'inherit',textAlign:'center'}}>
            <div style={{fontSize:14,marginBottom:2}}>üìÇ</div>
            <div style={{fontWeight:600}}>{c.n}</div>
            <div style={{fontSize:9,color:'#5e5c56'}}>{c.fmt}</div>
          </button>)}
        </div>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  WORKFLOW EMBAUCHE ‚Äî Checklist compl√®te onboarding
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function WorkflowEmbaucheMod({s,d}){
  const [sel,setSel]=useState(null);
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  const getChecklist=(emp)=>{
    const items=[
      {id:'contrat',l:'Contrat de travail sign√©',cat:'Documents',done:!!emp.startD},
      {id:'dimona',l:'Dimona IN envoy√©e',cat:'ONSS',done:s.dims?.some(d=>d.empId===emp.id&&d.type==='IN')},
      {id:'registre',l:'Registre du personnel mis √† jour',cat:'Documents',done:true},
      {id:'niss',l:'NISS v√©rifi√© (modulo 97)',cat:'Identit√©',done:!!emp.niss&&emp.niss.replace(/[\s.\-]/g,'').length===11},
      {id:'iban',l:'IBAN v√©rifi√©',cat:'Financier',done:!!emp.iban},
      {id:'medecine',l:'Visite m√©dicale programm√©e',cat:'Bien-√™tre',done:false},
      {id:'mutuelle',l:'Affiliation mutuelle v√©rifi√©e',cat:'Social',done:false},
      {id:'reglement',l:'R√®glement de travail remis',cat:'Documents',done:false},
      {id:'badge',l:'Badge / acc√®s cr√©√©',cat:'IT',done:false},
      {id:'assurance',l:'Assurance-loi AT d√©clar√©e',cat:'Social',done:false},
      {id:'allocfam',l:'Caisse allocations familiales notifi√©e',cat:'Social',done:false},
      {id:'fiscal',l:'Fiche fiscale (√©tat civil, enfants)',cat:'Fiscal',done:!!emp.civil},
      {id:'transport',l:'Transport domicile-travail configur√©',cat:'R√©mun√©ration',done:emp.commType&&emp.commType!=='none'},
      {id:'cheques',l:'Ch√®ques-repas activ√©s',cat:'Avantages',done:emp.mvT>0},
      {id:'email',l:'Email de bienvenue envoy√©',cat:'Communication',done:false},
    ];
    return items;
  };
  
  return <div>
    <PH title="Workflow Embauche" sub="Checklist automatique pour chaque nouveau travailleur"/>
    {!sel?<div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(280px,1fr))',gap:12}}>
        {ae.map(emp=>{
          const cl=getChecklist(emp);
          const done=cl.filter(c=>c.done).length;
          const pct=Math.round(done/cl.length*100);
          return <C key={emp.id} style={{cursor:'pointer',transition:'all .15s'}} onClick={()=>setSel(emp)}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}}>
              <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0'}}>{emp.first} {emp.last}</div>
              <span style={{fontSize:11,padding:'2px 8px',borderRadius:10,background:pct===100?'rgba(74,222,128,.15)':pct>=50?'rgba(251,146,60,.15)':'rgba(248,113,113,.15)',color:pct===100?'#4ade80':pct>=50?'#fb923c':'#f87171',fontWeight:600}}>{pct}%</span>
            </div>
            <div style={{fontSize:11,color:'#5e5c56',marginBottom:8}}>{emp.fn||'‚Äî'} ¬∑ Entr√©e: {emp.startD||'‚Äî'}</div>
            <div style={{height:6,background:'rgba(198,163,78,.1)',borderRadius:3,overflow:'hidden'}}>
              <div style={{height:'100%',width:`${pct}%`,background:pct===100?'#4ade80':pct>=50?'linear-gradient(90deg,#fb923c,#c6a34e)':'#f87171',borderRadius:3,transition:'width .3s'}}/>
            </div>
            <div style={{fontSize:10,color:'#5e5c56',marginTop:4}}>{done}/{cl.length} √©tapes compl√©t√©es</div>
          </C>;
        })}
      </div>
    </div>:<div>
      <B v="outline" onClick={()=>setSel(null)} style={{marginBottom:16,fontSize:11}}>‚Üê Retour</B>
      <C>
        <h3 style={{fontSize:16,fontWeight:600,color:'#c6a34e',margin:'0 0 4px'}}>{sel.first} {sel.last}</h3>
        <div style={{fontSize:11,color:'#5e5c56',marginBottom:16}}>{sel.fn} ¬∑ {sel.contract} ¬∑ CP {sel.cp} ¬∑ Entr√©e: {sel.startD}</div>
        {['Documents','ONSS','Identit√©','Financier','Social','Fiscal','Bien-√™tre','IT','R√©mun√©ration','Avantages','Communication'].map(cat=>{
          const items=getChecklist(sel).filter(c=>c.cat===cat);
          if(!items.length)return null;
          return <div key={cat} style={{marginBottom:12}}>
            <div style={{fontSize:11,fontWeight:600,color:'#9e9b93',marginBottom:6,textTransform:'uppercase',letterSpacing:'.5px'}}>{cat}</div>
            {items.map(it=><div key={it.id} style={{display:'flex',alignItems:'center',gap:8,padding:'6px 10px',marginBottom:2,borderRadius:6,background:it.done?'rgba(74,222,128,.04)':'rgba(248,113,113,.04)'}}>
              <span style={{fontSize:14}}>{it.done?'‚úÖ':'‚¨ú'}</span>
              <span style={{fontSize:12,color:it.done?'#4ade80':'#d4d0c8'}}>{it.l}</span>
            </div>)}
          </div>;
        })}
      </C>
    </div>}
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  WORKFLOW LICENCIEMENT ‚Äî Pr√©avis, C4, d√©compte final
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function WorkflowLicenciementMod({s,d}){
  const [sel,setSel]=useState(null);
  const [motif,setMotif]=useState('licenciement');
  const [dateSortie,setDateSortie]=useState(new Date().toISOString().slice(0,10));
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  
  const calcPreavis=(emp)=>{
    if(!emp.startD)return{semaines:0,mois:0};
    const start=new Date(emp.startD);
    const now=new Date();
    const years=(now-start)/(365.25*24*60*60*1000);
    // Loi du 26/12/2013 ‚Äî Statut unique
    let semaines=0;
    if(years<0.25)semaines=1;
    else if(years<0.5)semaines=3;
    else if(years<1)semaines=4;
    else if(years<2)semaines=5;
    else if(years<3)semaines=7;
    else if(years<4)semaines=9;
    else if(years<5)semaines=12;
    else if(years<6)semaines=15;
    else if(years<7)semaines=18;
    else if(years<8)semaines=21;
    else if(years<9)semaines=24;
    else if(years<10)semaines=27;
    else if(years<11)semaines=30;
    else if(years<12)semaines=33;
    else if(years<13)semaines=36;
    else if(years<14)semaines=39;
    else if(years<15)semaines=42;
    else if(years<16)semaines=45;
    else if(years<17)semaines=48;
    else if(years<18)semaines=51;
    else if(years<19)semaines=54;
    else if(years<20)semaines=57;
    else if(years<21)semaines=60;
    else if(years<22)semaines=62;
    else semaines=62+Math.floor((years-22))*1;
    return{semaines,mois:Math.round(semaines/4.33),years:Math.round(years*10)/10};
  };
  
  const calcIndemnite=(emp,preavis)=>{
    const brut=parseFloat(emp.monthlySalary)||0;
    const mensuel=brut*(1+0.0892); // + p√©cule vacances
    return Math.round(mensuel*preavis.mois*100)/100;
  };

  const documents=[
    {id:'c4',l:'C4 ‚Äî Certificat de ch√¥mage',icon:'üìÑ',auto:true},
    {id:'c131a',l:'C131A ‚Äî Attestation vacances',icon:'üìã',auto:true},
    {id:'decompte',l:'D√©compte final d√©taill√©',icon:'üí∞',auto:true},
    {id:'dimona',l:'Dimona OUT',icon:'üì°',auto:true},
    {id:'attestation',l:"Attestation d'occupation",icon:'üìù',auto:true},
    {id:'fiche281',l:'Fiche 281.10 (si fin ann√©e)',icon:'üßæ',auto:false},
    {id:'email',l:'Email au travailleur',icon:'üìß',auto:true},
    {id:'notif_compta',l:'Notification au comptable',icon:'üìä',auto:true},
  ];

  return <div>
    <PH title="Workflow Licenciement" sub="Pr√©avis automatique, C4, d√©compte final, Dimona OUT"/>
    {!sel?<div>
      <ST>S√©lectionnez le travailleur √† licencier</ST>
      <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(260px,1fr))',gap:10}}>
        {ae.map(emp=>{
          const pr=calcPreavis(emp);
          return <C key={emp.id} style={{cursor:'pointer'}} onClick={()=>setSel(emp)}>
            <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0'}}>{emp.first} {emp.last}</div>
            <div style={{fontSize:11,color:'#5e5c56'}}>{emp.fn} ¬∑ Entr√©e: {emp.startD} ¬∑ {pr.years} ans</div>
            <div style={{fontSize:11,color:'#fb923c',marginTop:4}}>Pr√©avis: {pr.semaines} semaines ({pr.mois} mois)</div>
          </C>;
        })}
      </div>
    </div>:<div>
      <B v="outline" onClick={()=>setSel(null)} style={{marginBottom:16,fontSize:11}}>‚Üê Retour</B>
      <C>
        <h3 style={{fontSize:16,fontWeight:600,color:'#f87171',margin:'0 0 12px'}}>Licenciement: {sel.first} {sel.last}</h3>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12,marginBottom:16}}>
          <I label="Motif" value={motif} onChange={setMotif} options={[
            {v:'licenciement',l:'Licenciement classique'},{v:'fin_cdd',l:'Fin CDD'},
            {v:'motif_grave',l:'Motif grave'},{v:'commun_accord',l:'Rupture commun accord'},
            {v:'demission',l:'D√©mission'},{v:'force_majeure',l:'Force majeure m√©dicale'},
            {v:'transfert',l:'Transfert CCT 32bis'},{v:'pension',l:'Pension/Pr√©pension'},
          ]}/>
          <I label="Date de sortie" type="date" value={dateSortie} onChange={setDateSortie}/>
          <div style={{padding:12,background:'rgba(248,113,113,.06)',borderRadius:8,textAlign:'center'}}>
            <div style={{fontSize:10,color:'#9e9b93'}}>Pr√©avis</div>
            <div style={{fontSize:20,fontWeight:700,color:'#f87171'}}>{calcPreavis(sel).semaines} sem.</div>
            <div style={{fontSize:10,color:'#5e5c56'}}>{calcPreavis(sel).mois} mois ¬∑ {calcPreavis(sel).years} ans anc.</div>
          </div>
        </div>
        {motif!=='motif_grave'&&motif!=='demission'&&<div style={{padding:14,background:'rgba(198,163,78,.06)',borderRadius:10,marginBottom:16,border:'1px solid rgba(198,163,78,.15)'}}>
          <div style={{fontSize:12,color:'#c6a34e',fontWeight:600,marginBottom:4}}>Indemnit√© de pr√©avis estim√©e</div>
          <div style={{fontSize:22,fontWeight:700,color:'#c6a34e'}}>{fmt(calcIndemnite(sel,calcPreavis(sel)))}</div>
          <div style={{fontSize:10,color:'#5e5c56'}}>Brut {fmt(sel.monthlySalary)} √ó {calcPreavis(sel).mois} mois √ó 1.0892 (p√©cule)</div>
        </div>}
        {motif==='motif_grave'&&<div style={{padding:14,background:'rgba(248,113,113,.06)',borderRadius:10,marginBottom:16,border:'1px solid rgba(248,113,113,.2)'}}>
          <div style={{fontSize:12,color:'#f87171',fontWeight:600}}>‚ö†Ô∏è Motif grave ‚Äî Pas de pr√©avis ni d'indemnit√©</div>
          <div style={{fontSize:11,color:'#5e5c56',marginTop:4}}>Notification dans les 3 jours ouvrables. Lettre recommand√©e avec motifs pr√©cis.</div>
        </div>}
        <ST>Documents √† g√©n√©rer</ST>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8}}>
          {documents.map(doc=><div key={doc.id} style={{display:'flex',alignItems:'center',gap:8,padding:'10px 12px',borderRadius:8,background:'rgba(198,163,78,.03)',border:'1px solid rgba(198,163,78,.08)'}}>
            <span style={{fontSize:16}}>{doc.icon}</span>
            <div style={{flex:1}}>
              <div style={{fontSize:12,color:'#e8e6e0'}}>{doc.l}</div>
              <div style={{fontSize:9,color:doc.auto?'#4ade80':'#5e5c56'}}>{doc.auto?'Auto-g√©n√©r√©':'Manuel'}</div>
            </div>
          </div>)}
        </div>
        <B style={{width:'100%',marginTop:16}} onClick={()=>{
          d({type:'UPD_E',d:{...sel,status:'sorti',dateSortie:dateSortie,motifSortie:motif}});
          alert(`‚úÖ ${sel.first} ${sel.last} ‚Äî Sortie enregistr√©e (${motif}). Pr√©avis: ${calcPreavis(sel).semaines} semaines.`);
          setSel(null);
        }}>‚ö° Ex√©cuter le licenciement</B>
      </C>
    </div>}
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  WORKFLOW MALADIE ‚Äî Salaire garanti, certificat, mutuelle
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function WorkflowMaladieMod({s,d}){
  const [sel,setSel]=useState(null);
  const [dateDebut,setDateDebut]=useState(new Date().toISOString().slice(0,10));
  const [dateFin,setDateFin]=useState('');
  const [certRecu,setCertRecu]=useState(false);
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  
  const calcGaranti=(emp,jours)=>{
    const isEmploye=emp.statut==='employe'||emp.statut==='etudiant';
    if(isEmploye){
      // Employ√©: 30 jours √† 100%
      if(jours<=30)return{pct:100,source:'Employeur',regime:'Salaire garanti employ√© (30j)'};
      return{pct:60,source:'Mutuelle',regime:'Indemnit√© mutuelle (60%)'};
    }else{
      // Ouvrier: 7j √† 100%, 7j √† 85.88%, 14j √† 25.88% (+ mutuelle 60%)
      if(jours<=7)return{pct:100,source:'Employeur',regime:'Salaire garanti ouvrier ‚Äî Semaine 1 (100%)'};
      if(jours<=14)return{pct:85.88,source:'Employeur',regime:'Salaire garanti ouvrier ‚Äî Semaine 2 (85.88%)'};
      if(jours<=30)return{pct:25.88,source:'Employeur + Mutuelle',regime:'Semaines 3-4: employeur 25.88% + mutuelle 60%'};
      return{pct:60,source:'Mutuelle',regime:'Indemnit√© mutuelle (60%)'};
    }
  };

  return <div>
    <PH title="Workflow Maladie" sub="Salaire garanti, certificat m√©dical, mutuelle, Bradford Factor"/>
    {!sel?<div>
      <ST>S√©lectionnez le travailleur en incapacit√©</ST>
      <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(260px,1fr))',gap:10}}>
        {ae.map(emp=><C key={emp.id} style={{cursor:'pointer'}} onClick={()=>setSel(emp)}>
          <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0'}}>{emp.first} {emp.last}</div>
          <div style={{fontSize:11,color:'#5e5c56'}}>{emp.fn} ¬∑ {emp.statut==='ouvrier'?'Ouvrier':'Employ√©'} ¬∑ {fmt(emp.monthlySalary)}/mois</div>
        </C>)}
      </div>
    </div>:<div>
      <B v="outline" onClick={()=>setSel(null)} style={{marginBottom:16,fontSize:11}}>‚Üê Retour</B>
      <C>
        <h3 style={{fontSize:16,fontWeight:600,color:'#fb923c',margin:'0 0 12px'}}>Maladie: {sel.first} {sel.last}</h3>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12,marginBottom:16}}>
          <I label="Date d√©but" type="date" value={dateDebut} onChange={setDateDebut}/>
          <I label="Date fin (si connue)" type="date" value={dateFin} onChange={setDateFin}/>
          <I label="Certificat re√ßu" value={certRecu?'oui':'non'} onChange={v=>setCertRecu(v==='oui')} options={[{v:'non',l:'Non'},{v:'oui',l:'Oui'}]}/>
        </div>
        
        {/* Simulation salaire garanti */}
        <ST>Simulation salaire garanti</ST>
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8}}>
          {[7,14,21,30,60,90,180,365].map(j=>{
            const g=calcGaranti(sel,j);
            return <div key={j} style={{padding:10,borderRadius:8,background:'rgba(198,163,78,.03)',border:'1px solid rgba(198,163,78,.08)',textAlign:'center'}}>
              <div style={{fontSize:10,color:'#9e9b93'}}>Jour {j}</div>
              <div style={{fontSize:16,fontWeight:700,color:g.pct===100?'#4ade80':g.pct>60?'#fb923c':'#f87171'}}>{g.pct}%</div>
              <div style={{fontSize:9,color:'#5e5c56'}}>{g.source}</div>
            </div>;
          })}
        </div>
        
        <div style={{marginTop:12,padding:12,background:'rgba(96,165,250,.04)',borderRadius:8,fontSize:11,color:'#60a5fa',lineHeight:1.6}}>
          <b>{sel.statut==='ouvrier'?'Ouvrier':'Employ√©'}</b>: {sel.statut==='ouvrier'
            ?'Semaine 1: 100% employeur ¬∑ Semaine 2: 85.88% employeur ¬∑ Semaines 3-4: 25.88% employeur + 60% mutuelle ¬∑ Apr√®s 30j: mutuelle 60%'
            :'30 premiers jours: 100% employeur (salaire garanti) ¬∑ Apr√®s 30j: mutuelle 60% du salaire plafonn√©'}
        </div>
        
        {!certRecu&&<div style={{marginTop:12,padding:12,background:'rgba(248,113,113,.06)',borderRadius:8,border:'1px solid rgba(248,113,113,.15)'}}>
          <div style={{fontSize:12,color:'#f87171',fontWeight:600}}>‚ö†Ô∏è Certificat m√©dical manquant</div>
          <div style={{fontSize:11,color:'#5e5c56',marginTop:4}}>Le travailleur doit fournir un certificat dans les 48h (sauf convention collective diff√©rente).</div>
        </div>}
        
        {dateFin&&<div style={{marginTop:12}}>
          <ST>Actions</ST>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8}}>
            <div style={{padding:10,borderRadius:8,background:'rgba(74,222,128,.04)',border:'1px solid rgba(74,222,128,.1)',display:'flex',alignItems:'center',gap:8}}>
              <span>üìÑ</span><span style={{fontSize:12,color:'#4ade80'}}>DRS pr√©-remplie</span>
            </div>
            <div style={{padding:10,borderRadius:8,background:'rgba(96,165,250,.04)',border:'1px solid rgba(96,165,250,.1)',display:'flex',alignItems:'center',gap:8}}>
              <span>üìß</span><span style={{fontSize:12,color:'#60a5fa'}}>Notification mutuelle</span>
            </div>
          </div>
        </div>}
      </C>
    </div>}
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SPRINT 5 ‚Äî IA PR√âDICTIVE & RECOMMANDATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CP_PRESETS_GLOBAL={'100':{fn:'Ouvrier',monthlySalary:2100},'110':{fn:'Ouvrier textile',monthlySalary:2150},'111':{fn:'Ouvrier m√©tallurgie',monthlySalary:2400},'112':{fn:'Ouvrier garage',monthlySalary:2300},'116':{fn:'Ouvrier chimie',monthlySalary:2450},'118':{fn:'Boulanger',monthlySalary:2200},'121':{fn:'Nettoyeur',monthlySalary:2050},'124':{fn:'Ouvrier construction',monthlySalary:2400},'125':{fn:'Ouvrier bois',monthlySalary:2200},'130':{fn:'Imprimeur',monthlySalary:2350},'140':{fn:'Chauffeur',monthlySalary:2350},'144':{fn:'Ouvrier agriculture',monthlySalary:2050},'145':{fn:'Ouvrier horticulture',monthlySalary:2050},'149.01':{fn:'√âlectricien',monthlySalary:2400},'200':{fn:'Employ√©',monthlySalary:2800},'201':{fn:'Employ√© commerce d√©tail',monthlySalary:2300},'202':{fn:'Employ√© commerce alimentaire',monthlySalary:2200},'207':{fn:'Employ√© chimie',monthlySalary:3200},'209':{fn:'Employ√© m√©tal',monthlySalary:3000},'211':{fn:'Cadre',monthlySalary:4500},'214':{fn:'Employ√© textile',monthlySalary:2600},'216':{fn:'Employ√© notaire',monthlySalary:2700},'218':{fn:'Employ√© CNE',monthlySalary:2600},'219':{fn:'Employ√© technologie',monthlySalary:3500},'220':{fn:'Employ√© agro-alimentaire',monthlySalary:2700},'225':{fn:'Employ√© cr√©dit',monthlySalary:3300},'226':{fn:'Employ√© commerce international',monthlySalary:3100},'302':{fn:'Ouvrier Horeca',monthlySalary:2150},'304':{fn:'Artiste',monthlySalary:2500},'306':{fn:'Employ√© assurance',monthlySalary:3200},'310':{fn:'Employ√© banque',monthlySalary:3400},'311':{fn:'Employ√© grande distribution',monthlySalary:2500},'313':{fn:'Employ√© pharmacie',monthlySalary:2700},'314':{fn:'Coiffeur',monthlySalary:2200},'317':{fn:'Employ√© gardiennage',monthlySalary:2500},'318':{fn:'Aide familiale',monthlySalary:2400},'319':{fn:'√âducateur',monthlySalary:2700},'322':{fn:'Int√©rimaire',monthlySalary:2500},'329':{fn:'Travailleur socio-culturel',monthlySalary:2600},'330':{fn:'Professionnel de sant√©',monthlySalary:3000},'332':{fn:'Aide-soignant(e)',monthlySalary:2500},'336':{fn:'Employ√© profession lib√©rale',monthlySalary:2700},'338':{fn:'Ouvrier titres-services',monthlySalary:2050}};
// ‚îÄ‚îÄ CP_PRESETS_FULL: 153 CP belges (module-level pour performance ‚Äî allou√© 1x) ‚îÄ‚îÄ
const CP_PRESETS_FULL={'100':{fn:'Ouvrier',statut:'ouvrier',monthlySalary:2100,whWeek:38},'100.01':{fn:'Ouvrier sous-CP nationale',statut:'ouvrier',monthlySalary:2100,whWeek:38},'101':{fn:'Mineur',statut:'ouvrier',monthlySalary:2200,whWeek:36},'102':{fn:'Carrier',statut:'ouvrier',monthlySalary:2300,whWeek:38},'102.01':{fn:'Carrier (petites)',statut:'ouvrier',monthlySalary:2200,whWeek:38},'102.02':{fn:'Carrier (grandes)',statut:'ouvrier',monthlySalary:2400,whWeek:38},'104':{fn:'Ouvrier sid√©rurgie',statut:'ouvrier',monthlySalary:2500,whWeek:38},'105':{fn:'Ouvrier m√©taux non-ferreux',statut:'ouvrier',monthlySalary:2400,whWeek:38},'106.01':{fn:'Ouvrier cimenteries',statut:'ouvrier',monthlySalary:2450,whWeek:38},'106.02':{fn:'Ouvrier b√©ton',statut:'ouvrier',monthlySalary:2300,whWeek:38},'107':{fn:'Ma√Ætre-tailleur',statut:'ouvrier',monthlySalary:2150,whWeek:38},'108':{fn:'Ouvrier brosserie',statut:'ouvrier',monthlySalary:2050,whWeek:38},'109':{fn:'Ouvrier confection',statut:'ouvrier',monthlySalary:2050,whWeek:38},'110':{fn:'Ouvrier textile',statut:'ouvrier',monthlySalary:2150,whWeek:36},'111':{fn:'Ouvrier m√©tallurgie',statut:'ouvrier',monthlySalary:2400,whWeek:38},'111.01':{fn:'M√©canicien',statut:'ouvrier',monthlySalary:2450,whWeek:38},'111.02':{fn:'M√©canicien r√©paration',statut:'ouvrier',monthlySalary:2400,whWeek:38},'111.03':{fn:'Monteur',statut:'ouvrier',monthlySalary:2500,whWeek:38},'112':{fn:'Ouvrier garage',statut:'ouvrier',monthlySalary:2300,whWeek:38},'113':{fn:'Ouvrier c√©ramique',statut:'ouvrier',monthlySalary:2200,whWeek:38},'114':{fn:'Briquetier',statut:'ouvrier',monthlySalary:2250,whWeek:38},'115':{fn:'Ouvrier verrerie',statut:'ouvrier',monthlySalary:2400,whWeek:38},'116':{fn:'Ouvrier chimie',statut:'ouvrier',monthlySalary:2450,whWeek:38},'117':{fn:'Ouvrier p√©trole',statut:'ouvrier',monthlySalary:2600,whWeek:38},'118':{fn:'Boulanger',statut:'ouvrier',monthlySalary:2200,whWeek:38},'118.01':{fn:'Boulanger industriel',statut:'ouvrier',monthlySalary:2250,whWeek:38},'119':{fn:'Ouvrier commerce alimentaire',statut:'ouvrier',monthlySalary:2100,whWeek:38},'120':{fn:'Ouvrier textile Flandre',statut:'ouvrier',monthlySalary:2150,whWeek:36},'121':{fn:'Nettoyeur',statut:'ouvrier',monthlySalary:2050,whWeek:38},'124':{fn:'Ouvrier construction',statut:'ouvrier',monthlySalary:2400,whWeek:38},'125':{fn:'Ouvrier bois',statut:'ouvrier',monthlySalary:2200,whWeek:38},'125.02':{fn:'Menuisier',statut:'ouvrier',monthlySalary:2250,whWeek:38},'126':{fn:'Ouvrier ameublement',statut:'ouvrier',monthlySalary:2150,whWeek:38},'127':{fn:'Ouvrier combustibles',statut:'ouvrier',monthlySalary:2250,whWeek:38},'128':{fn:'Ouvrier cuir',statut:'ouvrier',monthlySalary:2100,whWeek:38},'129':{fn:'Ouvrier papier',statut:'ouvrier',monthlySalary:2250,whWeek:38},'130':{fn:'Imprimeur',statut:'ouvrier',monthlySalary:2350,whWeek:38},'131':{fn:'Batelier',statut:'ouvrier',monthlySalary:2300,whWeek:38},'132':{fn:'Travaux techniques',statut:'ouvrier',monthlySalary:2400,whWeek:38},'136':{fn:'Ouvrier transfo papier',statut:'ouvrier',monthlySalary:2200,whWeek:38},'140':{fn:'Chauffeur',statut:'ouvrier',monthlySalary:2350,whWeek:38},'140.01':{fn:'Chauffeur autobus',statut:'ouvrier',monthlySalary:2400,whWeek:38},'140.02':{fn:'Taxi',statut:'ouvrier',monthlySalary:2200,whWeek:38},'140.03':{fn:'D√©m√©nageur',statut:'ouvrier',monthlySalary:2300,whWeek:38},'140.04':{fn:'Transport routier',statut:'ouvrier',monthlySalary:2350,whWeek:38},'142':{fn:'R√©cup√©rateur',statut:'ouvrier',monthlySalary:2150,whWeek:38},'143':{fn:'P√™che maritime',statut:'ouvrier',monthlySalary:2400,whWeek:38},'144':{fn:'Ouvrier agriculture',statut:'ouvrier',monthlySalary:2050,whWeek:38},'145':{fn:'Ouvrier horticulture',statut:'ouvrier',monthlySalary:2050,whWeek:38},'146':{fn:'Ouvrier forestier',statut:'ouvrier',monthlySalary:2100,whWeek:38},'149.01':{fn:'√âlectricien',statut:'ouvrier',monthlySalary:2400,whWeek:38},'149.02':{fn:'Carrossier',statut:'ouvrier',monthlySalary:2350,whWeek:38},'150':{fn:'Ouvrier poterie',statut:'ouvrier',monthlySalary:2150,whWeek:38},'152':{fn:'Ouvrier non-marchand',statut:'ouvrier',monthlySalary:2200,whWeek:38},'200':{fn:'Employ√©',statut:'employe',monthlySalary:2800,whWeek:38},'201':{fn:'Employ√© commerce d√©tail',statut:'employe',monthlySalary:2300,whWeek:38},'202':{fn:'Employ√© commerce alimentaire',statut:'employe',monthlySalary:2200,whWeek:38},'207':{fn:'Employ√© chimie',statut:'employe',monthlySalary:3200,whWeek:38},'209':{fn:'Employ√© m√©tal',statut:'employe',monthlySalary:3000,whWeek:38},'210':{fn:'Employ√© sid√©rurgie',statut:'employe',monthlySalary:3100,whWeek:38},'211':{fn:'Cadre',statut:'employe',monthlySalary:4500,whWeek:38},'214':{fn:'Employ√© textile',statut:'employe',monthlySalary:2600,whWeek:36},'215':{fn:'Employ√© confection',statut:'employe',monthlySalary:2500,whWeek:38},'216':{fn:'Employ√© notaire',statut:'employe',monthlySalary:2700,whWeek:38},'218':{fn:'Employ√© CNE',statut:'employe',monthlySalary:2600,whWeek:38},'219':{fn:'Employ√© technologie',statut:'employe',monthlySalary:3500,whWeek:38},'220':{fn:'Employ√© agro-alimentaire',statut:'employe',monthlySalary:2700,whWeek:38},'222':{fn:'Employ√© papier',statut:'employe',monthlySalary:2800,whWeek:38},'224':{fn:'Employ√© m√©taux non-ferreux',statut:'employe',monthlySalary:3000,whWeek:38},'225':{fn:'Employ√© cr√©dit',statut:'employe',monthlySalary:3300,whWeek:37},'226':{fn:'Employ√© commerce international',statut:'employe',monthlySalary:3100,whWeek:38},'227':{fn:'Employ√© audiovisuel',statut:'employe',monthlySalary:2800,whWeek:38},'302':{fn:'Ouvrier Horeca',statut:'ouvrier',monthlySalary:2150,whWeek:38},'303':{fn:'Ouvrier cin√©ma',statut:'ouvrier',monthlySalary:2200,whWeek:38},'304':{fn:'Artiste',statut:'employe',monthlySalary:2500,whWeek:38},'305':{fn:'Employ√© sant√©',statut:'employe',monthlySalary:2800,whWeek:38},'306':{fn:'Employ√© assurance',statut:'employe',monthlySalary:3200,whWeek:37},'307':{fn:'Employ√© courtage',statut:'employe',monthlySalary:2900,whWeek:38},'309':{fn:'Employ√© bourse',statut:'employe',monthlySalary:3400,whWeek:37},'310':{fn:'Employ√© banque',statut:'employe',monthlySalary:3400,whWeek:37},'311':{fn:'Employ√© grande distribution',statut:'employe',monthlySalary:2500,whWeek:38},'312':{fn:'Employ√© grands magasins',statut:'employe',monthlySalary:2400,whWeek:38},'313':{fn:'Employ√© pharmacie',statut:'employe',monthlySalary:2700,whWeek:38},'314':{fn:'Coiffeur',statut:'employe',monthlySalary:2200,whWeek:38},'315':{fn:'Employ√© aviation',statut:'employe',monthlySalary:3500,whWeek:38},'316':{fn:'Employ√© int√©rim',statut:'employe',monthlySalary:2600,whWeek:38},'317':{fn:'Employ√© gardiennage',statut:'employe',monthlySalary:2500,whWeek:38},'318':{fn:'Aide familiale',statut:'employe',monthlySalary:2400,whWeek:38},'319':{fn:'√âducateur',statut:'employe',monthlySalary:2700,whWeek:38},'320':{fn:'Employ√© pompes fun√®bres',statut:'employe',monthlySalary:2400,whWeek:38},'321':{fn:'Employ√© commerce d√©tail alim.',statut:'employe',monthlySalary:2200,whWeek:38},'322':{fn:'Int√©rimaire',statut:'employe',monthlySalary:2500,whWeek:38},'323':{fn:'Concierge',statut:'employe',monthlySalary:2300,whWeek:38},'324':{fn:'Employ√© diamant',statut:'employe',monthlySalary:3000,whWeek:38},'326':{fn:'Employ√© gaz/√©lectricit√©',statut:'employe',monthlySalary:3300,whWeek:38},'327':{fn:'Employ√© travail adapt√©',statut:'employe',monthlySalary:2300,whWeek:38},'328':{fn:'Employ√© transport urbain',statut:'employe',monthlySalary:2800,whWeek:38},'329':{fn:'Travailleur socio-culturel',statut:'employe',monthlySalary:2600,whWeek:38},'330':{fn:'Professionnel de sant√©',statut:'employe',monthlySalary:3000,whWeek:38},'330.01':{fn:'Infirmier(e)',statut:'employe',monthlySalary:3100,whWeek:38},'331':{fn:'Employ√© tourisme',statut:'employe',monthlySalary:2500,whWeek:38},'332':{fn:'Aide-soignant(e)',statut:'employe',monthlySalary:2500,whWeek:38},'333':{fn:'Employ√© attraction touristique',statut:'employe',monthlySalary:2300,whWeek:38},'335':{fn:'Employ√© prestataire services',statut:'employe',monthlySalary:2600,whWeek:38},'336':{fn:'Employ√© profession lib√©rale',statut:'employe',monthlySalary:2700,whWeek:38},'337':{fn:'Employ√© auxiliaire non-marchand',statut:'employe',monthlySalary:2500,whWeek:38},'338':{fn:'Ouvrier titres-services',statut:'ouvrier',monthlySalary:2050,whWeek:38},'339':{fn:'Employ√© logement social',statut:'employe',monthlySalary:2700,whWeek:38},'340':{fn:'Employ√© orthop√©die',statut:'employe',monthlySalary:2800,whWeek:38},'341':{fn:'Ouvrier intermittent spectacle',statut:'ouvrier',monthlySalary:2300,whWeek:38}};

// ‚îÄ‚îÄ PR√âDICTION TURNOVER ‚îÄ‚îÄ
function PredictionTurnoverMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  
  const calcRiskScore=(emp)=>{
    let score=0;const factors=[];
    // Anciennet√© < 1 an = risque √©lev√©
    if(emp.startD){
      const months=Math.round((new Date()-new Date(emp.startD))/(30.44*24*60*60*1000));
      if(months<6){score+=30;factors.push({f:'Anciennet√© < 6 mois',pts:30,risk:'high'});}
      else if(months<12){score+=20;factors.push({f:'Anciennet√© < 1 an',pts:20,risk:'med'});}
      else if(months<24){score+=10;factors.push({f:'Anciennet√© 1-2 ans',pts:10,risk:'low'});}
      else{factors.push({f:`Anciennet√© ${Math.round(months/12)} ans`,pts:0,risk:'ok'});}
    }else{score+=15;factors.push({f:'Date entr√©e manquante',pts:15,risk:'med'});}
    // Salaire vs march√© CP
    const preset=CP_PRESETS_GLOBAL[emp.cp];
    if(preset&&emp.monthlySalary){
      const ratio=emp.monthlySalary/preset.monthlySalary;
      if(ratio<0.85){score+=25;factors.push({f:`Salaire ${Math.round((1-ratio)*100)}% sous march√©`,pts:25,risk:'high'});}
      else if(ratio<0.95){score+=15;factors.push({f:`Salaire ${Math.round((1-ratio)*100)}% sous march√©`,pts:15,risk:'med'});}
      else if(ratio>1.15){score-=5;factors.push({f:`Salaire ${Math.round((ratio-1)*100)}% au-dessus`,pts:-5,risk:'ok'});}
      else{factors.push({f:'Salaire dans la norme',pts:0,risk:'ok'});}
    }
    // CDD = risque naturel
    if(emp.contract==='CDD'){score+=20;factors.push({f:'Contrat CDD',pts:20,risk:'high'});}
    if(emp.contract==='student'){score+=15;factors.push({f:'Contrat √©tudiant',pts:15,risk:'med'});}
    if(emp.contract==='interim'){score+=25;factors.push({f:'Int√©rimaire',pts:25,risk:'high'});}
    // Pas de ch√®ques-repas = insatisfaction possible
    if(!emp.mvT||emp.mvT<=0){score+=5;factors.push({f:'Pas de ch√®ques-repas',pts:5,risk:'low'});}
    // Pas de transport
    if(!emp.commType||emp.commType==='none'){score+=5;factors.push({f:'Pas d\'intervention transport',pts:5,risk:'low'});}
    return{score:Math.min(Math.max(score,0),100),factors,level:score>=60?'critical':score>=40?'high':score>=20?'medium':'low'};
  };
  
  const ranked=ae.map(emp=>({emp,risk:calcRiskScore(emp)})).sort((a,b)=>b.risk.score-a.risk.score);
  const avgRisk=ranked.length?Math.round(ranked.reduce((a,r)=>a+r.risk.score,0)/ranked.length):0;
  
  return <div>
    <PH title="üß† Pr√©diction Turnover IA" sub="Score de risque de d√©part par employ√©"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      <SC label="Risque moyen" value={`${avgRisk}%`} color={avgRisk>=40?'#f87171':avgRisk>=20?'#fb923c':'#4ade80'}/>
      <SC label="Risque critique" value={ranked.filter(r=>r.risk.level==='critical').length} color="#f87171" sub="Score ‚â• 60"/>
      <SC label="Risque √©lev√©" value={ranked.filter(r=>r.risk.level==='high').length} color="#fb923c" sub="Score 40-59"/>
      <SC label="Risque faible" value={ranked.filter(r=>r.risk.level==='low').length} color="#4ade80" sub="Score < 20"/>
    </div>
    <C>
      <div style={{display:'flex',flexDirection:'column',gap:6}}>
        {ranked.map(({emp,risk},i)=><div key={i} style={{display:'flex',alignItems:'center',gap:12,padding:'12px 16px',borderRadius:10,background:risk.level==='critical'?'rgba(248,113,113,.04)':risk.level==='high'?'rgba(251,146,60,.04)':'rgba(198,163,78,.02)',border:'1px solid '+(risk.level==='critical'?'rgba(248,113,113,.12)':risk.level==='high'?'rgba(251,146,60,.12)':'rgba(198,163,78,.06)')}}>
          <div style={{width:50,textAlign:'center'}}>
            <div style={{fontSize:20,fontWeight:700,color:risk.level==='critical'?'#f87171':risk.level==='high'?'#fb923c':risk.level==='medium'?'#c6a34e':'#4ade80'}}>{risk.score}</div>
            <div style={{fontSize:8,color:'#5e5c56',textTransform:'uppercase'}}>score</div>
          </div>
          <div style={{flex:1}}>
            <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>{emp.first} {emp.last}</div>
            <div style={{fontSize:10.5,color:'#5e5c56'}}>{emp.fn||'‚Äî'} ¬∑ CP {emp.cp} ¬∑ {emp.contract||'CDI'}</div>
          </div>
          <div style={{display:'flex',gap:4,flexWrap:'wrap',maxWidth:350}}>
            {risk.factors.filter(f=>f.pts!==0).map((f,j)=><span key={j} style={{fontSize:9,padding:'2px 6px',borderRadius:4,background:f.risk==='high'?'rgba(248,113,113,.1)':f.risk==='med'?'rgba(251,146,60,.1)':f.risk==='ok'?'rgba(74,222,128,.1)':'rgba(198,163,78,.06)',color:f.risk==='high'?'#f87171':f.risk==='med'?'#fb923c':f.risk==='ok'?'#4ade80':'#c6a34e'}}>{f.pts>0?'+':''}{f.pts} {f.f}</span>)}
          </div>
        </div>)}
      </div>
    </C>
  </div>;
}

// ‚îÄ‚îÄ RECOMMANDATIONS SALARIALES ‚îÄ‚îÄ
function RecoSalaireMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  return <div>
    <PH title="üí° Recommandations Salariales IA" sub="Comparaison au march√© par CP"/>
    <C>
      <div style={{display:'flex',flexDirection:'column',gap:6}}>
        {ae.map((emp,i)=>{
          const preset=CP_PRESETS_GLOBAL[emp.cp];
          const market=preset?.monthlySalary||0;
          const actual=parseFloat(emp.monthlySalary)||0;
          const diff=market>0?Math.round((actual/market-1)*100):null;
          const status=diff===null?'unknown':diff<-15?'underpaid':diff<-5?'slightly_under':diff>15?'overpaid':diff>5?'slightly_over':'market';
          const colors={underpaid:'#f87171',slightly_under:'#fb923c',market:'#4ade80',slightly_over:'#60a5fa',overpaid:'#a78bfa',unknown:'#5e5c56'};
          const labels={underpaid:'Sous-pay√©',slightly_under:'L√©g√®rement sous',market:'Dans le march√©',slightly_over:'L√©g√®rement au-dessus',overpaid:'Au-dessus',unknown:'Pas de r√©f√©rence'};
          return <div key={i} style={{display:'flex',alignItems:'center',gap:12,padding:'12px 16px',borderRadius:10,background:'rgba(198,163,78,.02)',border:'1px solid rgba(198,163,78,.06)'}}>
            <div style={{flex:1}}>
              <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>{emp.first} {emp.last}</div>
              <div style={{fontSize:10.5,color:'#5e5c56'}}>{emp.fn||'‚Äî'} ¬∑ CP {emp.cp} ({preset?.fn||'‚Äî'})</div>
            </div>
            <div style={{textAlign:'right',minWidth:100}}>
              <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>{fmt(actual)}</div>
              <div style={{fontSize:10,color:'#5e5c56'}}>actuel</div>
            </div>
            <div style={{textAlign:'right',minWidth:100}}>
              <div style={{fontSize:13,fontWeight:600,color:'#c6a34e'}}>{market>0?fmt(market):'‚Äî'}</div>
              <div style={{fontSize:10,color:'#5e5c56'}}>march√©</div>
            </div>
            <div style={{minWidth:120,textAlign:'center'}}>
              {diff!==null&&<div style={{height:6,background:'rgba(198,163,78,.1)',borderRadius:3,position:'relative',overflow:'hidden',marginBottom:4}}>
                <div style={{position:'absolute',left:'50%',top:0,height:'100%',width:2,background:'rgba(198,163,78,.3)'}}/>
                <div style={{position:'absolute',left:`${Math.min(Math.max(50+diff,5),95)}%`,top:-2,width:10,height:10,borderRadius:'50%',background:colors[status],transform:'translateX(-50%)'}}/>
              </div>}
              <span style={{fontSize:10,fontWeight:600,color:colors[status]}}>{diff!==null?`${diff>0?'+':''}${diff}%`:''} {labels[status]}</span>
            </div>
          </div>;
        })}
      </div>
    </C>
  </div>;
}

// ‚îÄ‚îÄ PR√âVISION MASSE SALARIALE ‚îÄ‚îÄ
function PrevisionMasseMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  const masseBrute=ae.reduce((a,e)=>a+(parseFloat(e.monthlySalary)||0),0);
  const masseAnnuelle=masseBrute*13.92; // 12 mois + p√©cule + 13√®me
  const [indexRate,setIndexRate]=useState(2);
  const projections=Array.from({length:12},(_,i)=>{
    const month=i+1;
    const indexFactor=1+(indexRate/100)*(month/12);
    const projected=masseBrute*indexFactor;
    const cost=projected*1.35; // ~35% charges patronales
    return{month,projected:Math.round(projected),cost:Math.round(cost),indexFactor};
  });
  const totalProjected12=projections.reduce((a,p)=>a+p.projected,0);
  const totalCost12=projections.reduce((a,p)=>a+p.cost,0);
  
  return <div>
    <PH title="üìà Pr√©vision Masse Salariale" sub="Projection 12 mois avec indexation"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      <SC label="Masse brute / mois" value={fmt(masseBrute)} color="#c6a34e"/>
      <SC label="Masse annuelle brute" value={fmt(masseAnnuelle)} color="#60a5fa" sub="12m + p√©cule + 13√®me"/>
      <SC label="Projection 12 mois" value={fmt(totalProjected12)} color="#4ade80" sub={`Avec index ${indexRate}%`}/>
      <SC label="Co√ªt total projet√©" value={fmt(totalCost12)} color="#a78bfa" sub="Charges patronales incluses"/>
    </div>
    <C>
      <div style={{display:'flex',alignItems:'center',gap:12,marginBottom:16}}>
        <I label="Taux d'indexation annuel (%)" type="number" value={indexRate} onChange={v=>setIndexRate(parseFloat(v)||0)}/>
        <div style={{fontSize:11,color:'#5e5c56',marginTop:16}}>Index sant√© pr√©vu: ~2% en 2026 (CP 200)</div>
      </div>
      <div style={{display:'flex',alignItems:'flex-end',gap:6,height:200,padding:'0 10px'}}>
        {projections.map((p,i)=>{
          const maxH=Math.max(...projections.map(x=>x.cost));
          const hCost=Math.round((p.cost/maxH)*170);
          const hBrut=Math.round((p.projected/maxH)*170);
          return <div key={i} style={{flex:1,display:'flex',flexDirection:'column',alignItems:'center',gap:2}}>
            <div style={{fontSize:8,color:'#a78bfa',fontWeight:600}}>{(p.cost/1000).toFixed(1)}k</div>
            <div style={{width:'60%',height:hCost,background:'rgba(167,139,250,.25)',borderRadius:'4px 4px 0 0',position:'relative'}}>
              <div style={{position:'absolute',bottom:0,width:'100%',height:hBrut,background:'linear-gradient(180deg,#c6a34e,#8b7340)',borderRadius:'4px 4px 0 0'}}/>
            </div>
            <div style={{fontSize:9,color:'#5e5c56',marginTop:4}}>M{p.month}</div>
          </div>;
        })}
      </div>
      <div style={{display:'flex',justifyContent:'center',gap:16,marginTop:10}}>
        <div style={{display:'flex',alignItems:'center',gap:4,fontSize:10,color:'#5e5c56'}}><span style={{width:10,height:4,borderRadius:2,background:'#c6a34e',display:'inline-block'}}/>Masse brute</div>
        <div style={{display:'flex',alignItems:'center',gap:4,fontSize:10,color:'#5e5c56'}}><span style={{width:10,height:4,borderRadius:2,background:'rgba(167,139,250,.4)',display:'inline-block'}}/>Co√ªt total</div>
      </div>
    </C>
  </div>;
}

// ‚îÄ‚îÄ D√âTECTION ANOMALIES ‚îÄ‚îÄ
function DetectionAnomaliesMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  const anomalies=[];
  
  ae.forEach(emp=>{
    const brut=parseFloat(emp.monthlySalary)||0;
    const preset=CP_PRESETS_GLOBAL[emp.cp];
    // Salaire √† 0
    if(brut<=0)anomalies.push({emp,type:'error',cat:'Salaire',msg:'Salaire brut √† 0‚Ç¨ ‚Äî impossible de calculer la paie',fix:'Configurer le salaire brut mensuel'});
    // Salaire tr√®s bas (sous RMMMG)
    else if(brut<2029.88&&emp.contract!=='student'&&emp.contract!=='flexi')anomalies.push({emp,type:'error',cat:'Salaire',msg:`Salaire ${fmt(brut)} sous le RMMMG (2.029,88‚Ç¨ en 2026)`,fix:'V√©rifier si le r√©gime est temps partiel ou augmenter au minimum l√©gal'});
    // Salaire aberrant > 15000‚Ç¨
    else if(brut>15000)anomalies.push({emp,type:'warning',cat:'Salaire',msg:`Salaire ${fmt(brut)} tr√®s √©lev√© ‚Äî v√©rifier la saisie`,fix:'Confirmer le montant ou corriger'});
    // NISS manquant
    if(!emp.niss)anomalies.push({emp,type:'warning',cat:'Identit√©',msg:'NISS manquant ‚Äî Dimona impossible',fix:'Ajouter le num√©ro de registre national'});
    // NISS format invalide
    if(emp.niss&&emp.niss.replace(/[\s.\-]/g,'').length!==11)anomalies.push({emp,type:'error',cat:'Identit√©',msg:`NISS "${emp.niss}" ‚Äî format invalide (doit √™tre 11 chiffres)`,fix:'Corriger le format du NISS'});
    // IBAN manquant
    if(!emp.iban)anomalies.push({emp,type:'info',cat:'Financier',msg:'IBAN manquant ‚Äî virement impossible',fix:'Ajouter le num√©ro IBAN'});
    // Date d'entr√©e manquante
    if(!emp.startD)anomalies.push({emp,type:'warning',cat:'Contrat',msg:'Date d\'entr√©e manquante ‚Äî anciennet√© non calculable',fix:'Ajouter la date d\'entr√©e en service'});
    // Date de fin pass√©e mais statut actif
    if(emp.endD&&new Date(emp.endD)<new Date()&&emp.status!=='sorti')anomalies.push({emp,type:'error',cat:'Contrat',msg:`Date fin ${emp.endD} d√©pass√©e mais statut encore actif`,fix:'Mettre le statut en "Sorti" ou prolonger le contrat'});
    // Heures > 38h sans contrat sp√©cial
    if(emp.whWeek>40)anomalies.push({emp,type:'warning',cat:'Horaire',msg:`${emp.whWeek}h/semaine ‚Äî d√©passe le maximum l√©gal (38h + max 11h sup)`,fix:'V√©rifier le contrat et les heures suppl√©mentaires'});
    // √âcart salaire/march√© > 40%
    if(preset&&brut>0){
      const ratio=brut/preset.monthlySalary;
      if(ratio<0.6)anomalies.push({emp,type:'warning',cat:'March√©',msg:`Salaire ${Math.round((1-ratio)*100)}% en dessous du march√© CP ${emp.cp}`,fix:`Envisager augmentation vers ${fmt(preset.monthlySalary)}`});
    }
  });
  
  // Doublons NISS
  const nissList=ae.filter(e=>e.niss).map(e=>({emp:e,niss:e.niss.replace(/[\s.\-]/g,'')}));
  const seen={};
  nissList.forEach(({emp,niss})=>{
    if(seen[niss])anomalies.push({emp,type:'error',cat:'Doublon',msg:`NISS en double avec ${seen[niss].first} ${seen[niss].last}`,fix:'Supprimer le doublon ou corriger le NISS'});
    else seen[niss]=emp;
  });
  
  const sorted=anomalies.sort((a,b)=>a.type==='error'?-1:b.type==='error'?1:a.type==='warning'?-1:1);
  
  return <div>
    <PH title="üîç D√©tection d'Anomalies" sub={`${anomalies.length} anomalie(s) d√©tect√©e(s)`}/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      <SC label="Total anomalies" value={anomalies.length} color={anomalies.length>5?'#f87171':'#fb923c'}/>
      <SC label="Critiques" value={sorted.filter(a=>a.type==='error').length} color="#f87171"/>
      <SC label="Avertissements" value={sorted.filter(a=>a.type==='warning').length} color="#fb923c"/>
      <SC label="Infos" value={sorted.filter(a=>a.type==='info').length} color="#60a5fa"/>
    </div>
    {sorted.length===0?<C><div style={{textAlign:'center',padding:40,color:'#4ade80',fontSize:16}}>‚úÖ Aucune anomalie d√©tect√©e ‚Äî Tous les dossiers sont conformes !</div></C>:
    <C>
      <div style={{display:'flex',flexDirection:'column',gap:6}}>
        {sorted.map((a,i)=><div key={i} style={{display:'flex',alignItems:'center',gap:12,padding:'10px 14px',borderRadius:8,background:a.type==='error'?'rgba(248,113,113,.04)':a.type==='warning'?'rgba(251,146,60,.04)':'rgba(96,165,250,.04)',border:'1px solid '+(a.type==='error'?'rgba(248,113,113,.1)':a.type==='warning'?'rgba(251,146,60,.1)':'rgba(96,165,250,.1)')}}>
          <span style={{fontSize:16}}>{a.type==='error'?'üî¥':a.type==='warning'?'üü°':'üîµ'}</span>
          <div style={{flex:1}}>
            <div style={{fontSize:12,color:a.type==='error'?'#f87171':a.type==='warning'?'#fb923c':'#60a5fa',fontWeight:600}}>{a.emp.first} {a.emp.last} ‚Äî {a.cat}</div>
            <div style={{fontSize:11,color:'#9e9b93',marginTop:2}}>{a.msg}</div>
          </div>
          <div style={{fontSize:10,color:'#4ade80',maxWidth:200,textAlign:'right'}}>üí° {a.fix}</div>
        </div>)}
      </div>
    </C>}
  </div>;
}

// ‚îÄ‚îÄ SCORE SANT√â DOSSIER ‚îÄ‚îÄ
function ScoreSanteMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  
  const checks=[
    {id:'societe_nom',l:'Nom soci√©t√©',ok:!!s.co.name,cat:'Soci√©t√©'},
    {id:'societe_vat',l:'TVA / BCE',ok:!!s.co.vat,cat:'Soci√©t√©'},
    {id:'societe_onss',l:'Matricule ONSS',ok:!!s.co.onss,cat:'Soci√©t√©'},
    {id:'societe_iban',l:'IBAN soci√©t√©',ok:!!s.co.bank,cat:'Soci√©t√©'},
    {id:'societe_cp',l:'Commission paritaire',ok:!!s.co.cp,cat:'Soci√©t√©'},
    {id:'societe_assurance',l:'Assurance-loi AT',ok:!!s.co.insurer,cat:'Soci√©t√©'},
    {id:'emps_exist',l:'Au moins 1 travailleur',ok:ae.length>0,cat:'Travailleurs'},
    {id:'emps_niss',l:'Tous les NISS renseign√©s',ok:ae.length>0&&ae.every(e=>e.niss),cat:'Travailleurs'},
    {id:'emps_iban',l:'Tous les IBAN renseign√©s',ok:ae.length>0&&ae.every(e=>e.iban),cat:'Travailleurs'},
    {id:'emps_salaire',l:'Tous les salaires configur√©s',ok:ae.length>0&&ae.every(e=>e.monthlySalary>0),cat:'Travailleurs'},
    {id:'emps_contrat',l:'Dates d\'entr√©e renseign√©es',ok:ae.length>0&&ae.every(e=>e.startD),cat:'Travailleurs'},
    {id:'dimona',l:'Au moins 1 Dimona',ok:s.dims?.length>0,cat:'D√©clarations'},
    {id:'fiche',l:'Au moins 1 fiche de paie',ok:s.pays?.length>0,cat:'D√©clarations'},
  ];
  
  const done=checks.filter(c=>c.ok).length;
  const total=checks.length;
  const pct=Math.round(done/total*100);
  const color=pct>=80?'#4ade80':pct>=50?'#fb923c':'#f87171';
  
  return <div>
    <PH title="üè• Score Sant√© Dossier" sub="Compl√©tion et conformit√© du dossier client"/>
    <div style={{display:'grid',gridTemplateColumns:'200px 1fr',gap:18}}>
      <C style={{textAlign:'center',padding:30}}>
        <div style={{position:'relative',width:120,height:120,margin:'0 auto 16px'}}>
          <svg width="120" height="120" viewBox="0 0 120 120">
            <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(198,163,78,.1)" strokeWidth="10"/>
            <circle cx="60" cy="60" r="50" fill="none" stroke={color} strokeWidth="10" strokeDasharray={`${pct*3.14} ${314-pct*3.14}`} strokeLinecap="round" transform="rotate(-90 60 60)"/>
          </svg>
          <div style={{position:'absolute',top:'50%',left:'50%',transform:'translate(-50%,-50%)',textAlign:'center'}}>
            <div style={{fontSize:28,fontWeight:700,color}}>{pct}%</div>
            <div style={{fontSize:9,color:'#5e5c56'}}>{done}/{total}</div>
          </div>
        </div>
        <div style={{fontSize:13,fontWeight:600,color}}>{pct>=80?'Excellent':pct>=50?'√Ä compl√©ter':'Critique'}</div>
      </C>
      <C>
        {['Soci√©t√©','Travailleurs','D√©clarations'].map(cat=><div key={cat} style={{marginBottom:14}}>
          <div style={{fontSize:11,fontWeight:600,color:'#9e9b93',textTransform:'uppercase',letterSpacing:'.5px',marginBottom:6}}>{cat}</div>
          {checks.filter(c=>c.cat===cat).map(c=><div key={c.id} style={{display:'flex',alignItems:'center',gap:8,padding:'5px 0'}}>
            <span style={{fontSize:14}}>{c.ok?'‚úÖ':'‚ùå'}</span>
            <span style={{fontSize:12,color:c.ok?'#4ade80':'#f87171'}}>{c.l}</span>
          </div>)}
        </div>)}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SPRINT 6 ‚Äî SCALE: API + MULTI-CURRENCY + MULTI-TENANT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ API DOCUMENTATION ‚îÄ‚îÄ
function APIDocMod({s,d}){
  const [activeEndpoint,setActiveEndpoint]=useState('auth');
  const endpoints=[
    {id:'auth',cat:'üîë Authentication',endpoints:[
      {method:'POST',path:'/api/v1/auth/login',desc:'Connexion utilisateur',body:'{"email":"...","password":"..."}',response:'{"token":"jwt_token","user":{...}}'},
      {method:'POST',path:'/api/v1/auth/register',desc:'Inscription nouveau client',body:'{"email":"...","password":"...","nom":"...","societe":"..."}',response:'{"user_id":"...","message":"OK"}'},
      {method:'POST',path:'/api/v1/auth/refresh',desc:'Rafra√Æchir le token',body:'{"refresh_token":"..."}',response:'{"token":"new_jwt"}'},
    ]},
    {id:'employees',cat:'üë§ Employ√©s',endpoints:[
      {method:'GET',path:'/api/v1/employees',desc:'Liste des employ√©s',body:null,response:'[{"id":"...","first":"...","last":"...","niss":"..."}]'},
      {method:'POST',path:'/api/v1/employees',desc:'Cr√©er un employ√©',body:'{"first":"Jean","last":"Dupont","niss":"85.07.15-123.45","cp":"200","monthlySalary":3000}',response:'{"id":"E-xxx","created":true}'},
      {method:'PUT',path:'/api/v1/employees/:id',desc:'Modifier un employ√©',body:'{"monthlySalary":3200}',response:'{"updated":true}'},
      {method:'DELETE',path:'/api/v1/employees/:id',desc:'Supprimer un employ√©',body:null,response:'{"deleted":true}'},
    ]},
    {id:'payroll',cat:'üí∞ Paie',endpoints:[
      {method:'POST',path:'/api/v1/payroll/calculate',desc:'Calculer une fiche de paie',body:'{"employee_id":"...","month":2,"year":2026}',response:'{"gross":3000,"onss":392.1,"tax":580,"net":1950,...}'},
      {method:'POST',path:'/api/v1/payroll/batch',desc:'Batch ‚Äî Toutes les fiches',body:'{"month":2,"year":2026}',response:'{"count":15,"total_gross":45000,"total_net":29250}'},
      {method:'GET',path:'/api/v1/payroll/history',desc:'Historique des fiches',body:null,response:'[{"period":"Jan 2026","count":15,"total":45000}]'},
    ]},
    {id:'declarations',cat:'üì° D√©clarations',endpoints:[
      {method:'POST',path:'/api/v1/dimona/in',desc:'Dimona IN (embauche)',body:'{"employee_id":"...","start_date":"2026-03-01"}',response:'{"dimona_id":"D-xxx","status":"accepted"}'},
      {method:'POST',path:'/api/v1/dimona/out',desc:'Dimona OUT (sortie)',body:'{"employee_id":"...","end_date":"2026-03-31"}',response:'{"dimona_id":"D-xxx","status":"accepted"}'},
      {method:'POST',path:'/api/v1/dmfa/generate',desc:'G√©n√©rer DmfA trimestrielle',body:'{"quarter":1,"year":2026}',response:'{"xml":"...","ticket":"ONSS-xxx","anomalies":[]}'},
    ]},
    {id:'export',cat:'üìÇ Export',endpoints:[
      {method:'GET',path:'/api/v1/export/:format',desc:'Export comptable (bob,winbooks,clearfact,exact...)',body:null,response:'CSV/XML file download'},
      {method:'GET',path:'/api/v1/export/sepa',desc:'Fichier SEPA virements',body:null,response:'XML SEPA pain.001'},
    ]},
    {id:'webhooks',cat:'üîî Webhooks',endpoints:[
      {method:'POST',path:'/api/v1/webhooks/register',desc:'Enregistrer un webhook',body:'{"url":"https://...","events":["payroll.calculated","employee.created"]}',response:'{"webhook_id":"W-xxx"}'},
      {method:'GET',path:'/api/v1/webhooks',desc:'Liste des webhooks actifs',body:null,response:'[{"id":"W-xxx","url":"...","events":[...]}]'},
    ]},
  ];
  const methodColors={GET:'#4ade80',POST:'#60a5fa',PUT:'#fb923c',DELETE:'#f87171'};
  const active=endpoints.find(e=>e.id===activeEndpoint)||endpoints[0];
  
  return <div>
    <PH title="üîå API Documentation" sub="REST API v1 ‚Äî Int√©grations & Automatisation"/>
    <div style={{display:'grid',gridTemplateColumns:'220px 1fr',gap:18}}>
      <C>
        <ST>Endpoints</ST>
        {endpoints.map(ep=><button key={ep.id} onClick={()=>setActiveEndpoint(ep.id)} style={{display:'block',width:'100%',padding:'8px 12px',marginBottom:3,borderRadius:6,border:activeEndpoint===ep.id?'1px solid rgba(198,163,78,.3)':'1px solid rgba(198,163,78,.05)',background:activeEndpoint===ep.id?'rgba(198,163,78,.1)':'transparent',color:activeEndpoint===ep.id?'#c6a34e':'#9e9b93',cursor:'pointer',fontSize:11,textAlign:'left',fontFamily:'inherit'}}>{ep.cat}</button>)}
        <div style={{marginTop:14,padding:10,background:'rgba(198,163,78,.04)',borderRadius:8,fontSize:10,color:'#5e5c56',lineHeight:1.6}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>Base URL</div>
          <code style={{color:'#e8e6e0',fontSize:9.5}}>https://api.aureussocial.be/v1</code>
          <div style={{fontWeight:600,color:'#c6a34e',marginTop:8,marginBottom:4}}>Auth Header</div>
          <code style={{color:'#e8e6e0',fontSize:9.5}}>Authorization: Bearer {'<token>'}</code>
          <div style={{fontWeight:600,color:'#c6a34e',marginTop:8,marginBottom:4}}>Rate Limit</div>
          <div>1000 req/min (standard)<br/>5000 req/min (enterprise)</div>
        </div>
      </C>
      <C>
        <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:12}}>{active.cat}</div>
        <div style={{display:'flex',flexDirection:'column',gap:10}}>
          {active.endpoints.map((ep,i)=><div key={i} style={{padding:14,borderRadius:10,background:'rgba(198,163,78,.02)',border:'1px solid rgba(198,163,78,.08)'}}>
            <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:8}}>
              <span style={{fontSize:10,fontWeight:700,padding:'3px 8px',borderRadius:4,background:`${methodColors[ep.method]}22`,color:methodColors[ep.method]}}>{ep.method}</span>
              <code style={{fontSize:12,color:'#e8e6e0',fontWeight:500}}>{ep.path}</code>
            </div>
            <div style={{fontSize:11,color:'#9e9b93',marginBottom:8}}>{ep.desc}</div>
            {ep.body&&<div style={{marginBottom:6}}>
              <div style={{fontSize:9,color:'#5e5c56',textTransform:'uppercase',marginBottom:3}}>Request Body</div>
              <pre style={{background:'#060810',border:'1px solid rgba(139,115,60,.1)',borderRadius:6,padding:8,fontSize:9.5,color:'#4ade80',overflowX:'auto',margin:0}}>{ep.body}</pre>
            </div>}
            <div>
              <div style={{fontSize:9,color:'#5e5c56',textTransform:'uppercase',marginBottom:3}}>Response</div>
              <pre style={{background:'#060810',border:'1px solid rgba(139,115,60,.1)',borderRadius:6,padding:8,fontSize:9.5,color:'#60a5fa',overflowX:'auto',margin:0}}>{ep.response}</pre>
            </div>
          </div>)}
        </div>
      </C>
    </div>
  </div>;
}

// ‚îÄ‚îÄ MULTI-CURRENCY CONVERTER ‚îÄ‚îÄ
function MultiCurrencyMod({s,d}){
  const [amount,setAmount]=useState(1000);
  const [from,setFrom]=useState('EUR');
  const rates={EUR:1,GBP:0.856,USD:1.085,CHF:0.942,SEK:11.28,DKK:7.46,NOK:11.42,PLN:4.31,CZK:25.12,HUF:393.5,RON:4.98,BGN:1.96,HRK:7.53,TRY:34.2,MAD:10.82,XOF:655.96};
  const currencies=Object.keys(rates);
  
  return <div>
    <PH title="üí± Multi-Devises" sub="Conversion et co√ªts salariaux internationaux"/>
    <C>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12,marginBottom:16}}>
        <I label="Montant" type="number" value={amount} onChange={v=>setAmount(parseFloat(v)||0)}/>
        <I label="Devise source" value={from} onChange={setFrom} options={currencies.map(c=>({v:c,l:c}))}/>
      </div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:8}}>
        {currencies.filter(c=>c!==from).map(cur=>{
          const converted=amount/rates[from]*rates[cur];
          return <div key={cur} style={{padding:12,borderRadius:8,background:'rgba(198,163,78,.03)',border:'1px solid rgba(198,163,78,.08)',textAlign:'center'}}>
            <div style={{fontSize:10,color:'#5e5c56'}}>{cur}</div>
            <div style={{fontSize:16,fontWeight:700,color:'#c6a34e'}}>{converted.toFixed(2)}</div>
            <div style={{fontSize:9,color:'#5e5c56'}}>1 {from} = {(rates[cur]/rates[from]).toFixed(4)} {cur}</div>
          </div>;
        })}
      </div>
    </C>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SPRINT 7 ‚Äî √âCOSYST√àME: INT√âGRATIONS + MARKETPLACE + WEBHOOKS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ MARKETPLACE MODULES ‚îÄ‚îÄ
function MarketplaceMod({s,d}){
  const [cat,setCat]=useState('all');
  const modules=[
    {id:'mod_fleet',name:'Fleet Management',desc:'Gestion de flotte v√©hicules de soci√©t√©. Budget mobilit√©, cartes carburant, TCO, avantage de toute nature auto.',icon:'üöó',price:49,cat:'mobilite',status:'available',rating:4.8,installs:342},
    {id:'mod_expense',name:'Expense Management',desc:'Notes de frais automatis√©es avec OCR. Scan ticket ‚Üí remboursement. Politique de d√©penses configurable.',icon:'üßæ',price:29,cat:'finance',status:'available',rating:4.6,installs:567},
    {id:'mod_recruitment',name:'Recruitment ATS',desc:'Applicant Tracking System int√©gr√©. Publication offres, CV parsing, pipeline candidats, scoring IA.',icon:'üéØ',price:79,cat:'rh',status:'available',rating:4.5,installs:189},
    {id:'mod_elearning',name:'E-Learning LMS',desc:'Plateforme de formation en ligne. Parcours obligatoires (s√©curit√©, RGPD), certifications, suivi compliance.',icon:'üìö',price:39,cat:'formation',status:'available',rating:4.7,installs:298},
    {id:'mod_survey',name:'Employee Survey',desc:'Enqu√™tes de satisfaction, barom√®tre social, eNPS, pulse surveys hebdomadaires.',icon:'üìä',price:19,cat:'rh',status:'available',rating:4.4,installs:423},
    {id:'mod_planning',name:'Planning & Shifts',desc:'Planification des horaires et shifts. Rotation automatique, √©changes entre coll√®gues, respect temps de repos.',icon:'üìÖ',price:39,cat:'temps',status:'available',rating:4.6,installs:512},
    {id:'mod_onboarding',name:'Digital Onboarding',desc:'Parcours d\'int√©gration digital. Checklist, signature √©lectronique, welcome pack, mentor assign√©.',icon:'üéì',price:29,cat:'rh',status:'coming',rating:0,installs:0},
    {id:'mod_offboarding',name:'Offboarding Suite',desc:'Processus de sortie complet. R√©cup√©ration mat√©riel, transfert connaissances, exit interview, alumni network.',icon:'üëã',price:19,cat:'rh',status:'coming',rating:0,installs:0},
    {id:'mod_analytics',name:'People Analytics Pro',desc:'Dashboards RH avanc√©s. Turnover pr√©dictif ML, cohortes, benchmarks sectoriels, equal pay analysis.',icon:'üìà',price:99,cat:'analytics',status:'available',rating:4.9,installs:156},
    {id:'mod_sign',name:'E-Signature',desc:'Signature √©lectronique eIDAS. Contrats, avenants, r√®glement de travail. Int√©gration itsme¬Æ et eID belge.',icon:'‚úçÔ∏è',price:29,cat:'documents',status:'available',rating:4.7,installs:678},
    {id:'mod_whistleblower',name:'Whistleblower Channel',desc:'Canal de signalement anonyme conforme Directive UE 2019/1937. Obligatoire +50 travailleurs.',icon:'üîî',price:19,cat:'compliance',status:'available',rating:4.3,installs:89},
    {id:'mod_ai_assistant',name:'AI Payroll Assistant',desc:'Assistant IA conversationnel sp√©cialis√© droit social belge. R√©pond aux questions CP, pr√©avis, indexation.',icon:'ü§ñ',price:59,cat:'ia',status:'available',rating:4.8,installs:834},
  ];
  const cats=[{v:'all',l:'Tous'},{v:'rh',l:'RH'},{v:'finance',l:'Finance'},{v:'temps',l:'Temps'},{v:'formation',l:'Formation'},{v:'mobilite',l:'Mobilit√©'},{v:'documents',l:'Documents'},{v:'compliance',l:'Compliance'},{v:'analytics',l:'Analytics'},{v:'ia',l:'IA'}];
  const filtered=cat==='all'?modules:modules.filter(m=>m.cat===cat);
  
  return <div>
    <PH title="üè™ Marketplace" sub={`${modules.length} modules disponibles ‚Äî √âtendez votre plateforme`}/>
    <div style={{display:'flex',gap:6,marginBottom:16,flexWrap:'wrap'}}>
      {cats.map(c=><button key={c.v} onClick={()=>setCat(c.v)} style={{padding:'6px 14px',borderRadius:20,border:cat===c.v?'1px solid rgba(198,163,78,.3)':'1px solid rgba(198,163,78,.08)',background:cat===c.v?'rgba(198,163,78,.12)':'transparent',color:cat===c.v?'#c6a34e':'#9e9b93',cursor:'pointer',fontSize:11,fontFamily:'inherit'}}>{c.l}</button>)}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(300px,1fr))',gap:12}}>
      {filtered.map(m=><C key={m.id} style={{position:'relative',overflow:'hidden'}}>
        {m.status==='coming'&&<div style={{position:'absolute',top:10,right:-30,transform:'rotate(45deg)',background:'#fb923c',color:'#fff',fontSize:9,padding:'2px 35px',fontWeight:700}}>BIENT√îT</div>}
        <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:10}}>
          <span style={{fontSize:28}}>{m.icon}</span>
          <div>
            <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0'}}>{m.name}</div>
            <div style={{display:'flex',gap:6,alignItems:'center'}}>
              {m.rating>0&&<span style={{fontSize:10,color:'#c6a34e'}}>‚òÖ {m.rating}</span>}
              {m.installs>0&&<span style={{fontSize:10,color:'#5e5c56'}}>{m.installs} installations</span>}
            </div>
          </div>
        </div>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.5,marginBottom:12,minHeight:45}}>{m.desc}</div>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
          <div style={{fontSize:16,fontWeight:700,color:'#c6a34e'}}>{m.price}‚Ç¨<span style={{fontSize:10,fontWeight:400,color:'#5e5c56'}}>/mois</span></div>
          <B v={m.status==='coming'?'outline':'gold'} style={{fontSize:11,padding:'6px 16px'}} onClick={()=>{if(m.status==='available')alert(`‚úÖ Module "${m.name}" activ√© ! (${m.price}‚Ç¨/mois)`)}}>
            {m.status==='coming'?'Notifier':'Activer'}
          </B>
        </div>
      </C>)}
    </div>
  </div>;
}

// ‚îÄ‚îÄ INT√âGRATIONS CONNECTEURS ‚îÄ‚îÄ
function IntegrationsMod({s,d}){
  const integrations=[
    {cat:'Comptabilit√©',items:[
      {name:'BOB Software',logo:'üü¶',status:'connected',desc:'Export OD automatique mensuel'},
      {name:'Winbooks',logo:'üü©',status:'connected',desc:'Sync journaux comptables'},
      {name:'Exact Online',logo:'üüß',status:'available',desc:'API bi-directionnelle'},
      {name:'ClearFact',logo:'üü®',status:'connected',desc:'Upload factures + pi√®ces'},
      {name:'Octopus',logo:'üü™',status:'available',desc:'Export √©critures'},
      {name:'Yuki',logo:'‚¨ú',status:'available',desc:'XML automatique'},
      {name:'Horus',logo:'üîµ',status:'available',desc:'Interface comptable'},
    ]},
    {cat:'ONSS & Gouvernement',items:[
      {name:'Portail S√©curit√© Sociale',logo:'üèõÔ∏è',status:'connected',desc:'Dimona, DmfA, DRS'},
      {name:'MyMinfin',logo:'üè¶',status:'connected',desc:'Pr√©compte 274, Belcotax 281'},
      {name:'itsme¬Æ',logo:'üì±',status:'available',desc:'Signature √©lectronique + auth'},
      {name:'CSAM',logo:'üîê',status:'available',desc:'Authentication f√©d√©rale'},
    ]},
    {cat:'Banque & Paiement',items:[
      {name:'Isabel 6',logo:'üè¶',status:'available',desc:'Virements SEPA batch'},
      {name:'Codabox',logo:'üì¶',status:'available',desc:'CODA + SODA automatique'},
      {name:'Ponto (Isabel)',logo:'üí≥',status:'available',desc:'Relev√©s bancaires PSD2'},
    ]},
    {cat:'RH & Bien-√™tre',items:[
      {name:'Pluxee (Sodexo)',logo:'üü†',status:'connected',desc:'Commande ch√®ques-repas'},
      {name:'Edenred',logo:'üî¥',status:'available',desc:'Ch√®ques-repas & √©co-ch√®ques'},
      {name:'Monizze',logo:'üü¢',status:'available',desc:'Ch√®ques-repas digitaux'},
      {name:'Attentia',logo:'ü©∫',status:'available',desc:'M√©decine du travail'},
      {name:'Mensura',logo:'üè•',status:'available',desc:'Pr√©vention & bien-√™tre'},
    ]},
    {cat:'Communication',items:[
      {name:'Microsoft Teams',logo:'üü£',status:'available',desc:'Notifications paie & RH'},
      {name:'Slack',logo:'üí¨',status:'available',desc:'Alertes & workflow'},
      {name:'SMTP Email',logo:'üìß',status:'connected',desc:'Fiches de paie par email'},
    ]},
  ];
  const statusColors={connected:'#4ade80',available:'#5e5c56',error:'#f87171'};
  const statusLabels={connected:'Connect√©',available:'Disponible',error:'Erreur'};
  
  return <div>
    <PH title="üîó Int√©grations" sub="Connecteurs et API partenaires"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      <SC label="Total connecteurs" value={integrations.reduce((a,c)=>a+c.items.length,0)} color="#c6a34e"/>
      <SC label="Connect√©s" value={integrations.reduce((a,c)=>a+c.items.filter(i=>i.status==='connected').length,0)} color="#4ade80"/>
      <SC label="Disponibles" value={integrations.reduce((a,c)=>a+c.items.filter(i=>i.status==='available').length,0)} color="#60a5fa"/>
      <SC label="Cat√©gories" value={integrations.length} color="#a78bfa"/>
    </div>
    {integrations.map((cat,ci)=><C key={ci} style={{marginBottom:12}}>
      <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginBottom:10}}>{cat.cat}</div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(220px,1fr))',gap:8}}>
        {cat.items.map((it,i)=><div key={i} style={{display:'flex',alignItems:'center',gap:10,padding:'10px 12px',borderRadius:8,background:'rgba(198,163,78,.02)',border:'1px solid rgba(198,163,78,.06)'}}>
          <span style={{fontSize:20}}>{it.logo}</span>
          <div style={{flex:1}}>
            <div style={{fontSize:12,fontWeight:600,color:'#e8e6e0'}}>{it.name}</div>
            <div style={{fontSize:9.5,color:'#5e5c56'}}>{it.desc}</div>
          </div>
          <span style={{width:8,height:8,borderRadius:'50%',background:statusColors[it.status]}} title={statusLabels[it.status]}/>
        </div>)}
      </div>
    </C>)}
  </div>;
}

// ‚îÄ‚îÄ WEBHOOK MANAGER ‚îÄ‚îÄ
function WebhookManagerMod({s,d}){
  const [hooks,setHooks]=useState([
    {id:'WH-001',url:'https://accounting.example.com/webhook',events:['payroll.calculated','payroll.batch'],status:'active',lastCall:'2026-02-14T10:30:00',success:142,fail:2},
    {id:'WH-002',url:'https://erp.example.com/aureus',events:['employee.created','employee.updated'],status:'active',lastCall:'2026-02-13T16:45:00',success:67,fail:0},
  ]);
  const allEvents=['payroll.calculated','payroll.batch','employee.created','employee.updated','employee.deleted','dimona.sent','dmfa.generated','contract.signed','absence.declared','alert.triggered'];
  
  return <div>
    <PH title="üîî Webhook Manager" sub="√âv√©nements temps r√©el vers vos syst√®mes"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:12,marginBottom:18}}>
      <SC label="Webhooks actifs" value={hooks.filter(h=>h.status==='active').length} color="#4ade80"/>
      <SC label="Appels r√©ussis" value={hooks.reduce((a,h)=>a+h.success,0)} color="#60a5fa"/>
      <SC label="Erreurs" value={hooks.reduce((a,h)=>a+h.fail,0)} color={hooks.reduce((a,h)=>a+h.fail,0)>0?'#f87171':'#4ade80'}/>
    </div>
    <C>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}}>
        <ST>Webhooks configur√©s</ST>
        <B v="outline" style={{fontSize:10}} onClick={()=>{
          const newHook={id:'WH-'+Date.now().toString(36).toUpperCase(),url:'https://',events:[],status:'draft',lastCall:null,success:0,fail:0};
          setHooks([...hooks,newHook]);
        }}>+ Ajouter webhook</B>
      </div>
      {hooks.map((h,i)=><div key={h.id} style={{padding:14,borderRadius:10,background:'rgba(198,163,78,.02)',border:'1px solid rgba(198,163,78,.08)',marginBottom:8}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}}>
          <div style={{display:'flex',alignItems:'center',gap:8}}>
            <span style={{width:8,height:8,borderRadius:'50%',background:h.status==='active'?'#4ade80':'#fb923c'}}/>
            <code style={{fontSize:12,color:'#e8e6e0'}}>{h.url}</code>
          </div>
          <span style={{fontSize:10,color:'#5e5c56'}}>{h.id}</span>
        </div>
        <div style={{display:'flex',gap:4,flexWrap:'wrap',marginBottom:8}}>
          {h.events.map(ev=><span key={ev} style={{fontSize:9,padding:'2px 8px',borderRadius:10,background:'rgba(96,165,250,.1)',color:'#60a5fa'}}>{ev}</span>)}
        </div>
        <div style={{display:'flex',gap:16,fontSize:10,color:'#5e5c56'}}>
          <span>‚úÖ {h.success} succ√®s</span>
          <span>‚ùå {h.fail} erreurs</span>
          {h.lastCall&&<span>Dernier appel: {new Date(h.lastCall).toLocaleString('fr-BE')}</span>}
        </div>
      </div>)}
    </C>
    <C style={{marginTop:12}}>
      <ST>√âv√©nements disponibles</ST>
      <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:6}}>
        {allEvents.map(ev=><div key={ev} style={{padding:'8px 10px',borderRadius:6,background:'rgba(198,163,78,.03)',border:'1px solid rgba(198,163,78,.06)',fontSize:10,color:'#9e9b93',textAlign:'center'}}>{ev}</div>)}
      </div>
    </C>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SPRINT 8 ‚Äî PR√âDICTIF: BUDGET AUTO + SIMULATEUR + KPI AVANC√âS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ BUDGET AUTOMATIQUE ‚îÄ‚îÄ
function BudgetAutoMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  const [year,setYear]=useState(new Date().getFullYear());
  const [indexRate,setIndexRate]=useState(2);
  const [hiring,setHiring]=useState(0);
  const [avgNewSalary,setAvgNewSalary]=useState(3000);
  
  const masseBrute=ae.reduce((a,e)=>a+(parseFloat(e.monthlySalary)||0),0);
  const months=Array.from({length:12},(_,i)=>{
    const m=i+1;
    const indexFactor=1+(indexRate/100)*(m/12);
    const hireEffect=m>=6?(hiring*avgNewSalary*(m-5)/12):0;
    const brut=(masseBrute*indexFactor)+hireEffect;
    const onssE=brut*0.25;
    const onssW=brut*0.1307;
    const pp=brut*0.22;
    const net=brut-onssW-pp;
    const cost=brut+onssE;
    const cheques=ae.length*22*6.91;
    return{m,brut:Math.round(brut),onssE:Math.round(onssE),onssW:Math.round(onssW),pp:Math.round(pp),net:Math.round(net),cost:Math.round(cost),cheques:Math.round(cheques),total:Math.round(cost+cheques)};
  });
  const totals=months.reduce((a,m)=>({brut:a.brut+m.brut,onssE:a.onssE+m.onssE,onssW:a.onssW+m.onssW,pp:a.pp+m.pp,net:a.net+m.net,cost:a.cost+m.cost,cheques:a.cheques+m.cheques,total:a.total+m.total}),{brut:0,onssE:0,onssW:0,pp:0,net:0,cost:0,cheques:0,total:0});
  const pec13=masseBrute*0.92;const pecD=masseBrute;
  const annualTotal=totals.total+pec13+pecD;
  
  return <div>
    <PH title="üìä Budget Salarial Automatique" sub={`Projection ${year} ‚Äî ${ae.length} travailleurs`}/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:12,marginBottom:16}}>
      <SC label="Masse brute / an" value={fmt(totals.brut)} color="#c6a34e"/>
      <SC label="ONSS patronal / an" value={fmt(totals.onssE)} color="#f87171"/>
      <SC label="Ch√®ques-repas / an" value={fmt(totals.cheques)} color="#fb923c"/>
      <SC label="13√®me mois + P√©cule" value={fmt(pec13+pecD)} color="#60a5fa"/>
      <SC label="CO√õT TOTAL ANNUEL" value={fmt(annualTotal)} color="#a78bfa" sub={`${fmt(annualTotal/12)}/mois`}/>
    </div>
    <div style={{display:'grid',gridTemplateColumns:'300px 1fr',gap:18}}>
      <C>
        <ST>Param√®tres</ST>
        <div style={{display:'grid',gap:10}}>
          <I label="Ann√©e" type="number" value={year} onChange={v=>setYear(parseInt(v))}/>
          <I label="Indexation annuelle (%)" type="number" value={indexRate} onChange={v=>setIndexRate(parseFloat(v)||0)}/>
          <I label="Embauches pr√©vues (S2)" type="number" value={hiring} onChange={v=>setHiring(parseInt(v)||0)}/>
          {hiring>0&&<I label="Salaire moyen embauches" type="number" value={avgNewSalary} onChange={v=>setAvgNewSalary(parseFloat(v)||0)}/>}
        </div>
        <div style={{marginTop:14,padding:12,background:'rgba(198,163,78,.04)',borderRadius:8,fontSize:10.5,color:'#5e5c56',lineHeight:1.8}}>
          <div><b style={{color:'#c6a34e'}}>Hypoth√®ses:</b></div>
          <div>‚Ä¢ Indexation: {indexRate}% lin√©aire</div>
          <div>‚Ä¢ ONSS patronal: 25%</div>
          <div>‚Ä¢ Pr√©compte moyen: 22%</div>
          <div>‚Ä¢ CR: 22j √ó 6,91‚Ç¨ empl.</div>
          <div>‚Ä¢ 13√®me mois: 92% du brut</div>
          <div>‚Ä¢ P√©cule vacances: 100% du brut</div>
          {hiring>0&&<div>‚Ä¢ {hiring} embauches √† {fmt(avgNewSalary)} d√®s juillet</div>}
        </div>
      </C>
      <C>
        <ST>Budget mensuel d√©taill√©</ST>
        <div style={{overflowX:'auto'}}>
          <table style={{width:'100%',borderCollapse:'collapse',fontSize:10.5}}>
            <thead><tr style={{borderBottom:'1px solid rgba(198,163,78,.15)'}}>
              <th style={{padding:'6px 8px',textAlign:'left',color:'#5e5c56',fontSize:9}}>MOIS</th>
              <th style={{padding:'6px 8px',textAlign:'right',color:'#5e5c56',fontSize:9}}>BRUT</th>
              <th style={{padding:'6px 8px',textAlign:'right',color:'#5e5c56',fontSize:9}}>ONSS PAT.</th>
              <th style={{padding:'6px 8px',textAlign:'right',color:'#5e5c56',fontSize:9}}>PP</th>
              <th style={{padding:'6px 8px',textAlign:'right',color:'#5e5c56',fontSize:9}}>NET</th>
              <th style={{padding:'6px 8px',textAlign:'right',color:'#5e5c56',fontSize:9}}>CR</th>
              <th style={{padding:'6px 8px',textAlign:'right',color:'#c6a34e',fontSize:9,fontWeight:700}}>TOTAL</th>
            </tr></thead>
            <tbody>
              {months.map(m=><tr key={m.m} style={{borderBottom:'1px solid rgba(198,163,78,.04)'}}>
                <td style={{padding:'5px 8px',color:'#e8e6e0'}}>{MN[m.m-1]}</td>
                <td style={{padding:'5px 8px',textAlign:'right',color:'#e8e6e0',fontFamily:'monospace'}}>{fmt(m.brut)}</td>
                <td style={{padding:'5px 8px',textAlign:'right',color:'#f87171',fontFamily:'monospace'}}>{fmt(m.onssE)}</td>
                <td style={{padding:'5px 8px',textAlign:'right',color:'#fb923c',fontFamily:'monospace'}}>{fmt(m.pp)}</td>
                <td style={{padding:'5px 8px',textAlign:'right',color:'#4ade80',fontFamily:'monospace'}}>{fmt(m.net)}</td>
                <td style={{padding:'5px 8px',textAlign:'right',color:'#60a5fa',fontFamily:'monospace'}}>{fmt(m.cheques)}</td>
                <td style={{padding:'5px 8px',textAlign:'right',color:'#c6a34e',fontWeight:700,fontFamily:'monospace'}}>{fmt(m.total)}</td>
              </tr>)}
              <tr style={{borderTop:'2px solid rgba(198,163,78,.3)',background:'rgba(198,163,78,.04)'}}>
                <td style={{padding:'8px',color:'#c6a34e',fontWeight:700}}>TOTAL</td>
                <td style={{padding:'8px',textAlign:'right',color:'#c6a34e',fontWeight:700,fontFamily:'monospace'}}>{fmt(totals.brut)}</td>
                <td style={{padding:'8px',textAlign:'right',color:'#f87171',fontWeight:700,fontFamily:'monospace'}}>{fmt(totals.onssE)}</td>
                <td style={{padding:'8px',textAlign:'right',color:'#fb923c',fontWeight:700,fontFamily:'monospace'}}>{fmt(totals.pp)}</td>
                <td style={{padding:'8px',textAlign:'right',color:'#4ade80',fontWeight:700,fontFamily:'monospace'}}>{fmt(totals.net)}</td>
                <td style={{padding:'8px',textAlign:'right',color:'#60a5fa',fontWeight:700,fontFamily:'monospace'}}>{fmt(totals.cheques)}</td>
                <td style={{padding:'8px',textAlign:'right',color:'#c6a34e',fontWeight:700,fontFamily:'monospace',fontSize:12}}>{fmt(totals.total)}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </C>
    </div>
  </div>;
}

// ‚îÄ‚îÄ SIMULATEUR WHAT-IF ‚îÄ‚îÄ
function SimulateurWhatIfMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  const masseBrute=ae.reduce((a,e)=>a+(parseFloat(e.monthlySalary)||0),0);
  const [scenarios,setScenarios]=useState([
    {id:1,name:'Sc√©nario actuel',index:0,embauches:0,departs:0,augmentation:0,active:true},
    {id:2,name:'Croissance mod√©r√©e',index:2,embauches:3,departs:1,augmentation:3,active:true},
    {id:3,name:'Croissance forte',index:2,embauches:8,departs:2,augmentation:5,active:true},
    {id:4,name:'Restructuration',index:2,embauches:0,departs:5,augmentation:0,active:true},
  ]);
  
  const calcScenario=(sc)=>{
    const effectif=ae.length+sc.embauches-sc.departs;
    const masseAjustee=masseBrute*(1+sc.augmentation/100)*(1+sc.index/100);
    const masseNew=sc.embauches*2800;
    const masseLess=sc.departs*(masseBrute/Math.max(ae.length,1));
    const masseTotale=masseAjustee+masseNew-masseLess;
    const annuel=masseTotale*12;
    const cout=annuel*1.35;
    const pec=masseTotale*1.92;
    return{effectif,mensuel:Math.round(masseTotale),annuel:Math.round(annuel),cout:Math.round(cout),pec:Math.round(pec),totalAn:Math.round(cout+pec)};
  };

  return <div>
    <PH title="üîÆ Simulateur What-If" sub="Comparez diff√©rents sc√©narios d'√©volution"/>
    <div style={{display:'grid',gridTemplateColumns:`repeat(${scenarios.filter(s=>s.active).length},1fr)`,gap:14}}>
      {scenarios.filter(sc=>sc.active).map(sc=>{
        const r=calcScenario(sc);
        const base=calcScenario(scenarios[0]);
        const diff=r.totalAn-base.totalAn;
        return <C key={sc.id} style={{border:sc.id===1?'1px solid rgba(198,163,78,.25)':'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:14,fontWeight:600,color:sc.id===1?'#c6a34e':'#e8e6e0',marginBottom:12}}>{sc.name}</div>
          <div style={{display:'grid',gap:8,marginBottom:14}}>
            <I label="Indexation (%)" type="number" value={sc.index} onChange={v=>setScenarios(scenarios.map(s=>s.id===sc.id?{...s,index:parseFloat(v)||0}:s))}/>
            <I label="Embauches" type="number" value={sc.embauches} onChange={v=>setScenarios(scenarios.map(s=>s.id===sc.id?{...s,embauches:parseInt(v)||0}:s))}/>
            <I label="D√©parts" type="number" value={sc.departs} onChange={v=>setScenarios(scenarios.map(s=>s.id===sc.id?{...s,departs:parseInt(v)||0}:s))}/>
            <I label="Augmentation (%)" type="number" value={sc.augmentation} onChange={v=>setScenarios(scenarios.map(s=>s.id===sc.id?{...s,augmentation:parseFloat(v)||0}:s))}/>
          </div>
          <div style={{display:'flex',flexDirection:'column',gap:6}}>
            <div style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(198,163,78,.06)'}}>
              <span style={{fontSize:11,color:'#9e9b93'}}>Effectif</span>
              <span style={{fontSize:12,fontWeight:600,color:'#e8e6e0'}}>{r.effectif}</span>
            </div>
            <div style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(198,163,78,.06)'}}>
              <span style={{fontSize:11,color:'#9e9b93'}}>Masse/mois</span>
              <span style={{fontSize:12,fontWeight:600,color:'#c6a34e'}}>{fmt(r.mensuel)}</span>
            </div>
            <div style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(198,163,78,.06)'}}>
              <span style={{fontSize:11,color:'#9e9b93'}}>Co√ªt annuel</span>
              <span style={{fontSize:12,fontWeight:600,color:'#a78bfa'}}>{fmt(r.totalAn)}</span>
            </div>
            {sc.id!==1&&<div style={{padding:8,borderRadius:6,background:diff>0?'rgba(248,113,113,.06)':'rgba(74,222,128,.06)',textAlign:'center',marginTop:4}}>
              <span style={{fontSize:13,fontWeight:700,color:diff>0?'#f87171':'#4ade80'}}>{diff>0?'+':''}{fmt(diff)}/an</span>
              <div style={{fontSize:9,color:'#5e5c56'}}>vs sc√©nario actuel</div>
            </div>}
          </div>
        </C>;
      })}
    </div>
  </div>;
}

// ‚îÄ‚îÄ KPI DASHBOARD AVANC√â ‚îÄ‚îÄ
function KPIDashboardMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  const masseBrute=ae.reduce((a,e)=>a+(parseFloat(e.monthlySalary)||0),0);
  const calcs=ae.map(e=>({e,c:calc(e,DPER,s.co)}));
  const totalCost=calcs.reduce((a,x)=>a+x.c.costTotal,0);
  const totalNet=calcs.reduce((a,x)=>a+x.c.net,0);
  
  // KPI calculations
  const avgSalary=ae.length?masseBrute/ae.length:0;
  const medianSalary=ae.length?[...ae].sort((a,b)=>(a.monthlySalary||0)-(b.monthlySalary||0))[Math.floor(ae.length/2)]?.monthlySalary||0:0;
  const ratioCharges=masseBrute>0?((totalCost-masseBrute)/masseBrute*100):0;
  const ratioNet=masseBrute>0?(totalNet/masseBrute*100):0;
  const cdi=ae.filter(e=>e.contract==='CDI'||!e.contract).length;
  const cdd=ae.filter(e=>e.contract==='CDD').length;
  const students=ae.filter(e=>e.contract==='student').length;
  const genderM=ae.filter(e=>e.sex==='M').length;
  const genderF=ae.filter(e=>e.sex==='F').length;
  const employes=ae.filter(e=>e.statut==='employe').length;
  const ouvriers=ae.filter(e=>e.statut==='ouvrier').length;
  
  // Salary distribution
  const brackets=[{l:'< 2.000‚Ç¨',min:0,max:2000},{l:'2.000-2.500‚Ç¨',min:2000,max:2500},{l:'2.500-3.000‚Ç¨',min:2500,max:3000},{l:'3.000-3.500‚Ç¨',min:3000,max:3500},{l:'3.500-4.000‚Ç¨',min:3500,max:4000},{l:'> 4.000‚Ç¨',min:4000,max:999999}];
  const dist=brackets.map(b=>({...b,count:ae.filter(e=>(e.monthlySalary||0)>=b.min&&(e.monthlySalary||0)<b.max).length}));
  const maxDist=Math.max(...dist.map(d=>d.count),1);

  return <div>
    <PH title="üìä KPI Dashboard Avanc√©" sub="Indicateurs cl√©s de performance RH"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:10,marginBottom:16}}>
      <SC label="Effectif total" value={ae.length} color="#c6a34e"/>
      <SC label="Salaire moyen" value={fmt(avgSalary)} color="#60a5fa"/>
      <SC label="Salaire m√©dian" value={fmt(medianSalary)} color="#4ade80"/>
      <SC label="Ratio charges" value={`${ratioCharges.toFixed(0)}%`} color="#f87171" sub="du brut"/>
      <SC label="Ratio net/brut" value={`${ratioNet.toFixed(0)}%`} color="#a78bfa"/>
      <SC label="Co√ªt/employ√©" value={fmt(ae.length?totalCost/ae.length:0)} color="#fb923c" sub="/mois"/>
    </div>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:14}}>
      {/* Distribution salariale */}
      <C>
        <ST>Distribution salariale</ST>
        <div style={{display:'flex',flexDirection:'column',gap:6}}>
          {dist.map((d,i)=><div key={i} style={{display:'flex',alignItems:'center',gap:8}}>
            <span style={{fontSize:10,color:'#5e5c56',width:80,textAlign:'right'}}>{d.l}</span>
            <div style={{flex:1,height:18,background:'rgba(198,163,78,.06)',borderRadius:4,overflow:'hidden'}}>
              <div style={{height:'100%',width:`${(d.count/maxDist)*100}%`,background:'linear-gradient(90deg,#c6a34e,#a78bfa)',borderRadius:4,display:'flex',alignItems:'center',paddingLeft:6}}>
                {d.count>0&&<span style={{fontSize:9,color:'#fff',fontWeight:600}}>{d.count}</span>}
              </div>
            </div>
          </div>)}
        </div>
      </C>
      {/* R√©partition contrats */}
      <C>
        <ST>R√©partition</ST>
        <div style={{display:'flex',flexDirection:'column',gap:10}}>
          <div>
            <div style={{fontSize:10,color:'#5e5c56',marginBottom:6}}>Par contrat</div>
            {[{l:'CDI',v:cdi,c:'#4ade80'},{l:'CDD',v:cdd,c:'#fb923c'},{l:'√âtudiants',v:students,c:'#60a5fa'}].map(x=><div key={x.l} style={{display:'flex',alignItems:'center',gap:6,marginBottom:4}}>
              <span style={{width:10,height:10,borderRadius:'50%',background:x.c}}/>
              <span style={{fontSize:11,color:'#9e9b93',flex:1}}>{x.l}</span>
              <span style={{fontSize:12,fontWeight:600,color:'#e8e6e0'}}>{x.v}</span>
              <span style={{fontSize:10,color:'#5e5c56'}}>{ae.length?Math.round(x.v/ae.length*100):0}%</span>
            </div>)}
          </div>
          <div>
            <div style={{fontSize:10,color:'#5e5c56',marginBottom:6}}>Par statut</div>
            {[{l:'Employ√©s',v:employes,c:'#a78bfa'},{l:'Ouvriers',v:ouvriers,c:'#c6a34e'}].map(x=><div key={x.l} style={{display:'flex',alignItems:'center',gap:6,marginBottom:4}}>
              <span style={{width:10,height:10,borderRadius:'50%',background:x.c}}/>
              <span style={{fontSize:11,color:'#9e9b93',flex:1}}>{x.l}</span>
              <span style={{fontSize:12,fontWeight:600,color:'#e8e6e0'}}>{x.v}</span>
            </div>)}
          </div>
          <div>
            <div style={{fontSize:10,color:'#5e5c56',marginBottom:6}}>Par genre</div>
            {[{l:'Hommes',v:genderM,c:'#60a5fa'},{l:'Femmes',v:genderF,c:'#f472b6'},{l:'Non renseign√©',v:ae.length-genderM-genderF,c:'#5e5c56'}].map(x=><div key={x.l} style={{display:'flex',alignItems:'center',gap:6,marginBottom:4}}>
              <span style={{width:10,height:10,borderRadius:'50%',background:x.c}}/>
              <span style={{fontSize:11,color:'#9e9b93',flex:1}}>{x.l}</span>
              <span style={{fontSize:12,fontWeight:600,color:'#e8e6e0'}}>{x.v}</span>
            </div>)}
          </div>
        </div>
      </C>
      {/* Equal Pay Gap */}
      <C>
        <ST>Equal Pay Analysis</ST>
        {genderM>0&&genderF>0?<div>
          {(()=>{
            const avgM=ae.filter(e=>e.sex==='M').reduce((a,e)=>a+(e.monthlySalary||0),0)/genderM;
            const avgF=ae.filter(e=>e.sex==='F').reduce((a,e)=>a+(e.monthlySalary||0),0)/genderF;
            const gap=((avgM-avgF)/avgM*100);
            return <div style={{textAlign:'center',padding:20}}>
              <div style={{fontSize:36,fontWeight:700,color:Math.abs(gap)<5?'#4ade80':gap>0?'#fb923c':'#60a5fa'}}>{gap.toFixed(1)}%</div>
              <div style={{fontSize:12,color:'#9e9b93',marginTop:4}}>Gender Pay Gap</div>
              <div style={{marginTop:12,display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
                <div style={{padding:8,borderRadius:6,background:'rgba(96,165,250,.06)'}}>
                  <div style={{fontSize:10,color:'#60a5fa'}}>‚ôÇ Moyenne H</div>
                  <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0'}}>{fmt(avgM)}</div>
                </div>
                <div style={{padding:8,borderRadius:6,background:'rgba(244,114,182,.06)'}}>
                  <div style={{fontSize:10,color:'#f472b6'}}>‚ôÄ Moyenne F</div>
                  <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0'}}>{fmt(avgF)}</div>
                </div>
              </div>
              <div style={{fontSize:10,color:'#5e5c56',marginTop:10}}>{Math.abs(gap)<5?'‚úÖ √âcart acceptable (<5%)':gap>10?'‚ö†Ô∏è √âcart significatif ‚Äî action requise':'‚ö†Ô∏è √âcart √† surveiller'}</div>
            </div>;
          })()}
        </div>:<div style={{textAlign:'center',padding:30,color:'#5e5c56',fontSize:11}}>Renseignez le genre (H/F) des travailleurs pour activer l'analyse Equal Pay</div>}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SPRINT 9 ‚Äî AUTOMATISATION: WORKFLOWS + SCHEDULER + TEMPLATES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ AUTOMATISATIONS & R√àGLES ‚îÄ‚îÄ
function AutomationsMod({s,d}){
  const [rules,setRules]=useState([
    {id:'R1',name:'Pr√©paration paie mensuelle',trigger:'date',triggerValue:'20',action:'auto_prepare_payroll',enabled:true,lastRun:'2026-01-20T08:00:00',runs:12,desc:'Collecte absences, calcule brut/net, pr√©pare toutes les fiches ‚Üí EN ATTENTE de votre validation'},
    {id:'R1b',name:'Scan absences automatique',trigger:'date',triggerValue:'19',action:'auto_scan_absences',enabled:true,lastRun:'2026-01-19T08:00:00',runs:12,desc:'Scanne certificats m√©dicaux, cong√©s encod√©s, jours f√©ri√©s ‚Üí pr√©pare le r√©cap ‚Üí EN ATTENTE validation'},
    {id:'R2',name:'Pr√©paration DmfA trimestrielle',trigger:'date_quarterly',triggerValue:'15',action:'auto_prepare_dmfa',enabled:true,lastRun:'2026-01-15T09:00:00',runs:4,desc:'G√©n√®re le XML DmfA avec toutes les donn√©es du trimestre ‚Üí EN ATTENTE de votre envoi'},
    {id:'R3',name:'Pr√©paration Dimona embauche',trigger:'event',triggerValue:'employee_created',action:'auto_prepare_dimona',enabled:true,lastRun:'2026-02-10T14:30:00',runs:8,desc:'Pr√©-remplit la Dimona IN avec les donn√©es de l\'employ√© ‚Üí EN ATTENTE de votre validation'},
    {id:'R4',name:'Dossier fin CDD',trigger:'condition',triggerValue:'cdd_expires_30d',action:'auto_prepare_cdd',enabled:true,lastRun:'2026-02-01T08:00:00',runs:3,desc:'Pr√©pare renouvellement OU documents de sortie (C4, d√©compte) ‚Üí EN ATTENTE de votre d√©cision'},
    {id:'R5',name:'Calcul indexation annuelle',trigger:'date_yearly',triggerValue:'01-01',action:'auto_calc_indexation',enabled:true,lastRun:'2026-01-01T06:00:00',runs:1,desc:'Calcule les nouveaux salaires index√©s pour tous les travailleurs ‚Üí EN ATTENTE de votre application'},
    {id:'R6',name:'Backup donn√©es quotidien',trigger:'daily',triggerValue:'02:00',action:'auto_backup',enabled:true,lastRun:'2026-02-14T02:00:00',runs:365,desc:'Sauvegarde automatique compl√®te (aucune validation requise)'},
    {id:'R7',name:'G√©n√©ration rapport mensuel',trigger:'date',triggerValue:'1',action:'auto_generate_report',enabled:true,lastRun:'2026-02-01T07:00:00',runs:6,desc:'G√©n√®re le rapport RH complet (effectifs, co√ªts, absences) ‚Üí EN ATTENTE de votre envoi'},
    {id:'R8',name:'Pr√©paration Belcotax',trigger:'date_yearly',triggerValue:'02-01',action:'auto_prepare_belcotax',enabled:true,lastRun:'2026-02-01T06:00:00',runs:1,desc:'G√©n√®re toutes les fiches 281.10 et 281.20 ‚Üí EN ATTENTE de votre soumission'},
    {id:'R9',name:'Calcul provisions ONSS',trigger:'date',triggerValue:'1',action:'auto_calc_onss',enabled:true,lastRun:'2026-02-01T06:00:00',runs:12,desc:'Calcule le montant des provisions ONSS √† payer le 5 ‚Üí EN ATTENTE de votre virement'},
    {id:'R10',name:'Notification anniversaire',trigger:'condition',triggerValue:'birthday_today',action:'auto_birthday',enabled:true,lastRun:'2026-02-12T08:00:00',runs:15,desc:'Info anniversaire collaborateur (aucune validation requise)'},
    {id:'R11',name:'G√©n√©ration SEPA virements',trigger:'date',triggerValue:'25',action:'auto_prepare_sepa',enabled:true,lastRun:'2026-01-25T18:00:00',runs:12,desc:'Cr√©e le fichier SEPA avec tous les virements salaires ‚Üí EN ATTENTE de votre upload bancaire'},
    {id:'R12',name:'Pr√©paration PP 274',trigger:'date',triggerValue:'10',action:'auto_prepare_pp',enabled:true,lastRun:'2026-02-10T06:00:00',runs:12,desc:'Calcule et g√©n√®re la d√©claration pr√©compte professionnel ‚Üí EN ATTENTE de votre soumission FinProf'},
  ]);
  
  const triggerIcons={date:'üìÖ',date_quarterly:'üìÖ',date_yearly:'üìÖ',event:'‚ö°',condition:'üîç',daily:'üîÑ'};
  const triggerLabels={date:'Mensuel',date_quarterly:'Trimestriel',date_yearly:'Annuel',event:'√âv√©nement',condition:'Condition',daily:'Quotidien'};
  const actionLabels={auto_prepare_payroll:'‚ö° Pr√©pare paie',auto_scan_absences:'‚ö° Scan absences',auto_prepare_dmfa:'‚ö° Pr√©pare DmfA',auto_prepare_dimona:'‚ö° Pr√©pare Dimona',auto_prepare_cdd:'‚ö° Dossier CDD',auto_calc_indexation:'‚ö° Calcul index',auto_backup:'üíæ Backup',auto_generate_report:'‚ö° Rapport',auto_prepare_belcotax:'‚ö° Pr√©pare 281',auto_calc_onss:'‚ö° Calcul ONSS',auto_birthday:'üéÇ Anniversaire',auto_prepare_sepa:'‚ö° Pr√©pare SEPA',auto_prepare_pp:'‚ö° Pr√©pare PP 274'};
  
  // Status badge
  const statusBadge=(r)=>{
    if(r.action==='auto_backup'||r.action==='auto_birthday')return {label:'Auto',color:'#4ade80',bg:'rgba(74,222,128,.08)'};
    return {label:'üîí En attente validation',color:'#fb923c',bg:'rgba(251,146,60,.08)'};
  };
  
  return <div>
    <PH title="‚öôÔ∏è Automatisations" sub={`${rules.filter(r=>r.enabled).length} r√®gles actives sur ${rules.length}`}/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:16}}>
      <SC label="R√®gles actives" value={rules.filter(r=>r.enabled).length} color="#4ade80"/>
      <SC label="R√®gles inactives" value={rules.filter(r=>!r.enabled).length} color="#5e5c56"/>
      <SC label="Total ex√©cutions" value={rules.reduce((a,r)=>a+r.runs,0)} color="#60a5fa"/>
      <SC label="Derni√®re ex√©cution" value={rules.filter(r=>r.lastRun).sort((a,b)=>new Date(b.lastRun)-new Date(a.lastRun))[0]?.lastRun?new Date(rules.filter(r=>r.lastRun).sort((a,b)=>new Date(b.lastRun)-new Date(a.lastRun))[0].lastRun).toLocaleDateString('fr-BE'):'‚Äî'} color="#c6a34e"/>
    </div>
    <C>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}}>
        <ST>R√®gles d'automatisation</ST>
        <B v="outline" style={{fontSize:10}} onClick={()=>setRules([...rules,{id:'R'+Date.now(),name:'Nouvelle r√®gle',trigger:'event',triggerValue:'',action:'alert_email',enabled:false,lastRun:null,runs:0,desc:''}])}>+ Nouvelle r√®gle</B>
      </div>
      {rules.map((r,i)=><div key={r.id} style={{display:'flex',alignItems:'center',gap:14,padding:'14px 16px',borderRadius:10,background:r.enabled?'rgba(74,222,128,.03)':'rgba(94,92,86,.03)',border:`1px solid ${r.enabled?'rgba(74,222,128,.12)':'rgba(94,92,86,.12)'}`,marginBottom:8,opacity:r.enabled?1:0.6}}>
        <button onClick={()=>setRules(rules.map(x=>x.id===r.id?{...x,enabled:!x.enabled}:x))} style={{width:40,height:22,borderRadius:11,border:'none',cursor:'pointer',background:r.enabled?'#4ade80':'#3a3832',position:'relative',transition:'all .3s'}}>
          <div style={{width:16,height:16,borderRadius:'50%',background:'#fff',position:'absolute',top:3,left:r.enabled?21:3,transition:'all .3s'}}/>
        </button>
        <span style={{fontSize:20}}>{triggerIcons[r.trigger]}</span>
        <div style={{flex:1}}>
          <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>{r.name}</div>
          <div style={{fontSize:10.5,color:'#5e5c56',marginTop:2}}>{r.desc}</div>
        </div>
        <div style={{textAlign:'right'}}>
          <div style={{display:'flex',gap:6,marginBottom:4}}>
            <span style={{fontSize:9,padding:'2px 8px',borderRadius:10,background:'rgba(198,163,78,.08)',color:'#c6a34e'}}>{triggerLabels[r.trigger]}</span>
            <span style={{fontSize:9,padding:'2px 8px',borderRadius:10,background:'rgba(96,165,250,.08)',color:'#60a5fa'}}>{actionLabels[r.action]||r.action}</span>
          </div>
          <div style={{fontSize:9,color:'#5e5c56'}}>{r.runs} ex√©cutions{r.lastRun?` ¬∑ Dernier: ${new Date(r.lastRun).toLocaleDateString('fr-BE')}`:''}</div>
        </div>
        <B v="outline" style={{fontSize:9,padding:'4px 10px'}} onClick={()=>{
          if(r.action==='auto_backup'||r.action==='auto_birthday'){
            setRules(rules.map(x=>x.id===r.id?{...x,runs:x.runs+1,lastRun:new Date().toISOString()}:x));
            alert(`‚úÖ "${r.name}" ex√©cut√©.`);
          }else{
            const ok=confirm(`üîí VALIDATION REQUISE\n\n"${r.name}"\n\nLe syst√®me a tout pr√©par√©.\nVoulez-vous VALIDER et ENVOYER ?`);
            if(ok){
              setRules(rules.map(x=>x.id===r.id?{...x,runs:x.runs+1,lastRun:new Date().toISOString()}:x));
              alert(`‚úÖ "${r.name}" valid√© et envoy√© !`);
            }
          }
        }}>{r.action==='auto_backup'||r.action==='auto_birthday'?'‚ñ∂ Run':'‚úÖ Valider & Envoyer'}</B>
      </div>)}
    </C>
  </div>;
}

// ‚îÄ‚îÄ PLANIFICATEUR DE T√ÇCHES ‚îÄ‚îÄ
function SchedulerMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  const now=new Date();
  const m=now.getMonth()+1;const y=now.getFullYear();
  const q=Math.ceil(m/3);
  
  const tasks=[
    // Mensuels
    {id:'T1',title:'Calcul fiches de paie',deadline:`${y}-${String(m).padStart(2,'0')}-25`,freq:'Mensuel',cat:'Paie',status:m>1?'done':'pending',prio:'haute',auto:true},
    {id:'T2',title:'Provisions ONSS',deadline:`${y}-${String(m).padStart(2,'0')}-05`,freq:'Mensuel',cat:'ONSS',status:'done',prio:'haute',auto:true},
    {id:'T3',title:'Virements salaires (SEPA)',deadline:`${y}-${String(m).padStart(2,'0')}-28`,freq:'Mensuel',cat:'Paie',status:'pending',prio:'haute',auto:false},
    {id:'T4',title:`PP 274 ‚Äî ${m>1?new Date(y,m-2).toLocaleString('fr',{month:'short'}):new Date(y-1,11).toLocaleString('fr',{month:'short'})}/${m>1?y:y-1}`,deadline:`${y}-${String(m).padStart(2,'0')}-15`,freq:'Mensuel',cat:'Fiscal',status:now.getDate()>15?'done':'pending',prio:'haute',auto:true},
    // Trimestriels
    {id:'T5',title:`DmfA T${q>1?q-1:4}/${q>1?y:y-1}`,deadline:q===1?`${y}-01-31`:q===2?`${y}-04-30`:q===3?`${y}-07-31`:`${y}-10-31`,freq:'Trimestriel',cat:'ONSS',status:'pending',prio:'critique',auto:true},
    {id:'T6',title:`Solde ONSS T${q>1?q-1:4}/${q>1?y:y-1}`,deadline:q===1?`${y}-01-31`:q===2?`${y}-04-30`:q===3?`${y}-07-31`:`${y}-10-31`,freq:'Trimestriel',cat:'ONSS',status:'pending',prio:'critique',auto:false},
    // Annuels
    {id:'T7',title:`Belcotax 281 ‚Äî ${y-1}`,deadline:`${y}-02-28`,freq:'Annuel',cat:'Fiscal',status:m>2?'done':'pending',prio:'critique',auto:true},
    {id:'T8',title:`Bilan social ${y-1}`,deadline:`${y}-03-31`,freq:'Annuel',cat:'RH',status:'pending',prio:'moyenne',auto:false},
    {id:'T9',title:`Indexation salariale ${y}`,deadline:`${y}-01-15`,freq:'Annuel',cat:'Paie',status:m>1?'done':'pending',prio:'haute',auto:true},
    {id:'T10',title:`Plan de formation ${y}`,deadline:`${y}-03-31`,freq:'Annuel',cat:'RH',status:'pending',prio:'moyenne',auto:false},
    {id:'T11',title:`Fiches 281.10 travailleurs`,deadline:`${y}-02-28`,freq:'Annuel',cat:'Fiscal',status:m>2?'done':'pending',prio:'critique',auto:true},
    {id:'T12',title:`Fiche 281.20 dirigeants`,deadline:`${y}-02-28`,freq:'Annuel',cat:'Fiscal',status:m>2?'done':'pending',prio:'critique',auto:true},
    {id:'T13',title:'V√©rification contrats CDD',deadline:`${y}-${String(m).padStart(2,'0')}-01`,freq:'Mensuel',cat:'Contrats',status:'pending',prio:'moyenne',auto:true},
    {id:'T14',title:'M√©decine du travail ‚Äî planification',deadline:`${y}-${String(m).padStart(2,'0')}-15`,freq:'Annuel',cat:'Bien-√™tre',status:'pending',prio:'moyenne',auto:false},
  ];
  
  const [filter,setFilter]=useState('all');
  const statusColors={done:'#4ade80',pending:'#fb923c',overdue:'#f87171',critique:'#f87171'};
  const prioColors={critique:'#f87171',haute:'#fb923c',moyenne:'#60a5fa',basse:'#5e5c56'};
  const filtered=filter==='all'?tasks:tasks.filter(t=>filter==='pending'?t.status==='pending':filter==='done'?t.status==='done':t.cat===filter);
  
  return <div>
    <PH title="üìã Planificateur de T√¢ches" sub={`Calendrier social ${y} ‚Äî ${ae.length} travailleurs`}/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:12,marginBottom:16}}>
      <SC label="Total t√¢ches" value={tasks.length} color="#c6a34e"/>
      <SC label="√Ä faire" value={tasks.filter(t=>t.status==='pending').length} color="#fb923c"/>
      <SC label="Termin√©es" value={tasks.filter(t=>t.status==='done').length} color="#4ade80"/>
      <SC label="Critiques" value={tasks.filter(t=>t.prio==='critique'&&t.status==='pending').length} color="#f87171"/>
      <SC label="Automatis√©es" value={tasks.filter(t=>t.auto).length} color="#a78bfa"/>
    </div>
    <div style={{display:'flex',gap:6,marginBottom:14,flexWrap:'wrap'}}>
      {['all','pending','done','Paie','ONSS','Fiscal','RH','Contrats'].map(f=><button key={f} onClick={()=>setFilter(f)} style={{padding:'5px 12px',borderRadius:16,border:filter===f?'1px solid rgba(198,163,78,.3)':'1px solid rgba(198,163,78,.06)',background:filter===f?'rgba(198,163,78,.1)':'transparent',color:filter===f?'#c6a34e':'#9e9b93',cursor:'pointer',fontSize:10.5,fontFamily:'inherit'}}>{{all:'Tous',pending:'√Ä faire',done:'Termin√©es'}[f]||f}</button>)}
    </div>
    <C>
      <table style={{width:'100%',borderCollapse:'collapse',fontSize:11}}>
        <thead><tr style={{borderBottom:'1px solid rgba(198,163,78,.12)'}}>
          <th style={{padding:'8px',textAlign:'left',color:'#5e5c56',fontSize:9}}>STATUT</th>
          <th style={{padding:'8px',textAlign:'left',color:'#5e5c56',fontSize:9}}>T√ÇCHE</th>
          <th style={{padding:'8px',textAlign:'center',color:'#5e5c56',fontSize:9}}>DEADLINE</th>
          <th style={{padding:'8px',textAlign:'center',color:'#5e5c56',fontSize:9}}>FR√âQUENCE</th>
          <th style={{padding:'8px',textAlign:'center',color:'#5e5c56',fontSize:9}}>PRIORIT√â</th>
          <th style={{padding:'8px',textAlign:'center',color:'#5e5c56',fontSize:9}}>RAPPEL</th>
        </tr></thead>
        <tbody>{filtered.map(t=>{
          const dl=new Date(t.deadline);
          const overdue=t.status==='pending'&&dl<now;
          return <tr key={t.id} style={{borderBottom:'1px solid rgba(198,163,78,.04)',background:overdue?'rgba(248,113,113,.04)':'transparent'}}>
            <td style={{padding:'8px'}}><span style={{display:'inline-block',width:10,height:10,borderRadius:'50%',background:overdue?'#f87171':statusColors[t.status]||'#5e5c56'}}/></td>
            <td style={{padding:'8px',color:'#e8e6e0',fontWeight:500}}>
              {t.title}
              <span style={{marginLeft:8,fontSize:9,padding:'1px 6px',borderRadius:8,background:'rgba(198,163,78,.06)',color:'#9e9b93'}}>{t.cat}</span>
            </td>
            <td style={{padding:'8px',textAlign:'center',color:overdue?'#f87171':'#9e9b93',fontFamily:'monospace',fontSize:10}}>{dl.toLocaleDateString('fr-BE')}</td>
            <td style={{padding:'8px',textAlign:'center',fontSize:10,color:'#5e5c56'}}>{t.freq}</td>
            <td style={{padding:'8px',textAlign:'center'}}><span style={{fontSize:9,padding:'2px 8px',borderRadius:10,background:`${prioColors[t.prio]}15`,color:prioColors[t.prio],fontWeight:600}}>{t.prio}</span></td>
            <td style={{padding:'8px',textAlign:'center'}}>{t.auto?<span style={{color:'#a78bfa'}}>‚ö°</span>:<span style={{color:'#5e5c56'}}>‚Äî</span>}</td>
          </tr>;})}
        </tbody>
      </table>
    </C>
  </div>;
}

// ‚îÄ‚îÄ GESTION DES ABSENCES (PR√â-PAIE) ‚îÄ‚îÄ
function AbsencesMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  const now=new Date();
  const [month,setMonth]=useState(now.getMonth()+1);
  const [year,setYear]=useState(now.getFullYear());
  const [absences,setAbsences]=useState([]);
  const [showForm,setShowForm]=useState(false);
  const [form,setForm]=useState({empId:'',type:'maladie',dateFrom:'',dateTo:'',days:0,justif:false,note:''});
  
  const types=[
    {id:'maladie',label:'üè• Maladie (salaire garanti)',color:'#f87171',impact:'garanti'},
    {id:'conge',label:'üèñÔ∏è Cong√© annuel',color:'#4ade80',impact:'pay√©'},
    {id:'sans_solde',label:'‚ùå Absence injustifi√©e',color:'#ef4444',impact:'d√©duction'},
    {id:'ct_temps',label:'‚è∞ Cr√©dit-temps',color:'#60a5fa',impact:'r√©duit'},
    {id:'maternite',label:'ü§± Maternit√©/Paternit√©',color:'#f472b6',impact:'mutuelle'},
    {id:'accident',label:'‚ö†Ô∏è Accident de travail',color:'#fb923c',impact:'assurance'},
    {id:'formation',label:'üìö Formation',color:'#a78bfa',impact:'pay√©'},
    {id:'ferie',label:'üéâ Jour f√©ri√©',color:'#c6a34e',impact:'pay√©'},
    {id:'petit_chomage',label:'üìã Petit ch√¥mage',color:'#06b6d4',impact:'pay√©'},
    {id:'chomage_eco',label:'üè≠ Ch√¥mage √©conomique',color:'#5e5c56',impact:'ONEM'},
  ];
  
  const addAbsence=()=>{
    if(!form.empId||!form.dateFrom)return alert('S√©lectionnez un employ√© et une date');
    const d1=new Date(form.dateFrom);
    const d2=form.dateTo?new Date(form.dateTo):d1;
    const days=Math.ceil((d2-d1)/(1000*60*60*24))+1;
    const weekdays=Array.from({length:days},(_,i)=>{const d=new Date(d1);d.setDate(d.getDate()+i);return d.getDay()}).filter(d=>d>0&&d<6).length;
    setAbsences([...absences,{...form,id:'ABS-'+Date.now(),days:weekdays,created:new Date().toISOString()}]);
    setForm({empId:'',type:'maladie',dateFrom:'',dateTo:'',days:0,justif:false,note:''});
    setShowForm(false);
  };
  
  const eName=(e)=>(e.first||e.last)?`${e.first||''} ${e.last||''}`.trim():(e.fn||`Emp ${(e.id||'').slice(-3)}`);
  const monthAbsences=absences.filter(a=>{const d=new Date(a.dateFrom);return d.getMonth()+1===month&&d.getFullYear()===year;});
  const totalDays=monthAbsences.reduce((a,x)=>a+x.days,0);
  const unjustified=monthAbsences.filter(a=>a.type==='sans_solde').length;
  const validated=monthAbsences.filter(a=>a.justif).length;
  
  // Paie readiness check
  const empsWithAbsence=new Set(monthAbsences.map(a=>a.empId));
  const empsWithoutCheck=ae.filter(e=>!empsWithAbsence.has(e.id));
  const allChecked=empsWithoutCheck.length===0||monthAbsences.length>0;
  
  return <div>
    <PH title="üìÖ Gestion des Absences" sub={`${MN[month-1]} ${year} ‚Äî V√©rification pr√©-paie`}/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:12,marginBottom:16}}>
      <SC label="Absences ce mois" value={monthAbsences.length} color="#c6a34e"/>
      <SC label="Jours d'absence" value={totalDays} color="#fb923c"/>
      <SC label="Injustifi√©es" value={unjustified} color={unjustified>0?'#f87171':'#4ade80'}/>
      <SC label="Justificatifs OK" value={validated} color="#4ade80"/>
      <SC label={allChecked?"‚úÖ Pr√™t pour paie":"‚ö†Ô∏è √Ä v√©rifier"} value={`${ae.length-empsWithoutCheck.length}/${ae.length}`} color={allChecked?'#4ade80':'#fb923c'}/>
    </div>
    
    {/* Readiness Banner */}
    <div style={{padding:14,borderRadius:10,marginBottom:16,background:unjustified>0?'rgba(248,113,113,.06)':monthAbsences.length>0?'rgba(74,222,128,.06)':'rgba(251,146,60,.06)',border:`1px solid ${unjustified>0?'rgba(248,113,113,.15)':monthAbsences.length>0?'rgba(74,222,128,.15)':'rgba(251,146,60,.15)'}`}}>
      <div style={{fontSize:13,fontWeight:600,color:unjustified>0?'#f87171':monthAbsences.length>0?'#4ade80':'#fb923c'}}>
        {unjustified>0?`‚ö†Ô∏è ${unjustified} absence(s) injustifi√©e(s) ‚Äî V√©rifier avant la paie !`:monthAbsences.length>0?'‚úÖ Absences encod√©es ‚Äî Vous pouvez lancer la paie':'‚ö†Ô∏è Aucune absence encod√©e ce mois ‚Äî V√©rifiez que tout est correct avant la paie'}
      </div>
      <div style={{fontSize:10.5,color:'#5e5c56',marginTop:4}}>Workflow: 1Ô∏è‚É£ Encoder absences ‚Üí 2Ô∏è‚É£ V√©rifier justificatifs ‚Üí 3Ô∏è‚É£ Valider ‚Üí 4Ô∏è‚É£ Lancer le batch paie</div>
    </div>

    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:16}}>
      <C>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
          <ST>P√©riode</ST>
        </div>
        <div style={{display:'grid',gap:8,marginBottom:12}}>
          <I label="Mois" value={month} onChange={v=>setMonth(parseInt(v))} options={MN.map((m,i)=>({v:i+1,l:m}))}/>
          <I label="Ann√©e" type="number" value={year} onChange={v=>setYear(parseInt(v))}/>
        </div>
        <B v="gold" style={{width:'100%',marginBottom:10}} onClick={()=>setShowForm(true)}>+ Encoder une absence</B>
        
        <div style={{fontSize:10,color:'#5e5c56',lineHeight:1.8,padding:10,background:'rgba(198,163,78,.03)',borderRadius:8}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>Impact sur la paie:</div>
          <div>üè• Maladie ‚Üí Salaire garanti (30j)</div>
          <div>üèñÔ∏è Cong√© ‚Üí Pay√© normalement</div>
          <div>‚ùå Injustifi√©e ‚Üí D√©duction au prorata</div>
          <div>ü§± Maternit√© ‚Üí Mutuelle (sauf 1√®re sem)</div>
          <div>‚ö†Ô∏è Accident ‚Üí Assurance-loi 90%</div>
          <div>üè≠ Ch√¥mage √©co ‚Üí ONEM 65%</div>
        </div>
      </C>
      <C>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
          <ST>Absences {MN[month-1]} {year}</ST>
          <span style={{fontSize:10,color:'#5e5c56'}}>{monthAbsences.length} enregistrement(s)</span>
        </div>
        {monthAbsences.length===0?<div style={{padding:40,textAlign:'center',color:'#5e5c56',fontSize:12}}>Aucune absence encod√©e pour cette p√©riode.<br/>Cliquez "+ Encoder une absence" pour commencer.</div>:
        <div style={{display:'flex',flexDirection:'column',gap:6}}>
          {monthAbsences.map(a=>{
            const emp=ae.find(e=>e.id===a.empId);
            const tp=types.find(t=>t.id===a.type);
            return <div key={a.id} style={{display:'flex',alignItems:'center',gap:10,padding:'10px 12px',borderRadius:8,background:'rgba(198,163,78,.02)',border:'1px solid rgba(198,163,78,.06)'}}>
              <span style={{fontSize:16}}>{tp?.label?.slice(0,2)}</span>
              <div style={{flex:1}}>
                <div style={{fontSize:12,fontWeight:500,color:'#e8e6e0'}}>{emp?eName(emp):'?'}</div>
                <div style={{fontSize:10,color:'#5e5c56'}}>{tp?.label?.slice(3)} ¬∑ {a.dateFrom}{a.dateTo&&a.dateTo!==a.dateFrom?` ‚Üí ${a.dateTo}`:''} ¬∑ {a.days}j</div>
              </div>
              <span style={{fontSize:9,padding:'2px 8px',borderRadius:10,background:a.justif?'rgba(74,222,128,.1)':'rgba(248,113,113,.1)',color:a.justif?'#4ade80':'#f87171'}}>{a.justif?'Justifi√©':'Non justifi√©'}</span>
              <button onClick={()=>setAbsences(absences.map(x=>x.id===a.id?{...x,justif:!x.justif}:x))} style={{fontSize:9,padding:'3px 8px',borderRadius:6,border:'1px solid rgba(198,163,78,.15)',background:'transparent',color:'#c6a34e',cursor:'pointer'}}>‚úì</button>
              <button onClick={()=>setAbsences(absences.filter(x=>x.id!==a.id))} style={{fontSize:9,padding:'3px 8px',borderRadius:6,border:'1px solid rgba(248,113,113,.15)',background:'transparent',color:'#f87171',cursor:'pointer'}}>‚úï</button>
            </div>;
          })}
        </div>}
      </C>
    </div>
    
    {/* Modal formulaire */}
    {showForm&&<div style={{position:'fixed',inset:0,background:'rgba(0,0,0,.6)',zIndex:9998,display:'flex',alignItems:'center',justifyContent:'center'}} onClick={()=>setShowForm(false)}>
      <div onClick={e=>e.stopPropagation()} style={{background:'#1a1914',border:'1px solid rgba(198,163,78,.2)',borderRadius:14,padding:24,width:420,maxHeight:'80vh',overflow:'auto'}}>
        <div style={{fontSize:16,fontWeight:600,color:'#c6a34e',marginBottom:16}}>üìÖ Encoder une absence</div>
        <div style={{display:'grid',gap:10}}>
          <I label="Employ√©" value={form.empId} onChange={v=>setForm({...form,empId:v})} options={[{v:'',l:'Choisir...'},...ae.map(e=>({v:e.id,l:eName(e)}))]}/>
          <I label="Type d'absence" value={form.type} onChange={v=>setForm({...form,type:v})} options={types.map(t=>({v:t.id,l:t.label}))}/>
          <I label="Date d√©but" type="date" value={form.dateFrom} onChange={v=>setForm({...form,dateFrom:v})}/>
          <I label="Date fin" type="date" value={form.dateTo} onChange={v=>setForm({...form,dateTo:v})}/>
          <I label="Note (optionnel)" value={form.note} onChange={v=>setForm({...form,note:v})}/>
          <div style={{display:'flex',alignItems:'center',gap:8}}>
            <input type="checkbox" checked={form.justif} onChange={e=>setForm({...form,justif:e.target.checked})}/>
            <span style={{fontSize:11,color:'#9e9b93'}}>Justificatif re√ßu (certificat m√©dical, etc.)</span>
          </div>
        </div>
        <div style={{display:'flex',gap:8,marginTop:16}}>
          <B v="gold" onClick={addAbsence}>Enregistrer</B>
          <B v="outline" onClick={()=>setShowForm(false)}>Annuler</B>
        </div>
      </div>
    </div>}
  </div>;
}

// ‚îÄ‚îÄ MOD√àLES DE DOCUMENTS ‚îÄ‚îÄ
function TemplatesMod({s,d}){
  const ae=s.emps.filter(e=>e.status==='active'||!e.status);
  const [selectedTpl,setSelectedTpl]=useState(null);
  const [selectedEmp,setSelectedEmp]=useState('');
  
  const templates=[
    {id:'tpl_cdi',name:'Contrat CDI',cat:'Contrat',icon:'üìÑ',desc:'Contrat √† dur√©e ind√©termin√©e conforme √† la loi du 3/7/1978',fields:['Nom','Pr√©nom','NISS','Fonction','CP','Salaire brut','Date d√©but','Lieu de travail','Horaire']},
    {id:'tpl_cdd',name:'Contrat CDD',cat:'Contrat',icon:'üìÑ',desc:'Contrat √† dur√©e d√©termin√©e ‚Äî √©crit obligatoire AVANT le d√©but',fields:['Nom','Pr√©nom','NISS','Fonction','CP','Salaire brut','Date d√©but','Date fin','Motif']},
    {id:'tpl_student',name:'Convention √©tudiant (COE)',cat:'Contrat',icon:'üéì',desc:'Convention d\'occupation √©tudiant ‚Äî mentions obligatoires (Titre VII)',fields:['Nom','Pr√©nom','NISS','Fonction','Salaire horaire','Date d√©but','Date fin','Horaire','√âcole']},
    {id:'tpl_avenant',name:'Avenant au contrat',cat:'Contrat',icon:'üìù',desc:'Modification des conditions (salaire, fonction, horaire)',fields:['Nom employ√©','Objet modification','Anciennes conditions','Nouvelles conditions','Date effet']},
    {id:'tpl_c4',name:'Formulaire C4',cat:'Sortie',icon:'üìã',desc:'Certificat de ch√¥mage ‚Äî obligatoire √† la fin du contrat',fields:['Nom','NISS','Date entr√©e','Date sortie','Motif fin','Dernier salaire']},
    {id:'tpl_preavis',name:'Lettre de pr√©avis',cat:'Sortie',icon:'‚úâÔ∏è',desc:'Notification de pr√©avis par l\'employeur (recommand√©)',fields:['Nom employ√©','Anciennet√©','Dur√©e pr√©avis','Date d√©but pr√©avis','Motif']},
    {id:'tpl_licenciement',name:'Lettre motif grave',cat:'Sortie',icon:'‚ö†Ô∏è',desc:'Notification dans les 3 jours ouvrables + motivation 3 jours',fields:['Nom employ√©','Date des faits','Description faits','Date notification']},
    {id:'tpl_attestation',name:'Attestation d\'emploi',cat:'Attestation',icon:'‚úÖ',desc:'Certificat confirmant l\'emploi (banque, bail, etc.)',fields:['Nom','Fonction','Date entr√©e','Type contrat','Salaire brut']},
    {id:'tpl_telework',name:'Avenant t√©l√©travail',cat:'Contrat',icon:'üè†',desc:'Avenant t√©l√©travail structurel conforme CCT n¬∞85',fields:['Nom employ√©','Jours t√©l√©travail','Indemnit√© bureau','√âquipement fourni','Date d√©but']},
    {id:'tpl_rt',name:'R√®glement de travail',cat:'L√©gal',icon:'üìñ',desc:'Document obligatoire d√®s le 1er travailleur (Loi 8/4/1965)',fields:['Horaires','Modes de paiement','Sanctions','Pr√©avis','Premiers secours','CPPT']},
    {id:'tpl_nda',name:'Accord de confidentialit√©',cat:'L√©gal',icon:'üîí',desc:'Clause de confidentialit√© pour donn√©es sensibles',fields:['Nom employ√©','P√©rim√®tre','Dur√©e','Sanctions','Date']},
    {id:'tpl_warning',name:'Avertissement √©crit',cat:'Disciplinaire',icon:'‚ö°',desc:'Premier ou second avertissement formel',fields:['Nom employ√©','Date des faits','Description','Mesures attendues','Sanctions possibles']},
    {id:'tpl_conge',name:'Demande de cong√©',cat:'RH',icon:'üèñÔ∏è',desc:'Formulaire de demande de vacances / cong√©',fields:['Nom employ√©','Type cong√©','Date d√©but','Date fin','Nb jours','Motif']},
    {id:'tpl_expense',name:'Note de frais',cat:'Finance',icon:'üßæ',desc:'Formulaire de remboursement de frais professionnels',fields:['Nom employ√©','Date','Description','Montant','Justificatif','Cat√©gorie']},
    {id:'tpl_eval',name:'√âvaluation annuelle',cat:'RH',icon:'üìä',desc:'Formulaire d\'√©valuation des performances',fields:['Nom employ√©','P√©riode','Objectifs','R√©sultats','Points forts','Axes d\'am√©lioration','Note globale']},
  ];
  
  const cats=[...new Set(templates.map(t=>t.cat))];
  const [catFilter,setCatFilter]=useState('all');
  const filtered=catFilter==='all'?templates:templates.filter(t=>t.cat===catFilter);
  
  const generateDoc=(tpl)=>{
    const emp=ae.find(e=>e.id===selectedEmp);
    const empName=emp?`${emp.first||emp.fn||'Emp'} ${emp.last||''}`.trim():'[NOM]';
    alert(`üìÑ Document "${tpl.name}" g√©n√©r√© pour ${empName}.\n\nEn production, ceci g√©n√©rera un PDF/DOCX pr√©-rempli avec les donn√©es de l'employ√©.`);
  };
  
  return <div>
    <PH title="üìë Mod√®les de Documents" sub={`${templates.length} mod√®les pr√™ts √† l'emploi`}/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:12,marginBottom:16}}>
      <SC label="Mod√®les" value={templates.length} color="#c6a34e"/>
      <SC label="Contrats" value={templates.filter(t=>t.cat==='Contrat').length} color="#60a5fa"/>
      <SC label="Sortie" value={templates.filter(t=>t.cat==='Sortie').length} color="#f87171"/>
      <SC label="RH" value={templates.filter(t=>t.cat==='RH').length} color="#4ade80"/>
      <SC label="L√©gal" value={templates.filter(t=>t.cat==='L√©gal').length} color="#a78bfa"/>
    </div>
    <div style={{display:'flex',gap:6,marginBottom:14,flexWrap:'wrap'}}>
      <button onClick={()=>setCatFilter('all')} style={{padding:'5px 12px',borderRadius:16,border:catFilter==='all'?'1px solid rgba(198,163,78,.3)':'1px solid rgba(198,163,78,.06)',background:catFilter==='all'?'rgba(198,163,78,.1)':'transparent',color:catFilter==='all'?'#c6a34e':'#9e9b93',cursor:'pointer',fontSize:10.5,fontFamily:'inherit'}}>Tous</button>
      {cats.map(c=><button key={c} onClick={()=>setCatFilter(c)} style={{padding:'5px 12px',borderRadius:16,border:catFilter===c?'1px solid rgba(198,163,78,.3)':'1px solid rgba(198,163,78,.06)',background:catFilter===c?'rgba(198,163,78,.1)':'transparent',color:catFilter===c?'#c6a34e':'#9e9b93',cursor:'pointer',fontSize:10.5,fontFamily:'inherit'}}>{c}</button>)}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(280px,1fr))',gap:12}}>
      {filtered.map(tpl=><C key={tpl.id}>
        <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:8}}>
          <span style={{fontSize:24}}>{tpl.icon}</span>
          <div>
            <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>{tpl.name}</div>
            <span style={{fontSize:9,padding:'1px 6px',borderRadius:8,background:'rgba(198,163,78,.06)',color:'#9e9b93'}}>{tpl.cat}</span>
          </div>
        </div>
        <div style={{fontSize:10.5,color:'#5e5c56',lineHeight:1.5,marginBottom:10,minHeight:30}}>{tpl.desc}</div>
        <div style={{display:'flex',gap:4,flexWrap:'wrap',marginBottom:10}}>
          {tpl.fields.map(f=><span key={f} style={{fontSize:8.5,padding:'2px 6px',borderRadius:6,background:'rgba(96,165,250,.06)',color:'#60a5fa'}}>{f}</span>)}
        </div>
        <div style={{display:'flex',gap:6}}>
          <I label="" value={selectedEmp} onChange={setSelectedEmp} options={[{v:'',l:'Choisir employ√©...'},...ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))]}/>
          <B v="gold" style={{fontSize:10,padding:'6px 14px',whiteSpace:'nowrap'}} onClick={()=>generateDoc(tpl)}>G√©n√©rer</B>
        </div>
      </C>)}
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ALERTES L√âGALES ‚Äî Veille juridique et √©ch√©ances
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODULE: DOCUMENTS JURIDIQUES ‚Äî Phase 0 Fiduciaire Sociale
// Convention de Mandat, DPA RGPD, Registre RGPD, Politique Confidentialit√©
// G√©n√©ration PDF c√¥t√© client + envoi email en 1 clic
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function DocumentsJuridiquesMod({s,d}){
  const [selectedDoc,setSelectedDoc]=useState(null);
  const [sending,setSending]=useState(null);
  const [sent,setSent]=useState({});
  const [generating,setGenerating]=useState(null);
  const [generated,setGenerated]=useState({});
  const [emailModal,setEmailModal]=useState(null);
  const [email,setEmail]=useState('');
  const [emailSent,setEmailSent]=useState(false);
  const [previewDoc,setPreviewDoc]=useState(null);

  const client=s.co||{};
  const clientName=client.name||'Client';
  const clientEmail=client.email||'';
  const clientVat=client.vat||'';
  const clientAddr=client.addr||'';
  const clientContact=client.contact||'';
  const clientOnss=client.onss||'';

  const docs=[
    {
      id:"convention_mandat",
      title:'Convention de Mandat',
      subtitle:'Contrat prestataire ‚Äî employeur (ONSS/Mahis)',
      icon:'üìã',
      color:'#c6a34e',
      status:'obligatoire',
      articles:10,
      description:'Contrat √©crit obligatoire entre mandant (employeur) et mandataire (Aureus Social) pour les d√©clarations sociales Dimona/DmfA via MAHIS. Couvre: gestion salariale, d√©clarations ONSS, admin personnel, conseil social.',
      legalRef:'Instructions administratives ONSS ‚Äî Mandataires',
      sections:['Objet du mandat',"Missions (paie, Dimona, DmfA, BELCOTAX, contrats)","Obligations client","Obligations Aureus Social","Limitation responsabilit√©","R√©mun√©ration","Dur√©e & r√©siliation","Transfert mandat","Protection donn√©es","Droit applicable"],
    },
    {
      id:"dpa_rgpd",
      title:'DPA ‚Äî Sous-traitance Donn√©es',
      subtitle:'Contrat art. 28 RGPD + Loi belge 30/7/2018',
      icon:'üîí',
      color:'#60a5fa',
      status:'obligatoire',
      articles:9,
      description:'Contrat obligatoire r√©gissant le traitement des donn√©es personnelles des travailleurs. D√©finit les cat√©gories de donn√©es (NISS, salaires, IBAN, sant√©), les mesures de s√©curit√© (AES-256, 2FA, RLS), les sous-traitants ult√©rieurs et la notification de fuite 24h.',
      legalRef:'Art. 28 R√®glement (UE) 2016/679 (RGPD)',
      sections:['Objet et finalit√©',"6 cat√©gories donn√©es (identification, pro, financi√®res, fiscales, SS, sant√©)","Personnes concern√©es","8 obligations sous-traitant (art. 28.3)","Notification fuite 24h","Transferts internationaux","Dur√©es conservation","Registre traitement","Droit applicable"],
    },
    {
      id:"registre_rgpd",
      title:'Registre de Traitement RGPD',
      subtitle:'Article 30 RGPD ‚Äî Obligatoire',
      icon:'üìä',
      color:'#4ade80',
      status:'obligatoire',
      articles:6,
      description:"Registre documentant les 6 activit√©s de traitement d'Aureus Social: payroll, Dimona/DmfA, BELCOTAX, admin personnel, agent IA, s√©curit√©. Inclut sous-traitants ult√©rieurs (Supabase, Vercel, Anthropic) et mesures art. 32.",
      legalRef:'Art. 30 R√®glement (UE) 2016/679 (RGPD)',
      sections:['Identification sous-traitant',"T1: Gestion salariale","T2: D√©clarations sociales","T3: D√©clarations fiscales","T4: Admin personnel","T5: Agent IA juridique","T6: S√©curit√©","Sous-traitants ult√©rieurs","Mesures techniques art. 32"],
    },
    {
      id:"politique_confidentialite",
      title:'Politique de Confidentialit√©',
      subtitle:'aureussocial.be ‚Äî RGPD conforme',
      icon:'üõ°',
      color:'#f472b6',
      status:'obligatoire',
      articles:10,
      description:'Politique de confidentialit√© compl√®te pour le site web et la plateforme. Couvre: responsable du traitement, donn√©es collect√©es par cat√©gorie, destinataires, transferts internationaux, s√©curit√©, droits des personnes, cookies, r√©clamation APD.',
      legalRef:'Art. 13-14 RGPD + Loi belge 30/7/2018',
      sections:['Responsable traitement',"Champ d'application","Donn√©es & finalit√©s (4 cat√©gories)","Destinataires","Transferts internationaux","S√©curit√© (8 mesures)","Droits (acc√®s, rectification, effacement, portabilit√©, opposition)","Cookies","R√©clamation APD","Modifications"],
    },
  ];

  const generatePDF=(doc)=>{
    setGenerating(doc.id);
    const now=new Date();
    const dateStr=now.toLocaleDateString('fr-BE',{day:'2-digit',month:'2-digit',year:'numeric'});

    // Build HTML content for print/PDF
    let html=`<!DOCTYPE html><html><head><meta charset="utf-8"><title>${doc.title} ‚Äî Aureus Social</title>
    <style>
      @page{margin:2cm;size:A4}
      *{margin:0;padding:0;box-sizing:border-box}
      body{font-family:'Segoe UI',Helvetica,Arial,sans-serif;color:#2D2D2D;font-size:10pt;line-height:1.5}
      .header{border-bottom:2.5px solid #C8A84E;padding-bottom:10px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}
      .header-left{font-weight:700;font-size:12pt;color:#1A1A2E}
      .header-right{font-size:9pt;color:#666}
      h1{font-size:20pt;color:#1A1A2E;text-align:center;margin:30px 0 5px}
      h2{font-size:11pt;color:#C8A84E;text-align:center;margin-bottom:20px}
      .gold-line{border-top:2px solid #C8A84E;margin:15px 0}
      .article{color:#C8A84E;font-weight:700;font-size:10.5pt;margin-top:18px;margin-bottom:6px}
      .section-title{font-weight:700;font-size:11pt;color:#1A1A2E;margin-top:20px;margin-bottom:8px;border-bottom:1px solid #C8A84E;padding-bottom:4px}
      p{margin-bottom:8px;text-align:justify}
      .bold{font-weight:700}
      .field{color:#666;margin-bottom:4px}
      .sig-block{display:flex;gap:40px;margin-top:30px}
      .sig-col{flex:1}
      .sig-line{border-bottom:1px solid #999;height:50px;margin-top:10px}
      .footer{border-top:1px solid #C8A84E;margin-top:40px;padding-top:8px;font-size:8pt;color:#666;display:flex;justify-content:space-between}
      .small{font-size:8.5pt;color:#666}
      table{width:100%;border-collapse:collapse;margin:10px 0}
      th{background:#1A1A2E;color:#fff;padding:6px 8px;font-size:9pt;text-align:left}
      td{padding:5px 8px;font-size:9pt;border:0.5px solid #ccc;background:#f9f9f5}
      .highlight{background:rgba(198,163,78,.05);padding:12px;border-left:3px solid #C8A84E;margin:10px 0}
    </style></head><body>
    <div class="header"><div class="header-left">AUREUS SOCIAL</div><div class="header-right">Fiduciaire Sociale</div></div>`;

    if(doc.id==='convention_mandat'){
      html+=`<h1>CONVENTION DE MANDAT</h1>
      <h2>Gestion Administrative du Personnel et D√©clarations Sociales</h2>
      <div class="gold-line"></div>
      <p><em>Conclue conform√©ment aux articles 1984 √† 2010 du Code civil belge et aux instructions administratives de l'ONSS relatives aux mandataires (prestataires de services sociaux).</em></p>

      <div class="section-title">ENTRE LES PARTIES</div>
      <p class="bold">LE MANDANT (ci-apr√®s ¬´ le Client ¬ª)</p>
      <p class="field">D√©nomination sociale : <b>${clientName}</b></p>
      <p class="field">Num√©ro BCE : <b>${clientVat}</b></p>
      <p class="field">Si√®ge social : <b>${clientAddr}</b></p>
      <p class="field">Repr√©sent√© par : <b>${clientContact}</b></p>
      <p class="field">N¬∞ ONSS employeur : <b>${clientOnss||'____________________'}</b></p>

      <p class="bold" style="margin-top:14px">LE MANDATAIRE (ci-apr√®s ¬´ Aureus Social ¬ª)</p>
      <p class="field">D√©nomination : <b>Aureus IA SPRL</b> (Aureus Social ‚Äî Fiduciaire Sociale)</p>
      <p class="field">BCE : <b>BE 1028.230.781</b> ‚Äî Saint-Gilles, 1060 Bruxelles</p>
      <p class="field">Statut : <b>Prestataire de services sociaux (non agr√©√©)</b></p>

      <div class="article">Article 1 ‚Äî Objet du mandat</div>
      <p>Le Client confie √† Aureus Social la mission de prestataire de services sociaux au sens des instructions administratives de l'ONSS. Le mandat sera notifi√© via l'application MAHIS pour le cluster DmfA-Dimona.</p>

      <div class="article">Article 2 ‚Äî Missions confi√©es</div>
      <p><b>2.1 Gestion salariale</b> ‚Äî Calcul des r√©mun√©rations brutes/nettes, fiches de paie, cotisations ONSS (personnelles + patronales), pr√©compte professionnel SPF Finances, cotisation sp√©ciale SS, bonus √† l'emploi.</p>
      <p><b>2.2 D√©clarations sociales</b> ‚Äî Dimona (IN/OUT/UPDATE, STU, FLX, EXT), DmfA trimestrielle XML, DRS, BELCOTAX fiches 281.10, d√©claration 274 FINPROF.</p>
      <p><b>2.3 Administration du personnel</b> ‚Äî Contrats de travail par CP, calcul pr√©avis (loi Peeters), documents de fin de contrat (C4, certificat, attestation vacances, solde tout compte), gestion absences.</p>
      <p><b>2.4 Conseil social</b> ‚Äî Information g√©n√©rale sur obligations employeur. Recommandation juriste pour cas complexes.</p>

      <div class="article">Article 3 ‚Äî Obligations du Client</div>
      <p>Le Client s'engage √† : (a) transmettre les donn√©es dans les d√©lais ; (b) garantir leur exactitude ; (c) signer la procuration MAHIS via eID ; (d) payer directement les cotisations ONSS et pr√©compte professionnel ; (e) informer de tout changement.</p>

      <div class="article">Article 4 ‚Äî Obligations d'Aureus Social</div>
      <p>Aureus Social s'engage √† : (a) ex√©cuter avec diligence ; (b) respecter les d√©lais l√©gaux ; (c) informer des modifications l√©gislatives ; (d) assurer la confidentialit√© RGPD ; (e) maintenir une RC professionnelle ; (f) restituer les donn√©es en fin de mandat.</p>

      <div class="article">Article 5 ‚Äî Limitation de responsabilit√©</div>
      <p>Responsabilit√© limit√©e au montant des honoraires des 12 derniers mois. Pas de responsabilit√© pour donn√©es inexactes/tardives du Client ou non-paiement des cotisations.</p>

      <div class="article">Article 6 ‚Äî R√©mun√©ration</div>
      <p>Forfait mensuel par travailleur actif : _______ EUR HTVA. TVA 21%. Payable √† r√©ception, d√©lai 30 jours. R√©visable annuellement (indice sant√©).</p>

      <div class="article">Article 7 ‚Äî Dur√©e et r√©siliation</div>
      <p>Dur√©e ind√©termin√©e. Pr√©avis 3 mois, effectif au 1er jour du trimestre suivant (align√© ONSS). R√©siliation imm√©diate pour manquement grave apr√®s mise en demeure 15 jours.</p>

      <div class="article">Article 8 ‚Äî Transfert du mandat</div>
      <p>En fin de mandat : cl√¥ture MAHIS, transmission int√©grale des donn√©es dans format exploitable, continuit√© de service jusqu'√† prise en charge par nouveau mandataire.</p>

      <div class="article">Article 9 ‚Äî Protection des donn√©es</div>
      <p>R√©gi par le DPA annex√© (art. 28 RGPD). NISS utilis√© uniquement pour d√©clarations sociales (loi 3/6/2007).</p>

      <div class="article">Article 10 ‚Äî Droit applicable</div>
      <p>Droit belge. Tribunaux de Bruxelles.</p>

      <div class="sig-block">
        <div class="sig-col"><p class="bold">Pour le Client (Mandant)</p><div class="sig-line"></div><p class="small">Nom : ${clientContact||'____________________'}<br/>Fonction : ____________________<br/>Date : ${dateStr}</p></div>
        <div class="sig-col"><p class="bold">Pour Aureus Social (Mandataire)</p><div class="sig-line"></div><p class="small">Nom : M. Moussati<br/>Fonction : G√©rant<br/>Date : ${dateStr}</p></div>
      </div>
      <p class="small" style="margin-top:20px"><b>Annexes :</b> 1. DPA (art. 28 RGPD) ‚Äî 2. Grille tarifaire ‚Äî 3. Procuration MAHIS</p>`;
    }
    else if(doc.id==='dpa_rgpd'){
      html+=`<h1>CONTRAT DE SOUS-TRAITANCE<br/>DE DONN√âES PERSONNELLES</h1>
      <h2>Article 28 du R√®glement (UE) 2016/679 (RGPD)</h2>
      <div class="gold-line"></div>
      <p><b>Responsable du traitement :</b> ${clientName} (${clientVat})</p>
      <p><b>Sous-traitant :</b> Aureus IA SPRL ‚Äî BE 1028.230.781 ‚Äî Saint-Gilles, Bruxelles</p>

      <div class="article">Article 1 ‚Äî Objet</div>
      <p>Traitement de donn√©es pour : calcul r√©mun√©rations, fiches de paie, Dimona, DmfA, BELCOTAX, admin personnel.</p>

      <div class="article">Article 2 ‚Äî Cat√©gories de donn√©es</div>
      <table><tr><th>Cat√©gorie</th><th>Donn√©es</th></tr>
      <tr><td>Identification</td><td>Nom, pr√©nom, NISS, date naissance, adresse, nationalit√©, √©tat civil</td></tr>
      <tr><td>Professionnelles</td><td>Fonction, CP, contrat, r√©gime, horaire, anciennet√©</td></tr>
      <tr><td>Financi√®res</td><td>R√©mun√©ration brute, IBAN, primes, avantages nature, saisies</td></tr>
      <tr><td>Fiscales</td><td>Situation familiale, personnes √† charge, revenus conjoint</td></tr>
      <tr><td>S√©curit√© sociale</td><td>N¬∞ ONSS, cotisations, jours prest√©s, absences</td></tr>
      <tr><td>Sensibles (art. 9)</td><td>Certificats m√©dicaux, accidents travail (base: art. 9.2.b)</td></tr></table>

      <div class="article">Article 4 ‚Äî Obligations du sous-traitant</div>
      <p>(a) Traitement sur instruction document√©e uniquement ; (b) Confidentialit√© garantie ; (c) Mesures techniques : AES-256, TLS 1.3, 2FA, audit trail, RLS Supabase, h√©bergement UE ; (d) Pas de sous-traitant ult√©rieur sans accord √©crit ; (e) Aide exercice droits (5 jours) ; (f) Aide s√©curit√©/notification/AIPD ; (g) Suppression/restitution en 30 jours ; (h) Audit possible.</p>

      <div class="article">Article 5 ‚Äî Notification fuite</div>
      <div class="highlight"><b>24 heures</b> ‚Äî Notification au Client de toute violation, comprenant : nature, personnes concern√©es, cons√©quences, mesures prises.</div>

      <div class="article">Article 6 ‚Äî Sous-traitants ult√©rieurs</div>
      <table><tr><th>Sous-traitant</th><th>Localisation</th><th>Usage</th></tr>
      <tr><td>Supabase Inc.</td><td>UE (Irlande)</td><td>Base de donn√©es + Auth</td></tr>
      <tr><td>Vercel Inc.</td><td>UE/US CDN</td><td>H√©bergement frontend</td></tr>
      <tr><td>Anthropic PBC</td><td>US</td><td>Agent IA (donn√©es anonymis√©es)</td></tr></table>

      <div class="article">Article 7 ‚Äî Conservation</div>
      <p>Documents sociaux : 5 ans. Fiscaux : 7 ans. Comptables : 7 ans. Contrats : 5 ans. Au-del√† : suppression ou anonymisation irr√©versible.</p>

      <div class="sig-block">
        <div class="sig-col"><p class="bold">Responsable du traitement</p><div class="sig-line"></div><p class="small">${clientContact||'____________________'}<br/>Date : ${dateStr}</p></div>
        <div class="sig-col"><p class="bold">Sous-traitant</p><div class="sig-line"></div><p class="small">M. Moussati ‚Äî Aureus IA SPRL<br/>Date : ${dateStr}</p></div>
      </div>`;
    }
    else if(doc.id==='registre_rgpd'){
      html+=`<h1>REGISTRE DES ACTIVIT√âS<br/>DE TRAITEMENT</h1>
      <h2>Article 30 RGPD ‚Äî Aureus IA SPRL</h2>
      <div class="gold-line"></div>
      <table><tr><th>Champ</th><th>Information</th></tr>
      <tr><td>Sous-traitant</td><td>Aureus IA SPRL ‚Äî BE 1028.230.781</td></tr>
      <tr><td>Adresse</td><td>Saint-Gilles, 1060 Bruxelles</td></tr>
      <tr><td>Contact DPO</td><td>dpo@aureussocial.be</td></tr>
      <tr><td>Date registre</td><td>${dateStr}</td></tr></table>

      ${[
        {n:'T1 ‚Äî Gestion salariale',f:'Calcul r√©mun√©rations, fiches paie, cotisations ONSS, pr√©compte',b:'Obligation l√©gale (art. 6.1.c) + Contrat (art. 6.1.b)',p:'Travailleurs salari√©s',dest:'Client, ONSS, SPF Finances',dur:'5 ans apr√®s fin contrat'},
        {n:'T2 ‚Äî D√©clarations sociales',f:'Dimona IN/OUT, DmfA trimestrielle XML',b:'Obligation l√©gale (AR 5/11/2002)',p:'Travailleurs salari√©s',dest:'ONSS, BCSS',dur:'5 ans apr√®s trimestre'},
        {n:'T3 ‚Äî D√©clarations fiscales',f:'BELCOTAX 281.10, pr√©compte professionnel 274',b:'Obligation l√©gale (CIR/92)',p:'Travailleurs salari√©s',dest:'SPF Finances',dur:'7 ans'},
        {n:'T4 ‚Äî Admin personnel',f:'Registre personnel, contrats, absences, documents fin contrat',b:'Obligation l√©gale + Int√©r√™t l√©gitime',p:'Travailleurs + anciens',dest:'Client, Contr√¥le Lois Sociales',dur:'5 ans apr√®s fin contrat'},
        {n:'T5 ‚Äî Agent IA juridique',f:'Assistance droit social via agent conversationnel',b:'Int√©r√™t l√©gitime (art. 6.1.f)',p:'Utilisateurs plateforme',dest:'Anthropic (anonymis√©)',dur:'30 jours'},
        {n:'T6 ‚Äî S√©curit√©',f:'Authentification, logs acc√®s, d√©tection intrusion',b:'Art. 32 RGPD + Int√©r√™t l√©gitime',p:'Utilisateurs plateforme',dest:'Supabase Auth (UE)',dur:'12 mois logs'},
      ].map(t=>`<div class="section-title">${t.n}</div>
      <table><tr><td><b>Finalit√©</b></td><td>${t.f}</td></tr>
      <tr><td><b>Base l√©gale</b></td><td>${t.b}</td></tr>
      <tr><td><b>Personnes</b></td><td>${t.p}</td></tr>
      <tr><td><b>Destinataires</b></td><td>${t.dest}</td></tr>
      <tr><td><b>Conservation</b></td><td>${t.dur}</td></tr></table>`).join('')}

      <div class="section-title">Mesures de s√©curit√© (art. 32)</div>
      <table><tr><th>Mesure</th><th>Impl√©mentation</th></tr>
      <tr><td>Chiffrement repos</td><td>AES-256 (NISS, IBAN, salaires)</td></tr>
      <tr><td>Chiffrement transit</td><td>TLS 1.3 / HTTPS strict</td></tr>
      <tr><td>Authentification</td><td>2FA obligatoire</td></tr>
      <tr><td>Isolation donn√©es</td><td>Row Level Security Supabase</td></tr>
      <tr><td>Journalisation</td><td>Audit trail complet</td></tr>
      <tr><td>Sauvegarde</td><td>Quotidienne chiffr√©e + hebdo hors-site</td></tr>
      <tr><td>H√©bergement</td><td>Supabase EU (Irlande)</td></tr></table>
      <p class="small" style="margin-top:20px">Registre √©tabli le ${dateStr} ‚Äî M. Moussati, G√©rant, Aureus IA SPRL.</p>`;
    }
    else if(doc.id==='politique_confidentialite'){
      html+=`<h1>POLITIQUE DE CONFIDENTIALIT√â</h1>
      <h2>aureussocial.be ‚Äî Derni√®re mise √† jour : ${dateStr}</h2>
      <div class="gold-line"></div>

      <div class="section-title">1. Responsable du traitement</div>
      <p><b>Aureus IA SPRL</b> ‚Äî BCE BE 1028.230.781 ‚Äî Saint-Gilles, 1060 Bruxelles<br/>Contact : contact@aureussocial.be ‚Äî DPO : dpo@aureussocial.be</p>

      <div class="section-title">2. Donn√©es collect√©es</div>
      <table><tr><th>Cat√©gorie</th><th>Donn√©es</th><th>Base l√©gale</th><th>Conservation</th></tr>
      <tr><td>Visiteurs site</td><td>IP, cookies session</td><td>Int√©r√™t l√©gitime</td><td>12 mois</td></tr>
      <tr><td>Clients</td><td>BCE, adresse, contact, email</td><td>Contrat (art. 6.1.b)</td><td>Contrat + 7 ans</td></tr>
      <tr><td>Travailleurs</td><td>NISS, nom, IBAN, salaire, sant√©</td><td>Obligation l√©gale (art. 6.1.c)</td><td>5-7 ans</td></tr>
      <tr><td>Agent IA</td><td>Questions anonymis√©es</td><td>Int√©r√™t l√©gitime</td><td>30 jours</td></tr></table>

      <div class="section-title">3. Destinataires</div>
      <p>ONSS, SPF Finances, mutuelles, ONEM, ONVA (administrations). Supabase, Vercel (technique). Anthropic (IA, anonymis√©). <b>Aucune vente de donn√©es √† des tiers.</b></p>

      <div class="section-title">4. S√©curit√©</div>
      <p>AES-256, TLS 1.3, 2FA, Row Level Security, audit trail, backup quotidien, h√©bergement UE.</p>

      <div class="section-title">5. Vos droits (RGPD)</div>
      <p>Acc√®s (art. 15), Rectification (art. 16), Effacement (art. 17), Limitation (art. 18), Portabilit√© (art. 20), Opposition (art. 21). Contact : dpo@aureussocial.be ‚Äî R√©ponse sous 30 jours.</p>

      <div class="section-title">6. Cookies</div>
      <p>Uniquement cookies techniques de session. Aucun tracking/publicitaire.</p>

      <div class="section-title">7. R√©clamation</div>
      <p><b>Autorit√© de Protection des Donn√©es (APD)</b><br/>Rue de la Presse 35, 1000 Bruxelles ‚Äî +32 2 274 48 00 ‚Äî contact@apd-gba.be</p>`;
    }

    html+=`<div class="footer"><span>Aureus IA SPRL ‚Äî TVA BE 1028.230.781 ‚Äî Saint-Gilles, Bruxelles</span><span>${dateStr}</span></div></body></html>`;

    // Open in new window for print/save as PDF
    const printWin=window.open('',"_blank","width=800,height=1100");
    if(printWin){
      printWin.document.write(html);
      printWin.document.close();
      setTimeout(()=>{
        printWin.print();
        setGenerating(null);
        setGenerated(prev=>({...prev,[doc.id]:true}));
      },500);
    } else {
      // Fallback: download as HTML
      const blob=new Blob([html],{type:"text/html"});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=url;a.download=`${doc.id}_${clientName.replace(/\s/g,"_")}.html`;
      a.click();URL.revokeObjectURL(url);
      setGenerating(null);
      setGenerated(prev=>({...prev,[doc.id]:true}));
    }
  };

  const openEmailModal=(doc)=>{
    setEmail(clientEmail);
    setEmailModal(doc);
    setEmailSent(false);
  };

  const sendEmail=()=>{
    if(!email||!email.includes('@')){alert('Email invalide');return;}
    setSending(emailModal.id);

    // Simulate email send (in production: call API route /api/send-doc)
    setTimeout(()=>{
      setSending(null);
      setSent(prev=>({...prev,[emailModal.id]:true}));
      setEmailSent(true);
      // In production, this would call:
      // fetch('/api/send-document', { method:"POST", body: JSON.stringify({ docId, email, clientData }) })
    },1500);
  };

  const cardStyle={background:"rgba(255,255,255,.02)",border:'1px solid rgba(198,163,78,.12)',borderRadius:14,overflow:'hidden',transition:'all .2s',cursor:'pointer'};
  const cardHover={border:'1px solid rgba(198,163,78,.3)',background:"rgba(198,163,78,.03)"};

  return <div>
    {/* Header */}
    <C style={{padding:'20px 24px',background:"linear-gradient(135deg,rgba(198,163,78,.06),rgba(198,163,78,.02))"}}>
      <div style={{display:'flex',alignItems:'center',gap:14}}>
        <div style={{width:48,height:48,borderRadius:12,background:"linear-gradient(135deg,#c6a34e,#a08030)",display:'flex',alignItems:'center',justifyContent:'center',fontSize:22}}>‚öñÔ∏è</div>
        <div>
          <div style={{fontWeight:700,fontSize:18}}>Documents Juridiques ‚Äî Phase 0</div>
          <div style={{fontSize:12,color:'#5e5c56',marginTop:2}}>Convention de Mandat, DPA RGPD, Registre RGPD, Politique Confidentialit√©</div>
        </div>
      </div>
      <div style={{display:'flex',gap:8,marginTop:14,flexWrap:'wrap'}}>
        <span style={{fontSize:11,padding:'4px 10px',borderRadius:20,background:"rgba(198,163,78,.1)",color:'#c6a34e',fontWeight:600}}>üìã 4 documents obligatoires</span>
        <span style={{fontSize:11,padding:'4px 10px',borderRadius:20,background:"rgba(74,222,128,.1)",color:'#4ade80',fontWeight:600}}>üîí Conformes RGPD + Loi belge 30/7/2018</span>
        <span style={{fontSize:11,padding:'4px 10px',borderRadius:20,background:"rgba(96,165,250,.1)",color:'#60a5fa',fontWeight:600}}>üñ® G√©n√©rer PDF + ‚úâÔ∏è Envoyer en 1 clic</span>
      </div>
    </C>

    {/* Client info bar */}
    <C style={{marginTop:12,padding:'12px 18px',display:'flex',justifyContent:'space-between',alignItems:'center',background:"rgba(96,165,250,.03)",border:'1px solid rgba(96,165,250,.08)',borderRadius:10}}>
      <div style={{fontSize:12}}>
        <span style={{color:'#5e5c56'}}>Client actif : </span>
        <span style={{fontWeight:700,color:'#60a5fa'}}>{clientName}</span>
        {clientVat&&<span style={{color:'#5e5c56',marginLeft:10}}>({clientVat})</span>}
      </div>
      <div style={{fontSize:11,color:'#5e5c56'}}>
        Les documents seront pr√©-remplis avec les donn√©es du dossier client
      </div>
    </C>

    {/* Document cards */}
    <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:14,marginTop:16}}>
      {docs.map(doc=>{
        const isGenerated=generated[doc.id];
        const isSent=sent[doc.id];
        return <div key={doc.id} style={cardStyle} onMouseEnter={e=>{Object.assign(e.currentTarget.style,cardHover)}} onMouseLeave={e=>{e.currentTarget.style.border='1px solid rgba(198,163,78,.12)';e.currentTarget.style.background='rgba(255,255,255,.02)'}}>
          {/* Card header */}
          <div style={{padding:'16px 18px',borderBottom:'1px solid rgba(198,163,78,.06)',display:'flex',justifyContent:'space-between',alignItems:'flex-start'}}>
            <div style={{display:'flex',gap:12,alignItems:'center'}}>
              <span style={{fontSize:28}}>{doc.icon}</span>
              <div>
                <div style={{fontWeight:700,fontSize:14}}>{doc.title}</div>
                <div style={{fontSize:10,color:doc.color,marginTop:2}}>{doc.subtitle}</div>
              </div>
            </div>
            <span style={{fontSize:9,padding:'3px 8px',borderRadius:12,background:"rgba(239,68,68,.1)",color:'#ef4444',fontWeight:700,textTransform:'uppercase'}}>{doc.status}</span>
          </div>

          {/* Card body */}
          <div style={{padding:'12px 18px'}}>
            <p style={{fontSize:11,color:'#a09c94',lineHeight:1.5,marginBottom:10}}>{doc.description}</p>
            <div style={{fontSize:10,color:'#5e5c56',marginBottom:8}}>
              <span style={{color:'#c6a34e'}}>üìñ</span> {doc.legalRef} ‚Äî <b>{doc.articles} articles</b>
            </div>

            {/* Sections preview */}
            <div style={{display:'flex',flexWrap:'wrap',gap:4,marginBottom:12}}>
              {doc.sections.slice(0,5).map((sec,i)=><span key={i} style={{fontSize:9,padding:'2px 6px',borderRadius:6,background:"rgba(198,163,78,.05)",color:'#8a8578'}}>{sec}</span>)}
              {doc.sections.length>5&&<span style={{fontSize:9,padding:'2px 6px',color:'#5e5c56'}}>+{doc.sections.length-5} autres</span>}
            </div>
          </div>

          {/* Card actions */}
          <div style={{padding:'10px 18px 14px',borderTop:'1px solid rgba(198,163,78,.04)',display:'flex',gap:8}}>
            <button onClick={()=>generatePDF(doc)} disabled={generating===doc.id}
              style={{flex:1,padding:'9px 14px',borderRadius:8,border:'none',cursor:'pointer',fontWeight:600,fontSize:11,fontFamily:'inherit',
                background:generating===doc.id?'rgba(198,163,78,.15)':'linear-gradient(135deg,#c6a34e,#a08030)',
                color:generating===doc.id?'#c6a34e':'#fff',transition:'all .2s'}}>
              {generating===doc.id?'‚è≥ G√©n√©ration...':isGenerated?'‚úÖ Re-g√©n√©rer PDF':'üñ® G√©n√©rer PDF'}
            </button>
            <button onClick={()=>openEmailModal(doc)}
              style={{flex:1,padding:'9px 14px',borderRadius:8,border:'1px solid rgba(198,163,78,.2)',cursor:'pointer',fontWeight:600,fontSize:11,fontFamily:'inherit',
                background:isSent?'rgba(74,222,128,.08)':'transparent',
                color:isSent?'#4ade80':'#c6a34e',transition:'all .2s'}}>
              {isSent?'‚úÖ Envoy√©':'‚úâÔ∏è Envoyer au client'}
            </button>
          </div>
        </div>;
      })}
    </div>

    {/* Quick actions */}
    <C style={{marginTop:16,padding:'14px 18px'}}>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
        <div>
          <div style={{fontWeight:700,fontSize:13}}>‚ö° Actions group√©es</div>
          <div style={{fontSize:11,color:'#5e5c56',marginTop:2}}>G√©n√©rer ou envoyer tous les documents d'un coup</div>
        </div>
        <div style={{display:'flex',gap:8}}>
          <button onClick={()=>{docs.forEach((doc,i)=>setTimeout(()=>generatePDF(doc),i*1500))}}
            style={{padding:'10px 20px',borderRadius:8,border:'none',cursor:'pointer',fontWeight:700,fontSize:12,fontFamily:'inherit',background:"linear-gradient(135deg,#c6a34e,#a08030)",color:'#fff'}}>
            üñ® G√©n√©rer les 4 PDF
          </button>
          <button onClick={()=>openEmailModal({id:"all",title:'Tous les documents'})}
            style={{padding:'10px 20px',borderRadius:8,border:'1px solid rgba(198,163,78,.3)',cursor:'pointer',fontWeight:700,fontSize:12,fontFamily:'inherit',background:"transparent",color:'#c6a34e'}}>
            ‚úâÔ∏è Envoyer les 4 au client
          </button>
        </div>
      </div>
    </C>

    {/* Phase 0 checklist */}
    <C style={{marginTop:12,padding:'14px 18px'}}>
      <ST>Phase 0 ‚Äî Checklist documents juridiques</ST>
      {[
        {label:"Convention de Mandat Client",done:generated.convention_mandat,icon:'üìã'},
        {label:"DPA Sous-traitance Donn√©es (art. 28 RGPD)",done:generated.dpa_rgpd,icon:'üîí'},
        {label:"Registre de Traitement RGPD (art. 30)",done:generated.registre_rgpd,icon:'üìä'},
        {label:"Politique de Confidentialit√©",done:generated.politique_confidentialite,icon:'üõ°'},
      ].map((item,i)=><div key={i} style={{display:'flex',alignItems:'center',gap:10,padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.02)'}}>
        <span style={{fontSize:16}}>{item.done?'‚úÖ':'‚¨ú'}</span>
        <span style={{fontSize:16}}>{item.icon}</span>
        <span style={{fontSize:12,fontWeight:item.done?600:400,color:item.done?'#4ade80':'#d4d0c8'}}>{item.label}</span>
        {sent[['convention_mandat',"dpa_rgpd","registre_rgpd","politique_confidentialite"][i]]&&
          <span style={{fontSize:10,padding:'2px 8px',borderRadius:10,background:"rgba(74,222,128,.1)",color:'#4ade80',marginLeft:'auto'}}>‚úâÔ∏è Envoy√©</span>}
      </div>)}
    </C>

    {/* Warning */}
    <C style={{marginTop:12,padding:'12px 18px',fontSize:11,color:'#f59e0b',background:"rgba(245,158,11,.03)",border:'1px solid rgba(245,158,11,.1)',borderRadius:10}}>
      <b>‚ö†Ô∏è Important :</b> Ces documents sont des templates pr√©-remplis avec les donn√©es du dossier client. Faites-les valider par un juriste avant premi√®re utilisation avec de vrais clients. Le Client doit signer la procuration MAHIS s√©par√©ment via eID sur le portail de la s√©curit√© sociale.
    </C>

    {/* Email modal */}
    {emailModal&&<div style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,.7)",zIndex:9999,display:'flex',alignItems:'center',justifyContent:'center'}} onClick={()=>setEmailModal(null)}>
      <div onClick={e=>e.stopPropagation()} style={{background:"#1e1e2e",borderRadius:16,padding:24,width:440,border:'1px solid rgba(198,163,78,.2)',boxShadow:'0 20px 60px rgba(0,0,0,.5)'}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:16}}>
          <div style={{fontWeight:700,fontSize:16}}>‚úâÔ∏è Envoyer {emailModal.id==='all'?'les 4 documents':emailModal.title}</div>
          <button onClick={()=>setEmailModal(null)} style={{background:"none",border:'none',color:'#5e5c56',cursor:'pointer',fontSize:18}}>‚úï</button>
        </div>

        {emailSent?<div style={{textAlign:'center',padding:'30px 0'}}>
          <div style={{fontSize:48,marginBottom:12}}>‚úÖ</div>
          <div style={{fontWeight:700,fontSize:16,color:'#4ade80'}}>Document(s) envoy√©(s) !</div>
          <div style={{fontSize:12,color:'#5e5c56',marginTop:6}}>Un email avec le(s) PDF a √©t√© envoy√© √† <b>{email}</b></div>
          <button onClick={()=>setEmailModal(null)} style={{marginTop:16,padding:'10px 24px',borderRadius:8,border:'none',cursor:'pointer',fontWeight:600,fontSize:12,fontFamily:'inherit',background:"linear-gradient(135deg,#c6a34e,#a08030)",color:'#fff'}}>Fermer</button>
        </div>:<div>
          <div style={{marginBottom:12}}>
            <label style={{fontSize:11,color:'#5e5c56',display:'block',marginBottom:4}}>Email du client</label>
            <input type="email" value={email} onChange={e=>setEmail(e.target.value)} placeholder="client@example.com"
              style={{width:'100%',padding:'10px 14px',borderRadius:8,border:'1px solid rgba(198,163,78,.2)',background:"rgba(255,255,255,.03)",color:'#d4d0c8',fontSize:13,fontFamily:'inherit',outline:'none'}}/>
          </div>
          <div style={{fontSize:11,color:'#5e5c56',marginBottom:16,padding:'10px 12px',background:"rgba(96,165,250,.03)",borderRadius:8,border:'1px solid rgba(96,165,250,.08)'}}>
            üìé Le PDF sera pr√©-rempli avec les donn√©es de <b>{clientName}</b> ({clientVat}) et envoy√© en pi√®ce jointe.
          </div>
          <div style={{display:'flex',gap:8}}>
            <button onClick={()=>setEmailModal(null)} style={{flex:1,padding:'10px',borderRadius:8,border:'1px solid rgba(198,163,78,.15)',cursor:'pointer',fontWeight:600,fontSize:12,fontFamily:'inherit',background:"transparent",color:'#5e5c56'}}>Annuler</button>
            <button onClick={sendEmail} disabled={sending}
              style={{flex:1,padding:'10px',borderRadius:8,border:'none',cursor:'pointer',fontWeight:700,fontSize:12,fontFamily:'inherit',background:"linear-gradient(135deg,#c6a34e,#a08030)",color:'#fff'}}>
              {sending?'‚è≥ Envoi en cours...':'‚úâÔ∏è Envoyer maintenant'}
            </button>
          </div>
        </div>}
      </div>
    </div>}
  </div>;
}

function AlertesLegalesMod({s,d}){
  const now=new Date();
  const m=now.getMonth()+1;const y=now.getFullYear();
  const trim=Math.ceil(m/3);
  
  // ‚îÄ‚îÄ STATE POUR VEILLE AUTO ‚îÄ‚îÄ
  const [veille,setVeille]=useState(null); // r√©sultats de la derni√®re veille
  const [veilleLoading,setVeilleLoading]=useState(false);
  const [veilleError,setVeilleError]=useState('');
  const [veilleDate,setVeilleDate]=useState(null);
  const [veilleLog,setVeilleLog]=useState([]);
  const [showVeille,setShowVeille]=useState(false);
  
  const alertes=[
    // ‚îÄ‚îÄ √âCH√âANCES R√âCURRENTES ‚îÄ‚îÄ
    {type:"echeance",urgence:'haute',date:`05/${String(m<12?m+1:1).padStart(2,"0")}/${m<12?y:y+1}`,titre:"Provisions ONSS mensuelles",desc:`Paiement provisions au 5 du mois suivant (Art. 34 AR ONSS). Montant = 30-35% des cotisations trimestrielles.`,categorie:'ONSS',source:'onss.be'},
    {type:"echeance",urgence:'haute',date:trim===1?`15/04/${y}`:trim===2?`15/07/${y}`:trim===3?`15/10/${y}`:`15/01/${y+1}`,titre:`PP 274 ‚Äî T${trim}/${y}`,desc:`D√©claration et paiement du pr√©compte professionnel via FinProf (SPF Finances). Secr√©tariats sociaux: avant-dernier jour ouvrable du mois suivant.`,categorie:'Fiscal',source:'finances.belgium.be'},
    {type:"echeance",urgence:'haute',date:trim===1?`30/04/${y}`:trim===2?`31/07/${y}`:trim===3?`31/10/${y}`:`31/01/${y+1}`,titre:`DmfA T${trim}/${y}`,desc:`D√©claration multif. ONSS ‚Äî trimestrielle via batch ou portail socialsecurity.be. Solde des cotisations d√ª le dernier jour du mois suivant le trimestre.`,categorie:'ONSS',source:'socialsecurity.be'},
    {type:"echeance",urgence:'moyenne',date:'28/02/'+y,titre:"Belcotax ‚Äî Fiches 281",desc:"Envoi des fiches fiscales 281.10 (salari√©s) et 281.20 (dirigeants) via Belcotax on web ‚Äî D√©lai l√©gal: 28/02.",categorie:'Fiscal',source:'belcotaxonweb.be'},
    {type:"echeance",urgence:'moyenne',date:'31/03/'+y,titre:"Bilan social BNB",desc:"D√©p√¥t du bilan social (annexe au bilan annuel) aupr√®s de la BNB ‚Äî entreprises > 20 ETP.",categorie:'BNB',source:'nbb.be'},
    {type:"echeance",urgence:'moyenne',date:'30/04/'+y,titre:"Cotis. vacances ouvriers (10,27%)",desc:"Cotisation annuelle vacances ouvriers (10,27% sur masse salariale brute 108% ann√©e N-1). Pay√©e par l'employeur √† l'ONVA ou caisse sectorielle.",categorie:'ONSS',source:'onss.be'},
    {type:"echeance",urgence:'basse',date:'31/10/'+y,titre:"Cotisation Wijninckx",desc:`Cotisation sp√©ciale 12,5% (depuis 2026 ‚Äî ex 3%) sur pensions compl√©mentaires √©lev√©es. Sigedis calcule via DB2P, paiement √† l'ONSS avant 31/12.`,categorie:'ONSS',source:'db2p.be'},
    {type:"echeance",urgence:'basse',date:`31/01/${y+1}`,titre:"Statistiques INS",desc:"D√©claration statistique annuelle sur les salaires et les conditions de travail (INS/Statbel).",categorie:'Statistiques',source:'statbel.fgov.be'},
    
    // ‚îÄ‚îÄ NOUVEAUT√âS 2026 ‚îÄ‚îÄ
    {type:"legal",urgence:'haute',date:'01/01/2026',titre:"Ch√®ques-repas ‚Üí 10‚Ç¨ max",desc:"Valeur max augment√©e de 8‚Ç¨ √† 10‚Ç¨ (empl 8,91‚Ç¨ + trav 1,09‚Ç¨). D√©ductibilit√© fiscale: 4‚Ç¨/ch√®que (si empl paie max). N√©cessite CCT sectorielle ou avenant CTI. Norme salariale 0%: seule augmentation de max 2‚Ç¨ exclue.",categorie:'R√©mun√©ration',source:'Liantis + Moniteur 30/12/2025'},
    {type:"legal",urgence:'haute',date:'01/01/2026',titre:"Wijninckx ‚Üí 12,5%",desc:"Cotisation sp√©ciale pensions compl√©mentaires √©lev√©es passe de 3% √† 12,5% (Loi 18/12/2025 ‚Äî M.B. 30/12/2025). Applicable d√®s ann√©e de cotisation 2026. Objectif pension: 97.548‚Ç¨/an.",categorie:'Pension',source:'Partena ‚Äî Loi 18/12/2025'},
    {type:"legal",urgence:'haute',date:'01/01/2026',titre:"√âtudiant ‚Üí 650h/an",desc:"Contingent √©tudiant augment√© de 600h √† 650h/an. Pas de PP sur les 650 premi√®res heures (Annexe III 2026). Cotisation solidarit√© 2,71% + 5,42%.",categorie:'Contrats',source:'Securex + Annexe III'},
    {type:"legal",urgence:'haute',date:'01/04/2026',titre:"HS volontaires ‚Üí 360h/an (NOUVEAU)",desc:"Nouveau r√©gime unique: 360h/an (450h horeca). 240h brut=net (pas de sursalaire, pas ONSS, pas PP). Accord √©crit 1 an, reconduction tacite. R√©siliation pr√©avis 1 mois. TP: 3 ans anciennet√© + surcro√Æt temporaire.",categorie:'Dur√©e travail',source:'CM 05/12/2025 + avant-projet loi'},
    {type:"legal",urgence:'moyenne',date:'01/01-31/03/2026',titre:"Heures relance (transitoire T1)",desc:"120h de relance encore utilisables jusqu'au 31/03/2026 (brut=net). Accord √©crit obligatoire. ATTENTION: d√©duites du quota 240h brut=net du nouveau r√©gime √† partir du 01/04.",categorie:'Dur√©e travail',source:'Dynamik HR + Partena'},
    {type:"legal",urgence:'haute',date:'01/01/2026',titre:"HS fiscalement avantageuses ‚Üí 180h",desc:"Contingent structurel de 180 heures suppl√©mentaires avec sursalaire b√©n√©ficiant de la dispense PP employeur + r√©duction PP travailleur (Art.154bis CIR). Construction avec EPRE: 180h aussi (fin r√©gime sp√©cifique).",categorie:'Fiscal',source:'Accord Arizona + Securex'},
    {type:"legal",urgence:'moyenne',date:'01/01/2026',titre:"Cotisation ch√¥mage temporaire ‚Üí 0,09%",desc:"La cotisation patronale pour le ch√¥mage temporaire diminue √† 0,09% pour T1/2026 (FEB).",categorie:'ONSS',source:'VBO-FEB T1/2026'},
    {type:"legal",urgence:'basse',date:'T1-T3 2026',titre:"Cotisation Fonds amiante",desc:"Cotisation Fonds amiante due uniquement pour les 3 premiers trimestres de 2026 (FEB).",categorie:'ONSS',source:'VBO-FEB T1/2026'},
    {type:"legal",urgence:'basse',date:'2026',titre:"Cotisation FFE (Fonds Fermeture)",desc:"FFE classique: 0,32% (<20 trav.) / 0,37% (‚â•20 trav.) pour 2026. V√©rifier par CP.",categorie:'ONSS',source:'VBO-FEB T1/2026'},
    
    // ‚îÄ‚îÄ R√âFORMES √Ä VENIR (VEILLE) ‚îÄ‚îÄ
    {type:"veille",urgence:'info',date:'2026-2030',titre:"Quotit√© exempt√©e ‚Üí 15.600‚Ç¨ progressif",desc:"Augmentation progressive de la quotit√© exempt√©e de 10.900‚Ç¨ √† 15.600‚Ç¨ d'ici revenus 2030. Premiers paliers d√®s 2026. Impact sur PP: r√©duction progressive.",categorie:'Fiscal',source:'Projet loi IPP ‚Äî Securex'},
    {type:"veille",urgence:'info',date:'2027-2030',titre:"Suppression quotient conjugal",desc:"Suppression progressive du quotient conjugal d√®s exercice d'imposition 2027. Avantage r√©duit de moiti√© apr√®s 4 ans. Impact sur bar√®me 2 (mari√© 1 revenu).",categorie:'Fiscal',source:'Projet loi IPP ‚Äî Securex'},
    {type:"veille",urgence:'info',date:'2026',titre:"Bonus/Malus pension",desc:"Nouveau syst√®me bonus 2-5%/an pour report pension, malus pour anticipation. Remplace ancien bonus pension supprim√©. Entr√©e: 2026-2040 progressif.",categorie:'Pension',source:'Projet loi r√©forme pensions'},
    {type:"veille",urgence:'info',date:'2026',titre:"Plafond indexation 4.000‚Ç¨",desc:"L'accord de gouvernement pr√©voit un plafond de 4.000‚Ç¨ brut pour le calcul de l'indexation automatique. Pas encore l√©gislatif.",categorie:'R√©mun√©ration',source:'Accord Arizona'},
    
    // ‚îÄ‚îÄ INDEXATIONS ‚îÄ‚îÄ
    {type:"indexation",urgence:'info',date:'01/01/'+y,titre:"Index CP 200 (auxiliaire employ√©s)",desc:"Indexation de 2,21% au 01/01/2026. Adaptation automatique des bar√®mes A/B/C/D.",categorie:'Bar√®mes',source:'salairesminimums.be'},
    {type:"indexation",urgence:'info',date:'Trimestriel',titre:"Index CP 124 Construction",desc:"Indexation trimestrielle. V√©rifier les taux horaires cat√©gories I‚ÜíChef IV.",categorie:'Bar√®mes',source:'salairesminimums.be'},
    {type:"indexation",urgence:'info',date:'01/01/'+y,titre:"Index CP 302 Horeca",desc:"Indexation au 01/01/2026. Cat√©gories I-V par anciennet√©.",categorie:'Bar√®mes',source:'salairesminimums.be'},
    
    // ‚îÄ‚îÄ PERMANENTS ‚îÄ‚îÄ
    {type:"echeance",urgence:'haute',date:'Permanent',titre:"Dimona IN/OUT obligatoire",desc:"Dimona IN au plus tard le jour de l'entr√©e en service. Dimona OUT le dernier jour. Amende: 2.750‚Ç¨ √† 13.750‚Ç¨ par infraction.",categorie:'ONSS',source:'Art. 7 AR 05/11/2002'},
    {type:"echeance",urgence:'moyenne',date:'Mensuel (25)',titre:"Paiement salaires",desc:"Salaire vers√© au plus tard le dernier jour ouvrable du mois (Art. 5 Loi 12/04/1965). Ex√©cution SEPA: date cible le 25.",categorie:'Paie',source:'Loi 12/04/1965'},
    {type:"legal",urgence:'basse',date:'Permanent',titre:"Moniteur belge ‚Äî Veille quotidienne",desc:"Surveiller: AR pr√©compte (jan.), CCT sectorielles, circulaires ONSS (trimestrielles), circulaires SPF Finances.",categorie:'Veille',source:'ejustice.just.fgov.be'},
  ];
  
  const urgColors={haute:'#f87171',moyenne:'#fb923c',basse:'#60a5fa',info:"#9e9b93"};
  const urgLabels={haute:'üî¥ Urgente',moyenne:'üü† √Ä planifier',basse:'üîµ Rappel',info:"‚ÑπÔ∏è Info"};
  const [filter,setFilter]=useState('all');
  
  // ‚îÄ‚îÄ Merge veille results with static alerts ‚îÄ‚îÄ
  const allAlertes = veille && veille.alertes ? [...alertes, ...veille.alertes.filter(va=>!alertes.some(a=>a.titre===va.titre))] : alertes;
  const filtered=filter==='all'?allAlertes:allAlertes.filter(a=>a.type===filter);

  // ‚îÄ‚îÄ VEILLE AUTOMATIQUE ‚Äî Claude API + Web Search ‚îÄ‚îÄ
  const runVeille = async () => {
    setVeilleLoading(true);
    setVeilleError('');
    setVeilleLog([]);
    const addLog = (msg) => setVeilleLog(prev=>[...prev, {t:new Date().toLocaleTimeString('fr-BE',{hour:'2-digit',minute:'2-digit',second:"2-digit"}), msg}]);
    
    addLog('üîç Lancement de la veille l√©gale belge...');
    
    const SOURCES = [
      'cotisations ONSS 2026 taux belgique nouveaut√©s',
      'pr√©compte professionnel bar√®me 2026 belgique Annexe III',
      'droit social belgique 2026 nouvelles lois moniteur belge arr√™t√© royal',
      'indexation salaires belgique 2026 commissions paritaires index sant√© pivot',
      'r√©forme pension belgique 2026 bonus malus arizona Wijninckx',
      'Fedris accidents travail cotisation tarification 2026 belgique',
      'ONVA vacances annuelles ouvriers taux 2026 p√©cule',
      'FLA federal learning account obligation formation employeur belgique 2026',
      'cotisation sp√©ciale s√©curit√© sociale 2026 belgique bar√®me suppression progressive',
      'DMFA DRS belgique 2026 modifications formulaires socialsecurity',
    ];
    
    try {
      addLog('üì° Interrogation Claude + recherche web sur 5 sources...');
      
      const systemPrompt = `Tu es un expert en droit social belge et en l√©gislation du travail. Tu dois analyser les r√©sultats de recherche web pour identifier les CHANGEMENTS L√âGISLATIFS R√âCENTS en Belgique concernant:
- Taux ONSS (cotisations patronales et personnelles)
- Pr√©compte professionnel (bar√®mes, tranches, quotit√© exempt√©e)
- Ch√®ques-repas, √©co-ch√®ques, avantages
- Contrats d'√©tudiant (contingent heures)
- Heures suppl√©mentaires (contingent fiscal, volontaires)
- Cotisation Wijninckx (pension compl√©mentaire)
- Indexations salariales par CP
- R√©formes en cours (Arizona, pensions, quotient conjugal)

PARAM√àTRES ACTUELS √Ä V√âRIFIER:
- ONSS travailleur: 13,07%
- ONSS employeur marchand: 25,00% (facial, post tax-shift)
- ONSS employeur non-marchand: 32,40% (Maribel social)
- Quotit√© exempt√©e: 10.900‚Ç¨
- Frais prof. forfaitaires: 30%, max 5.930‚Ç¨
- Ch√®ques-repas max: 10‚Ç¨ (8,91‚Ç¨ empl + 1,09‚Ç¨ trav)
- √âco-ch√®ques: 250‚Ç¨/an max
- HS fiscalement avantageuses: 180h/an
- HS volontaires: 360h/an (240h brut=net) depuis 01/04/2026
- √âtudiant: 650h/an
- Wijninckx: 12,5% (depuis 2026)
- Bonus emploi volet A: max 132,92‚Ç¨, seuil 3.340,44‚Ç¨
- Bonus emploi volet B: max 123,08‚Ç¨, seuil 2.833,27‚Ç¨
- CSS isol√© max: 60,94‚Ç¨/mois (182,82‚Ç¨/trim)
- CSS m√©nage 2 revenus max: 51,64‚Ç¨/mois (154,92‚Ç¨/trim)
- Vacances ouvriers cotis: 10,27% (brut 108% ann√©e N-1)
- FFE petites entreprises: 0,32%
- FFE grandes entreprises: 0,37%
- Ch√¥mage temporaire cotis: 0,09%
- Index sant√© pivot: v√©rifier le dernier d√©passement
- FLA (Federal Learning Account): obligation active depuis 01/04/2024
- Fedris: v√©rifier taux AT par secteur
- Flexi-jobs cotis patronale: 28%
- √âtudiant cotis solidarit√©: 2,71% perso + 5,42% patronale

R√©ponds UNIQUEMENT en JSON valide (pas de markdown, pas de backticks) avec cette structure:
{
  "date_analyse": "date ISO",
  "parametres_verifies": [
    {"param": "nom du param√®tre", "valeur_actuelle": "valeur dans l'app", "valeur_trouvee": "valeur trouv√©e", "statut": "OK|CHANG√â|NOUVEAU", "source": "url ou nom source", "detail": "explication si chang√©"}
  ],
  "nouvelles_alertes": [
    {"type": "legal|veille|indexation", "urgence": "haute|moyenne|basse|info", "date": "date", "titre": "titre court", "desc": "description compl√®te", "categorie": "cat√©gorie", "source": "source"}
  ],
  "resume": "r√©sum√© en 2-3 phrases des changements d√©tect√©s ou confirmation que tout est √† jour"
}`;

      const response = await fetch("/api/agent", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          messages: [{ role: "user", content: `Effectue une veille l√©gislative compl√®te sur le droit social belge. Voici les sources √† v√©rifier: ${SOURCES.join(', ')}. Date d'aujourd'hui: ${new Date().toLocaleDateString('fr-BE')}. V√©rifie si les param√®tres de paie belges sont toujours √† jour pour ${y}. R√©ponds UNIQUEMENT en JSON valide.` }],
          lang: 'fr'
        })
      });
      
      addLog('üì• R√©ponse re√ßue de Claude...');
      
      if (!response.ok) {
        const errText = await response.text();
        throw new Error(`API error ${response.status}: ${errText.substring(0,200)}`);
      }
      
      const data = await response.json();
      if(data.error)throw new Error(data.error);
      
      // Extract text from response (route returns {text:...})
      const fullText = data.text || '';
      
      addLog('üîé Analyse des r√©sultats...');
      
      // Parse JSON response
      let parsed = null;
      try {
        const clean = fullText.replace(/```json|```/g, "").trim();
        // Find JSON object in the text
        const jsonMatch = clean.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          parsed = JSON.parse(jsonMatch[0]);
        }
      } catch(parseErr) {
        addLog('‚ö†Ô∏è R√©sultats en texte brut (pas de JSON structur√©)');
        parsed = { resume: fullText, parametres_verifies: [], nouvelles_alertes: [] };
      }
      
      if (parsed) {
        // Process parameter changes
        const changes = (parsed.parametres_verifies||[]).filter(p=>p.statut==='CHANG√â');
        const newAlerts = parsed.nouvelles_alertes||[];
        
        if (changes.length > 0) {
          addLog(`‚ö†Ô∏è ${changes.length} PARAM√àTRE(S) MODIFI√â(S) D√âTECT√â(S) !`);
          changes.forEach(c => addLog(`  ‚Üí ${c.param}: ${c.valeur_actuelle} ‚Üí ${c.valeur_trouvee} (${c.source})`));
        } else {
          addLog('‚úÖ Tous les param√®tres sont √† jour !');
        }
        
        if (newAlerts.length > 0) {
          addLog(`üì¢ ${newAlerts.length} nouvelle(s) alerte(s) ajout√©e(s)`);
        }
        
        // Format for state
        const veilleResult = {
          date: new Date().toISOString(),
          parametres: parsed.parametres_verifies || [],
          alertes: newAlerts.map(a=>({...a, fromVeille:true})),
          resume: parsed.resume || 'Veille effectu√©e.',
          changes: changes,
        };
        
        setVeille(veilleResult);
        setVeilleDate(new Date());
        
        // Save to persistent storage
        try {
          try { localStorage.setItem('aureus-veille-latest', JSON.stringify(veilleResult)); } catch(e) {}
        } catch(e){}
        
        addLog('üíæ R√©sultats sauvegard√©s.');
        addLog('‚úÖ Veille termin√©e avec succ√®s !');
      }
      
    } catch(err) {
      console.error('Veille error:', err);
      setVeilleError(err.message || 'Erreur lors de la veille');
      addLog(`‚ùå Erreur: ${err.message}`);
    }
    
    setVeilleLoading(false);
  };
  
  // Load last veille on mount
  useEffect(()=>{
    (async()=>{
      try {
        if (typeof window === 'undefined') return;
        const val = localStorage.getItem('aureus-veille-latest');
        if(val) {
          const data = JSON.parse(val);
          setVeille(data);
          setVeilleDate(new Date(data.date));
        }
      } catch(e){}
    })();
  },[]);
  
  // Calendrier FinProf PP
  const calPP=[
    {periode:'T4/2025',deadline:'15/01/2026'},
    {periode:'T1/2026',deadline:'15/04/2026'},
    {periode:'T2/2026',deadline:'15/07/2026'},
    {periode:'T3/2026',deadline:'15/10/2026'},
    {periode:'T4/2026',deadline:'15/01/2027'},
  ];
  // Calendrier ONSS
  const calONSS=[
    {periode:'T4/2025',deadline:'31/01/2026',dmfa:'31/01/2026'},
    {periode:'T1/2026',deadline:'30/04/2026',dmfa:'30/04/2026'},
    {periode:'T2/2026',deadline:'31/07/2026',dmfa:'31/07/2026'},
    {periode:'T3/2026',deadline:'31/10/2026',dmfa:'31/10/2026'},
    {periode:'T4/2026',deadline:'31/01/2027',dmfa:'31/01/2027'},
  ];
  
  return <div>
    <PH title="Veille l√©gale & Calendrier 2026" sub="Institutions ‚Äî √âch√©ances ‚Äî Nouveaut√©s l√©gislatives ‚Äî Sources" actions={
      <button onClick={runVeille} disabled={veilleLoading} style={{padding:'10px 20px',borderRadius:10,background:veilleLoading?'rgba(198,163,78,.08)':'linear-gradient(135deg,#c6a34e,#a8893d)',color:veilleLoading?'#c6a34e':'#060810',border:'none',fontWeight:700,fontSize:12.5,cursor:veilleLoading?'wait':'pointer',fontFamily:'inherit',display:'flex',alignItems:'center',gap:8}}>
        {veilleLoading?<><span style={{animation:'spin 1s linear infinite',display:'inline-block'}}>‚ü≥</span> Veille en cours...</>:'üîÑ Actualiser la veille l√©gale'}
      </button>
    }/>
    
    {/* ‚îÄ‚îÄ PANNEAU VEILLE AGENT IA ‚îÄ‚îÄ */}
    {(veilleLoading || veilleLog.length>0 || veille) && <C style={{marginBottom:18,border:'1px solid rgba(198,163,78,.2)'}}>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}}>
        <div style={{display:'flex',alignItems:'center',gap:10}}>
          <div style={{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg,#c6a34e,#a8893d)",display:'flex',alignItems:'center',justifyContent:'center',fontSize:18}}>ü§ñ</div>
          <div>
            <div style={{fontSize:14,fontWeight:700,color:'#e2c878'}}>Agent Veille L√©gale</div>
            <div style={{fontSize:10.5,color:'#8b7340'}}>Claude + Web Search ‚Äî Monitoring droit social belge</div>
          </div>
        </div>
        {veilleDate && <div style={{fontSize:10,color:'#4ade80'}}>
          Derni√®re maj: {veilleDate.toLocaleDateString('fr-BE')} √† {veilleDate.toLocaleTimeString('fr-BE',{hour:'2-digit',minute:'2-digit'})}
        </div>}
      </div>
      
      {/* LOG EN TEMPS R√âEL */}
      {veilleLog.length>0 && <div style={{background:"rgba(0,0,0,.3)",borderRadius:8,padding:12,marginBottom:12,maxHeight:180,overflowY:'auto',fontFamily:'monospace',fontSize:11}}>
        {veilleLog.map((l,i)=><div key={i} style={{padding:'2px 0',color:l.msg.includes('‚ùå')?'#f87171':l.msg.includes('‚ö†Ô∏è')?'#fb923c':l.msg.includes('‚úÖ')?'#4ade80':'#9e9b93'}}>
          <span style={{color:'#5e5c56',marginRight:8}}>[{l.t}]</span>{l.msg}
        </div>)}
        {veilleLoading && <div style={{color:'#c6a34e',animation:'pulse 1.5s infinite'}}>‚è≥ En attente de r√©ponse...</div>}
      </div>}
      
      {/* ERREUR */}
      {veilleError && <div style={{padding:'10px 14px',background:"rgba(248,113,113,.08)",border:'1px solid rgba(248,113,113,.2)',borderRadius:8,marginBottom:12,fontSize:12,color:'#f87171'}}>
        ‚ùå {veilleError}
      </div>}
      
      {/* R√âSULTATS DE LA VEILLE */}
      {veille && !veilleLoading && <>
        {/* R√âSUM√â */}
        <div style={{padding:'12px 16px',background:"rgba(74,222,128,.06)",border:'1px solid rgba(74,222,128,.15)',borderRadius:10,marginBottom:14,fontSize:12.5,color:'#d4d0c8',lineHeight:1.6}}>
          <div style={{fontWeight:700,color:'#4ade80',marginBottom:6}}>üìã R√©sum√© de la veille</div>
          {veille.resume}
        </div>
        
        {/* PARAM√àTRES V√âRIFI√âS */}
        {veille.parametres && veille.parametres.length > 0 && <div style={{marginBottom:14}}>
          <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:8}}>üìä Param√®tres v√©rifi√©s ({veille.parametres.length})</div>
          <div style={{display:'grid',gap:4}}>
            {veille.parametres.map((p,i)=><div key={i} style={{display:'flex',alignItems:'center',gap:10,padding:'8px 12px',background:"rgba(198,163,78,.03)",borderRadius:6,borderLeft:`3px solid ${p.statut==='OK'?'#4ade80':p.statut==='CHANG√â'?'#f87171':'#fb923c'}`,fontSize:11.5}}>
              <span style={{fontWeight:600,color:p.statut==='OK'?'#4ade80':p.statut==='CHANG√â'?'#f87171':'#fb923c',width:16}}>{p.statut==='OK'?'‚úÖ':p.statut==='CHANG√â'?'‚ö†Ô∏è':'üÜï'}</span>
              <span style={{color:'#e8e6e0',flex:1}}>{p.param}</span>
              <span style={{fontFamily:'monospace',color:'#c6a34e'}}>{p.valeur_trouvee || p.valeur_actuelle}</span>
              {p.statut==='CHANG√â'&&<span style={{fontSize:10,color:'#f87171'}}>‚Üê √©tait: {p.valeur_actuelle}</span>}
              {p.source&&<span style={{fontSize:9.5,color:'#60a5fa'}}>({p.source})</span>}
            </div>)}
          </div>
        </div>}
        
        {/* CHANGEMENTS D√âTECT√âS */}
        {veille.changes && veille.changes.length > 0 && <div style={{padding:'12px 16px',background:"rgba(248,113,113,.06)",border:'1px solid rgba(248,113,113,.2)',borderRadius:10,marginBottom:14}}>
          <div style={{fontSize:12,fontWeight:700,color:'#f87171',marginBottom:8}}>‚ö†Ô∏è CHANGEMENTS D√âTECT√âS ‚Äî Action requise</div>
          {veille.changes.map((c,i)=><div key={i} style={{padding:'6px 0',borderBottom:'1px solid rgba(248,113,113,.1)',fontSize:12,color:'#d4d0c8'}}>
            <b>{c.param}:</b> {c.valeur_actuelle} ‚Üí <b style={{color:'#f87171'}}>{c.valeur_trouvee}</b>
            {c.detail&&<div style={{fontSize:11,color:'#9e9b93',marginTop:2}}>{c.detail}</div>}
          </div>)}
        </div>}
        
        {/* NOUVELLES ALERTES DE LA VEILLE */}
        {veille.alertes && veille.alertes.length > 0 && <div style={{marginBottom:14}}>
          <div style={{fontSize:12,fontWeight:600,color:'#fb923c',marginBottom:8}}>üì¢ Nouvelles alertes d√©tect√©es ({veille.alertes.length})</div>
          {veille.alertes.map((a,i)=><div key={i} style={{padding:'10px 14px',background:"rgba(198,163,78,.03)",border:'1px solid rgba(198,163,78,.08)',borderRadius:8,borderLeft:`3px solid ${urgColors[a.urgence]||'#9e9b93'}`,marginBottom:6}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
              <span style={{fontSize:12.5,fontWeight:600,color:'#e8e6e0'}}>{a.titre} <span style={{fontSize:10,color:'#4ade80',background:"rgba(74,222,128,.1)",padding:'2px 6px',borderRadius:4,marginLeft:6}}>NOUVEAU</span></span>
              <span style={{fontSize:10,color:urgColors[a.urgence]}}>{urgLabels[a.urgence]}</span>
            </div>
            <div style={{fontSize:11,color:'#9e9b93',marginTop:4}}>{a.desc}</div>
          </div>)}
        </div>}
      </>}
    </C>}
    
    <style>{`@keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }`}</style>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <div>
      <C>
        <ST>Filtrer</ST>
        {[{v:"all",l:"üìã Tout ("+alertes.length+')'},{v:"echeance",l:"üìÖ √âch√©ances"},{v:"legal",l:"‚öñÔ∏è Nouveaut√©s 2026"},{v:"veille",l:"üîÆ R√©formes √† venir"},{v:"indexation",l:"üìà Indexations"}].map(x=>
          <button key={x.v} onClick={()=>setFilter(x.v)} style={{display:'block',width:'100%',padding:'9px 12px',marginBottom:4,border:filter===x.v?'1px solid rgba(198,163,78,.3)':'1px solid rgba(198,163,78,.06)',borderRadius:7,background:filter===x.v?'rgba(198,163,78,.1)':'rgba(198,163,78,.02)',color:filter===x.v?'#c6a34e':'#9e9b93',cursor:'pointer',fontSize:12,textAlign:'left',fontFamily:'inherit',fontWeight:filter===x.v?600:400}}>{x.l}</button>
        )}
        <div style={{marginTop:14,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:11,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>R√©sum√©</div>
          <div>üî¥ Urgentes: <b style={{color:'#f87171'}}>{alertes.filter(a=>a.urgence==='haute').length}</b></div>
          <div>üü† √Ä planifier: <b style={{color:'#fb923c'}}>{alertes.filter(a=>a.urgence==='moyenne').length}</b></div>
          <div>üîµ Rappels: <b style={{color:'#60a5fa'}}>{alertes.filter(a=>a.urgence==='basse').length}</b></div>
          <div>‚ÑπÔ∏è Veille: <b style={{color:'#9e9b93'}}>{alertes.filter(a=>a.urgence==='info').length}</b></div>
        </div>
      </C>

      {/* CALENDRIER PP FINPROF */}
      <C style={{marginTop:14}}>
        <ST>üìÖ Calendrier PP (FinProf)</ST>
        <div style={{fontSize:10.5,color:'#9e9b93',lineHeight:1.8}}>
          {calPP.map((c,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'3px 0',borderBottom:'1px solid rgba(198,163,78,.06)'}}>
            <span>{c.periode}</span><b style={{color:'#c6a34e'}}>{c.deadline}</b>
          </div>)}
          <div style={{marginTop:6,fontSize:9.5,color:'#60a5fa'}}>SPF Finances ‚Äî finances.belgium.be/fr/FinProf<br/>Secr√©tariats sociaux agr√©√©s: avant-dernier jour ouvrable du mois suivant</div>
        </div>
      </C>
      
      {/* CALENDRIER ONSS */}
      <C style={{marginTop:14}}>
        <ST>üìÖ Calendrier ONSS / DmfA</ST>
        <div style={{fontSize:10.5,color:'#9e9b93',lineHeight:1.8}}>
          {calONSS.map((c,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'3px 0',borderBottom:'1px solid rgba(198,163,78,.06)'}}>
            <span>{c.periode}</span><b style={{color:'#c6a34e'}}>{c.deadline}</b>
          </div>)}
          <div style={{marginTop:6,fontSize:9.5,color:'#60a5fa'}}>Provisions mensuelles: le 5 du mois suivant<br/>Solde trimestriel: dernier jour du mois suivant le trimestre</div>
        </div>
      </C>

      {/* INSTITUTIONS */}
      <C style={{marginTop:14}}>
        <ST>üèõ Institutions de r√©f√©rence</ST>
        <div style={{fontSize:10,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:2,fontSize:11}}>F√©d√©ral ‚Äî S√©curit√© sociale</div>
          <div><b style={{color:'#c6a34e'}}>ONSS</b> ‚Äî onss.be / socialsecurity.be</div>
          <div><b style={{color:'#c6a34e'}}>SPF Finances</b> ‚Äî finances.belgium.be</div>
          <div><b style={{color:'#c6a34e'}}>Fisconetplus</b> ‚Äî eservices.minfin.fgov.be <span style={{color:'#60a5fa'}}>(circulaires, Annexe III PP)</span></div>
          <div><b style={{color:'#c6a34e'}}>SPF Emploi</b> ‚Äî emploi.belgique.be</div>
          <div><b style={{color:'#c6a34e'}}>Moniteur belge</b> ‚Äî ejustice.just.fgov.be</div>
          <div><b style={{color:'#c6a34e'}}>CNT</b> ‚Äî cnt-nar.be (CCT interprof.)</div>
          <div><b style={{color:'#c6a34e'}}>ONEM</b> ‚Äî onem.be</div>
          <div><b style={{color:'#c6a34e'}}>INAMI</b> ‚Äî inami.fgov.be</div>
          <div><b style={{color:'#c6a34e'}}>SFP</b> ‚Äî sfpd.fgov.be / MyPension.be</div>
          <div><b style={{color:'#c6a34e'}}>Sigedis</b> ‚Äî sigedis.be / DB2P</div>
          <div><b style={{color:'#c6a34e'}}>Fedris</b> ‚Äî fedris.be <span style={{color:'#60a5fa'}}>(accidents travail, maladies prof.)</span></div>
          <div><b style={{color:'#c6a34e'}}>ONVA</b> ‚Äî onva.be <span style={{color:'#60a5fa'}}>(vacances annuelles ouvriers)</span></div>
          <div><b style={{color:'#c6a34e'}}>BCSS/KSZ</b> ‚Äî ksz-bcss.fgov.be <span style={{color:'#60a5fa'}}>(Banque Carrefour SS)</span></div>
          <div><b style={{color:'#c6a34e'}}>CAPAC</b> ‚Äî capac.fgov.be <span style={{color:'#60a5fa'}}>(allocations ch√¥mage, C4)</span></div>
          <div><b style={{color:'#c6a34e'}}>INASTI</b> ‚Äî inasti.be <span style={{color:'#60a5fa'}}>(ind√©pendants, statut mixte)</span></div>
          <div><b style={{color:'#c6a34e'}}>SPF √âconomie</b> ‚Äî economie.fgov.be <span style={{color:'#60a5fa'}}>(index sant√©, indices prix)</span></div>
          <div><b style={{color:'#c6a34e'}}>FLA</b> ‚Äî federallearningaccount.be <span style={{color:'#60a5fa'}}>(obligation formation)</span></div>
          <div><b style={{color:'#c6a34e'}}>Statbel</b> ‚Äî statbel.fgov.be</div>
          <div><b style={{color:'#c6a34e'}}>BCE</b> ‚Äî kbo-bce-search.economie.fgov.be</div>
          <div><b style={{color:'#c6a34e'}}>Belcotax</b> ‚Äî belcotaxonweb.be</div>
          <div><b style={{color:'#c6a34e'}}>Chambre</b> ‚Äî lachambre.be <span style={{color:'#f87171'}}>(projets de loi = alertes pr√©coces!)</span></div>
          <div style={{borderTop:'1px solid rgba(198,163,78,.1)',paddingTop:6,marginTop:4}}>
            <b style={{color:'#60a5fa'}}>R√©gions:</b><br/>
            Bruxelles: Actiris (activa.brussels)<br/>
            Wallonie: FOREM (forem.be)<br/>
            Flandre: VDAB (vdab.be)
          </div>
          <div style={{borderTop:'1px solid rgba(198,163,78,.1)',paddingTop:6,marginTop:4}}>
            <b style={{color:'#fb923c'}}>Secr√©tariats sociaux (veille):</b><br/>
            Securex ‚Äî Partena ‚Äî Acerta ‚Äî Liantis ‚Äî UCM ‚Äî Groupe S
          </div>
          <div style={{borderTop:'1px solid rgba(198,163,78,.1)',paddingTop:6,marginTop:4}}>
            <b style={{color:'#9e9b93'}}>Juridique:</b><br/>
            Droitbelge.be ‚Äî SocialEye (Wolters Kluwer) ‚Äî Salairesminimums.be
          </div>
        </div>
      </C>
      </div>

      {/* ALERTES D√âTAILL√âES */}
      <C style={{padding:'14px 18px'}}>
        <div style={{display:'flex',flexDirection:'column',gap:10}}>
          {filtered.map((a,i)=>
            <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.03)",border:'1px solid rgba(198,163,78,.08)',borderRadius:10,borderLeft:`3px solid ${urgColors[a.urgence]}`}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:6}}>
                <span style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>{a.titre}</span>
                <span style={{fontSize:10,color:urgColors[a.urgence],fontWeight:600}}>{urgLabels[a.urgence]}</span>
              </div>
              <div style={{fontSize:11.5,color:'#9e9b93',lineHeight:1.6}}>{a.desc}</div>
              <div style={{display:'flex',gap:12,marginTop:8}}>
                <span style={{fontSize:10,color:'#5e5c56'}}>üìÖ {a.date}</span>
                <span style={{fontSize:10,color:'#c6a34e'}}>üè∑Ô∏è {a.categorie}</span>
                {a.source&&<span style={{fontSize:10,color:'#60a5fa'}}>üìé {a.source}</span>}
              </div>
            </div>
          )}
        </div>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BILAN SOCIAL BNB ‚Äî D√©claration annuelle
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function BilanSocialBNBMod({s,d}){
  const [yr,setYr]=useState(new Date().getFullYear()-1);
  const ae=s.emps.filter(e=>e.status==='active');
  const ouvriers=ae.filter(e=>(e.statut||'')===('ouvrier'));
  const employes=ae.filter(e=>(e.statut||'')==='employe'||(e.statut||'')==='');
  const h=ae.filter(e=>(e.sexe||'M')==='M').length;
  const f=ae.length-h;
  const etp=ae.reduce((a,e)=>{const r=parseFloat(e.regime)||38;return a+r/38;},0);
  const masseBrute=ae.reduce((a,e)=>a+e.monthlySalary*13,0);
  const masseONSS=ae.reduce((a,e)=>a+e.monthlySalary*13*(LEGAL.ONSS_SECTEUR[e.cp]?.e||0.25),0);
  // ATN totaux
  const atnVoiture=ae.filter(e=>e.carFuel&&e.carFuel!=='none').length;
  const atnGSM=ae.filter(e=>e.atnGSM).length;
  const atnPC=ae.filter(e=>e.atnPC).length;
  const atnInternet=ae.filter(e=>e.atnInternet).length;
  const atnLogement=ae.filter(e=>e.atnLogement).length;
  const atnChauffage=ae.filter(e=>e.atnChauffage).length;
  const atnElec=ae.filter(e=>e.atnElec).length;
  const atnMontantAnnuel=ae.reduce((a,e)=>{const r=calc(e,DPER,s.co);return a+(r.atnTotal||0)*12;},0);
  
  const rubriques=[
    {code:'100',l:"√âtat du personnel",items:[
      {code:'1001',l:"Travailleurs inscrits au registre (fin exercice)",v:ae.length},
      {code:'1001a',l:"  dont Hommes",v:h},
      {code:'1001b',l:"  dont Femmes",v:f},
      {code:'1002',l:"Effectif moyen (ETP)",v:etp.toFixed(1)},
      {code:'1003',l:"Heures prest√©es",v:(etp*1976).toFixed(0)},
    ]},
    {code:'101',l:"Personnel selon le type de contrat",items:[
      {code:'1011',l:"CDI",v:ae.filter(e=>e.contract==='CDI').length},
      {code:'1012',l:"CDD",v:ae.filter(e=>e.contract==='CDD').length},
      {code:'1013',l:"Travail nettement d√©fini",v:ae.filter(e=>e.contract==='trav_det').length},
      {code:'1014',l:"Contrat de remplacement",v:ae.filter(e=>e.contract==='remplacement').length},
    ]},
    {code:'102',l:"Personnel selon le statut",items:[
      {code:'1021',l:"Employ√©s",v:employes.length},
      {code:'1022',l:"Ouvriers",v:ouvriers.length},
    ]},
    {code:'103',l:"Personnel selon le niveau d\'√©tudes",items:[
      {code:'1031',l:"Primaire",v:ae.filter(e=>(e.niveauEtude||'')==='prim').length},
      {code:'1032',l:"Secondaire",v:ae.filter(e=>(e.niveauEtude||'')==='sec_inf'||(e.niveauEtude||'')==='sec').length},
      {code:'1033',l:"Sup√©rieur non-universitaire",v:ae.filter(e=>(e.niveauEtude||'')==='sup').length},
      {code:'1034',l:"Universitaire",v:ae.filter(e=>(e.niveauEtude||'')==='univ').length},
    ]},
    {code:'150',l:"Avantages en nature (ATN)",items:[
      {code:'1501',l:"V√©hicule de soci√©t√©",v:atnVoiture},
      {code:'1502',l:"GSM / T√©l√©phone",v:atnGSM},
      {code:'1503',l:"PC / Tablette",v:atnPC},
      {code:'1504',l:"Connexion internet priv√©e",v:atnInternet},
      {code:'1505',l:"Logement gratuit",v:atnLogement},
      {code:'1506',l:"Chauffage",v:atnChauffage},
      {code:'1507',l:"√âlectricit√©",v:atnElec},
      {code:'1508',l:"Total b√©n√©ficiaires ATN",v:ae.filter(e=>(e.carFuel&&e.carFuel!=='none')||e.atnGSM||e.atnPC||e.atnInternet||e.atnLogement||e.atnChauffage||e.atnElec).length,bold:true},
      {code:'1509',l:"Montant ATN annuel total",v:fmt(atnMontantAnnuel),bold:true},
    ]},
    {code:'200',l:"Frais de personnel",items:[
      {code:'2001',l:"R√©mun√©rations et avantages sociaux directs",v:fmt(masseBrute)},
      {code:'2002',l:"Cotisations patronales ONSS",v:fmt(masseONSS)},
      {code:'2003',l:"Primes patronales assurance extra-l√©gale",v:fmt(0)},
      {code:'2004',l:"Autres frais de personnel",v:fmt(0)},
      {code:'2005',l:"Avantages en nature (ATN)",v:fmt(atnMontantAnnuel)},
      {code:'2006',l:"TOTAL FRAIS DE PERSONNEL",v:fmt(masseBrute+masseONSS+atnMontantAnnuel),bold:true},
    ]},
    {code:'300',l:"Mouvements du personnel",items:[
      {code:'3001',l:"Entr√©es",v:0},
      {code:'3002',l:"  dont CDI",v:0},
      {code:'3003',l:"Sorties",v:0},
      {code:'3004',l:"  dont pension/pr√©pension",v:0},
      {code:'3005',l:"  dont licenciement",v:0},
      {code:'3006',l:"  dont autre motif",v:0},
    ]},
    {code:'580',l:"Formation continue",items:[
      {code:'5801',l:"Heures de formation (total)",v:0},
      {code:'5802',l:"  dont Hommes",v:0},
      {code:'5803',l:"  dont Femmes",v:0},
      {code:'5804',l:"Co√ªt net formation",v:fmt(0)},
    ]},
  ];
  
  const generateXBRL=()=>{
    let doc=`BILAN SOCIAL ‚Äî EXERCICE ${yr}\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;
    doc+=`Entreprise: ${s.co.name}\nBCE: ${s.co.bce||'[BCE]'}\nExercice: 01/01/${yr} ‚Äî 31/12/${yr}\n\n`;
    rubriques.forEach(rub=>{
      doc+=`‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n${rub.code} ‚Äî ${rub.l}\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
      rub.items.forEach(it=>{
        doc+=`  ${it.code}: ${it.l.padEnd(50)} ${it.v}\n`;
      });
      doc+='\n';
    });
    doc+=`\nCe document est √©tabli conform√©ment √† l'AR du 04/08/1996.\nD√©p√¥t obligatoire √† la Banque Nationale de Belgique via le portail Filing.\n`;
    return doc;
  };
  
  return <div>
    <PH title="Bilan Social BNB" sub={`Exercice ${yr} ‚Äî AR 04/08/1996`} actions={<B onClick={()=>{
      const doc=generateXBRL();
      d({type:"MODAL",m:{w:900,c:<div>
        <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 12px',fontFamily:"'Cormorant Garamond',serif"}}>Bilan Social {yr}</h2>
        <div style={{fontSize:11,color:'#c6a34e',marginBottom:10}}>Format BNB ‚Äî D√©p√¥t via Filing</div>
        <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:450,overflowY:'auto'}}>{doc}</pre>
        <div style={{display:'flex',gap:10,marginTop:14,justifyContent:'flex-end'}}>
          <B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B>
          <B onClick={()=>{navigator.clipboard?.writeText(doc);alert('Copi√© !')}}>Copier</B>
        </div>
      </div>}});
    }}>G√©n√©rer le bilan</B>}/>
    <div style={{display:'grid',gridTemplateColumns:'260px 1fr',gap:18}}>
      <C>
        <I label="Exercice" type="number" value={yr} onChange={v=>setYr(v)}/>
        <div style={{marginTop:14,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>Donn√©es cl√©s</div>
          <div>Effectif: <b style={{color:'#e8e6e0'}}>{ae.length}</b> ({h}H / {f}F)</div>
          <div>ETP moyen: <b style={{color:'#e8e6e0'}}>{etp.toFixed(1)}</b></div>
          <div>Employ√©s: <b style={{color:'#e8e6e0'}}>{employes.length}</b></div>
          <div>Ouvriers: <b style={{color:'#e8e6e0'}}>{ouvriers.length}</b></div>
          <div>Masse salariale: <b style={{color:'#4ade80'}}>{fmt(masseBrute)}</b></div>
        </div>
        <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          Le bilan social est obligatoire pour les entreprises de plus de 20 ETP. D√©p√¥t annuel √† la BNB avec les comptes annuels.
        </div>
      </C>
      <C style={{padding:'14px 18px',maxHeight:600,overflowY:'auto'}}>
        {rubriques.map(rub=><div key={rub.code} style={{marginBottom:18}}>
          <div style={{fontSize:13,fontWeight:600,color:'#c6a34e',marginBottom:8,paddingBottom:6,borderBottom:'1px solid rgba(198,163,78,.15)'}}>{rub.code} ‚Äî {rub.l}</div>
          {rub.items.map(it=><div key={it.code} style={{display:'flex',justifyContent:'space-between',padding:'6px 10px',borderRadius:4,background:it.bold?'rgba(198,163,78,.08)':'transparent'}}>
            <span style={{fontSize:11.5,color:it.bold?'#c6a34e':'#9e9b93'}}>{it.l}</span>
            <span style={{fontSize:11.5,fontWeight:it.bold?700:500,color:it.bold?'#c6a34e':'#e8e6e0',fontFamily:'monospace'}}>{it.v}</span>
          </div>)}
        </div>)}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CALCUL CO2 ‚Äî Contribution voitures de soci√©t√©
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CO2_FUEL=[
  {id:"essence",l:"Essence",minCO2:102},
  {id:"diesel",l:"Diesel",minCO2:84},
  {id:"lpg",l:"LPG / CNG",minCO2:84},
  {id:"electrique",l:"√âlectrique (0g)",minCO2:0},
  {id:"hybride_e",l:"Hybride rechargeable (PHEV)",minCO2:50},
];

function CO2Mod({s,d}){
  const [cars,setCars]=useState([{id:1,emp:'',marque:'',modele:'',fuel:"essence",co2:120,catVal:25000,dateImmat:''}]);
  const [yr,setYr]=useState(new Date().getFullYear());
  const addCar=()=>setCars(p=>[...p,{id:Date.now(),emp:'',marque:'',modele:'',fuel:"essence",co2:120,catVal:25000,dateImmat:''}]);
  const upd=(id,k,v)=>setCars(p=>p.map(c=>c.id===id?{...c,[k]:v}:c));
  const rem=(id)=>setCars(p=>p.filter(c=>c.id!==id));
  
  const calcCO2=(car)=>{
    const co2=parseInt(car.co2)||0;
    if(car.fuel==='electrique')return{atn:0,cotCO2:31.34,deduct:100,pct:4,cat:"√âlectrique"};
    const catVal=parseFloat(car.catVal)||25000;
    const basePct=5.5;
    const deltaCO2=co2-(car.fuel==='diesel'?84:102);
    let pct=basePct+(deltaCO2*0.1);
    pct=Math.max(4,Math.min(18,pct));
    const atnMensuel=(catVal*(6/7)*(pct/100))/12;
    let cotCO2=0;
    if(car.fuel==='diesel')cotCO2=((co2*0.00714*71.4644)+31.34);
    else cotCO2=((co2*0.00714*83.6644)+31.34);
    cotCO2=Math.max(31.34,cotCO2);
    let deduct=50;
    if(co2===0)deduct=100;
    else if(co2<=50)deduct=100;
    else if(co2<=100)deduct=80;
    else if(co2<=150)deduct=65;
    else if(co2<=200)deduct=50;
    else deduct=40;
    return{atn:atnMensuel,cotCO2:cotCO2/3,deduct,pct,cat:CO2_FUEL.find(f=>f.id===car.fuel)?.l||''};
  };
  
  const ae=s.emps.filter(e=>e.status==='active');
  const results=cars.map(c=>({...c,...calcCO2(c)}));
  const totCot=results.reduce((a,r)=>a+r.cotCO2,0);
  const totATN=results.reduce((a,r)=>a+r.atn,0);
  
  return <div>
    <PH title="Calcul CO2 ‚Äî Voitures de soci√©t√©" sub={`Exercice ${yr} ‚Äî Art. 36 CIR 92 & Cotisation de solidarit√© CO2`}/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Param√®tres</ST>
        <I label="Ann√©e" type="number" value={yr} onChange={v=>setYr(v)}/>
        <div style={{marginTop:14,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>Totaux mensuels</div>
          <div>V√©hicules: <b style={{color:'#e8e6e0'}}>{cars.length}</b></div>
          <div>ATN total: <b style={{color:'#fb923c'}}>{fmt(totATN)}</b>/mois</div>
          <div>Cotisation CO2: <b style={{color:'#f87171'}}>{fmt(totCot)}</b>/mois</div>
        </div>
        <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          <b>ATN</b>: Avantage de toute nature imposable (ajout√© au brut fiscal).<br/>
          <b>Cotisation CO2</b>: Cotisation patronale de solidarit√© ONSS (min. 31,34‚Ç¨/mois).<br/>
          <b>D√©ductibilit√©</b>: % frais voiture d√©ductibles ISOC selon CO2.
        </div>
        <B style={{width:'100%',marginTop:14}} onClick={addCar}>+ Ajouter un v√©hicule</B>
      </C>
      <C style={{padding:'14px 18px',maxHeight:650,overflowY:'auto'}}>
        {results.map((car,i)=><div key={car.id} style={{padding:16,marginBottom:12,background:"rgba(198,163,78,.03)",border:'1px solid rgba(198,163,78,.08)',borderRadius:10}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}}>
            <span style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>V√©hicule {i+1} {car.marque&&`‚Äî ${car.marque} ${car.modele}`}</span>
            <button onClick={()=>rem(car.id)} style={{background:"rgba(248,113,113,.1)",border:'1px solid rgba(248,113,113,.2)',borderRadius:6,color:'#f87171',padding:'3px 10px',cursor:'pointer',fontSize:11,fontFamily:'inherit'}}>‚úï</button>
          </div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:10}}>
            <I label="Employ√©" value={car.emp} onChange={v=>upd(car.id,"emp",v)} options={[{v:"",l:"‚Äî Choisir ‚Äî"},...ae.map(e=>({v:`${e.first||e.fn||'Emp'} ${e.last||''}`,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))]}/>
            <I label="Marque" value={car.marque} onChange={v=>upd(car.id,"marque",v)}/>
            <I label="Mod√®le" value={car.modele} onChange={v=>upd(car.id,"modele",v)}/>
            <I label="Carburant" value={car.fuel} onChange={v=>upd(car.id,"fuel",v)} options={CO2_FUEL.map(f=>({v:f.id,l:f.l}))}/>
            <I label="CO2 g/km" type="number" value={car.co2} onChange={v=>upd(car.id,"co2",v)}/>
            <I label="Valeur catalogue ‚Ç¨" type="number" value={car.catVal} onChange={v=>upd(car.id,"catVal",v)}/>
            <I label="1√®re immatriculation" value={car.dateImmat} onChange={v=>upd(car.id,"dateImmat",v)}/>
            <I label="D√©ductibilit√© ISOC" value={`${car.deduct}%`} onChange={()=>{}}/>
          </div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:10,marginTop:10}}>
            {[{l:"ATN mensuel",v:fmt(car.atn),c:'#fb923c'},{l:"Cotisation CO2/mois",v:fmt(car.cotCO2),c:'#f87171'},{l:"D√©ductibilit√© ISOC",v:car.deduct+'%',c:'#60a5fa'},{l:"% ATN",v:(car.pct||0).toFixed(1)+'%',c:'#c6a34e'}].map((x,j)=>
              <div key={j} style={{padding:10,background:`${x.c}11`,borderRadius:8,textAlign:'center'}}>
                <div style={{fontSize:10,color:'#5e5c56'}}>{x.l}</div>
                <div style={{fontSize:16,fontWeight:700,color:x.c}}>{x.v}</div>
              </div>
            )}
          </div>
        </div>)}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CERTIFICAT PME ‚Äî Attestation aide r√©gionale
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function CertPMEMod({s,d}){
  const [yr,setYr]=useState(new Date().getFullYear());
  const [form,setForm]=useState({region:'bxl',effectif:'',ca:'',bilanTotal:"",dateCreation:'',isStarter:false,zonesAidees:false});
  const upd=(k,v)=>setForm(p=>({...p,[k]:v}));
  const regions=[
    {id:"bxl",l:"Bruxelles-Capitale",org:'Actiris / hub.brussels',primes:['Prime de transition',"Aide Activa.brussels","Prime de stage First"]},
    {id:"wal",l:"Wallonie",org:'FOREM / SPW √âconomie',primes:['Ch√®ques-entreprises',"Aide APE","Prime Impulsion"]},
    {id:"vla",l:"Flandre",org:'VDAB / VLAIO',primes:['KMO-portefeuille',"Winwinlening","Vlaams investeringsfonds"]},
  ];
  const reg=regions.find(r=>r.id===form.region);
  const eff=parseInt(form.effectif)||0;const ca=parseFloat(form.ca)||0;const bil=parseFloat(form.bilanTotal)||0;
  let categorie='Non-PME';
  if(eff<10&&ca<=2&&bil<=2)categorie='Micro-entreprise';
  else if(eff<50&&ca<=10&&bil<=10)categorie='Petite entreprise';
  else if(eff<250&&ca<=50&&bil<=43)categorie='Moyenne entreprise';
  const isPME=categorie!=='Non-PME';
  
  const generate=()=>{
    const now=new Date().toLocaleDateString('fr-BE');
    let doc=`CERTIFICAT PME\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nATTESTATION DE QUALIFICATION PME\nConform√©ment √† la Recommandation 2003/361/CE\n\n`;
    doc+=`Entreprise: ${s.co.name}\nBCE: ${s.co.bce||'[BCE]'}\nSi√®ge: ${s.co.address||'[Adresse]'}\nR√©gion: ${reg?.l}\nDate de cr√©ation: ${form.dateCreation||'[Date]'}\n\n`;
    doc+=`CRIT√àRES PME (Exercice ${yr})\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
    doc+=`Effectif (ETP):\t${eff}\t${eff<250?'‚úÖ':'‚ùå'} (< 250)\nCA:\t\t${ca}M‚Ç¨\t${ca<=50?'‚úÖ':'‚ùå'} (‚â§ 50M‚Ç¨)\nBilan:\t\t${bil}M‚Ç¨\t${bil<=43?'‚úÖ':'‚ùå'} (‚â§ 43M‚Ç¨)\n\n`;
    doc+=`R√âSULTAT: ${categorie.toUpperCase()}\nStatut PME: ${isPME?'‚úÖ CONFIRM√â':'‚ùå NON √âLIGIBLE'}\n\n`;
    if(isPME){doc+=`AIDES R√âGIONALES (${reg?.l})\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nOrganisme: ${reg?.org}\n`;reg?.primes.forEach((p,i)=>{doc+=`${i+1}. ${p}\n`;});}
    if(form.isStarter)doc+=`\n‚≠ê Statut STARTER (< 4 ans)\n`;
    doc+=`\nDate: ${now}\n${s.co.name}\n`;
    return doc;
  };
  
  return <div>
    <PH title="Certificat PME" sub="Recommandation UE 2003/361/CE ‚Äî Aides r√©gionales"/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Donn√©es entreprise</ST>
        <I label="R√©gion" value={form.region} onChange={v=>upd('region',v)} options={regions.map(r=>({v:r.id,l:r.l}))}/>
        <I label="Effectif (ETP)" type="number" value={form.effectif} onChange={v=>upd('effectif',v)}/>
        <I label="CA (M‚Ç¨)" type="number" value={form.ca} onChange={v=>upd('ca',v)}/>
        <I label="Total bilan (M‚Ç¨)" type="number" value={form.bilanTotal} onChange={v=>upd('bilanTotal',v)}/>
        <I label="Date de cr√©ation" value={form.dateCreation} onChange={v=>upd('dateCreation',v)}/>
        <div style={{marginTop:10,display:'flex',gap:14}}>
          <label style={{fontSize:12,color:'#9e9b93',display:'flex',alignItems:'center',gap:6,cursor:'pointer'}}><input type="checkbox" checked={form.isStarter} onChange={e=>upd('isStarter',e.target.checked)}/> Starter</label>
          <label style={{fontSize:12,color:'#9e9b93',display:'flex',alignItems:'center',gap:6,cursor:'pointer'}}><input type="checkbox" checked={form.zonesAidees} onChange={e=>upd('zonesAidees',e.target.checked)}/> Zone aid√©e</label>
        </div>
        <div style={{marginTop:14,padding:12,background:isPME?'rgba(74,222,128,.08)':'rgba(248,113,113,.08)',borderRadius:8,border:`1px solid ${isPME?'rgba(74,222,128,.2)':'rgba(248,113,113,.2)'}`,textAlign:'center'}}>
          <div style={{fontSize:11,color:'#5e5c56',marginBottom:4}}>Classification</div>
          <div style={{fontSize:18,fontWeight:700,color:isPME?'#4ade80':'#f87171'}}>{categorie}</div>
          <div style={{fontSize:11,color:isPME?'#4ade80':'#f87171',marginTop:4}}>{isPME?'‚úÖ √âligible':'‚ùå Non √©ligible'}</div>
        </div>
      </C>
      <C>
        <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:16}}>Seuils PME ‚Äî UE 2003/361/CE</div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:14,marginBottom:20}}>
          {[{l:"Micro",eff:'< 10',ca:'‚â§ 2M‚Ç¨',bil:"‚â§ 2M‚Ç¨"},{l:"Petite",eff:'< 50',ca:'‚â§ 10M‚Ç¨',bil:"‚â§ 10M‚Ç¨"},{l:"Moyenne",eff:'< 250',ca:'‚â§ 50M‚Ç¨',bil:"‚â§ 43M‚Ç¨"}].map(cat=>
            <div key={cat.l} style={{padding:14,background:categorie.toLowerCase().includes(cat.l.toLowerCase())?'rgba(198,163,78,.1)':'rgba(198,163,78,.03)',border:`1px solid ${categorie.toLowerCase().includes(cat.l.toLowerCase())?'rgba(198,163,78,.3)':'rgba(198,163,78,.06)'}`,borderRadius:8}}>
              <div style={{fontSize:13,fontWeight:600,color:'#c6a34e',marginBottom:8}}>{cat.l}</div>
              <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>Effectif: {cat.eff}<br/>CA: {cat.ca}<br/>Bilan: {cat.bil}</div>
            </div>
          )}
        </div>
        {isPME&&<div style={{marginBottom:16}}>
          <div style={{fontSize:13,fontWeight:600,color:'#4ade80',marginBottom:10}}>Aides ‚Äî {reg?.l}</div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8}}>
            {reg?.primes.map((p,i)=><div key={i} style={{padding:10,background:"rgba(74,222,128,.05)",border:'1px solid rgba(74,222,128,.1)',borderRadius:8,fontSize:12,color:'#d4d0c8'}}>{p}</div>)}
          </div>
        </div>}
        <B onClick={()=>{const doc=generate();d({type:"MODAL",m:{w:900,c:<div>
          <h2 style={{fontSize:17,fontWeight:600,color:'#e8e6e0',margin:'0 0 12px',fontFamily:"'Cormorant Garamond',serif"}}>Certificat PME</h2>
          <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10.5,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:450,overflowY:'auto'}}>{doc}</pre>
          <div style={{display:'flex',gap:10,marginTop:14,justifyContent:'flex-end'}}><B v="outline" onClick={()=>d({type:"MODAL",m:null})}>Fermer</B><B onClick={()=>{navigator.clipboard?.writeText(doc);alert('Copi√© !')}}>Copier</B></div>
        </div>}});}}>G√©n√©rer le certificat</B>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  COMMANDE √âCO-CH√àQUES ‚Äî Fichier commande fournisseur
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ECO_PROVIDERS=[
  {id:"pluxee",n:'Pluxee (ex-Sodexo)',ic:'üü†',format:'CSV',fields:['Nom',"Pr√©nom","NN","Montant","Adresse livraison"],site:'www.pluxee.be'},
  {id:"edenred",n:'Edenred',ic:'üî¥',format:'CSV/XLSX',fields:['Nom',"Pr√©nom","NISS","Montant","Email"],site:'www.edenred.be'},
  {id:"monizze",n:'Monizze',ic:'üü¢',format:'CSV',fields:['Nom',"Pr√©nom","NN","Montant","Carte Monizze ID"],site:'www.monizze.be'},
  {id:"got",n:'G.O.T. Connection',ic:'üîµ',format:'CSV',fields:['Nom',"Pr√©nom","NISS","Montant","R√©f√©rence"],site:'www.gotconnection.be'},
];

function EcoCommandeMod({s,d}){
  const [provider,setProvider]=useState('sodexo');
  const [yr,setYr]=useState(new Date().getFullYear());
  const [montant,setMontant]=useState(250);
  const [gen,setGen]=useState(null);
  const ae=s.emps.filter(e=>e.status==='active');
  const prov=ECO_PROVIDERS.find(p=>p.id===provider);
  
  const generate=()=>{
    const header=prov.fields.join(';');
    const rows=ae.map(emp=>{
      const vals=prov.fields.map(f=>{
        if(f==='Nom')return emp.last||'';if(f==='Pr√©nom')return emp.first||'';
        if(f==='NN'||f==='NISS')return emp.nn||'XX.XX.XX-XXX.XX';
        if(f==='Montant')return montant.toFixed(2);
        if(f==='Adresse livraison')return emp.address||s.co.address||'';
        if(f==='Email')return emp.email||'';if(f==='Carte Monizze ID')return emp.monizzeId||'[√Ä compl√©ter]';return '';
      });return vals.join(';');
    });
    setGen({csv:header+'\n'+rows.join('\n'),total:ae.length*montant,count:ae.length});
  };
  
  return <div>
    <PH title="Commande √âco-ch√®ques" sub={`Exercice ${yr} ‚Äî CCT 98 du CNT`}/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Param√®tres</ST>
        <I label="Fournisseur" value={provider} onChange={setProvider} options={ECO_PROVIDERS.map(p=>({v:p.id,l:`${p.ic} ${p.n}`}))}/>
        <I label="Ann√©e" type="number" value={yr} onChange={v=>setYr(v)}/>
        <I label="Montant/travailleur (‚Ç¨)" type="number" value={montant} onChange={v=>setMontant(parseFloat(v)||0)}/>
        <div style={{marginTop:12,padding:10,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>R√©capitulatif</div>
          <div>Fournisseur: <b style={{color:'#e8e6e0'}}>{prov?.n}</b></div>
          <div>Format: <b style={{color:'#e8e6e0'}}>{prov?.format}</b></div>
          <div>Travailleurs: <b style={{color:'#e8e6e0'}}>{ae.length}</b></div>
          <div>Total: <b style={{color:'#4ade80'}}>{fmt(ae.length*montant)}</b></div>
        </div>
        <B style={{width:'100%',marginTop:14}} onClick={generate}>G√©n√©rer fichier commande</B>
        <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          <b>CCT 98</b>: Max 250‚Ç¨/an par travailleur TP. Exon√©r√© ONSS et fiscal si conditions respect√©es. Format compatible portail {prov?.site}.
        </div>
      </C>
      <C>
        <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:14}}>Travailleurs ‚Äî √âco-ch√®ques {yr}</div>
        <Tbl cols={[
          {k:'n',l:"Nom",b:1,r:r=>`${r.first} ${r.last}`},
          {k:'nn',l:"NN",r:r=><span style={{fontSize:10,fontFamily:'monospace',color:'#9e9b93'}}>{r.nn||'XX.XX.XX-XXX.XX'}</span>},
          {k:'r',l:"R√©gime",r:r=>r.regime||'38h'},
          {k:'m',l:"Montant",a:'right',r:()=><span style={{fontWeight:600,color:'#4ade80'}}>{fmt(montant)}</span>},
        ]} data={ae}/>
        {gen&&<div style={{marginTop:16}}>
          <div style={{display:'flex',gap:14,marginBottom:12}}>
            <span style={{fontSize:12,color:'#9e9b93'}}>Lignes: <b style={{color:'#e8e6e0'}}>{gen.count}</b></span>
            <span style={{fontSize:12,color:'#9e9b93'}}>Total: <b style={{color:'#4ade80'}}>{fmt(gen.total)}</b></span>
          </div>
          <pre style={{background:"#060810",border:'1px solid rgba(139,115,60,.15)',borderRadius:8,padding:14,fontSize:10,color:'#9e9b93',whiteSpace:'pre-wrap',maxHeight:250,overflowY:'auto'}}>{gen.csv}</pre>
          <div style={{display:'flex',gap:10,marginTop:12}}>
            <B v="ghost" onClick={()=>{navigator.clipboard?.writeText(gen.csv);alert('CSV copi√© !')}}>üìã Copier CSV</B>
          </div>
        </div>}
      </C>
    </div>
  </div>;
}
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PR√âAVIS L√âGAL ‚Äî Calculateur dur√©e & co√ªt (Loi statut unique 26/12/2013)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function PreavisMod({s,d}){
  const [eid,setEid]=useState(s.emps[0]?.id||'');
  const [motif,setMotif]=useState('licenciement');
  const [dateNotif,setDateNotif]=useState('');
  const ae=s.emps.filter(e=>e.status==='active');
  const emp=ae.find(e=>e.id===eid);
  
  const calcPreavis=(emp)=>{
    if(!emp)return null;
    const start=new Date(emp.startD||'2020-01-01');
    const now=new Date();
    const ancMois=Math.max(0,Math.round((now-start)/(1000*60*60*24*30.44)));
    const ancAns=ancMois/12;
    // Loi statut unique 26/12/2013 ‚Äî bar√®me employeur
    let semaines=0;
    if(motif==='licenciement'){
      // Tranche 1: 0-5 ans ‚Üí formule progressive
      if(ancAns<0.25)semaines=1;
      else if(ancAns<0.5)semaines=3;
      else if(ancAns<0.75)semaines=4;
      else if(ancAns<1)semaines=5;
      else if(ancAns<2)semaines=6;
      else if(ancAns<3)semaines=8;
      else if(ancAns<4)semaines=9;
      else if(ancAns<5)semaines=12;
      else if(ancAns<6)semaines=15;
      else if(ancAns<7)semaines=18;
      else if(ancAns<8)semaines=21;
      else if(ancAns<9)semaines=24;
      else if(ancAns<10)semaines=27;
      else if(ancAns<11)semaines=30;
      else if(ancAns<12)semaines=33;
      else if(ancAns<13)semaines=36;
      else if(ancAns<14)semaines=39;
      else if(ancAns<15)semaines=42;
      else if(ancAns<16)semaines=45;
      else if(ancAns<17)semaines=48;
      else if(ancAns<18)semaines=51;
      else if(ancAns<19)semaines=54;
      else if(ancAns<20)semaines=57;
      else if(ancAns<21)semaines=60;
      else semaines=60+Math.floor((ancAns-20))*3;
    } else {
      // D√©mission ‚Äî environ 1/2 du pr√©avis licenciement, max 13 sem
      if(ancAns<0.25)semaines=1;
      else if(ancAns<0.5)semaines=2;
      else if(ancAns<1)semaines=2;
      else if(ancAns<2)semaines=3;
      else if(ancAns<3)semaines=4;
      else if(ancAns<4)semaines=5;
      else if(ancAns<5)semaines=6;
      else if(ancAns<6)semaines=7;
      else if(ancAns<7)semaines=9;
      else if(ancAns<8)semaines=10;
      else semaines=13;
    }
    const jours=semaines*7;
    const joursCal=semaines*5;
    const p=calc(emp,{days:21,overtimeH:0,sundayH:0,nightH:0,sickG:0,bonus:0,y13:0,advance:0,garnish:0,otherDed:0,month:now.getMonth()+1,year:now.getFullYear()},s.co);
    const coutSemaine=p.costTotal/4.33;
    const indemnite=coutSemaine*semaines;
    return{ancMois,ancAns:ancAns.toFixed(1),semaines,jours,joursCal,indemnite,coutSemaine,brut:emp.monthlySalary,cost:p.costTotal};
  };
  
  const r=calcPreavis(emp);
  
  return <div>
    <PH title="Pr√©avis l√©gal" sub="Loi du 26/12/2013 ‚Äî Statut unique"/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Param√®tres</ST>
        <I label="Travailleur" value={eid} onChange={setEid} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <I label="Type" value={motif} onChange={setMotif} options={[{v:"licenciement",l:"Licenciement (par employeur)"},{v:"demission",l:"D√©mission (par travailleur)"}]}/>
        <I label="Date notification" type="date" value={dateNotif} onChange={setDateNotif}/>
        {r&&<div style={{marginTop:14,padding:12,background:motif==='licenciement'?'rgba(248,113,113,.08)':'rgba(96,165,250,.08)',borderRadius:8,border:`1px solid ${motif==='licenciement'?'rgba(248,113,113,.2)':'rgba(96,165,250,.2)'}`,textAlign:'center'}}>
          <div style={{fontSize:11,color:'#5e5c56'}}>Dur√©e du pr√©avis</div>
          <div style={{fontSize:28,fontWeight:700,color:motif==='licenciement'?'#f87171':'#60a5fa'}}>{r.semaines} sem.</div>
          <div style={{fontSize:12,color:'#9e9b93'}}>{r.joursCal} jours ouvrables ¬∑ {r.jours} jours calendrier</div>
        </div>}
        {r&&motif==='licenciement'&&<div style={{marginTop:10,padding:12,background:"rgba(248,113,113,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#f87171',marginBottom:4}}>Co√ªt indemnit√© de rupture</div>
          <div>Co√ªt/semaine: <b style={{color:'#e8e6e0'}}>{r?fmt(r.coutSemaine):'-'}</b></div>
          <div>Indemnit√© totale: <b style={{color:'#f87171',fontSize:14}}>{r?fmt(r.indemnite):'-'}</b></div>
        </div>}
      </C>
      <C>
        {emp&&r&&<div>
          <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:16}}>{emp.first} {emp.last} ‚Äî {motif==='licenciement'?'Licenciement':'D√©mission'}</div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:12,marginBottom:20}}>
            {[{l:"Anciennet√©",v:`${r.ancAns} ans`,c:'#c6a34e'},{l:"Brut mensuel",v:fmt(r.brut),c:'#e8e6e0'},{l:"Co√ªt mensuel",v:fmt(r.cost),c:'#a78bfa'},{l:"Pr√©avis",v:`${r.semaines} sem.`,c:motif==='licenciement'?'#f87171':'#60a5fa'}].map((x,i)=>
              <div key={i} style={{padding:14,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center',border:'1px solid rgba(198,163,78,.08)'}}>
                <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>{x.l}</div>
                <div style={{fontSize:18,fontWeight:700,color:x.c,marginTop:4}}>{x.v}</div>
              </div>
            )}
          </div>
          <div style={{padding:14,background:"rgba(96,165,250,.04)",borderRadius:8,fontSize:11.5,color:'#60a5fa',lineHeight:1.8}}>
            <b>Art. 37/2 Loi 03/07/1978</b> ‚Äî Le pr√©avis prend cours le lundi suivant la semaine de notification.<br/>
            <b>Contre-pr√©avis</b> (si licenciement) ‚Äî Le travailleur peut donner un contre-pr√©avis r√©duit pendant le pr√©avis.<br/>
            <b>Outplacement</b> ‚Äî Obligatoire si pr√©avis ‚â• 30 semaines (= anciennet√© ‚â• ~10 ans). Valeur: min. 1.800‚Ç¨ sur 12 mois.<br/>
            <b>Dispense C4</b> ‚Äî Si motif grave (art. 35), pas de pr√©avis. Notification dans les 3 jours ouvrables.
          </div>
        </div>}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  P√âCULE DE SORTIE ‚Äî Solde tout compte
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function PeculeSortieMod({s,d}){
  const [eid,setEid]=useState(s.emps[0]?.id||'');
  const [dateSortie,setDateSortie]=useState('');
  const [motif,setMotif]=useState('licenciement');
  const ae=s.emps.filter(e=>e.status==='active');
  const emp=ae.find(e=>e.id===eid);
  
  const calcSortie=(emp)=>{
    if(!emp)return null;
    const brut=emp.monthlySalary||0;
    const now=dateSortie?new Date(dateSortie):new Date();
    const moisPreste=now.getMonth()+1;
    // Prorata 13e mois
    const prorata13=brut*(moisPreste/12);
    // Solde cong√©s (employ√©s: jours non pris √ó salaire journalier)
    const salJour=brut/21.66;
    const droitVac=Math.round(20*(moisPreste/12));
    const joursNonPris=Math.max(0,droitVac-0); // suppose 0 pris
    const soldeConges=joursNonPris*salJour;
    // P√©cule vacances sortie (simple = 7.67% brut r√©f, double = 7.67%)
    const brutRef=brut*moisPreste;
    const pecSimple=brutRef*0.0767;
    const pecDouble=brutRef*0.0767;
    // ONSS sur p√©cule sortie
    const onssVac=(pecSimple+pecDouble)*0.1307;
    // Indemnit√© compensatoire de pr√©avis (si licenciement)
    let indemPreavis=0;
    if(motif==='licenciement'){
      const start=new Date(emp.startD||'2020-01-01');
      const ancAns=Math.max(0,(now-start)/(1000*60*60*24*365.25));
      let sem=0;
      if(ancAns<1)sem=5;else if(ancAns<2)sem=6;else if(ancAns<3)sem=8;
      else if(ancAns<5)sem=12;else if(ancAns<8)sem=21;else if(ancAns<10)sem=27;
      else if(ancAns<15)sem=42;else if(ancAns<20)sem=57;else sem=60+Math.floor((ancAns-20))*3;
      const p=calc(emp,{days:21,overtimeH:0,sundayH:0,nightH:0,sickG:0,bonus:0,y13:0,advance:0,garnish:0,otherDed:0,month:now.getMonth()+1,year:now.getFullYear()},s.co);
      indemPreavis=(p.costTotal/4.33)*sem;
    }
    const totalBrut=prorata13+soldeConges+pecSimple+pecDouble;
    const onssTotal=totalBrut*0.1307;
    const ppEstim=totalBrut*0.25;
    const totalNet=totalBrut-onssTotal-ppEstim;
    return{prorata13,soldeConges,joursNonPris,pecSimple,pecDouble,onssVac,indemPreavis,totalBrut,onssTotal,ppEstim,totalNet,moisPreste,droitVac};
  };
  const r=calcSortie(emp);
  
  return <div>
    <PH title="P√©cule de sortie" sub="Solde de tout compte ‚Äî d√©compte final"/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Param√®tres</ST>
        <I label="Travailleur" value={eid} onChange={setEid} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <I label="Date de sortie" type="date" value={dateSortie} onChange={setDateSortie}/>
        <I label="Motif" value={motif} onChange={setMotif} options={[{v:"licenciement",l:"Licenciement"},{v:"demission",l:"D√©mission"},{v:"commun",l:"Rupture d\'un commun accord"},{v:"pension",l:"Pension"},{v:"deces",l:"D√©c√®s"}]}/>
        {r&&<div style={{marginTop:14,padding:12,background:"rgba(74,222,128,.08)",borderRadius:8,textAlign:'center'}}>
          <div style={{fontSize:11,color:'#5e5c56'}}>Total net estim√© √† verser</div>
          <div style={{fontSize:24,fontWeight:700,color:'#4ade80'}}>{fmt(r.totalNet)}</div>
          {r.indemPreavis>0&&<div style={{fontSize:12,color:'#f87171',marginTop:4}}>+ Indemnit√© pr√©avis: {fmt(r.indemPreavis)}</div>}
        </div>}
      </C>
      <C>
        {emp&&r&&<div>
          <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:16}}>D√©compte final ‚Äî {emp.first} {emp.last}</div>
          <div style={{display:'flex',flexDirection:'column',gap:8}}>
            {[
              {l:"Prorata 13√®me mois",v:r.prorata13,sub:`${r.moisPreste}/12 mois`},
              {l:`Solde cong√©s (${r.joursNonPris}j non pris)`,v:r.soldeConges,sub:`${r.droitVac} jours droit`},
              {l:"P√©cule de vacances simple (7,67%)",v:r.pecSimple},
              {l:"P√©cule de vacances double (7,67%)",v:r.pecDouble},
              {l:"TOTAL BRUT",v:r.totalBrut,bold:true},
              {l:"ONSS travailleur (-13,07%)",v:-r.onssTotal,neg:true},
              {l:"Pr√©compte estim√© (-25%)",v:-r.ppEstim,neg:true},
              {l:"TOTAL NET",v:r.totalNet,bold:true,green:true},
            ].map((it,i)=>
              <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'10px 14px',background:it.bold?'rgba(198,163,78,.08)':'rgba(198,163,78,.03)',borderRadius:8}}>
                <div><span style={{fontSize:12,color:it.bold?'#c6a34e':'#d4d0c8',fontWeight:it.bold?700:400}}>{it.l}</span>{it.sub&&<span style={{fontSize:10,color:'#5e5c56',marginLeft:8}}>({it.sub})</span>}</div>
                <span style={{fontSize:it.bold?15:13,fontWeight:it.bold?700:500,color:it.neg?'#f87171':it.green?'#4ade80':'#e8e6e0',fontFamily:'monospace'}}>{fmt(Math.abs(it.v))}</span>
              </div>
            )}
            {r.indemPreavis>0&&<div style={{padding:'12px 14px',background:"rgba(248,113,113,.08)",borderRadius:8,border:'1px solid rgba(248,113,113,.15)',marginTop:8}}>
              <div style={{fontSize:13,fontWeight:600,color:'#f87171'}}>Indemnit√© compensatoire de pr√©avis</div>
              <div style={{fontSize:20,fontWeight:700,color:'#f87171',marginTop:4}}>{fmt(r.indemPreavis)}</div>
              <div style={{fontSize:10.5,color:'#9e9b93',marginTop:4}}>Co√ªt total employeur (brut + ONSS patronales). Soumise √† ONSS et pr√©compte.</div>
            </div>}
          </div>
        </div>}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CR√âDIT-TEMPS / INTERRUPTION DE CARRI√àRE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function CreditTempsMod({s,d}){
  const [eid,setEid]=useState(s.emps[0]?.id||'');
  const [regime,setRegime]=useState('mi_temps');
  const [motif,setMotif]=useState('soins');
  const [debut,setDebut]=useState('');
  const [duree,setDuree]=useState(12);
  const ae=s.emps.filter(e=>e.status==='active');
  const emp=ae.find(e=>e.id===eid);
  
  const regimes=[
    {id:"complet",l:"Cr√©dit-temps complet",pct:100,alloc:564.34,desc:"Suspension totale du contrat"},
    {id:"mi_temps",l:"Cr√©dit-temps mi-temps",pct:50,alloc:282.17,desc:"R√©duction √† mi-temps"},
    {id:"1_5",l:"Cr√©dit-temps 1/5",pct:20,alloc:152.50,desc:"R√©duction d'1 jour/semaine (TP uniquement)"},
    {id:"conge_parent",l:"Cong√© parental",pct:100,alloc:926.29,desc:"Par enfant < 12 ans. Max 4 mois complet"},
    {id:"assist_med",l:"Assistance m√©dicale",pct:100,alloc:926.29,desc:"Membre famille gravement malade"},
    {id:"soins_pall",l:"Soins palliatifs",pct:100,alloc:926.29,desc:"1 mois renouvelable 1√ó"},
    {id:"fin_carriere",l:"Emploi fin de carri√®re",pct:20,alloc:262.64,desc:"R√©duction 1/5 d√®s 55 ans (exceptions: 50 ans)"},
  ];
  const motifs=[
    {id:"soins",l:"Soins enfant ‚â§ 8 ans"},{id:"assist",l:"Assistance membre famille malade"},
    {id:"formation",l:"Formation reconnue"},{id:"sans_motif",l:"Sans motif (si CCT sectorielle)"},
  ];
  const sel=regimes.find(r=>r.id===regime);
  const salaire=emp?.monthlySalary||0;
  const newSalaire=salaire*(1-sel.pct/100);
  const allocONEM=sel.alloc;
  const totalRevenu=newSalaire+allocONEM;
  const pertePct=salaire>0?((salaire-totalRevenu)/salaire*100).toFixed(1):0;
  
  return <div>
    <PH title="Cr√©dit-temps / Interruption de carri√®re" sub="CCT 103 du CNT ‚Äî Allocations ONEM"/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Configuration</ST>
        <I label="Travailleur" value={eid} onChange={setEid} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <I label="R√©gime" value={regime} onChange={setRegime} options={regimes.map(r=>({v:r.id,l:r.l}))}/>
        <I label="Motif" value={motif} onChange={setMotif} options={motifs.map(m=>({v:m.id,l:m.l}))}/>
        <I label="Date d√©but" type="date" value={debut} onChange={setDebut}/>
        <I label="Dur√©e (mois)" type="number" value={duree} onChange={setDuree}/>
        <div style={{marginTop:14,padding:12,background:"rgba(96,165,250,.08)",borderRadius:8,fontSize:11,color:'#60a5fa',lineHeight:1.6}}>
          <b>{sel.l}</b><br/>{sel.desc}<br/>Formulaire ONEM: <b>C61</b> (√† soumettre au bureau ONEM local)
        </div>
      </C>
      <C>
        {emp&&<div>
          <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:16}}>{emp.first} {emp.last} ‚Äî Simulation {sel.l}</div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:12,marginBottom:20}}>
            {[{l:"Salaire actuel",v:fmt(salaire),c:'#e8e6e0'},{l:"Nouveau salaire",v:fmt(newSalaire),c:'#fb923c'},{l:"Allocation ONEM",v:fmt(allocONEM),c:'#60a5fa'},{l:"Total revenu",v:fmt(totalRevenu),c:'#4ade80'}].map((x,i)=>
              <div key={i} style={{padding:14,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center',border:'1px solid rgba(198,163,78,.08)'}}>
                <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>{x.l}</div>
                <div style={{fontSize:18,fontWeight:700,color:x.c,marginTop:4}}>{x.v}</div>
              </div>
            )}
          </div>
          <div style={{padding:14,background:"rgba(248,113,113,.06)",borderRadius:8,marginBottom:16}}>
            <span style={{fontSize:12,color:'#9e9b93'}}>Perte de revenu mensuel: </span>
            <span style={{fontSize:16,fontWeight:700,color:'#f87171'}}>{fmt(salaire-totalRevenu)} (-{pertePct}%)</span>
          </div>
          <Tbl cols={[{k:'r',l:"R√©gime",b:1,r:r=>r.l},{k:'p',l:"R√©duction",a:'right',r:r=>r.pct+'%'},{k:'a',l:"Allocation ONEM/mois",a:'right',r:r=><span style={{color:'#60a5fa'}}>{fmt(r.alloc)}</span>},{k:'d',l:"Description",r:r=><span style={{fontSize:10.5,color:'#9e9b93'}}>{r.desc}</span>}]} data={regimes}/>
        </div>}
      </C>
    </div>
  </div>;
}

function IndexAutoMod({s,d}){
  const ae=s.emps||[];const [tab,setTab]=useState('sim');
  const [tauxIndex,setTauxIndex]=useState(2.0);
  const data=ae.map(e=>{const p=calc(e,DPER,s.co);const augm=p.gross*tauxIndex/100;return{e,p,augm,newGross:p.gross+augm};});
  const totAugm=data.reduce((a,r)=>a+r.augm,0);const totCout=totAugm*1.35*12;
  
  return <div>
    <PH title="Indexation Automatique" sub="Index-pivot ‚Äî Simulation impact salarial"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Taux indexation",v:tauxIndex.toFixed(2)+'%',c:'#c6a34e'},{l:"Augmentation mensuelle",v:fmt(totAugm),c:'#fb923c'},{l:"Surco√ªt annuel (charges)",v:fmt(totCout),c:'#f87171'},{l:"Travailleurs impact√©s",v:ae.length,c:'#60a5fa'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"sim",l:"Simulation"},{v:"history",l:"Historique index"},{v:"rules",l:"M√©canisme"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    {tab==='sim'&&<div style={{display:'grid',gridTemplateColumns:'250px 1fr',gap:18}}>
      <C><ST>Param√®tres</ST>
        <I label="Taux indexation (%)" type="number" value={tauxIndex} onChange={v=>setTauxIndex(+v)}/>
        <div style={{marginTop:14,padding:14,background:"rgba(198,163,78,.06)",borderRadius:8,textAlign:'center'}}>
          <div style={{fontSize:10,color:'#5e5c56'}}>SURCO√õT ANNUEL TOTAL</div>
          <div style={{fontSize:24,fontWeight:700,color:'#f87171',marginTop:4}}>{fmt(totCout)}</div>
          <div style={{fontSize:10,color:'#5e5c56'}}>charges comprises (√ó1,35)</div>
        </div>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Impact par travailleur</div></div>
        <Tbl cols={[
          {k:'n',l:"Travailleur",b:1,r:r=>`${r.e.first||r.e.fn||'Emp'} ${r.e.last||''}`},
          {k:'g',l:"Brut actuel",a:'right',r:r=>fmt(r.p.gross)},
          {k:'a',l:"Augmentation",a:'right',r:r=><span style={{color:'#fb923c'}}>+{fmt(r.augm)}</span>},
          {k:'ng',l:"Nouveau brut",a:'right',r:r=><span style={{fontWeight:600,color:'#4ade80'}}>{fmt(r.newGross)}</span>},
        ]} data={data}/>
      </C>
    </div>}
    {tab==='history'&&<C><ST>D√©passements d'index-pivot r√©cents</ST>
      {[{d:"Octobre 2025",t:'2,00%',s:'CP 200, 218, 226'},{d:"Janvier 2025",t:'2,00%',s:'CP 124 (construction)'},{d:"Novembre 2024",t:'2,00%',s:'CP 200'},{d:"Janvier 2024",t:'2,00%',s:'Tous secteurs'}].map((r,i)=>
        <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
          <b style={{color:'#e8e6e0'}}>{r.d}</b><span style={{color:'#c6a34e'}}>{r.t}</span><span style={{color:'#9e9b93',fontSize:10}}>{r.s}</span>
        </div>
      )}
    </C>}
    {tab==='rules'&&<C><ST>M√©canisme d'indexation belge</ST>
      <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
        {[{l:"Indice de base",v:"Indice sant√© liss√© (sans tabac, alcool, carburant)"},{l:"Pivot",v:"D√©clenchement quand indice d√©passe le pivot"},{l:"Taux",v:"2% √† chaque d√©passement"},{l:"Moment",v:"Varie selon CP (mensuel ou fixe janvier)"},{l:"Secteur public",v:"Automatique au mois de d√©passement"},{l:"Secteur priv√©",v:"Selon convention sectorielle"}].map((r,i)=>
          <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <span>{r.l}</span><span style={{fontWeight:600,color:'#e8e6e0'}}>{r.v}</span>
          </div>
        )}
      </div>
    </C>}
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PLAN CAF√âT√âRIA / FLEXIBLE REWARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function CafeteriaMod({s,d}){
  const [eid,setEid]=useState(s.emps[0]?.id||'');
  const [budget,setBudget]=useState(3000);
  const [choix,setChoix]=useState({});
  const ae=s.emps.filter(e=>e.status==='active');
  const emp=ae.find(e=>e.id===eid);
  
  const options=[
    {id:"pc",l:"üì± PC/Tablet/GSM",fiscal:"ATN forfaitaire (72‚Ç¨/an PC, 36‚Ç¨/an GSM, 36‚Ç¨/an internet)",max:2000},
    {id:"pension",l:"üí∞ Pension compl√©mentaire",fiscal:"Exon√©r√© si < 80% rule (LPC). ONSS 8,86% employeur",max:5000},
    {id:"epargne",l:"üè¶ √âpargne long terme",fiscal:"R√©duction imp√¥t 30% (max 2.450‚Ç¨/an)",max:2450},
    {id:"velo",l:"üö≤ V√©lo (leasing)",fiscal:"Exon√©r√© ONSS et IPP. Indemnit√© v√©lo 0,27‚Ç¨/km",max:3000},
    {id:"formation",l:"üìö Formation",fiscal:"D√©ductible 120% pour l\'employeur",max:5000},
    {id:"garde",l:"üë∂ Garde d\'enfants",fiscal:"R√©duction imp√¥t (max 15,70‚Ç¨/jour/enfant < 14 ans)",max:3000},
    {id:"multimedia",l:"üì∫ Multim√©dia",fiscal:"ATN si usage priv√©. D√©ductible employeur.",max:1500},
    {id:"mobilite",l:"üöó Budget mobilit√©",fiscal:"Voir module Budget Mobilit√© (3 piliers)",max:10000},
    {id:"conges_extra",l:"üå¥ Jours de cong√© extra",fiscal:"Conversion brut ‚Üí jours. Neutre ONSS.",max:0},
    {id:"warrants",l:"üìà Warrants",fiscal:"ONSS 13,07% sur valeur. Pas de PP si >1 an.",max:5000},
  ];
  
  const totalChoisi=Object.values(choix).reduce((a,v)=>a+(parseFloat(v)||0),0);
  const reste=budget-totalChoisi;
  
  return <div>
    <PH title="Plan Caf√©t√©ria ‚Äî Flexible Reward" sub="Optimisation salariale sur mesure"/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Configuration</ST>
        <I label="Travailleur" value={eid} onChange={setEid} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <I label="Budget annuel (‚Ç¨)" type="number" value={budget} onChange={v=>setBudget(parseFloat(v)||0)}/>
        <div style={{marginTop:14,padding:12,borderRadius:8,textAlign:'center',background:reste>=0?'rgba(74,222,128,.08)':'rgba(248,113,113,.08)'}}>
          <div style={{fontSize:11,color:'#5e5c56'}}>Budget restant</div>
          <div style={{fontSize:24,fontWeight:700,color:reste>=0?'#4ade80':'#f87171'}}>{fmt(reste)}</div>
          <div style={{fontSize:11,color:'#9e9b93'}}>sur {fmt(budget)} allou√©</div>
        </div>
      </C>
      <C style={{padding:'14px 18px',maxHeight:650,overflowY:'auto'}}>
        <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:16}}>Choix des avantages</div>
        {options.map(opt=><div key={opt.id} style={{padding:14,marginBottom:8,background:"rgba(198,163,78,.03)",border:'1px solid rgba(198,163,78,.08)',borderRadius:10}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}}>
            <span style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>{opt.l}</span>
            <div style={{width:120}}><I label="" type="number" value={choix[opt.id]||0} onChange={v=>setChoix(p=>({...p,[opt.id]:Math.min(parseFloat(v)||0,opt.max||99999)}))}/></div>
          </div>
          <div style={{fontSize:10.5,color:'#9e9b93'}}>{opt.fiscal}</div>
          {opt.max>0&&<div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>Max: {fmt(opt.max)}/an</div>}
        </div>)}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BONUS CCT 90 ‚Äî Prime non r√©currente li√©e aux r√©sultats
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function CCT90Mod({s,d}){
  const ae=s.emps||[];const [montant,setMontant]=useState(2000);const [type,setType]=useState('collectif');
  const n=ae.length;const totBrut=montant*n;
  const cotSpec=totBrut*0.3313;// 33,13% cotisation patronale sp√©ciale
  const impot=0;// exon√©r√© PP si conditions respect√©es
  const cotW=totBrut*0.1307;
  const netTrav=totBrut-cotW;
  
  return <div>
    <PH title="CCT 90 ‚Äî Bonus Salarial" sub="Avantages non r√©currents li√©s aux r√©sultats ‚Äî Plan bonus"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Bonus/trav.",v:fmt(montant),c:'#c6a34e'},{l:"Co√ªt total employeur",v:fmt(totBrut+cotSpec),c:'#f87171',s:'bonus + 33,13%'},{l:"Net travailleur",v:fmt(netTrav/n),c:'#4ade80',s:'apr√®s ONSS 13,07%'},{l:"Plafond 2026",v:"‚Ç¨ 4.020",c:'#a78bfa',s:'par travailleur'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
          {k.s&&<div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{k.s}</div>}
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'300px 1fr',gap:18}}>
      <div>
        <C><ST>Param√®tres plan bonus</ST>
          <I label="Montant par travailleur (‚Ç¨)" type="number" value={montant} onChange={v=>setMontant(+v)}/>
          <I label="Type" value={type} onChange={v=>setType(v)} style={{marginTop:9}} options={[{v:"collectif",l:"Collectif (tous les travailleurs)"},{v:"categorie",l:"Par cat√©gorie objective"},{v:"entreprise",l:"Objectif d\'entreprise"}]}/>
          <div style={{marginTop:14,padding:14,background:"rgba(198,163,78,.06)",borderRadius:8}}>
            <div style={{fontSize:11,color:'#9e9b93',lineHeight:2}}>
              {[{l:"Bonus brut total",v:fmt(totBrut)},{l:"Cotis. patronale 33,13%",v:fmt(cotSpec)},{l:"Co√ªt total employeur",v:fmt(totBrut+cotSpec)},{l:"ONSS trav. 13,07%",v:fmt(cotW)},{l:"PP travailleur",v:"‚Ç¨ 0 (exon√©r√©)"},{l:"Net total travailleurs",v:fmt(netTrav)}].map((r,i)=>
                <div key={i} style={{display:'flex',justifyContent:'space-between',borderBottom:'1px solid rgba(255,255,255,.03)',padding:'2px 0'}}>
                  <span>{r.l}</span><span style={{fontWeight:600,color:r.l.includes('Co√ªt')?'#f87171':r.l.includes('Net')?'#4ade80':'#e8e6e0'}}>{r.v}</span>
                </div>
              )}
            </div>
          </div>
        </C>
      </div>
      <C><ST>Proc√©dure CCT 90</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {['1. R√©daction de l\'acte d\'adh√©sion (< 50 trav.) ou CCT d\'entreprise (‚â• 50)',"2. Objectifs mesurables, v√©rifiables, incertains","3. P√©riode de r√©f√©rence: min. 3 mois","4. D√©p√¥t au SPF ETCS (greffe)","5. √âvaluation des r√©sultats √† la fin de la p√©riode","6. Paiement si objectifs atteints","7. Mention sur fiche de paie (code sp√©cifique)"].map((step,i)=>
            <div key={i} style={{padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>{step}</div>
          )}
        </div>
        <div style={{marginTop:12,display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
          {[{t:'Avantages employeur',items:['Cotis. 33,13% (vs ~35% salaire)',"D√©ductible fiscalement","Motivation √©quipe"]},{t:'Avantages travailleur',items:['Exon√©r√© pr√©compte prof.',"Seul 13,07% ONSS","Jusqu'√† ‚Ç¨4.020/an net"]}].map((col,ci)=>
            <div key={ci} style={{padding:10,background:"rgba(74,222,128,.04)",borderRadius:8}}>
              <div style={{fontWeight:600,color:'#4ade80',fontSize:11,marginBottom:4}}>{col.t}</div>
              {col.items.map((it,ii)=><div key={ii} style={{fontSize:10.5,color:'#9e9b93',padding:'2px 0'}}>‚úì {it}</div>)}
            </div>
          )}
        </div>
      </C>
    </div>
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BUDGET MOBILIT√â ‚Äî 3 Piliers (Loi 17/03/2019)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function BudgetMobiliteMod({s,d}){
  const [eid,setEid]=useState(s.emps[0]?.id||'');
  const [budgetAn,setBudgetAn]=useState(6000);
  const [p1,setP1]=useState(0);
  const [p2,setP2]=useState(0);
  const ae=s.emps.filter(e=>e.status==='active');
  const p3=Math.max(0,budgetAn-p1-p2);
  const cotP3=p3*0.3807; // 38,07% cotisation sp√©ciale sur pilier 3
  const netP3=p3-cotP3;
  
  return <div>
    <PH title="Budget mobilit√©" sub="Loi du 17/03/2019 ‚Äî Alternative voiture de soci√©t√©"/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Configuration</ST>
        <I label="Travailleur" value={eid} onChange={setEid} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <I label="Budget annuel (‚Ç¨)" type="number" value={budgetAn} onChange={v=>setBudgetAn(parseFloat(v)||0)}/>
        <I label="Pilier 1 ‚Äî Voiture √©co (‚Ç¨/an)" type="number" value={p1} onChange={v=>setP1(parseFloat(v)||0)}/>
        <I label="Pilier 2 ‚Äî Mobilit√© durable (‚Ç¨/an)" type="number" value={p2} onChange={v=>setP2(parseFloat(v)||0)}/>
        <div style={{marginTop:14,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,textAlign:'center'}}>
          <div style={{fontSize:11,color:'#5e5c56'}}>Pilier 3 ‚Äî Solde en cash</div>
          <div style={{fontSize:22,fontWeight:700,color:'#c6a34e'}}>{fmt(p3)}</div>
          <div style={{fontSize:11,color:'#9e9b93'}}>Net apr√®s cotisation: {fmt(netP3)}</div>
        </div>
      </C>
      <C>
        <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:16}}>R√©partition des 3 piliers</div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:14,marginBottom:20}}>
          {[
            {l:"Pilier 1",sub:'Voiture √©cologique',v:p1,c:'#fb923c',desc:"Voiture + √©missions CO2 ‚â§ seuil. ATN calcul√© sur la nouvelle voiture."},
            {l:"Pilier 2",sub:'Mobilit√© durable',v:p2,c:'#60a5fa',desc:"Transports en commun, v√©lo, trottinette, logement (max 400‚Ç¨/mois si < 10km travail). Exon√©r√© ONSS et IPP."},
            {l:"Pilier 3",sub:'Solde en cash',v:p3,c:'#4ade80',desc:`Cotisation sp√©ciale: 38,07%. Net: ${fmt(netP3)}. Pas de PP ni d'ONSS ordinaire.`},
          ].map((x,i)=>
            <div key={i} style={{padding:16,background:"rgba(198,163,78,.04)",borderRadius:8,border:'1px solid rgba(198,163,78,.08)'}}>
              <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>{x.l}</div>
              <div style={{fontSize:11,color:x.c,fontWeight:600}}>{x.sub}</div>
              <div style={{fontSize:22,fontWeight:700,color:x.c,marginTop:8}}>{fmt(x.v)}</div>
              <div style={{fontSize:10,color:'#9e9b93',marginTop:6,lineHeight:1.5}}>{x.desc}</div>
            </div>
          )}
        </div>
        <div style={{height:24,borderRadius:8,overflow:'hidden',display:'flex',marginBottom:10}}>
          <div style={{width:`${budgetAn>0?p1/budgetAn*100:0}%`,background:"#fb923c",transition:'width .3s'}}/>
          <div style={{width:`${budgetAn>0?p2/budgetAn*100:0}%`,background:"#60a5fa",transition:'width .3s'}}/>
          <div style={{flex:1,background:"#4ade80"}}/>
        </div>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATISTIQUES INS ‚Äî Structure des r√©mun√©rations
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function StatsINSMod({s,d}){
  const ae=s.emps||[];const n=ae.length;
  const [yr,setYr]=useState(new Date().getFullYear());
  
  // Stats par genre
  const hommes=ae.filter(e=>e.sex==='M').length;const femmes=ae.filter(e=>e.sex==='F').length;const autres=n-hommes-femmes;
  // Stats par statut
  const emp=ae.filter(e=>e.statut!=='ouvrier').length;const ouv=ae.filter(e=>e.statut==='ouvrier').length;
  // Stats par r√©gime
  const ft=ae.filter(e=>!e.regime||e.regime==='full').length;const pt=n-ft;
  // Masse salariale
  const masse=ae.reduce((a,e)=>{const p=calc(e,DPER,s.co);return a+p.gross*12},0);
  // Age moyen
  const ages=ae.map(e=>{if(!e.birth)return 35;const b=new Date(e.birth);return Math.floor((Date.now()-b)/31557600000);});
  const ageMoy=ages.length?Math.round(ages.reduce((a,b)=>a+b,0)/ages.length):0;
  // Anciennet√© moyenne
  const ancs=ae.map(e=>{if(!e.startD)return 2;const s2=new Date(e.startD);return Math.round((Date.now()-s2)/31557600000*10)/10;});
  const ancMoy=ancs.length?(ancs.reduce((a,b)=>a+b,0)/ancs.length).toFixed(1):0;
  
  return <div>
    <PH title="Statistiques & Indicateurs RH" sub="Donn√©es consolid√©es ‚Äî Bilan social, reporting, benchmarks"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(6,1fr)',gap:10,marginBottom:18}}>
      {[{l:"Effectif",v:n,c:'#60a5fa'},{l:"√Çge moyen",v:ageMoy+'a',c:'#a78bfa'},{l:"Anciennet√© moy.",v:ancMoy+'a',c:'#c6a34e'},{l:"Masse salariale",v:fmt(masse),c:'#4ade80'},{l:"Temps plein",v:ft,c:'#e8e6e0'},{l:"Temps partiel",v:pt,c:'#fb923c'}].map((k,i)=>
        <div key={i} style={{padding:'12px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)',textAlign:'center'}}>
          <div style={{fontSize:9,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:18,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:18}}>
      <C><ST>R√©partition H/F</ST>
        {[{l:"Hommes",v:hommes,pct:n?Math.round(hommes/n*100):0,c:'#60a5fa'},{l:"Femmes",v:femmes,pct:n?Math.round(femmes/n*100):0,c:'#f472b6'},{l:"Non renseign√©",v:autres,pct:n?Math.round(autres/n*100):0,c:'#9e9b93'}].map((r,i)=>
          <div key={i} style={{marginBottom:8}}>
            <div style={{display:'flex',justifyContent:'space-between',fontSize:12,marginBottom:3}}><span style={{color:'#9e9b93'}}>{r.l}</span><span style={{fontWeight:600,color:r.c}}>{r.v} ({r.pct}%)</span></div>
            <div style={{height:6,background:"rgba(255,255,255,.04)",borderRadius:3}}><div style={{height:6,background:r.c,borderRadius:3,width:r.pct+'%'}}/></div>
          </div>
        )}
      </C>
      <C><ST>Statut</ST>
        {[{l:"Employ√©s",v:emp,pct:n?Math.round(emp/n*100):0,c:'#60a5fa'},{l:"Ouvriers",v:ouv,pct:n?Math.round(ouv/n*100):0,c:'#fb923c'}].map((r,i)=>
          <div key={i} style={{marginBottom:8}}>
            <div style={{display:'flex',justifyContent:'space-between',fontSize:12,marginBottom:3}}><span style={{color:'#9e9b93'}}>{r.l}</span><span style={{fontWeight:600,color:r.c}}>{r.v} ({r.pct}%)</span></div>
            <div style={{height:6,background:"rgba(255,255,255,.04)",borderRadius:3}}><div style={{height:6,background:r.c,borderRadius:3,width:r.pct+'%'}}/></div>
          </div>
        )}
        <div style={{marginTop:12,fontSize:11,color:'#9e9b93'}}>
          <div>Ratio employ√©s/ouvriers: <b style={{color:'#e8e6e0'}}>{ouv>0?(emp/ouv).toFixed(1):'‚àû'}</b></div>
          <div>Benchmark BE: <b style={{color:'#e8e6e0'}}>~70/30</b></div>
        </div>
      </C>
      <C><ST>Pyramide des √¢ges</ST>
        {[{t:'< 25 ans',c:'#4ade80'},{t:'25-34',c:'#60a5fa'},{t:'35-44',c:'#a78bfa'},{t:'45-54',c:'#fb923c'},{t:'55+',c:'#f87171'}].map((tr,i)=>{
          const count=ages.filter(a=>i===0?a<25:i===1?a>=25&&a<35:i===2?a>=35&&a<45:i===3?a>=45&&a<55:a>=55).length;
          const pct=n?Math.round(count/n*100):0;
          return <div key={i} style={{marginBottom:6}}>
            <div style={{display:'flex',justifyContent:'space-between',fontSize:11,marginBottom:2}}><span style={{color:'#9e9b93'}}>{tr.t}</span><span style={{color:tr.c,fontWeight:600}}>{count} ({pct}%)</span></div>
            <div style={{height:5,background:"rgba(255,255,255,.04)",borderRadius:3}}><div style={{height:5,background:tr.c,borderRadius:3,width:Math.max(2,pct)+'%'}}/></div>
          </div>;
        })}
      </C>
    </div>
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  WARRANTS ‚Äî Stock options / Optimisation fiscale
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function WarrantsMod({s,d}){
  const [montant,setMontant]=useState(3000);
  const [type,setType]=useState('warrant');
  const ae=s.emps.filter(e=>e.status==='active');
  const onssW=montant*0.1307;
  const onssE=montant*0.25;
  const avFiscal=type==='warrant'?montant*0.18:montant*0.165;
  const ppWarrant=avFiscal*0.535;
  const netTrav=montant-onssW-ppWarrant;
  const coutEmpl=montant+onssE;
  const netClassique=montant*(1-0.1307)*(1-0.45);
  const gain=netTrav-netClassique;
  
  return <div>
    <PH title="Warrants / Stock Options" sub="Optimisation fiscale ‚Äî Loi 26/03/1999"/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Configuration</ST>
        <I label="Montant brut (‚Ç¨)" type="number" value={montant} onChange={v=>setMontant(parseFloat(v)||0)}/>
        <I label="Type" value={type} onChange={setType} options={[{v:"warrant",l:"Warrants (18%)"},{v:"options",l:"Stock options (16,5%)"}]}/>
        <div style={{marginTop:14,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>Comparaison</div>
          <div>Net warrant: <b style={{color:'#4ade80'}}>{fmt(netTrav)}</b></div>
          <div>Net classique: <b style={{color:'#e8e6e0'}}>{fmt(netClassique)}</b></div>
          <div>Gain net: <b style={{color:'#4ade80'}}>+{fmt(gain)}</b></div>
        </div>
      </C>
      <C>
        <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginBottom:16}}>Simulation ‚Äî {ae.length} travailleur(s)</div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14,marginBottom:20}}>
          <div style={{padding:16,background:"rgba(74,222,128,.06)",borderRadius:8,border:'1px solid rgba(74,222,128,.15)'}}>
            <div style={{fontSize:12,fontWeight:600,color:'#4ade80',marginBottom:8}}>Via Warrants</div>
            <div style={{fontSize:11,color:'#9e9b93',lineHeight:2}}>
              Brut: {fmt(montant)}<br/>ONSS (13,07%): -{fmt(onssW)}<br/>
              Base imposable (18%): {fmt(avFiscal)}<br/>PP (~53,5%): -{fmt(ppWarrant)}<br/>
              <b style={{color:'#4ade80',fontSize:14}}>Net: {fmt(netTrav)}</b>
            </div>
          </div>
          <div style={{padding:16,background:"rgba(248,113,113,.06)",borderRadius:8,border:'1px solid rgba(248,113,113,.15)'}}>
            <div style={{fontSize:12,fontWeight:600,color:'#f87171',marginBottom:8}}>Via Brut classique</div>
            <div style={{fontSize:11,color:'#9e9b93',lineHeight:2}}>
              Brut: {fmt(montant)}<br/>ONSS (13,07%): -{fmt(onssW)}<br/>
              PP (~45%): -{fmt((montant-onssW)*0.45)}<br/>
              <b style={{color:'#f87171',fontSize:14}}>Net: {fmt(netClassique)}</b>
            </div>
          </div>
        </div>
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PLAN DE FORMATION ‚Äî Obligation l√©gale (Loi 3/10/2022)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function PlanFormationMod({s,d}){
  const ae=s.emps||[];const [formations,setFormations]=useState([]);
  const [f,setF]=useState({titre:"",type:"interne",duree:8,emps:[],budget:500,date:'',formateur:''});
  const n=ae.length;
  // Obligation: 5 jours/an/ETP (loi 3/10/2022)
  const obligMin=n*5;const hRealisees=formations.reduce((a,c)=>a+(+c.duree||0)*(c.emps?.length||0),0);
  const budgetTotal=formations.reduce((a,c)=>a+(+c.budget||0),0);
  
  const add=()=>{if(!f.titre)return;setFormations(p=>[{...f,id:"FORM-"+Date.now()},...p]);setF({titre:"",type:"interne",duree:8,emps:[],budget:500,date:'',formateur:''});};
  
  return <div>
    <PH title="Plan de Formation" sub="Obligation 5 jours/an/ETP ‚Äî Loi du 3/10/2022"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:10,marginBottom:18}}>
      {[{l:"Formations",v:formations.length,c:'#60a5fa'},{l:"Heures r√©alis√©es",v:hRealisees,c:'#a78bfa'},{l:"Objectif (jours)",v:obligMin,c:'#c6a34e',s:n+' ETP √ó 5j'},{l:"Budget consomm√©",v:fmt(budgetTotal),c:'#f87171'},{l:"Taux r√©alisation",v:obligMin?(Math.round(hRealisees/8/obligMin*100))+'%':'0%',c:hRealisees/8>=obligMin?'#4ade80':'#fb923c'}].map((k,i)=>
        <div key={i} style={{padding:'12px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)',textAlign:'center'}}>
          <div style={{fontSize:9,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:18,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
          {k.s&&<div style={{fontSize:9,color:'#5e5c56',marginTop:1}}>{k.s}</div>}
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'350px 1fr',gap:18}}>
      <div>
        <C><ST>Nouvelle formation</ST>
          <I label="Titre" value={f.titre} onChange={v=>setF({...f,titre:v})}/>
          <I label="Type" value={f.type} onChange={v=>setF({...f,type:v})} style={{marginTop:9}} options={[{v:"interne",l:"Formation interne"},{v:"externe",l:"Formation externe"},{v:"elearning",l:"E-learning"},{v:"conference",l:"Conf√©rence/S√©minaire"},{v:"coaching",l:"Coaching individuel"}]}/>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
            <I label="Dur√©e (heures)" type="number" value={f.duree} onChange={v=>setF({...f,duree:+v})}/>
            <I label="Budget (‚Ç¨)" type="number" value={f.budget} onChange={v=>setF({...f,budget:+v})}/>
          </div>
          <I label="Formateur" value={f.formateur} onChange={v=>setF({...f,formateur:v})} style={{marginTop:9}}/>
          <I label="Date" type="date" value={f.date} onChange={v=>setF({...f,date:v})} style={{marginTop:9}}/>
          <B onClick={add} style={{width:'100%',marginTop:14}}>Ajouter formation</B>
        </C>
        <C style={{marginTop:12}}><ST>Obligation l√©gale</ST>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
            <div>Minimum: <b style={{color:'#c6a34e'}}>5 jours/an/ETP</b></div>
            <div>Base: <b style={{color:'#e8e6e0'}}>Loi 3/10/2022 (deal emploi)</b></div>
            <div>Entreprises ‚â•20: <b style={{color:'#e8e6e0'}}>Plan obligatoire (30/09)</b></div>
            <div>Entreprises 10-19: <b style={{color:'#e8e6e0'}}>Cr√©dit individuel 1j/an</b></div>
            <div>Droit individuel: <b style={{color:'#e8e6e0'}}>Pas de report sur N+1</b></div>
          </div>
          <div style={{marginTop:8,padding:8,background:"rgba(248,113,113,.06)",borderRadius:6,fontSize:10.5,color:'#f87171'}}>
            <b>CCT sectorielle:</b> V√©rifier si le secteur pr√©voit des obligations sup√©rieures.
          </div>
        </C>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Formations planifi√©es ({formations.length})</div></div>
        {formations.length>0?<Tbl cols={[
          {k:'t',l:"Formation",b:1,r:r=>r.titre},
          {k:'tp',l:"Type",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:"rgba(96,165,250,.1)",color:'#60a5fa'}}>{r.type}</span>},
          {k:'d',l:"Dur√©e",a:'right',r:r=>`${r.duree}h`},
          {k:'f',l:"Formateur",r:r=>r.formateur||'‚Äî'},
          {k:'dt',l:"Date",r:r=>r.date||'√Ä planifier'},
          {k:'b',l:"Budget",a:'right',r:r=><span style={{fontWeight:600,color:'#c6a34e'}}>{fmt(r.budget)}</span>},
        ]} data={formations}/>:<div style={{padding:40,textAlign:'center',color:'#5e5c56'}}>Aucune formation planifi√©e</div>}
      </C>
    </div>
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NOTES DE FRAIS ‚Äî Remboursement frais propres employeur
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function NoteFraisMod({s,d}){
  const [eid,setEid]=useState(s.emps[0]?.id||'');
  const [notes,setNotes]=useState([]);
  const ae=s.emps.filter(e=>e.status==='active');
  const addNote=()=>setNotes(p=>[...p,{id:Date.now(),date:'',desc:"",cat:"deplacement",montant:0,justif:false}]);
  const updN=(id,k,v)=>setNotes(p=>p.map(n=>n.id===id?{...n,[k]:v}:n));
  const remN=(id)=>setNotes(p=>p.filter(n=>n.id!==id));
  const cats=[
    {id:"deplacement",l:"üöó D√©placement",forfait:'0,4280‚Ç¨/km (2026)'},
    {id:"repas",l:"üçΩÔ∏è Repas d\'affaires",forfait:'Max raisonnable + justificatif'},
    {id:"logement",l:"üè® Logement",forfait:'Facture originale'},
    {id:"telecom",l:"üì± T√©l√©com/Internet",forfait:'Forfait ou r√©el'},
    {id:"bureau",l:"üè† Bureau √† domicile",forfait:'Forfait 148,73‚Ç¨/mois (2026)'},
    {id:"materiel",l:"üì¶ Mat√©riel/Fournitures",forfait:'Facture originale'},
    {id:"parking",l:"üÖøÔ∏è Parking",forfait:'Ticket/re√ßu'},
    {id:"divers",l:"üìã Autres",forfait:'Justificatif obligatoire'},
  ];
  const total=notes.reduce((a,n)=>a+parseFloat(n.montant||0),0);
  
  return <div>
    <PH title="Notes de frais" sub="Frais propres √† l'employeur ‚Äî Exon√©r√© ONSS et IPP" actions={<B onClick={addNote}>+ Note de frais</B>}/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Travailleur</ST>
        <I label="Employ√©" value={eid} onChange={setEid} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <div style={{marginTop:14,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>Total</div>
          <div>Notes: <b style={{color:'#e8e6e0'}}>{notes.length}</b></div>
          <div>Montant total: <b style={{color:'#4ade80'}}>{fmt(total)}</b></div>
        </div>
        <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          <b>Forfait km 2026:</b> 0,4280‚Ç¨/km<br/>
          <b>Bureau domicile:</b> max 148,73‚Ç¨/mois<br/>
          Exon√©r√© ONSS et IPP si frais r√©els ou forfait accept√© par le fisc.
        </div>
      </C>
      <C style={{padding:'14px 18px',maxHeight:600,overflowY:'auto'}}>
        {notes.length===0&&<div style={{textAlign:'center',padding:40,color:'#5e5c56'}}>Aucune note de frais</div>}
        {notes.map((n,i)=><div key={n.id} style={{padding:14,marginBottom:10,background:"rgba(198,163,78,.03)",border:'1px solid rgba(198,163,78,.08)',borderRadius:10}}>
          <div style={{display:'flex',justifyContent:'space-between',marginBottom:8}}>
            <span style={{fontSize:12,fontWeight:600,color:'#e8e6e0'}}>Note {i+1}</span>
            <button onClick={()=>remN(n.id)} style={{background:"rgba(248,113,113,.1)",border:'1px solid rgba(248,113,113,.2)',borderRadius:6,color:'#f87171',padding:'3px 10px',cursor:'pointer',fontSize:11,fontFamily:'inherit'}}>‚úï</button>
          </div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 1fr',gap:10}}>
            <I label="Date" type="date" value={n.date} onChange={v=>updN(n.id,"date",v)}/>
            <I label="Cat√©gorie" value={n.cat} onChange={v=>updN(n.id,"cat",v)} options={cats.map(c=>({v:c.id,l:c.l}))}/>
            <I label="Montant (‚Ç¨)" type="number" value={n.montant} onChange={v=>updN(n.id,"montant",v)}/>
            <I label="Description" value={n.desc} onChange={v=>updN(n.id,"desc",v)}/>
          </div>
        </div>)}
      </C>
    </div>
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HEURES SUPPL√âMENTAIRES ‚Äî Calcul majorations & r√©cup√©ration
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function HeuresSupMod({s,d}){
  const [eid,setEid]=useState(s.emps[0]?.id||'');
  const [heures,setHeures]=useState([]);
  const [tab,setTab]=useState('saisie');
  const ae=s.emps.filter(e=>e.status==='active');
  const emp=ae.find(e=>e.id===eid);
  const addH=()=>setHeures(p=>[...p,{id:Date.now(),date:'',type:"sem",h:0}]);
  const updH=(id,k,v)=>setHeures(p=>p.map(x=>x.id===id?{...x,[k]:v}:x));
  const delH=(id)=>setHeures(p=>p.filter(x=>x.id!==id));
  // ‚îÄ‚îÄ Limites fiscales 2026 ‚îÄ‚îÄ
  const LIMIT_FISCAL=130; // heures avec r√©duction PP (66,81% du sursalaire)
  const LIMIT_VOLONTAIRE=120; // heures volontariat/an
  const LIMIT_RELANCE=120; // heures relance suppl√©mentaires
  
  const types=[
    {id:"sem",l:"Semaine (jours ouvrables)",maj:50,recup:true,fiscal:true},
    {id:"sam",l:"Samedi",maj:50,recup:true,fiscal:true},
    {id:"dim",l:"Dimanche",maj:100,recup:true,fiscal:true},
    {id:"ferie",l:"Jour f√©ri√©",maj:100,recup:true,fiscal:true},
    {id:"nuit",l:"Nuit (20h-06h)",maj:25,recup:false,fiscal:false},
    {id:"volontaire",l:"Volontariat (max 120h/an)",maj:0,recup:false,fiscal:false},
    {id:"relance",l:"Heures relance (120h supp.)",maj:50,recup:false,fiscal:true},
  ];
  
  const hr=emp?(emp.monthlySalary/(emp.whWeek||38)/4.33):0;
  const results=heures.map(h=>{
    const t=types.find(x=>x.id===h.type)||types[0];
    const hh=parseFloat(h.h)||0;
    const base=hh*hr;
    const majoration=base*(t.maj/100);
    return{...h,tauxH:hr,base,majoration,total:base+majoration,recup:t.recup?hh:0,typeName:t.l,majPct:t.maj,fiscal:t.fiscal};
  });
  const totH=results.reduce((a,r)=>a+(parseFloat(r.h)||0),0);
  const totMaj=results.reduce((a,r)=>a+r.majoration,0);
  const totRecup=results.reduce((a,r)=>a+r.recup,0);
  const totBrut=results.reduce((a,r)=>a+r.total,0);
  // Fiscal tracking
  const hFiscales=results.filter(r=>r.fiscal).reduce((a,r)=>a+(parseFloat(r.h)||0),0);
  const hVolontaire=results.filter(r=>r.type==='volontaire').reduce((a,r)=>a+(parseFloat(r.h)||0),0);
  const pctFiscal=Math.min(100,Math.round(hFiscales/LIMIT_FISCAL*100));
  const redPP=Math.min(hFiscales,LIMIT_FISCAL)*hr*0.5*0.6681; // r√©duction PP sur sursalaire 50% des 130 premi√®res h
  const redONSSPatronal=Math.min(hFiscales,LIMIT_FISCAL)*hr*0.5*0.4143; // dispense versement PP employeur
  
  return <div>
    <PH title="Heures suppl√©mentaires" sub="Loi 16/03/1971 ‚Äî Majorations, r√©cup√©ration & avantage fiscal" actions={<B onClick={addH}>+ Prestations</B>}/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Total heures",v:totH+'h',c:'#fb923c'},{l:"Majorations",v:fmt(totMaj),c:'#f87171'},{l:"Brut total",v:fmt(totBrut),c:'#4ade80'},{l:"R√©cup. due",v:totRecup+'h',c:'#60a5fa'},{l:"R√©duction PP",v:fmt(redPP),c:'#a78bfa'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    {/* Fiscal gauge */}
    <div style={{marginBottom:18,padding:16,background:'rgba(198,163,78,.04)',borderRadius:12,border:'1px solid rgba(198,163,78,.08)'}}>
      <div style={{display:'flex',justifyContent:'space-between',marginBottom:8}}>
        <span style={{fontSize:12,fontWeight:600,color:'#c6a34e'}}>Compteur fiscal ‚Äî {hFiscales}h / {LIMIT_FISCAL}h (r√©duction PP 66,81%)</span>
        <span style={{fontSize:12,color:pctFiscal>=100?'#f87171':'#4ade80',fontWeight:600}}>{pctFiscal}%{pctFiscal>=100?' ‚Äî LIMITE ATTEINTE':''}</span>
      </div>
      <div style={{height:8,background:'rgba(139,115,60,.15)',borderRadius:4,overflow:'hidden'}}>
        <div style={{width:pctFiscal+'%',height:'100%',background:pctFiscal>=100?'#f87171':pctFiscal>=80?'#fb923c':'#4ade80',borderRadius:4,transition:'width .3s'}}/>
      </div>
      <div style={{display:'flex',justifyContent:'space-between',marginTop:6,fontSize:10,color:'#5e5c56'}}>
        <span>R√©duction PP travailleur: {fmt(redPP)}</span>
        <span>Dispense versement PP employeur: {fmt(redONSSPatronal)}</span>
        <span>Volontariat: {hVolontaire}h / {LIMIT_VOLONTAIRE}h</span>
      </div>
    </div>
    {/* Tabs */}
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:'saisie',l:'Saisie prestations'},{v:'recap',l:'R√©capitulatif'},{v:'regles',l:'R√®gles l√©gales'}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    {tab==='saisie'&&<div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <C>
        <ST>Travailleur</ST>
        <I label="Employ√©" value={eid} onChange={setEid} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        {emp&&<div style={{marginTop:14,padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,fontSize:12,color:'#9e9b93',lineHeight:2}}>
          <div style={{fontWeight:600,color:'#c6a34e',marginBottom:4}}>R√©sum√©</div>
          <div>Taux horaire: <b style={{color:'#e8e6e0'}}>{fmt(hr)}/h</b></div>
          <div>R√©gime: <b style={{color:'#e8e6e0'}}>{emp.whWeek||38}h/sem</b></div>
          <div>Total heures sup: <b style={{color:'#fb923c'}}>{totH}h</b></div>
          <div>Majorations: <b style={{color:'#f87171'}}>{fmt(totMaj)}</b></div>
          <div>Brut total: <b style={{color:'#4ade80'}}>{fmt(totBrut)}</b></div>
          <div>R√©cup√©ration due: <b style={{color:'#60a5fa'}}>{totRecup}h</b></div>
          <div>R√©duction PP (130h): <b style={{color:'#a78bfa'}}>{fmt(redPP)}</b></div>
        </div>}
      </C>
      <C style={{padding:'14px 18px',maxHeight:600,overflowY:'auto'}}>
        {heures.length===0&&<div style={{textAlign:'center',padding:40,color:'#5e5c56'}}>Aucune prestation enregistr√©e ‚Äî cliquez + Prestations</div>}
        {heures.map((h,i)=><div key={h.id} style={{padding:12,marginBottom:8,background:"rgba(198,163,78,.03)",border:'1px solid rgba(198,163,78,.08)',borderRadius:10}}>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr 80px 40px',gap:10,alignItems:'end'}}>
            <I label="Date" type="date" value={h.date} onChange={v=>updH(h.id,"date",v)}/>
            <I label="Type" value={h.type} onChange={v=>updH(h.id,"type",v)} options={types.map(t=>({v:t.id,l:`${t.l} (+${t.maj}%)`}))}/>
            <I label="Heures" type="number" value={h.h} onChange={v=>updH(h.id,"h",v)}/>
            <div style={{padding:'8px 0',textAlign:'right'}}>
              <div style={{fontSize:10,color:'#5e5c56'}}>Brut</div>
              <div style={{fontSize:14,fontWeight:600,color:'#4ade80'}}>{results[i]?fmt(results[i].total):'-'}</div>
            </div>
            <button onClick={()=>delH(h.id)} style={{background:'none',border:'none',color:'#f87171',cursor:'pointer',fontSize:16,padding:'8px 0'}}>‚úï</button>
          </div>
        </div>)}
      </C>
    </div>}
    {tab==='recap'&&<C>
      <ST>R√©capitulatif par type</ST>
      {results.length>0?<Tbl cols={[
        {k:'t',l:"Type",b:1,r:r=>r.typeName},
        {k:'h',l:"Heures",a:'right',r:r=><span style={{fontWeight:600}}>{r.h}h</span>},
        {k:'m',l:"Majoration",a:'right',r:r=><span style={{color:'#c6a34e'}}>{r.majPct}%</span>},
        {k:'b',l:"Base",a:'right',r:r=>fmt(r.base)},
        {k:'j',l:"Sursalaire",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.majoration)}</span>},
        {k:'to',l:"Total brut",a:'right',r:r=><span style={{fontWeight:700,color:'#4ade80'}}>{fmt(r.total)}</span>},
        {k:'re',l:"R√©cup.",a:'right',r:r=>r.recup>0?<span style={{color:'#60a5fa'}}>{r.recup}h</span>:'‚Äî'},
        {k:'fi',l:"Fiscal",a:'right',r:r=>r.fiscal?<span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:'rgba(167,139,250,.1)',color:'#a78bfa'}}>66,81%</span>:'‚Äî'},
      ]} data={results}/>:<div style={{padding:30,textAlign:'center',color:'#5e5c56'}}>Ajoutez des prestations dans l'onglet Saisie</div>}
    </C>}
    {tab==='regles'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Majorations l√©gales</ST>
        <div style={{fontSize:12,color:'#c8c5bb',lineHeight:2}}>
          <div><b style={{color:'#c6a34e'}}>Semaine/Samedi:</b> +50% (Art. 29 Loi 16/03/1971)</div>
          <div><b style={{color:'#c6a34e'}}>Dimanche/F√©ri√©:</b> +100%</div>
          <div><b style={{color:'#c6a34e'}}>Nuit (20h-06h):</b> +25% (varie selon CP)</div>
          <div><b style={{color:'#c6a34e'}}>R√©cup√©ration:</b> obligatoire dans le trimestre</div>
          <div><b style={{color:'#c6a34e'}}>Volontariat:</b> 120h/an ‚Äî pas de majoration ni r√©cup (Loi Peeters 2017)</div>
          <div><b style={{color:'#c6a34e'}}>Heures relance:</b> 120h/an suppl√©mentaires (AR COVID prolong√©)</div>
        </div>
      </C>
      <C><ST>Avantage fiscal ‚Äî 130h/an</ST>
        <div style={{fontSize:12,color:'#c8c5bb',lineHeight:2}}>
          <div><b style={{color:'#a78bfa'}}>Travailleur:</b> R√©duction PP de 66,81% sur le sursalaire des 130 premi√®res heures</div>
          <div><b style={{color:'#a78bfa'}}>Employeur:</b> Dispense de versement PP de 41,43% sur le m√™me sursalaire</div>
          <div><b style={{color:'#a78bfa'}}>Au-del√† de 130h:</b> Le sursalaire est tax√© normalement</div>
          <div><b style={{color:'#a78bfa'}}>Condition:</b> Heures sup prest√©es au-del√† de la dur√©e hebdomadaire (38h/sem ou CCT)</div>
          <div style={{marginTop:8,padding:10,background:'rgba(167,139,250,.06)',borderRadius:8,color:'#a78bfa',fontSize:11}}>
            <b>Exemple:</b> 130h √ó taux horaire 25‚Ç¨ √ó sursalaire 50% = 1.625‚Ç¨ de sursalaire.<br/>
            R√©duction PP travailleur: 1.625‚Ç¨ √ó 66,81% = <b>1.085,66‚Ç¨</b> d'√©conomie.
          </div>
        </div>
      </C>
    </div>}
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NOUVEAUX MODULES ‚Äî Benchmark Securex/Partena/UCM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function SimCoutMod({s,d}){
  const [brut,setBrut]=useState(3500);const [statut,setStatut]=useState('employe');const [regime,setRegime]=useState('full');
  const [cp,setCp]=useState('200');const [sec,setSec]=useState('marchand');
  
  const isOuv=statut==='ouvrier';
  const baseONSS=isOuv?brut*1.08:brut;
  const onssW=baseONSS*0.1307;
  const onssERate=sec==='marchand'?0.25:0.3240;
  const onssE=baseONSS*onssERate;
  const ffe=baseONSS*0.0013;
  const chomT=baseONSS*0.001;
  const totONSSE=onssE+ffe+chomT;
  const pecVac=isOuv?0:brut*0.1538;// employeurs - ouvriers via caisse
  const assAT=brut*12*0.003/12;
  const assGroupe=brut*0.03;
  const medTrav=91.50/12;
  const cr=220*(8-1.09)/12;// ch√®ques repas part employeur
  const eco=250/12;
  const totCout=brut+totONSSE+pecVac+assAT+assGroupe+medTrav+cr+eco;
  const ratio=totCout/brut;
  
  return <div>
    <PH title="Simulation Co√ªt Salarial Total" sub="Co√ªt employeur complet ‚Äî ONSS, avantages, provisions"/>
    <div style={{display:'grid',gridTemplateColumns:'300px 1fr',gap:18}}>
      <div>
        <C><ST>Param√®tres</ST>
          <I label="Brut mensuel (‚Ç¨)" type="number" value={brut} onChange={v=>setBrut(+v)}/>
          <I label="Statut" value={statut} onChange={setStatut} style={{marginTop:9}} options={[{v:"employe",l:"Employ√©"},{v:"ouvrier",l:"Ouvrier"}]}/>
          <I label="Secteur" value={sec} onChange={setSec} style={{marginTop:9}} options={[{v:"marchand",l:"Marchand (25%)"},{v:"non_marchand",l:"Non-marchand (32,40%)"}]}/>
          <I label="CP" value={cp} onChange={setCp} style={{marginTop:9}} options={[{v:"200",l:"CP 200 (CPNAE)"},{v:"302",l:"CP 302 (Horeca)"},{v:"124",l:"CP 124 (Construction)"},{v:"140",l:"CP 140 (Transport)"},{v:"330",l:"CP 330 (Sant√©)"}]}/>
          <div style={{marginTop:16,padding:16,background:"rgba(198,163,78,.06)",borderRadius:8,textAlign:'center'}}>
            <div style={{fontSize:10,color:'#5e5c56'}}>CO√õT TOTAL EMPLOYEUR</div>
            <div style={{fontSize:28,fontWeight:700,color:'#c6a34e',marginTop:4}}>{fmt(totCout)}</div>
            <div style={{fontSize:11,color:'#5e5c56'}}>Ratio: √ó{ratio.toFixed(2)} du brut</div>
          </div>
        </C>
      </div>
      <C><ST>D√©composition co√ªt mensuel</ST>
        {[{l:"Salaire brut",v:brut,c:'#e8e6e0',pct:100},
          {l:"ONSS patronal ("+((onssERate*100).toFixed(1))+'%)',v:onssE,c:'#f87171',pct:onssE/brut*100},
          {l:"Fonds fermeture entreprise (FFE)",v:ffe,c:'#f87171',pct:ffe/brut*100},
          {l:"Ch√¥mage temporaire",v:chomT,c:'#f87171',pct:chomT/brut*100},
          {l:"P√©cule vacances (provision)",v:pecVac,c:'#fb923c',pct:pecVac/brut*100},
          {l:"Assurance AT",v:assAT,c:'#a78bfa',pct:assAT/brut*100},
          {l:"Assurance groupe (3%)",v:assGroupe,c:'#a78bfa',pct:assGroupe/brut*100},
          {l:"M√©decine du travail",v:medTrav,c:'#60a5fa',pct:medTrav/brut*100},
          {l:"Ch√®ques-repas (part employeur)",v:cr,c:'#4ade80',pct:cr/brut*100},
          {l:"√âco-ch√®ques",v:eco,c:'#4ade80',pct:eco/brut*100},
        ].map((row,i)=><div key={i} style={{display:'flex',alignItems:'center',gap:10,padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
          <div style={{flex:1,fontSize:12,color:'#9e9b93'}}>{row.l}</div>
          <div style={{width:120,height:6,background:"rgba(255,255,255,.04)",borderRadius:3}}>
            <div style={{height:6,background:row.c,borderRadius:3,width:Math.min(100,row.pct)+'%'}}/>
          </div>
          <div style={{width:80,textAlign:'right',fontSize:12,fontWeight:600,color:row.c}}>{fmt(row.v)}</div>
        </div>)}
        <div style={{display:'flex',justifyContent:'space-between',padding:'14px 0',borderTop:'2px solid rgba(198,163,78,.3)',marginTop:8}}>
          <span style={{fontSize:14,fontWeight:700,color:'#e8e6e0'}}>CO√õT TOTAL MENSUEL</span>
          <span style={{fontSize:20,fontWeight:700,color:'#c6a34e'}}>{fmt(totCout)}</span>
        </div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:10,marginTop:12}}>
          {[{l:"Co√ªt annuel",v:fmt(totCout*13.92),c:'#c6a34e'},{l:"Co√ªt horaire",v:fmt(totCout/164.67),c:'#60a5fa'},{l:"Co√ªt journalier",v:fmt(totCout/21.67),c:'#a78bfa'}].map((k,i)=>
            <div key={i} style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}>
              <div style={{fontSize:10,color:'#5e5c56'}}>{k.l}</div>
              <div style={{fontSize:16,fontWeight:700,color:k.c,marginTop:2}}>{k.v}</div>
            </div>
          )}
        </div>
      </C>
    </div>
  </div>;
}


function TotalRewardMod({s,d}){
  const ae=s.emps||[];const [sel,setSel]=useState(ae[0]?.id||'');
  const emp=ae.find(e=>e.id===sel)||ae[0]||{};
  const p=emp.id?calc(emp,DPER,s.co):{gross:0,net:0,onssNet:0,onssE:0,tax:0,css:0,empBonus:0};
  const b=p.gross||0;
  
  // Composantes du package
  const items=[
    {c:'R√©mun√©ration directe',color:'#4ade80',i:[
      {l:"Salaire brut annuel (√ó12)",v:b*12},
      {l:"13√®me mois",v:b},
      {l:"P√©cule vacances (double)",v:b*0.92},
      {l:"Bonus √©ventuel (CCT 90)",v:0},
    ]},
    {c:'Avantages en nature',color:'#60a5fa',i:[
      {l:"Ch√®ques-repas (220j √ó "+fmt(+(emp.mvValue||8))+')',v:(emp.mvValue||8)*220},
      {l:"√âco-ch√®ques",v:+(emp.ecoCheques||250)},
      {l:"Assurance groupe (3% brut)",v:b*12*0.03},
      {l:"Assurance hospitalisation",v:480},
      {l:"GSM + abonnement",v:emp.atnGSM?300:0},
      {l:"Laptop / PC",v:emp.atnPC?180:0},
      {l:"Internet domicile",v:emp.atnNet?60:0},
    ]},
    {c:'Indemnit√©s & frais',color:'#a78bfa',i:[
      {l:"Frais propres employeur",v:(+(emp.expense||0))*12},
      {l:"Indemnit√© t√©l√©travail",v:(+(emp.indemTeletravail||0))*12},
      {l:"Transport domicile-travail",v:p.transport*12},
    ]},
    {c:'Cotisations employeur',color:'#f87171',i:[
      {l:"ONSS patronal annuel",v:p.onssE*12},
      {l:"Assurance accidents travail",v:b*12*0.01},
      {l:"M√©decine du travail",v:ae.length*91.50||91.50},
    ]},
  ];
  
  const totPackage=items.reduce((a,c)=>a+c.i.reduce((b2,x)=>b2+x.v,0),0);
  const totDirect=items[0].i.reduce((a,x)=>a+x.v,0);
  const totAvantages=items[1].i.reduce((a,x)=>a+x.v,0);
  const totFrais=items[2].i.reduce((a,x)=>a+x.v,0);
  const totCotis=items[3].i.reduce((a,x)=>a+x.v,0);
  
  return <div>
    <PH title="Total Reward Statement" sub="R√©mun√©ration globale par travailleur"/>
    <div style={{display:'grid',gridTemplateColumns:'280px 1fr',gap:18}}>
      <div>
        <C><ST>Travailleur</ST>
          <I label="S√©lection" value={sel} onChange={setSel} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
          <div style={{marginTop:16,textAlign:'center'}}>
            <div style={{width:60,height:60,borderRadius:'50%',background:"linear-gradient(135deg,#c6a34e,#a08030)",display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto',fontSize:22,fontWeight:700,color:'#fff'}}>{(emp.first||'?')[0]}{(emp.last||'?')[0]}</div>
            <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0',marginTop:8}}>{emp.first} {emp.last}</div>
            <div style={{fontSize:11,color:'#5e5c56'}}>{emp.fn||'Fonction'} ¬∑ CP {emp.cp||'200'}</div>
          </div>
          <div style={{marginTop:16,padding:14,background:"rgba(198,163,78,.06)",borderRadius:8,textAlign:'center'}}>
            <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>Package annuel total</div>
            <div style={{fontSize:28,fontWeight:700,color:'#c6a34e',marginTop:4}}>{fmt(totPackage)}</div>
            <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>soit {fmt(totPackage/12)}/mois</div>
          </div>
          {/* Mini breakdown */}
          <div style={{marginTop:12,fontSize:11,color:'#9e9b93',lineHeight:2}}>
            {[{l:"R√©mun√©ration",v:totDirect,c:'#4ade80'},{l:"Avantages",v:totAvantages,c:'#60a5fa'},{l:"Frais/indemnit√©s",v:totFrais,c:'#a78bfa'},{l:"Cotisations empl.",v:totCotis,c:'#f87171'}].map((r,i)=>
              <div key={i} style={{display:'flex',justifyContent:'space-between'}}>
                <span>{r.l}</span>
                <span style={{fontWeight:600,color:r.c}}>{fmt(r.v)}</span>
              </div>
            )}
          </div>
        </C>
      </div>
      <div>
        {items.map((cat,ci)=><C key={ci} style={{marginBottom:12,padding:0,overflow:'hidden'}}>
          <div style={{padding:'12px 18px',background:`${cat.color}08`,borderBottom:`1px solid ${cat.color}20`,display:'flex',justifyContent:'space-between',alignItems:'center'}}>
            <span style={{fontWeight:700,fontSize:12,color:cat.color,textTransform:'uppercase',letterSpacing:'.5px'}}>{cat.c}</span>
            <span style={{fontSize:13,fontWeight:700,color:cat.color}}>{fmt(cat.i.reduce((a,x)=>a+x.v,0))}</span>
          </div>
          {cat.i.filter(it=>it.v>0).map((it,ii)=><div key={ii} style={{display:'flex',justifyContent:'space-between',padding:'8px 18px',borderBottom:'1px solid rgba(255,255,255,.02)'}}>
            <span style={{fontSize:12,color:'#9e9b93'}}>{it.l}</span>
            <span style={{fontSize:12,fontWeight:600,color:'#e8e6e0'}}>{fmt(it.v)}</span>
          </div>)}
        </C>)}
      </div>
    </div>
  </div>;
}

function ATNMod({s,d}){
  const ae=s.emps||[];const [vehs,setVehs]=useState([]);
  const [tab,setTab]=useState('vehicule');
  const [atnAutres,setAtnAutres]=useState([]);
  const [f,setF]=useState({emp:'',marque:'',modele:'',co2:120,carburant:'essence',catalogue:35000,annee:new Date().getFullYear()});
  const [fa,setFa]=useState({emp:'',gsm:false,pc:false,internet:false,logement:false,logementRC:0,chauffage:false,electricite:false,logFourniGratuit:true});
  // ‚îÄ‚îÄ Forfaits ATN 2026 (AR royal) ‚îÄ‚îÄ
  const FORFAITS={gsm:{an:36,mois:3,label:'GSM/Smartphone'},pc:{an:72,mois:6,label:'PC/Tablette'},internet:{an:60,mois:5,label:'Connexion Internet'},
    chauffage:{an:2130,mois:177.50,label:'Chauffage gratuit'},electricite:{an:1060,mois:88.33,label:'√âlectricit√© gratuite'}};
  // Logement: RC √ó 100/60 √ó 3.87 (coefficient 2026) si meubl√© √ó5/3
  const calcLogement=(rc,meuble=false)=>{if(!rc||rc<=0)return 0;const base=rc*(100/60)*3.87;return meuble?base*(5/3):base;};
  const addAutre=()=>{
    if(!fa.emp)return;const emp=ae.find(e=>e.id===fa.emp);if(!emp)return;
    let total=0;const details=[];
    if(fa.gsm){total+=FORFAITS.gsm.an;details.push({type:'GSM',an:FORFAITS.gsm.an,mois:FORFAITS.gsm.mois});}
    if(fa.pc){total+=FORFAITS.pc.an;details.push({type:'PC/Tablette',an:FORFAITS.pc.an,mois:FORFAITS.pc.mois});}
    if(fa.internet){total+=FORFAITS.internet.an;details.push({type:'Internet',an:FORFAITS.internet.an,mois:FORFAITS.internet.mois});}
    if(fa.logement&&fa.logementRC>0){const lg=calcLogement(fa.logementRC,fa.logFourniGratuit);total+=lg;details.push({type:'Logement'+(fa.logFourniGratuit?' (meubl√©)':' (non meubl√©)'),an:Math.round(lg*100)/100,mois:Math.round(lg/12*100)/100});}
    if(fa.chauffage){total+=FORFAITS.chauffage.an;details.push({type:'Chauffage',an:FORFAITS.chauffage.an,mois:FORFAITS.chauffage.mois});}
    if(fa.electricite){total+=FORFAITS.electricite.an;details.push({type:'√âlectricit√©',an:FORFAITS.electricite.an,mois:FORFAITS.electricite.mois});}
    if(details.length===0)return alert('S√©lectionnez au moins un avantage');
    setAtnAutres(p=>[...p,{id:Date.now(),empId:fa.emp,empName:`${emp.first||''} ${emp.last||''}`,details,totalAn:Math.round(total*100)/100,totalMois:Math.round(total/12*100)/100}]);
    setFa({emp:'',gsm:false,pc:false,internet:false,logement:false,logementRC:0,chauffage:false,electricite:false,logFourniGratuit:true});
  };

  const addVeh=()=>{
    if(!f.emp)return;
    const age=new Date().getFullYear()-f.annee;
    const decote=Math.min(age*0.06,0.30);
    const catVal=+f.catalogue*(1-decote);
    const ref=f.carburant==='diesel'?67:f.carburant==='essence'?82:0;
    const pct=f.carburant==='electrique'?4:Math.min(18,Math.max(4,5.5+(+f.co2-ref)*0.1));
    const atn=Math.max(1600,catVal*6/7*(pct/100));
    const co2Cotis=f.carburant==='electrique'?31.99:f.carburant==='diesel'?((+f.co2*9+768)/12):((+f.co2*9+768)/12);
    setVehs(p=>[...p,{...f,id:Date.now(),atn,atnMens:atn/12,pct,catVal,co2Cotis,empName:ae.find(e=>e.id===f.emp)?.first+' '+ae.find(e=>e.id===f.emp)?.last}]);
  };
  const totATNVeh=vehs.reduce((a,v)=>a+v.atn,0);
  const totCO2=vehs.reduce((a,v)=>a+v.co2Cotis*12,0);
  const totATNAutres=atnAutres.reduce((a,v)=>a+v.totalAn,0);
  const totATNGlobal=totATNVeh+totATNAutres;
  const delVeh=(id)=>setVehs(p=>p.filter(v=>v.id!==id));
  const delAutre=(id)=>setAtnAutres(p=>p.filter(v=>v.id!==id));
  const empSummary=()=>{
    const map={};
    vehs.forEach(v=>{if(!map[v.emp])map[v.emp]={name:v.empName,veh:0,autres:0};map[v.emp].veh+=v.atn;});
    atnAutres.forEach(a=>{if(!map[a.empId])map[a.empId]={name:a.empName,veh:0,autres:0};map[a.empId].autres+=a.totalAn;});
    return Object.entries(map).map(([id,v])=>({id,name:v.name,veh:v.veh,autres:v.autres,total:v.veh+v.autres,mois:Math.round((v.veh+v.autres)/12*100)/100}));
  };

  return <div>
    <PH title="Avantages de Toute Nature (ATN)" sub="V√©hicules, GSM, PC, Internet, Logement ‚Äî Calcul fiscal complet 2026"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:12,marginBottom:18}}>
      {[{l:"V√©hicules",v:vehs.length,c:'#60a5fa'},{l:"ATN V√©hicules/an",v:fmt(totATNVeh),c:'#c6a34e'},{l:"ATN Autres/an",v:fmt(totATNAutres),c:'#a78bfa'},{l:"ATN TOTAL/an",v:fmt(totATNGlobal),c:'#f87171'},{l:"Cotis. CO‚ÇÇ/an",v:fmt(totCO2),c:'#fb923c'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:'vehicule',l:'üöó V√©hicule de soci√©t√©'},{v:'autres',l:'üì± GSM / PC / Logement'},{v:'resume',l:'üìä R√©sum√© par employ√©'},{v:'info',l:'‚ÑπÔ∏è Bar√®mes 2026'}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    {tab==='vehicule'&&<div style={{display:'grid',gridTemplateColumns:'350px 1fr',gap:18}}>
      <C><ST>Ajouter v√©hicule</ST>
        <I label="Travailleur" value={f.emp} onChange={v=>setF({...f,emp:v})} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
          <I label="Marque" value={f.marque} onChange={v=>setF({...f,marque:v})}/>
          <I label="Mod√®le" value={f.modele} onChange={v=>setF({...f,modele:v})}/>
          <I label="Carburant" value={f.carburant} onChange={v=>setF({...f,carburant:v})} options={[{v:"essence",l:"Essence"},{v:"diesel",l:"Diesel"},{v:"electrique",l:"√âlectrique"},{v:"hybride",l:"Hybride PHEV"}]}/>
          <I label="CO‚ÇÇ (g/km)" type="number" value={f.co2} onChange={v=>setF({...f,co2:+v})}/>
          <I label="Val. catalogue (‚Ç¨)" type="number" value={f.catalogue} onChange={v=>setF({...f,catalogue:+v})}/>
          <I label="Ann√©e 1√®re immat." type="number" value={f.annee} onChange={v=>setF({...f,annee:+v})}/>
        </div>
        <B onClick={addVeh} style={{width:'100%',marginTop:14}}>Calculer ATN v√©hicule</B>
        <div style={{marginTop:12,padding:10,background:"rgba(96,165,250,.06)",borderRadius:8,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          <b>Formule:</b> ATN = catalogue √ó 6/7 √ó CO‚ÇÇ% (min ‚Ç¨1.600)<br/>
          <b>D√©cote:</b> 6%/an depuis 1√®re immat. (max 30%)<br/>
          <b>√âlectrique:</b> CO‚ÇÇ% fixe = 4% (min)
        </div>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Flotte ({vehs.length})</div></div>
        {vehs.length>0?<Tbl cols={[
          {k:'e',l:"Travailleur",b:1,r:r=>r.empName},
          {k:'v',l:"V√©hicule",r:r=>`${r.marque} ${r.modele}`},
          {k:'c',l:"Carburant",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:r.carburant==='electrique'?'rgba(74,222,128,.1)':'rgba(198,163,78,.1)',color:r.carburant==='electrique'?'#4ade80':'#c6a34e'}}>{r.carburant}</span>},
          {k:'co',l:"CO‚ÇÇ",a:'right',r:r=>`${r.co2}g`},
          {k:'p',l:"%",a:'right',r:r=><span style={{color:'#c6a34e'}}>{r.pct.toFixed(1)}%</span>},
          {k:'a',l:"ATN/an",a:'right',r:r=><span style={{fontWeight:600,color:'#f87171'}}>{fmt(r.atn)}</span>},
          {k:'m',l:"ATN/mois",a:'right',r:r=>fmt(r.atnMens)},
          {k:'co2c',l:"CO‚ÇÇ/mois",a:'right',r:r=><span style={{color:'#f87171'}}>{fmt(r.co2Cotis)}</span>},
          {k:'x',l:"",a:'right',r:r=><button onClick={()=>delVeh(r.id)} style={{background:'none',border:'none',color:'#f87171',cursor:'pointer',fontSize:14}}>‚úï</button>},
        ]} data={vehs}/>:<div style={{padding:40,textAlign:'center',color:'#5e5c56'}}>Ajoutez un v√©hicule pour calculer l\'ATN</div>}
      </C>
    </div>}
    {tab==='autres'&&<div style={{display:'grid',gridTemplateColumns:'380px 1fr',gap:18}}>
      <C><ST>Avantages non-v√©hicule</ST>
        <I label="Travailleur" value={fa.emp} onChange={v=>setFa({...fa,emp:v})} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
        <div style={{marginTop:14,display:'flex',flexDirection:'column',gap:10}}>
          {[{k:'gsm',l:'üì± GSM/Smartphone',v:'36‚Ç¨/an (3‚Ç¨/mois)'},{k:'pc',l:'üíª PC/Tablette',v:'72‚Ç¨/an (6‚Ç¨/mois)'},{k:'internet',l:'üåê Internet priv√©',v:'60‚Ç¨/an (5‚Ç¨/mois)'}].map(it=>
            <label key={it.k} style={{display:'flex',alignItems:'center',gap:10,padding:'10px 14px',borderRadius:8,background:fa[it.k]?'rgba(198,163,78,.1)':'rgba(255,255,255,.02)',border:'1px solid '+(fa[it.k]?'rgba(198,163,78,.25)':'rgba(139,115,60,.08)'),cursor:'pointer',transition:'all .2s'}}>
              <input type="checkbox" checked={fa[it.k]} onChange={e=>setFa({...fa,[it.k]:e.target.checked})} style={{accentColor:'#c6a34e'}}/>
              <div><div style={{fontSize:12,color:'#e8e6e0',fontWeight:500}}>{it.l}</div><div style={{fontSize:10,color:'#9e9b93'}}>{it.v}</div></div>
            </label>
          )}
          <label style={{display:'flex',alignItems:'center',gap:10,padding:'10px 14px',borderRadius:8,background:fa.logement?'rgba(198,163,78,.1)':'rgba(255,255,255,.02)',border:'1px solid '+(fa.logement?'rgba(198,163,78,.25)':'rgba(139,115,60,.08)'),cursor:'pointer'}}>
            <input type="checkbox" checked={fa.logement} onChange={e=>setFa({...fa,logement:e.target.checked})} style={{accentColor:'#c6a34e'}}/>
            <div><div style={{fontSize:12,color:'#e8e6e0',fontWeight:500}}>üè† Logement gratuit</div><div style={{fontSize:10,color:'#9e9b93'}}>RC √ó 100/60 √ó 3,87 (meubl√©: √ó 5/3)</div></div>
          </label>
          {fa.logement&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,paddingLeft:10}}>
            <I label="RC logement (‚Ç¨)" type="number" value={fa.logementRC} onChange={v=>setFa({...fa,logementRC:+v})}/>
            <I label="Type" value={fa.logFourniGratuit?'meuble':'non_meuble'} onChange={v=>setFa({...fa,logFourniGratuit:v==='meuble'})} options={[{v:'meuble',l:'Meubl√© (√ó5/3)'},{v:'non_meuble',l:'Non meubl√©'}]}/>
            {fa.logementRC>0&&<div style={{gridColumn:'span 2',padding:8,background:'rgba(198,163,78,.06)',borderRadius:6,fontSize:11,color:'#c6a34e'}}>
              ATN Logement: {fmt(calcLogement(fa.logementRC,fa.logFourniGratuit))}/an = {fmt(calcLogement(fa.logementRC,fa.logFourniGratuit)/12)}/mois
            </div>}
          </div>}
          {[{k:'chauffage',l:'üî• Chauffage gratuit',v:'2.130‚Ç¨/an (177,50‚Ç¨/mois)'},{k:'electricite',l:'‚ö° √âlectricit√© gratuite',v:'1.060‚Ç¨/an (88,33‚Ç¨/mois)'}].map(it=>
            <label key={it.k} style={{display:'flex',alignItems:'center',gap:10,padding:'10px 14px',borderRadius:8,background:fa[it.k]?'rgba(198,163,78,.1)':'rgba(255,255,255,.02)',border:'1px solid '+(fa[it.k]?'rgba(198,163,78,.25)':'rgba(139,115,60,.08)'),cursor:'pointer'}}>
              <input type="checkbox" checked={fa[it.k]} onChange={e=>setFa({...fa,[it.k]:e.target.checked})} style={{accentColor:'#c6a34e'}}/>
              <div><div style={{fontSize:12,color:'#e8e6e0',fontWeight:500}}>{it.l}</div><div style={{fontSize:10,color:'#9e9b93'}}>{it.v}</div></div>
            </label>
          )}
        </div>
        <B onClick={addAutre} style={{width:'100%',marginTop:14}}>Ajouter les ATN s√©lectionn√©s</B>
      </C>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>ATN non-v√©hicule ({atnAutres.length} employ√©s)</div></div>
        {atnAutres.length>0?<div style={{padding:12}}>{atnAutres.map(a=><div key={a.id} style={{padding:14,marginBottom:10,background:'rgba(198,163,78,.03)',borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}}>
            <span style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>{a.empName}</span>
            <div style={{display:'flex',alignItems:'center',gap:10}}>
              <span style={{fontSize:14,fontWeight:700,color:'#c6a34e'}}>{fmt(a.totalAn)}/an ({fmt(a.totalMois)}/mois)</span>
              <button onClick={()=>delAutre(a.id)} style={{background:'none',border:'none',color:'#f87171',cursor:'pointer',fontSize:14}}>‚úï</button>
            </div>
          </div>
          <div style={{display:'flex',gap:6,flexWrap:'wrap'}}>{a.details.map((dt,i)=>
            <span key={i} style={{fontSize:10,padding:'3px 8px',borderRadius:4,background:'rgba(167,139,250,.08)',color:'#a78bfa'}}>{dt.type}: {fmt(dt.mois)}/mois</span>
          )}</div>
        </div>)}</div>:<div style={{padding:40,textAlign:'center',color:'#5e5c56'}}>S√©lectionnez les avantages et ajoutez-les</div>}
      </C>
    </div>}
    {tab==='resume'&&<C>
      <ST>R√©sum√© ATN par employ√©</ST>
      {empSummary().length>0?<Tbl cols={[
        {k:'n',l:"Employ√©",b:1,r:r=>r.name},
        {k:'v',l:"ATN V√©hicule/an",a:'right',r:r=>r.veh>0?<span style={{color:'#60a5fa'}}>{fmt(r.veh)}</span>:'‚Äî'},
        {k:'a',l:"ATN Autres/an",a:'right',r:r=>r.autres>0?<span style={{color:'#a78bfa'}}>{fmt(r.autres)}</span>:'‚Äî'},
        {k:'t',l:"TOTAL/an",a:'right',r:r=><span style={{fontWeight:700,color:'#f87171'}}>{fmt(r.total)}</span>},
        {k:'m',l:"TOTAL/mois",a:'right',r:r=><span style={{fontWeight:600,color:'#c6a34e'}}>{fmt(r.mois)}</span>},
      ]} data={empSummary()}/>:<div style={{padding:30,textAlign:'center',color:'#5e5c56'}}>Ajoutez des ATN dans les onglets V√©hicule ou GSM/PC/Logement</div>}
    </C>}
    {tab==='info'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Forfaits ATN 2026 ‚Äî Autres avantages</ST>
        <table style={{width:'100%',fontSize:12,borderCollapse:'collapse'}}>
          <thead><tr style={{borderBottom:'1px solid rgba(198,163,78,.15)'}}>
            <th style={{textAlign:'left',padding:'8px 0',color:'#9e9b93',fontSize:10,fontWeight:500}}>AVANTAGE</th>
            <th style={{textAlign:'right',padding:'8px 0',color:'#9e9b93',fontSize:10,fontWeight:500}}>PAR AN</th>
            <th style={{textAlign:'right',padding:'8px 0',color:'#9e9b93',fontSize:10,fontWeight:500}}>PAR MOIS</th>
          </tr></thead>
          <tbody>
            {Object.entries(FORFAITS).map(([k,v])=><tr key={k} style={{borderBottom:'1px solid rgba(139,115,60,.06)'}}>
              <td style={{padding:'8px 0',color:'#e8e6e0'}}>{v.label}</td>
              <td style={{textAlign:'right',padding:'8px 0',color:'#c6a34e',fontWeight:600}}>{fmt(v.an)}</td>
              <td style={{textAlign:'right',padding:'8px 0',color:'#9e9b93'}}>{fmt(v.mois)}</td>
            </tr>)}
            <tr style={{borderBottom:'1px solid rgba(139,115,60,.06)'}}>
              <td style={{padding:'8px 0',color:'#e8e6e0'}}>Logement (non meubl√©)</td>
              <td colSpan={2} style={{textAlign:'right',padding:'8px 0',color:'#9e9b93',fontSize:11}}>RC √ó 100/60 √ó 3,87</td>
            </tr>
            <tr><td style={{padding:'8px 0',color:'#e8e6e0'}}>Logement (meubl√©)</td>
              <td colSpan={2} style={{textAlign:'right',padding:'8px 0',color:'#9e9b93',fontSize:11}}>RC √ó 100/60 √ó 3,87 √ó 5/3</td>
            </tr>
          </tbody>
        </table>
      </C>
      <C><ST>ATN V√©hicule ‚Äî Formule 2026</ST>
        <div style={{fontSize:12,color:'#c8c5bb',lineHeight:1.8}}>
          <div><b style={{color:'#c6a34e'}}>Valeur catalogue:</b> Prix catalogue TVAC ‚Äì d√©cote 6%/an (max 30%)</div>
          <div><b style={{color:'#c6a34e'}}>% CO‚ÇÇ:</b> 5,5% + (CO‚ÇÇ r√©el ‚Äì r√©f√©rence) √ó 0,1%</div>
          <div><b style={{color:'#c6a34e'}}>R√©f√©rence CO‚ÇÇ 2026:</b> Essence/LPG = 82 g | Diesel = 67 g</div>
          <div><b style={{color:'#c6a34e'}}>Min/Max:</b> 4% minimum ‚Äî 18% maximum</div>
          <div><b style={{color:'#c6a34e'}}>√âlectrique:</b> 4% fixe (minimum)</div>
          <div><b style={{color:'#c6a34e'}}>ATN min:</b> ‚Ç¨1.600/an</div>
          <div><b style={{color:'#c6a34e'}}>Formule:</b> ATN = Val.cat √ó 6/7 √ó CO‚ÇÇ%</div>
          <div style={{marginTop:12,padding:10,background:'rgba(248,113,113,.06)',borderRadius:8,color:'#f87171',fontSize:11}}>
            <b>Cotisation CO‚ÇÇ employeur:</b> (CO‚ÇÇ √ó 9 + 768) / 12 par mois. √âlectrique: min 31,99‚Ç¨/mois.
          </div>
        </div>
      </C>
    </div>}
  </div>;
}


function ChomTempMod({s,d}){
  const ae=s.emps||[];const [ds,setDs]=useState([]);
  const [f,setF]=useState({emp:'',motif:'eco',debut:'',fin:'',jours:0,regime:'ft'});
  const [tab,setTab]=useState('new');
  const mots=[{v:"eco",l:"√âconomique (Art. 51 Loi 3/7/1978)"},{v:"fm",l:"Force majeure (Art. 26)"},{v:"int",l:"Intemp√©ries (Art. 50)"},{v:"tech",l:"Technique (Art. 49)"},{v:"med",l:"Force majeure m√©dicale"},{v:"energie",l:"Crise √©nerg√©tique (AR 11/2022)"}];
  
  const emp=ae.find(e=>e.id===f.emp);
  const add=()=>{
    if(!emp)return;
    const p=emp.id?calc(emp,DPER,s.co):{gross:0};
    const alloc=Math.min(p.gross*0.65,2000);// plafond ONEM simplifi√©
    const suppl=f.motif==='eco'?2:f.motif==='energie'?6.22:0;// suppl√©ment employeur
    setDs(p2=>[{...f,id:"CT-"+Date.now(),ename:`${emp.first} ${emp.last}`,niss:emp.niss,alloc,suppl,statut:emp.statut},...p2]);
    setF({emp:'',motif:'eco',debut:'',fin:'',jours:0,regime:'ft'});
  };
  
  const totJours=ds.reduce((a,c)=>a+(+c.jours||0),0);
  const totCost=ds.reduce((a,c)=>a+((+c.jours||0)*(c.suppl||0)),0);

  return <div>
    <PH title="Ch√¥mage Temporaire" sub="Notification ONEM ‚Äî C3.2, allocations, suppl√©ments"/>
    {/* KPIs */}
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Dossiers actifs",v:ds.length,c:'#fb923c'},{l:"Jours total",v:totJours,c:'#60a5fa'},{l:"Co√ªt suppl. employeur",v:fmt(totCost),c:'#f87171'},{l:"C3.2 g√©n√©r√©s",v:ds.length,c:'#a78bfa'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    {/* Tabs */}
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"new",l:"Nouveau dossier"},{v:"list",l:"Dossiers"},{v:"rules",l:"R√®gles ONEM"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    
    {tab==='new'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Cr√©er dossier ch√¥mage temporaire</ST>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9}}>
          <I label="Travailleur" value={f.emp} onChange={v=>setF({...f,emp:v})} span={2} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
          <I label="Motif" value={f.motif} onChange={v=>setF({...f,motif:v})} span={2} options={mots}/>
          <I label="D√©but" type="date" value={f.debut} onChange={v=>setF({...f,debut:v})}/>
          <I label="Fin" type="date" value={f.fin} onChange={v=>setF({...f,fin:v})}/>
          <I label="Jours pr√©vus" type="number" value={f.jours} onChange={v=>setF({...f,jours:v})}/>
          <I label="R√©gime" value={f.regime} onChange={v=>setF({...f,regime:v})} options={[{v:"ft",l:"Temps plein"},{v:"pt",l:"Temps partiel"},{v:"gd",l:"Grande suspension"},{v:"pd",l:"Petite suspension"}]}/>
        </div>
        <B onClick={add} style={{width:'100%',marginTop:14}}>Cr√©er dossier CT</B>
      </C>
      <C><ST>R√®gles par motif</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{m:'√âconomique ‚Äî Ouvriers',r:'Max 4 sem. cons√©cutives. Notification 7j avant. Suppl. ‚â• ‚Ç¨2/jour.',c:'#fb923c'},
            {m:'√âconomique ‚Äî Employ√©s',r:'Max 16 sem./an (26 si reconnu). Notification 14j. Suppl. ‚â• ‚Ç¨6.22/jour (CCT 172).',c:'#fb923c'},
            {m:'Force majeure',r:'Dur√©e illimit√©e si reconnue. Demande via formulaire sp√©cifique ONEM.',c:'#f87171'},
            {m:'Intemp√©ries',r:'Ouvriers uniquement. Secteurs construction, agriculture. Notification jour m√™me.',c:'#60a5fa'},
            {m:'Technique',r:'Ouvriers. Panne machines, manque mat√©riaux. Notification 7j.',c:'#a78bfa'},
          ].map((r,i)=><div key={i} style={{padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <div style={{fontWeight:600,color:r.c}}>{r.m}</div>
            <div style={{fontSize:10.5,marginTop:2}}>{r.r}</div>
          </div>)}
        </div>
      </C>
    </div>}
    
    {tab==='list'&&<C style={{padding:0,overflow:'hidden'}}>
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Dossiers ({ds.length})</div></div>
      <Tbl cols={[
        {k:'e',l:"Travailleur",b:1,r:r=>r.ename},
        {k:'m',l:"Motif",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:"rgba(251,146,56,.1)",color:'#fb923c'}}>{mots.find(m=>m.v===r.motif)?.l?.split(' (')[0]||r.motif}</span>},
        {k:'p',l:"P√©riode",r:r=>`${r.debut||'?'} ‚Üí ${r.fin||'?'}`},
        {k:'j',l:"Jours",a:'right',r:r=><span style={{fontWeight:600}}>{r.jours}</span>},
        {k:'a',l:"Alloc./jour",a:'right',r:r=><span style={{color:'#4ade80'}}>{fmt(r.alloc/21)}</span>},
        {k:'s',l:"Suppl.",a:'right',r:r=><span style={{color:'#f87171'}}>‚Ç¨{(r.suppl||0).toFixed(2)}/j</span>},
      ]} data={ds}/>
    </C>}
    
    {tab==='rules'&&<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Proc√©dure ONEM</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {['1. Notification au bureau r√©gional ONEM (d√©lai selon motif)',"2. Notification aux travailleurs (affichage + individuel)","3. Communication √† l'ONEM des 1ers jours effectifs de ch√¥mage","4. Formulaire C3.2 (constat du droit) ‚Üí travailleur","5. Validation mensuelle ASR (sc√©nario 5 ou 6)","6. Paiement allocations via organisme de paiement","7. Suppl√©ment employeur vers√© sur fiche de paie"].map((step,i)=>
            <div key={i} style={{padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>{step}</div>
          )}
        </div>
      </C>
      <C><ST>Allocations 2026</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{l:"Cohabitant avec charge",v:"65% du salaire plafonn√©"},{l:"Isol√©",v:"65% du salaire plafonn√©"},{l:"Cohabitant sans charge",v:"65% du salaire plafonn√©"},{l:"Plafond mensuel ONEM",v:"‚Ç¨ 3.199,26 (cat. A)"},{l:"Suppl√©ment CCT 172 (employ√©s)",v:"Min. ‚Ç¨6,22/jour"},{l:"Suppl√©ment ouvriers √©conomique",v:"Min. ‚Ç¨2,00/jour"},{l:"Suppl√©ment √©nergie",v:"‚Ç¨6,22/jour"}].map((r,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <span>{r.l}</span><span style={{fontWeight:600,color:'#c6a34e'}}>{r.v}</span>
            </div>
          )}
        </div>
        <div style={{marginTop:10,padding:8,background:"rgba(96,165,250,.06)",borderRadius:6,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
          <b>Portail:</b> www.onem.be ‚Üí Ch√¥mage temporaire<br/>
          <b>ASR:</b> Via portail s√©curit√© sociale (batch ou web)
        </div>
      </C>
    </div>}
  </div>;
}

function CongeEducMod({s,d}){
  const ae=s.emps||[];const [ds,setDs]=useState([]);
  const [f,setF]=useState({emp:'',formation:'',organisme:'',heures:0,region:'bxl',debut:'',fin:''});
  const pl={bxl:120,wal:180,vla:125};
  const tarif={bxl:22.07,wal:22.07,vla:22.07};
  const add=()=>{if(!f.emp)return;const max=pl[f.region];const h=Math.min(+f.heures,max);const remb=h*tarif[f.region];const emp=ae.find(e=>e.id===f.emp);setDs(p=>[{...f,id:"CE-"+Date.now(),max,remb,hRemb:h,ename:`${emp?.first} ${emp?.last}`},...p]);setF({emp:'',formation:'',organisme:'',heures:0,region:'bxl',debut:'',fin:''});};
  const totH=ds.reduce((a,c)=>a+c.hRemb,0);const totR=ds.reduce((a,c)=>a+c.remb,0);
  
  return <div>
    <PH title="Cong√©-√âducation Pay√©" sub="Remboursement r√©gional ‚Äî Heures, plafonds, formulaires"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Dossiers",v:ds.length,c:'#60a5fa'},{l:"Heures totales",v:totH+'h',c:'#a78bfa'},{l:"Remboursement total",v:fmt(totR),c:'#4ade80'},{l:"Tarif horaire",v:"‚Ç¨22,07",c:'#c6a34e'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'350px 1fr',gap:18}}>
      <div>
        <C><ST>Nouveau dossier</ST>
          <I label="Travailleur" value={f.emp} onChange={v=>setF({...f,emp:v})} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
          <I label="Formation" value={f.formation} onChange={v=>setF({...f,formation:v})} style={{marginTop:9}}/>
          <I label="Organisme" value={f.organisme} onChange={v=>setF({...f,organisme:v})} style={{marginTop:9}}/>
          <I label="R√©gion" value={f.region} onChange={v=>setF({...f,region:v})} style={{marginTop:9}} options={[{v:"bxl",l:"Bruxelles (120h)"},{v:"wal",l:"Wallonie (180h)"},{v:"vla",l:"Flandre (125h)"}]}/>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
            <I label="Heures" type="number" value={f.heures} onChange={v=>setF({...f,heures:v})}/>
            <I label="D√©but" type="date" value={f.debut} onChange={v=>setF({...f,debut:v})}/>
          </div>
          <B onClick={add} style={{width:'100%',marginTop:14}}>Ajouter dossier</B>
        </C>
        <C style={{marginTop:12}}><ST>Plafonds par r√©gion (2026)</ST>
          {[{r:'Bruxelles',h:120,t:'‚Ç¨22,07/h',tot:'‚Ç¨2.648'},{r:'Wallonie',h:180,t:'‚Ç¨22,07/h',tot:'‚Ç¨3.973'},{r:'Flandre (Vlaams Opleidingsverlof)',h:125,t:'‚Ç¨22,07/h',tot:'‚Ç¨2.759'}].map((r,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
              <div><b style={{color:'#e8e6e0'}}>{r.r}</b><div style={{fontSize:10,color:'#5e5c56'}}>{r.h}h max ¬∑ {r.t}</div></div>
              <span style={{fontWeight:700,color:'#c6a34e'}}>{r.tot}</span>
            </div>
          )}
        </C>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Dossiers ({ds.length})</div></div>
        {ds.length>0?<Tbl cols={[
          {k:'e',l:"Travailleur",b:1,r:r=>r.ename},
          {k:'f',l:"Formation",r:r=>r.formation||'‚Äî'},
          {k:'rg',l:"R√©gion",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:"rgba(96,165,250,.1)",color:'#60a5fa'}}>{r.region.toUpperCase()}</span>},
          {k:'h',l:"Heures",a:'right',r:r=><span>{r.hRemb}h <span style={{color:'#5e5c56',fontSize:10}}>/{r.max}h</span></span>},
          {k:'r',l:"Remboursement",a:'right',r:r=><span style={{fontWeight:600,color:'#4ade80'}}>{fmt(r.remb)}</span>},
        ]} data={ds}/>:<div style={{padding:40,textAlign:'center',color:'#5e5c56'}}>Aucun dossier</div>}
      </C>
    </div>
  </div>;
}


function RCCMod({s,d}){
  const ae=s.emps||[];const [f,setF]=useState({emp:'',brut:4000,age:60,anc:30,sex:'M'});const [r,setR]=useState(null);
  const emp=ae.find(e=>e.id===f.emp);
  
  const doCalc=()=>{
    const brutRef=+f.brut;const age=+f.age;const anc=+f.anc;
    // Allocation ch√¥mage (simplifi√© - bar√®me ONEM 2026)
    const plafond=age>=60?2500:2200;
    const alloc=Math.min(brutRef*0.60,plafond);
    // Compl√©ment entreprise = (brut net r√©f - allocation) / 2
    const complement=(brutRef-alloc)*0.50;
    // Cotisation sp√©ciale DECAVA
    const pctDecava=age<52?0.10:age<55?0.08:age<58?0.05:age<60?0.04:0.0325;
    const decava=complement*pctDecava;
    // Cotisation patronale
    const pctPatr=anc>=20?0.50:anc>=10?0.33:0.25;
    const cotPatr=complement*pctPatr*12;
    // Retenue INSS 6.50%
    const inss=(alloc+complement)*0.065;
    const netRCC=alloc+complement-inss-decava;
    setR({alloc,complement,decava,pctDecava,inss,netRCC,cotPatr,pctPatr,brutRef});
  };
  
  return <div>
    <PH title="RCC ‚Äî R√©gime de Ch√¥mage avec Compl√©ment d'entreprise" sub="Ex-pr√©pension ‚Äî Calcul, DECAVA, cotisations"/>
    <div style={{display:'grid',gridTemplateColumns:'320px 1fr',gap:18}}>
      <div>
        <C><ST>Param√®tres</ST>
          <I label="Travailleur" value={f.emp} onChange={v=>setF({...f,emp:v})} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
          <I label="Brut r√©f. mensuel (‚Ç¨)" type="number" value={f.brut} onChange={v=>setF({...f,brut:+v})} style={{marginTop:9}}/>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
            <I label="√Çge" type="number" value={f.age} onChange={v=>setF({...f,age:+v})}/>
            <I label="Anciennet√© (ans)" type="number" value={f.anc} onChange={v=>setF({...f,anc:+v})}/>
          </div>
          <B onClick={doCalc} style={{width:'100%',marginTop:14}}>Calculer RCC</B>
        </C>
        {r&&<C style={{marginTop:12}}><ST>Cotisation patronale</ST>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:2}}>
            <div>Taux DECAVA travailleur: <b style={{color:'#f87171'}}>{(r.pctDecava*100).toFixed(2)}%</b></div>
            <div>Cotisation patronale: <b style={{color:'#f87171'}}>{(r.pctPatr*100).toFixed(0)}%</b></div>
            <div>Co√ªt annuel employeur: <b style={{color:'#c6a34e'}}>{fmt(r.cotPatr)}</b></div>
          </div>
          <div style={{marginTop:10,padding:8,background:"rgba(96,165,250,.06)",borderRadius:6,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
            <b>DECAVA:</b> Cotisation sp√©ciale sur compl√©ment<br/>
            <b>D√©claration:</b> DmfA + code travailleur sp√©cifique<br/>
            <b>C4-RCC:</b> Document de sortie obligatoire
          </div>
        </C>}
      </div>
      {r?<div>
        {/* KPIs */}
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:16}}>
          {[{l:"Allocation ONEM",v:fmt(r.alloc),c:'#60a5fa',s:'/mois'},{l:"Compl√©ment entreprise",v:fmt(r.complement),c:'#fb923c',s:'/mois'},{l:"Net RCC",v:fmt(r.netRCC),c:'#4ade80',s:'/mois'},{l:"Co√ªt annuel empl.",v:fmt(r.cotPatr),c:'#f87171',s:'/an'}].map((k,i)=>
            <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
              <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>{k.l}</div>
              <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
              <div style={{fontSize:10,color:'#5e5c56'}}>{k.s}</div>
            </div>
          )}
        </div>
        <C><ST>D√©composition mensuelle</ST>
          {[{l:"Salaire brut de r√©f√©rence",v:r.brutRef,c:'#e8e6e0'},
            {l:"Allocation ch√¥mage ONEM (60%)",v:r.alloc,c:'#60a5fa'},
            {l:"Compl√©ment entreprise (50% diff√©rence)",v:r.complement,c:'#fb923c'},
            {l:"Sous-total brut RCC",v:r.alloc+r.complement,c:'#e8e6e0'},
            {l:"INSS -6,50%",v:-r.inss,c:'#f87171'},
            {l:"DECAVA -"+((r.pctDecava*100).toFixed(2))+'%',v:-r.decava,c:'#f87171'},
          ].map((row,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
            <span style={{color:'#9e9b93'}}>{row.l}</span>
            <span style={{fontWeight:600,color:row.c}}>{row.v<0?'- '+fmt(Math.abs(row.v)):fmt(row.v)}</span>
          </div>)}
          <div style={{display:'flex',justifyContent:'space-between',padding:'12px 0',borderTop:'2px solid rgba(198,163,78,.3)',marginTop:8}}>
            <span style={{fontSize:14,fontWeight:700,color:'#e8e6e0'}}>NET RCC mensuel</span>
            <span style={{fontSize:18,fontWeight:700,color:'#4ade80'}}>{fmt(r.netRCC)}</span>
          </div>
        </C>
        <C style={{marginTop:12}}><ST>Conditions d'acc√®s RCC 2026</ST>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
            {[{l:"R√©gime g√©n√©ral",v:"62 ans + 40 ans carri√®re (H) / 38 ans (F)"},{l:"Travail de nuit/lourd",v:"60 ans + 33 ans carri√®re dont 20 ans r√©gime"},{l:"Entreprise en difficult√©",v:"60 ans + 10 ans secteur dans les 15 derni√®res ann√©es"},{l:"Entreprise en restructuration",v:"60 ans (d√©rogation possible √† 58 ans)"},{l:"M√©tiers lourds",v:"60 ans + 35 ans carri√®re"}].map((r2,i)=>
              <div key={i} style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
                <div style={{fontWeight:600,color:'#c6a34e'}}>{r2.l}</div>
                <div style={{fontSize:10.5}}>{r2.v}</div>
              </div>
            )}
          </div>
        </C>
      </div>:<C style={{display:'flex',alignItems:'center',justifyContent:'center',minHeight:300,color:'#5e5c56'}}><div style={{textAlign:'center'}}><div style={{fontSize:40,marginBottom:10}}>üèñ</div><div>S√©lectionnez un travailleur et lancez le calcul</div></div></C>}
    </div>
  </div>;
}

function OutplacementMod({s,d}){
  const ae=s.emps||[];const [ds,setDs]=useState([]);
  const [f,setF]=useState({emp:'',type:"legal",prest:'',budget:1800,debut:'',duree:12});
  const tps=[{v:"legal",l:"L√©gal ‚â•45 ans (60h/12 mois)"},{v:"cct82",l:"CCT 82 (30h/3 mois min.)"},{v:"restr",l:"Restructuration"},{v:"volontaire",l:"Volontaire"}];
  const add=()=>{if(!f.emp)return;const emp=ae.find(e=>e.id===f.emp);setDs(p=>[{...f,id:"OP-"+Date.now(),ename:`${emp?.first} ${emp?.last}`,status:'en_cours'},...p]);};
  
  return <div>
    <PH title="Outplacement" sub="Accompagnement reclassement ‚Äî Offre obligatoire dans les 15 jours"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Dossiers actifs",v:ds.filter(x=>x.status==='en_cours').length,c:'#fb923c'},{l:"Budget total",v:fmt(ds.reduce((a,c)=>a+c.budget,0)),c:'#c6a34e'},{l:"Dossiers termin√©s",v:ds.filter(x=>x.status==='termine').length,c:'#4ade80'},{l:"Budget moyen",v:ds.length?fmt(ds.reduce((a,c)=>a+c.budget,0)/ds.length):'‚Äî',c:'#a78bfa'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'350px 1fr',gap:18}}>
      <div>
        <C><ST>Cr√©er dossier</ST>
          <I label="Travailleur" value={f.emp} onChange={v=>setF({...f,emp:v})} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
          <I label="Type" value={f.type} onChange={v=>setF({...f,type:v})} style={{marginTop:9}} options={tps}/>
          <I label="Prestataire" value={f.prest} onChange={v=>setF({...f,prest:v})} style={{marginTop:9}}/>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginTop:9}}>
            <I label="Budget (‚Ç¨)" type="number" value={f.budget} onChange={v=>setF({...f,budget:+v})}/>
            <I label="Dur√©e (mois)" type="number" value={f.duree} onChange={v=>setF({...f,duree:+v})}/>
          </div>
          <B onClick={add} style={{width:'100%',marginTop:14}}>Cr√©er dossier</B>
        </C>
        <C style={{marginTop:12}}><ST>Obligations l√©gales</ST>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
            {[{r:'‚â• 45 ans, licenci√©',o:"Obligatoire ‚Äî 60h sur 12 mois",b:'Min. ‚Ç¨1.800'},{r:'Pr√©avis ‚â• 30 sem.',o:"CCT 82 ‚Äî 1/12 du pr√©avis en outplacement",b:'D√©duit du pr√©avis'},{r:'Restructuration',o:"Cellule pour l'emploi obligatoire",b:'Selon plan social'}].map((r,i)=>
              <div key={i} style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
                <b style={{color:'#c6a34e'}}>{r.r}</b>
                <div style={{fontSize:10.5}}>{r.o}</div>
                <div style={{fontSize:10,color:'#60a5fa'}}>{r.b}</div>
              </div>
            )}
          </div>
          <div style={{marginTop:10,padding:8,background:"rgba(248,113,113,.06)",borderRadius:6,fontSize:10.5,color:'#f87171'}}>
            <b>Sanction:</b> Non-offre = indemnit√© compensatoire de 4 semaines de r√©mun√©ration.
          </div>
        </C>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>Dossiers ({ds.length})</div></div>
        {ds.length>0?<Tbl cols={[
          {k:'e',l:"Travailleur",b:1,r:r=>r.ename},
          {k:'t',l:"Type",r:r=><span style={{fontSize:10,padding:'2px 6px',borderRadius:4,background:"rgba(251,146,56,.1)",color:'#fb923c'}}>{tps.find(t=>t.v===r.type)?.l?.split(' (')[0]}</span>},
          {k:'p',l:"Prestataire",r:r=>r.prest||'√Ä d√©signer'},
          {k:'d',l:"Dur√©e",a:'right',r:r=>`${r.duree} mois`},
          {k:'b',l:"Budget",a:'right',r:r=><span style={{fontWeight:600,color:'#c6a34e'}}>{fmt(r.budget)}</span>},
        ]} data={ds}/>:<div style={{padding:40,textAlign:'center',color:'#5e5c56'}}>Aucun dossier</div>}
      </C>
    </div>
  </div>;
}


function AbsenteismeMod({s,d}){
  const ae=s.emps||[];const n=ae.length||1;
  const [period,setPeriod]=useState('ytd');
  const [dept,setDept]=useState('all');
  
  // Simulated absence data from employees
  const absData=ae.map(e=>{
    const seed=e.id?.charCodeAt(0)||1;
    const shortDays=Math.floor(seed%5);const longDays=Math.floor(seed%3)*5;
    const cases=shortDays>0?1:0+longDays>0?1:0;
    return{e,shortDays,longDays,totalDays:shortDays+longDays,cases:Math.max(1,cases),cost:(shortDays+longDays)*220};
  });
  
  const totDays=absData.reduce((a,r)=>a+r.totalDays,0);
  const totCases=absData.reduce((a,r)=>a+r.cases,0);
  const totCost=absData.reduce((a,r)=>a+r.cost,0);
  const jt=n*21*(period==='ytd'?new Date().getMonth()+1:period==='q'?3:12);
  const taux=jt>0?((totDays/jt)*100):0;
  const bf=totCases>0?(totCases*totCases*(totDays/totCases)):0;
  
  // Benchmark data
  const benchBE=4.2;const benchSector=3.8;
  
  return <div>
    <PH title="Analyse Absent√©isme" sub="Dashboard Bradford Factor, tendances, co√ªts"/>
    {/* Filters */}
    <div style={{display:'flex',gap:10,marginBottom:18}}>
      <I label="P√©riode" value={period} onChange={setPeriod} options={[{v:"ytd",l:"Ann√©e en cours"},{v:"q",l:"Trimestre"},{v:"y",l:"12 mois glissants"}]}/>
    </div>
    {/* KPIs */}
    <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Taux absent√©isme",v:taux.toFixed(1)+'%',c:taux>benchBE?'#ef4444':'#4ade80',s:taux>benchBE?'> Benchmark BE':'< Benchmark BE'},
        {l:"Bradford Factor",v:bf.toFixed(0),c:bf>500?'#fb923c':bf>200?'#f59e0b':'#4ade80',s:bf>500?'√âlev√© ‚Äî Action requise':bf>200?'Attention':'Normal'},
        {l:"Jours perdus",v:totDays,c:'#a78bfa',s:totCases+' cas'},
        {l:"Co√ªt estim√©",v:fmt(totCost),c:'#c6a34e',s:'‚Ç¨220/jour moyen'},
        {l:"Effectif",v:n,c:'#60a5fa',s:'travailleurs actifs'}
      ].map((k,i)=><div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
        <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
        <div style={{fontSize:typeof k.v==='number'?24:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{k.s}</div>
      </div>)}
    </div>
    
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      {/* Detail par travailleur */}
      <C style={{padding:0,overflow:'hidden'}}>
        <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(139,115,60,.1)'}}><div style={{fontSize:13,fontWeight:600,color:'#e8e6e0'}}>D√©tail par travailleur</div></div>
        <Tbl cols={[
          {k:'n',l:"Travailleur",b:1,r:r=>`${r.e.first||r.e.fn||'Emp'} ${r.e.last||''}`},
          {k:'s',l:"Court",a:'right',r:r=><span style={{color:'#f59e0b'}}>{r.shortDays}j</span>},
          {k:'lo',l:"Long",a:'right',r:r=><span style={{color:'#f87171'}}>{r.longDays}j</span>},
          {k:'t',l:"Total",a:'right',r:r=><span style={{fontWeight:600}}>{r.totalDays}j</span>},
          {k:'bf',l:"Bradford",a:'right',r:r=>{const b=r.cases*r.cases*r.totalDays;return <span style={{color:b>200?'#f87171':b>50?'#f59e0b':'#4ade80',fontWeight:600}}>{b}</span>}},
          {k:'c',l:"Co√ªt",a:'right',r:r=><span style={{color:'#c6a34e'}}>{fmt(r.cost)}</span>},
        ]} data={absData}/>
      </C>
      
      {/* Benchmark & analyse */}
      <div>
        <C><ST>Benchmark Belgique 2026</ST>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
            {[{l:"Votre taux",v:taux.toFixed(1)+'%',c:taux>benchBE?'#f87171':'#4ade80'},
              {l:"Moyenne Belgique",v:benchBE+'%',c:'#e8e6e0'},
              {l:"Secteur priv√©",v:benchSector+'%',c:'#e8e6e0'},
              {l:"Secteur public",v:"5.8%",c:'#e8e6e0'},
              {l:"Courte dur√©e (<1 mois)",v:(taux*0.4).toFixed(1)+'%',c:'#f59e0b'},
              {l:"Longue dur√©e (>1 mois)",v:(taux*0.6).toFixed(1)+'%',c:'#f87171'},
            ].map((r,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <span>{r.l}</span><span style={{fontWeight:600,color:r.c}}>{r.v}</span>
            </div>)}
          </div>
        </C>
        <C style={{marginTop:12}}><ST>Bradford Factor ‚Äî Interpr√©tation</ST>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
            {[{range:'0 ‚Äî 50',action:"Normal ‚Äî pas d'action",c:'#4ade80'},
              {range:'51 ‚Äî 200',action:"Entretien informel de retour",c:'#f59e0b'},
              {range:'201 ‚Äî 500',action:"Avertissement √©crit / plan d'action",c:'#fb923c'},
              {range:'> 500',action:"Mesure disciplinaire / m√©decin contr√¥le",c:'#f87171'},
            ].map((r,i)=><div key={i} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <span style={{color:r.c,fontWeight:600}}>{r.range}</span><span style={{fontSize:10.5}}>{r.action}</span>
            </div>)}
          </div>
          <div style={{marginTop:10,padding:8,background:"rgba(96,165,250,.06)",borderRadius:6,fontSize:10.5,color:'#60a5fa',lineHeight:1.5}}>
            <b>Formule:</b> B = S¬≤ √ó D (S = nb √©pisodes, D = jours totaux)<br/>
            <b>Source:</b> Bradford University School of Management
          </div>
        </C>
      </div>
    </div>
  </div>;
}

function AidesEmploiMod({s,d}){
  const [tab,setTab]=useState('premier');
  const ae=s.emps.filter(e=>e.status==='active');
  const [simEmp,setSimEmp]=useState(null);
  const [simRes,setSimRes]=useState(null);

  // ‚îÄ‚îÄ 1ER ENGAGEMENT ‚Äî R√©duction ONSS groupes-cibles (AR 16/05/2003 + R√©forme Avril 2026) ‚îÄ‚îÄ
  // ATTENTION: R√©forme au 01/04/2026 (projet AR ‚Äî Conseil d'√âtat en cours, pas encore MB)
  // Avant 01/04/2026: 1er = max ‚Ç¨3.100/trim √† vie | 2√®-3√® = d√©gressif 13 trim sur 20
  // Apr√®s 01/04/2026: 1er = max ‚Ç¨2.000/trim √† vie | 2√®-3√® = ‚Ç¨1.000/trim √ó 12 trim sur 20
  //                    4√®-5√® = ‚Ç¨1.000/trim √ó 12 trim sur 20 (r√©introduit!) | 6√® = supprim√©
  const PREMIER_ENG_AVANT=[
    {n:1,label:"1er travailleur",phase:"Avant 01/04/2026",red:"Exon√©ration max ‚Ç¨3.100/trim",trim:"Max ‚Ç¨3.100/trimestre",dur:'Illimit√©e (√† vie)',ref:"AR 16/05/2003 + Loi 26/12/2022",montant:[{t:'Tous trim.',m:3100}],full:true},
    {n:2,label:"2√®me travailleur",phase:"Avant 01/04/2026",red:"Forfait d√©gressif (13 trim / 20)",trim:"‚Ç¨1.550 ‚Üí ‚Ç¨1.050 ‚Üí ‚Ç¨450",dur:'13 trimestres sur 20',ref:"AR 16/05/2003 art.12",montant:[{t:'T1-T5',m:1550},{t:'T6-T9',m:1050},{t:'T10-T13',m:450}]},
    {n:3,label:"3√®me travailleur",phase:"Avant 01/04/2026",red:"Forfait d√©gressif (13 trim / 20)",trim:"‚Ç¨1.050 ‚Üí ‚Ç¨450",dur:'13 trimestres sur 20',ref:"AR 16/05/2003 art.12",montant:[{t:'T1-T9',m:1050},{t:'T10-T13',m:450}]},
  ];
  const PREMIER_ENG_APRES=[
    {n:1,label:"1er travailleur",phase:"Apr√®s 01/04/2026",red:"Exon√©ration max ‚Ç¨2.000/trim",trim:"Max ‚Ç¨2.000/trimestre",dur:'Illimit√©e (√† vie)',ref:"Projet AR 2026 (Conseil d'√âtat)",montant:[{t:'Tous trim.',m:2000}],full:true,change:'‚¨á Baisse de ‚Ç¨3.100 √† ‚Ç¨2.000'},
    {n:2,label:"2√®me travailleur",phase:"Apr√®s 01/04/2026",red:"Forfait fixe ‚Ç¨1.000/trim",trim:"‚Ç¨1.000/trimestre",dur:'12 trimestres sur 20',ref:"Projet AR 2026",montant:[{t:'T1-T12',m:1000}],change:'‚ú® Simplifi√©: montant fixe'},
    {n:3,label:"3√®me travailleur",phase:"Apr√®s 01/04/2026",red:"Forfait fixe ‚Ç¨1.000/trim",trim:"‚Ç¨1.000/trimestre",dur:'12 trimestres sur 20',ref:"Projet AR 2026",montant:[{t:'T1-T12',m:1000}],change:'‚ú® Simplifi√©: montant fixe'},
    {n:4,label:"4√®me travailleur",phase:"Apr√®s 01/04/2026 (ou 01/07/2026)",red:"Forfait fixe ‚Ç¨1.000/trim",trim:"‚Ç¨1.000/trimestre",dur:'12 trimestres sur 20',ref:"Projet AR 2026",montant:[{t:'T1-T12',m:1000}],change:'üÜï R√©introduit!'},
    {n:5,label:"5√®me travailleur",phase:"Apr√®s 01/04/2026 (ou 01/07/2026)",red:"Forfait fixe ‚Ç¨1.000/trim",trim:"‚Ç¨1.000/trimestre",dur:'12 trimestres sur 20',ref:"Projet AR 2026",montant:[{t:'T1-T12',m:1000}],change:'üÜï R√©introduit!'},
    {n:6,label:"6√®me travailleur",phase:"‚Äî",red:"SUPPRIM√â",trim:"‚Ç¨0",dur:'‚Äî',ref:"Supprim√© depuis 01/01/2024",montant:[],change:'‚ùå Plus de r√©duction'},
  ];
  const PREMIER_ENG_TOTAL=[
    {n:1,avant:'Illimit√© (max ‚Ç¨3.100/trim)',apres:'Illimit√© (max ‚Ç¨2.000/trim)',totalAvant:'Illimit√©',totalApres:'Illimit√©'},
    {n:2,avant:'‚Ç¨1.550√ó5 + ‚Ç¨1.050√ó4 + ‚Ç¨450√ó4 = ‚Ç¨13.750',apres:'‚Ç¨1.000√ó12 = ‚Ç¨12.000',totalAvant:'‚Ç¨13.750',totalApres:'‚Ç¨12.000'},
    {n:3,avant:'‚Ç¨1.050√ó9 + ‚Ç¨450√ó4 = ‚Ç¨11.250',apres:'‚Ç¨1.000√ó12 = ‚Ç¨12.000',totalAvant:'‚Ç¨11.250',totalApres:'‚Ç¨12.000'},
    {n:4,avant:'SUPPRIM√â (depuis 2024)',apres:'‚Ç¨1.000√ó12 = ‚Ç¨12.000',totalAvant:'‚Ç¨0',totalApres:'‚Ç¨12.000'},
    {n:5,avant:'SUPPRIM√â (depuis 2024)',apres:'‚Ç¨1.000√ó12 = ‚Ç¨12.000',totalAvant:'‚Ç¨0',totalApres:'‚Ç¨12.000'},
    {n:6,avant:'SUPPRIM√â',apres:'SUPPRIM√â',totalAvant:'‚Ç¨0',totalApres:'‚Ç¨0'},
  ];

  // ‚îÄ‚îÄ ACTIVA ‚Äî Plans d'activation par r√©gion ‚îÄ‚îÄ
  const ACTIVA={
    bxl:{
      nom:"Activa.brussels",org:'Actiris',ref:"Ordonnance 23/06/2017 + AGRBC 14/09/2017",
      mesures:[
        {nom:"Activa.brussels",cible:"Demandeur d'emploi (DE) inscrit Actiris ‚â• 12 mois",type:"Activation alloc. ch√¥mage + prime employeur",
          avantages:[
            {l:"Allocation de travail (travailleur)",m:'‚Ç¨350/mois pendant 12 mois max',source:'ONEm via CAPAC/syndicat'},
            {l:"Prime Actiris (employeur)",m:'‚Ç¨800/trimestre pendant 8 trimestres max',source:'Actiris'},
          ],conditions:"DE inscrit ‚â•12 mois, < 57 ans, r√©sidence Bruxelles. CDI ou CDD ‚â• 6 mois, mi-temps min.",procedure:'1. Attestation Actiris 2. Embauche 3. Demande ONSS via DmfA 4. Paiement automatique'},
        {nom:"Activa.brussels Jeunes (<30 ans)",cible:"DE < 30 ans inscrit Actiris ‚â• 6 mois",type:"Prime employeur renforc√©e",
          avantages:[
            {l:"Allocation de travail (travailleur)",m:'‚Ç¨350/mois pendant 6 mois',source:'ONEm'},
            {l:"Prime Actiris Jeunes (employeur)",m:'‚Ç¨350/mois (mi-temps) √† ‚Ç¨700/mois (temps plein) pendant 12 mois',source:'Actiris'},
          ],conditions:"DE < 30 ans, inscrit ‚â• 6 mois, peu qualifi√© (max CESS). R√©sidence Bruxelles.",procedure:'1. Carte Activa Actiris 2. Embauche CDI/CDD ‚â• 6 mois 3. Demande en ligne Actiris'},
        {nom:"Stage First",cible:"Jeune < 30 ans, 1√®re exp√©rience",type:"Stage en entreprise",
          avantages:[{l:"Indemnit√© de stage",m:'‚Ç¨200/mois minimum (employeur)',source:'Employeur'},{l:"Prime stage (DE)",m:"Maintien allocations d'insertion",source:'ONEm'}],
          conditions:"Jeune < 30 ans, DE inscrit Actiris, sans exp√©rience professionnelle",procedure:'Convention de stage via Actiris, dur√©e 3 √† 6 mois'},
        {nom:"Prime de transition",cible:"Travailleur licenci√© en restructuration",type:"Prime √† l'embauche",
          avantages:[{l:"Prime employeur",m:'‚Ç¨1.250/trimestre pendant 4 trimestres',source:'Actiris'}],
          conditions:"Travailleur licenci√© d'une entreprise en restructuration ou en faillite r√©sidant √† Bruxelles",procedure:'Attestation Actiris + demande dans les 6 mois'},
      ]
    },
    wal:{
      nom:"Impulsion / SESAM",org:'FOREM / SPW √âconomie & Emploi',ref:"D√©cret wallon 02/02/2017 + AGW 22/06/2017",
      mesures:[
        {nom:"Impulsion < 25 ans",cible:"Jeune DE inscrit FOREM < 25 ans",type:"Aide √† l'embauche",
          avantages:[{l:"Aide mensuelle (employeur)",m:'‚Ç¨500/mois pendant 36 mois max',source:'FOREM/SPW'}],
          conditions:"DE < 25 ans, inscrit FOREM ‚â• 6 mois, peu qualifi√© (max CESS)",procedure:'1. Demande en ligne FOREM 2. Embauche CDI/CDD ‚â• 6 mois 3. D√©claration trimestrielle'},
        {nom:"Impulsion 25-54 ans",cible:"DE inscrit FOREM 25-54 ans longue dur√©e",type:"Aide √† l'embauche",
          avantages:[{l:"Aide mensuelle (employeur)",m:'‚Ç¨500/mois pendant 24 mois max',source:'SPW'}],
          conditions:"DE 25-54 ans, inscrit FOREM ‚â• 12 mois (18 mois si qualifi√©)",procedure:'Identique Impulsion < 25'},
        {nom:"Impulsion 55+ ans",cible:"DE inscrit FOREM ‚â• 55 ans",type:"Aide √† l'embauche renforc√©e",
          avantages:[{l:"Aide mensuelle (employeur)",m:'‚Ç¨500/mois pendant 36 mois max',source:'SPW'}],
          conditions:"DE ‚â• 55 ans, inscrit FOREM ‚â• 6 mois",procedure:'Identique Impulsion < 25'},
        {nom:"SESAM (Soutien √† l'Emploi dans les Secteurs d'Activit√© Marchands)",cible:"PME ‚â§ 50 travailleurs, secteur marchand",type:"Aide √† la cr√©ation d'emploi",
          avantages:[{l:"Aide annuelle d√©gressive",m:'Ann√©e 1: ‚Ç¨15.000 ‚Äî Ann√©e 2: ‚Ç¨10.000 ‚Äî Ann√©e 3: ‚Ç¨5.000',source:'SPW √âconomie'}],
          conditions:"PME ‚â§ 50 travailleurs, secteur marchand, si√®ge en Wallonie, CDI min. mi-temps",procedure:'Demande avant embauche via formulaire SPW, engagement dans les 6 mois'},
        {nom:"APE (Aide √† la Promotion de l'Emploi)",cible:"Secteur non-marchand wallon",type:"Subvention points APE",
          avantages:[{l:"R√©duction co√ªt salarial",m:'Variable selon points APE attribu√©s (1 point ‚âà ‚Ç¨4.500/an)',source:'SPW'}],
          conditions:"ASBL, commune, CPAS, intercommunale en Wallonie. Attribution par Ministre.",procedure:'Demande annuelle, renouvellement selon disponibilit√©s budg√©taires'},
      ]
    },
    vla:{
      nom:"R√©ductions groupes-cibles flamands",org:'VDAB / WSE (Werk en Sociale Economie)',ref:"D√©cret flamand 04/03/2016 + AGF 17/02/2017",
      mesures:[
        {nom:"R√©duction jeunes < 25 ans",cible:"Jeune < 25 ans, peu qualifi√©",type:"R√©duction ONSS (prime Vlaanderen)",
          avantages:[{l:"Prime trimestrielle (employeur)",m:'‚Ç¨1.150/trimestre pendant 8 trimestres',source:'WSE via DmfA'}],
          conditions:"Jeune < 25 ans, sans dipl√¥me secondaire sup√©rieur, domicili√© en Flandre, salaire trimestriel ‚â§ ‚Ç¨9.000",procedure:'Automatique via DmfA si conditions remplies. Code 6320 en DmfA.'},
        {nom:"R√©duction travailleurs √¢g√©s 55+",cible:"Travailleur ‚â• 55 ans",type:"R√©duction ONSS",
          avantages:[{l:"Prime trimestrielle (employeur)",m:'‚Ç¨1.150/trimestre (sans limite dur√©e)',source:'WSE via DmfA'}],
          conditions:"Travailleur ‚â• 55 ans en service, domicili√© en Flandre, salaire trimestriel ‚â§ ‚Ç¨16.000",procedure:'Automatique via DmfA, pas de demande pr√©alable'},
        {nom:"R√©duction travailleurs en situation de handicap",cible:"Travailleur avec handicap reconnu",type:"R√©duction ONSS + prime",
          avantages:[{l:"Prime VOP (Vlaamse Ondersteuningspremie)",m:'40% √† 60% du co√ªt salarial pendant 5 ans max',source:'VDAB'}],
          conditions:"Handicap reconnu par VAPH/VDAB, contrat ‚â• 3 mois, domicili√© en Flandre",procedure:'Demande VDAB, √©valuation rendement, prime vers√©e trimestriellement'},
      ]
    },
    dg:{
      nom:"Aides Communaut√© germanophone",org:'ADG / Ministerium DG',ref:"D√©cret CG 28/05/2018",
      mesures:[
        {nom:"AktiF / AktiF PLUS",cible:"DE inscrit ADG",type:"Aide √† l'embauche",
          avantages:[{l:"Prime employeur AktiF",m:'‚Ç¨1.000/mois pendant 24 mois max (selon profil)',source:'ADG'}],
          conditions:"DE inscrit ADG, r√©sidence en CG, CDI ou CDD ‚â• 6 mois",procedure:'Demande ADG avant embauche'},
      ]
    }
  };

  // ‚îÄ‚îÄ R√âDUCTIONS GROUPES-CIBLES F√âD√âRALES (hors 1er engagement) ‚îÄ‚îÄ
  const GC_FED=[
    {nom:"R√©duction travailleurs √¢g√©s",cible:"‚â• 55 ans (Bruxelles et Wallonie)",montant:"‚Ç¨1.150/trim (55-57 ans) ‚Üí ‚Ç¨1.500/trim (‚â• 62 ans)",dur:'Tant que conditions remplies',ref:"AR 16/05/2003 Chap.VII",conditions:"Salaire trimestriel ‚â§ ‚Ç¨16.120 (2026). Travailleur ‚â• 55 ans en service, r√©sidant hors Flandre."},
    {nom:"R√©duction restructuration",cible:"Travailleur licenci√© d'entreprise en restructuration",montant:"‚Ç¨1.000/trim pendant 8 trimestres",dur:'8 trimestres',ref:"AR 16/05/2003 art.17 + Loi 01/02/2007",conditions:"Entreprise reconnue en restructuration ou fermeture. Embauche dans les 6 mois apr√®s licenciement."},
    {nom:"R√©duction SINE (√©conomie sociale d'insertion)",cible:"DE tr√®s √©loign√© du march√© du travail",montant:"‚Ç¨1.000/trim pendant 8 √† 21 trimestres",dur:'8 √† 21 trim. selon profil',ref:"AR 16/05/2003 art.18 + Loi 26/05/2002",conditions:"Entreprise d'√©conomie sociale agr√©√©e. Travailleur avec attestation SINE ONEM."},
    {nom:"R√©duction tuteur (formation en alternance)",cible:"Tuteur formant des apprentis/stagiaires",montant:"‚Ç¨800/trim par apprenti (max 4 apprentis = ‚Ç¨3.200/trim)",dur:'Pendant la formation',ref:"AR 16/05/2003 art.15bis",conditions:"Tuteur form√© et agr√©√©, accompagnant un jeune en alternance (IFAPME, SFPME, Syntra)."},
    {nom:"Convention Premier Emploi (CPE/Rosetta)",cible:"Jeune < 26 ans, obligation d'embauche",montant:"R√©duction ONSS forfaitaire ‚Ç¨1.000/trim",dur:'Pendant la CPE (max 12 mois)',ref:"Loi 24/12/1999 + AR 30/03/2000",conditions:"Entreprise ‚â• 50 travailleurs : obligation 3% jeunes. Jeune < 26 ans, DE inscrit, dipl√¥me depuis < 12 mois."},
    {nom:"R√©duction personnel de maison",cible:"Personnel domestique",montant:"Exon√©ration ONSS patronale quasi-totale",dur:'Illimit√©e',ref:"AR 16/05/2003 Chap.IV",conditions:"Travailleur occup√© √† des t√¢ches m√©nag√®res dans un m√©nage priv√©. Max 1 travailleur par m√©nage."},
    {nom:"R√©duction artiste",cible:"Travailleur sous statut artiste (ATA)",montant:"Forfait variable selon prestation",dur:'Par prestation',ref:"Loi 16/12/2022 (r√©forme statut artiste)",conditions:"Travailleur titulaire de l'attestation du travail des arts. Prestation artistique, technique ou de soutien."},
  ];

  // ‚îÄ‚îÄ DISPENSES DE VERSEMENT PR√âCOMPTE PROFESSIONNEL ‚îÄ‚îÄ
  const DISPENSES_PP=[
    {nom:"Travail de nuit et en √©quipes",pct:"22,8%",ref:"Art. 2751 CIR 92",conditions:"Travail en 2 ou 3 √©quipes successives, ou travail de nuit (20h-6h). Prime d'√©quipe/nuit obligatoire."},
    {nom:"Heures suppl√©mentaires",pct:"41,25% (120h) ou 32,19% (volontaires)",ref:"Art. 2752 CIR 92",conditions:"Heures supp. l√©gales (loi 16/03/1971). Max 180 heures/an (130h + 50h horeca)."},
    {nom:"Recherche scientifique",pct:"80%",ref:"Art. 2753 CIR 92",conditions:"Chercheurs titulaires d'un dipl√¥me master/doctorat. Employeur enregistr√© BELSPO."},
    {nom:"Zone d'aide (Zones en difficult√©)",pct:"25% (pendant 2 ans)",ref:"Art. 2758 CIR 92 + Loi 15/05/2014",conditions:"Investissement dans une zone d'aide reconnue (arr√™t√© r√©gional). Emploi cr√©√© dans les 3 ans."},
    {nom:"Sportifs r√©mun√©r√©s",pct:"80%",ref:"Art. 2756 CIR 92",conditions:"Sportif r√©mun√©r√© ‚â• 26 ans. Employeur: club sportif reconnu par une communaut√©."},
    {nom:"Jeunes travailleurs en formation (IBO/PFI/FPI)",pct:"Exon√©ration cotisations",ref:"Divers arr√™t√©s r√©gionaux",conditions:"Stage d'insertion professionnelle via VDAB (IBO), FOREM (PFI), Actiris (FPI), Bruxelles Formation."},
    {nom:"Marine marchande",pct:"100%",ref:"Art. 2754 CIR 92",conditions:"Marins r√©sidents UE/EEE employ√©s sur navire belge enregistr√©."},
    {nom:"Starters (PME)",pct:"10% (micro) ou 20% (petite)",ref:"Art. 27510 CIR 92",conditions:"Micro-entreprise (< 10 travailleurs) ou petite entreprise (< 50 travailleurs). Premiers 48 mois d'activit√©."},
  ];

  // ‚îÄ‚îÄ SIMULATEUR ‚îÄ‚îÄ
  const runSim=(emp)=>{
    const brut=parseFloat(emp.monthlySalary)||0;
    const brutTrim=brut*3;
    const onssPatBase=brutTrim*0.25;
    // R√©duction structurelle approximative
    const redStruct=brutTrim<=9788.76?Math.max(0,560.03-0.0798*(brutTrim-6030.78)):0;
    // V√©rifier √©ligibilit√©s ‚Äî NOUVEAU R√âGIME 04/2026
    const elig=[];
    const nEmps=ae.length;
    if(nEmps<=5){
      if(nEmps===0||nEmps===1){
        // 1er travailleur: max ‚Ç¨2.000/trim √† vie (apr√®s 01/04/2026)
        const maxRed=Math.min(onssPatBase,2000);
        elig.push({nom:"1er engagement ‚Äî Exon√©ration max ‚Ç¨2.000/trim",eco:maxRed,ecoTrim:maxRed,dur:'√Ä vie',type:"premier"});
      } else if(nEmps>=2&&nEmps<=5){
        // 2√® √† 5√®: ‚Ç¨1.000/trim √ó 12 trim
        const labels={2:'2√®me',3:'3√®me',4:'4√®me',5:'5√®me'};
        elig.push({nom:`${labels[nEmps]} travailleur ‚Äî ‚Ç¨1.000/trim`,eco:1000,ecoTrim:1000,dur:'12 trimestres (sur 20)',type:"premier"});
      }
    }
    const age=emp.birth?Math.floor((Date.now()-new Date(emp.birth).getTime())/31557600000):30;
    if(age<25)elig.push({nom:"CPE/Rosetta (< 26 ans)",eco:1000,ecoTrim:1000,dur:'Max 12 mois',type:"federal"});
    if(age>=55)elig.push({nom:"R√©duction travailleurs √¢g√©s (55+)",eco:age>=62?1500:1150,ecoTrim:age>=62?1500:1150,dur:'Illimit√©e',type:"federal"});
    setSimRes({emp,brut,brutTrim,onssPatBase:Math.round(onssPatBase*100)/100,redStruct:Math.round(redStruct*100)/100,elig});
  };

  const tabs=[
    {id:"premier",l:"üèó 1er Engagement",c:()=><div>
      <div style={{padding:14,background:"rgba(251,146,60,.06)",borderRadius:10,border:'1px solid rgba(251,146,60,.15)',marginBottom:16}}>
        <div style={{fontWeight:700,fontSize:14,color:'#fb923c'}}>‚ö† R√âFORME AU 01/04/2026 ‚Äî Projet AR transmis au Conseil d'√âtat (02/2026)</div>
        <div style={{fontSize:11.5,color:'#9e9b93',marginTop:6,lineHeight:1.6}}>Le gouvernement f√©d√©ral modifie les montants des r√©ductions premiers engagements. Le 1er travailleur passe de max ‚Ç¨3.100 √† max ‚Ç¨2.000/trim. Le 2√® et 3√® passent √† un forfait fixe de ‚Ç¨1.000/trim √ó 12. Les 4√® et 5√® travailleurs sont r√©introduits (‚Ç¨1.000/trim √ó 12). Le 6√® reste supprim√©. <b>Pas encore publi√© au Moniteur belge ‚Äî date probable: 01/04/2026 ou 01/07/2026.</b></div>
      </div>

      <div style={{fontWeight:700,fontSize:14,color:'#c6a34e',marginBottom:10}}>R√©gime actuel (jusqu'au 31/03/2026)</div>
      <C style={{padding:0,overflow:'hidden',marginBottom:16}}>
        <table style={{width:'100%',borderCollapse:'collapse',fontSize:12}}>
          <thead><tr style={{background:"rgba(198,163,78,.06)"}}>
            {['N¬∞',"Travailleur","T1-T5","T6-T9","T10-T13","Total max","Dur√©e"].map(h=><th key={h} style={{padding:'10px 12px',textAlign:'left',fontWeight:600,fontSize:11,color:'#c6a34e',borderBottom:'1px solid rgba(198,163,78,.1)'}}>{h}</th>)}
          </tr></thead>
          <tbody>{PREMIER_ENG_AVANT.map((e,i)=><tr key={i} style={{borderBottom:'1px solid rgba(255,255,255,.03)',background:i===0?'rgba(74,222,128,.04)':'transparent'}}>
            <td style={{padding:'10px 12px',fontWeight:700,color:'#c6a34e'}}>{e.n}</td>
            <td style={{padding:'10px 12px',fontWeight:600,color:'#e8e6e0'}}>{e.label}</td>
            <td style={{padding:'10px 12px',fontWeight:600,color:'#4ade80'}}>{e.full?'Max ‚Ç¨3.100':e.montant[0]?`‚Ç¨${e.montant[0].m}`:'-'}</td>
            <td style={{padding:'10px 12px',color:'#fb923c'}}>{e.full?'‚àû':e.montant[1]?`‚Ç¨${e.montant[1].m}`:'-'}</td>
            <td style={{padding:'10px 12px',color:'#9e9b93'}}>{e.full?'‚àû':e.montant[2]?`‚Ç¨${e.montant[2].m}`:'-'}</td>
            <td style={{padding:'10px 12px',fontWeight:700,color:'#e8e6e0'}}>{PREMIER_ENG_TOTAL[i].totalAvant}</td>
            <td style={{padding:'10px 12px',fontSize:11,color:'#5e5c56'}}>{e.dur}</td>
          </tr>)}</tbody>
        </table>
      </C>

      <div style={{fontWeight:700,fontSize:14,color:'#4ade80',marginBottom:10}}>Nouveau r√©gime (√† partir du 01/04/2026)</div>
      <C style={{padding:0,overflow:'hidden',marginBottom:16}}>
        <table style={{width:'100%',borderCollapse:'collapse',fontSize:12}}>
          <thead><tr style={{background:"rgba(74,222,128,.06)"}}>
            {['N¬∞',"Travailleur","Montant/trim","Dur√©e max","P√©riode r√©f.","Total max","Changement"].map(h=><th key={h} style={{padding:'10px 12px',textAlign:'left',fontWeight:600,fontSize:11,color:'#4ade80',borderBottom:'1px solid rgba(74,222,128,.15)'}}>{h}</th>)}
          </tr></thead>
          <tbody>{PREMIER_ENG_APRES.map((e,i)=><tr key={i} style={{borderBottom:'1px solid rgba(255,255,255,.03)',background:e.change?.includes('üÜï')?'rgba(74,222,128,.04)':e.change?.includes('‚ùå')?'rgba(248,113,113,.04)':'transparent'}}>
            <td style={{padding:'10px 12px',fontWeight:700,color:'#c6a34e'}}>{e.n}</td>
            <td style={{padding:'10px 12px',fontWeight:600,color:'#e8e6e0'}}>{e.label}</td>
            <td style={{padding:'10px 12px',fontWeight:700,color:e.n===6?'#f87171':'#4ade80'}}>{e.montant[0]?`‚Ç¨${e.montant[0].m}`:'‚Ç¨0'}</td>
            <td style={{padding:'10px 12px',color:'#9e9b93'}}>{e.dur}</td>
            <td style={{padding:'10px 12px',fontSize:11,color:'#5e5c56'}}>{e.full?'‚Äî':'20 trimestres'}</td>
            <td style={{padding:'10px 12px',fontWeight:700,color:'#e8e6e0'}}>{PREMIER_ENG_TOTAL[i].totalApres}</td>
            <td style={{padding:'10px 12px',fontSize:11,color:e.change?.includes('üÜï')?'#4ade80':e.change?.includes('‚¨á')?'#fb923c':e.change?.includes('‚ùå')?'#f87171':'#60a5fa'}}>{e.change||''}</td>
          </tr>)}</tbody>
        </table>
      </C>

      <div style={{fontWeight:700,fontSize:14,color:'#60a5fa',marginBottom:10}}>Comparatif avant/apr√®s</div>
      <C style={{padding:0,overflow:'hidden',marginBottom:16}}>
        <table style={{width:'100%',borderCollapse:'collapse',fontSize:12}}>
          <thead><tr style={{background:"rgba(96,165,250,.06)"}}>
            {['N¬∞',"Travailleur","Avant (total)","Apr√®s (total)","Impact"].map(h=><th key={h} style={{padding:'10px 14px',textAlign:'left',fontWeight:600,fontSize:11,color:'#60a5fa',borderBottom:'1px solid rgba(96,165,250,.15)'}}>{h}</th>)}
          </tr></thead>
          <tbody>{PREMIER_ENG_TOTAL.map((e,i)=>{
            const diff=i===0?'‚¨á -‚Ç¨1.100/trim':i<=2?(i===2?'‚¨Ü +‚Ç¨750 total':'‚¨á -‚Ç¨1.750 total'):i<=4?'üÜï +‚Ç¨12.000':'‚Äî';
            const col=diff.includes('‚¨Ü')?'#4ade80':diff.includes('‚¨á')?'#fb923c':diff.includes('üÜï')?'#4ade80':'#5e5c56';
            return <tr key={i} style={{borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <td style={{padding:'10px 14px',fontWeight:700,color:'#c6a34e'}}>{e.n}</td>
              <td style={{padding:'10px 14px',fontWeight:600,color:'#e8e6e0'}}>{PREMIER_ENG_APRES[i].label}</td>
              <td style={{padding:'10px 14px',color:'#9e9b93'}}>{e.totalAvant}</td>
              <td style={{padding:'10px 14px',fontWeight:600,color:'#e8e6e0'}}>{e.totalApres}</td>
              <td style={{padding:'10px 14px',fontWeight:600,color:col}}>{diff}</td>
            </tr>;})}
          </tbody>
        </table>
      </C>

      <div style={{marginTop:14,padding:14,background:"rgba(198,163,78,.04)",borderRadius:8,fontSize:11,color:'#9e9b93',lineHeight:1.7}}>
        <b style={{color:'#c6a34e'}}>R√®gles cl√©s:</b><br/>
        ‚Ä¢ Le droit s'ouvre sur base de l'<b>unit√© technique d'exploitation (UTE)</b>, pas de l'entit√© juridique<br/>
        ‚Ä¢ La r√©duction n'est <b>pas li√©e au travailleur</b> ‚Äî l'employeur choisit chaque trimestre pour quel travailleur<br/>
        ‚Ä¢ <b>Cumul possible</b>: r√©duction structurelle + 1er engagement (pas avec autre groupe-cible)<br/>
        ‚Ä¢ Les 4√®-5√® ne comptent pas les engagements avant 01/01/2024 (droits √©teints)<br/>
        ‚Ä¢ <b>Code DmfA</b>: zone 00829 ‚Äî r√©duction groupe-cible premiers engagements<br/>
        ‚Ä¢ Formule ONSS: Pg = G √ó ¬µ √ó Œ≤ (proportionnel aux prestations)<br/>
        ‚Ä¢ Source: <b>Securex 23/01/2026</b> ‚Äî Projet AR transmis au Conseil d'√âtat
      </div>
    </div>},

    {id:"activa",l:"üéØ Activa / R√©gional",c:()=><div>
      {Object.entries(ACTIVA).map(([key,reg])=><C key={key} style={{marginBottom:14}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}}>
          <div><div style={{fontWeight:700,fontSize:15,color:'#c6a34e'}}>{reg.nom}</div><div style={{fontSize:11,color:'#5e5c56'}}>{reg.org} ‚Äî {reg.ref}</div></div>
          <span style={{fontSize:10,padding:'4px 10px',borderRadius:20,background:key==='bxl'?'rgba(96,165,250,.1)':key==='wal'?'rgba(251,146,60,.1)':key==='vla'?'rgba(74,222,128,.1)':'rgba(167,139,250,.1)',color:key==='bxl'?'#60a5fa':key==='wal'?'#fb923c':key==='vla'?'#4ade80':'#a78bfa'}}>{key==='bxl'?'Bruxelles':key==='wal'?'Wallonie':key==='vla'?'Flandre':'CG'}</span>
        </div>
        {reg.mesures.map((m,mi)=><div key={mi} style={{padding:14,background:"rgba(198,163,78,.03)",borderRadius:8,border:'1px solid rgba(198,163,78,.06)',marginBottom:8}}>
          <div style={{fontWeight:600,fontSize:13,color:'#e8e6e0'}}>{m.nom}</div>
          <div style={{fontSize:11,color:'#60a5fa',marginTop:4}}>Cible: {m.cible}</div>
          <div style={{marginTop:8}}>{m.avantages.map((a,ai)=><div key={ai} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.02)'}}>
            <div style={{fontSize:11.5,color:'#9e9b93'}}>{a.l}</div>
            <div style={{fontSize:12,fontWeight:600,color:'#4ade80',whiteSpace:'nowrap'}}>{a.m}</div>
          </div>)}</div>
          <div style={{fontSize:10.5,color:'#5e5c56',marginTop:8,lineHeight:1.5}}><b>Conditions:</b> {m.conditions}</div>
          {m.procedure&&<div style={{fontSize:10.5,color:'#8b7340',marginTop:4}}><b>Proc√©dure:</b> {m.procedure}</div>}
        </div>)}
      </C>)}
    </div>},

    {id:"gc_fed",l:"‚öñ Groupes-cibles f√©d√©raux",c:()=><div>
      <div style={{padding:14,background:"rgba(96,165,250,.06)",borderRadius:10,border:'1px solid rgba(96,165,250,.15)',marginBottom:16}}>
        <div style={{fontWeight:700,fontSize:14,color:'#60a5fa'}}>R√©ductions groupes-cibles f√©d√©rales</div>
        <div style={{fontSize:11.5,color:'#9e9b93',marginTop:6,lineHeight:1.6}}>AR 16/05/2003 + modifications. Ces r√©ductions sont cumulables avec la r√©duction structurelle mais PAS entre elles (sauf 1er engagement + groupe-cible). Le syst√®me choisit automatiquement la plus avantageuse via la DmfA.</div>
      </div>
      {GC_FED.map((g,i)=><C key={i} style={{marginBottom:8,padding:'14px 18px'}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'start'}}>
          <div><div style={{fontWeight:600,fontSize:13,color:'#e8e6e0'}}>{g.nom}</div><div style={{fontSize:11,color:'#60a5fa',marginTop:3}}>Cible: {g.cible}</div></div>
          <div style={{textAlign:'right'}}><div style={{fontWeight:700,fontSize:13,color:'#4ade80'}}>{g.montant}</div><div style={{fontSize:10,color:'#5e5c56'}}>{g.dur}</div></div>
        </div>
        <div style={{fontSize:10.5,color:'#5e5c56',marginTop:8}}><b>Conditions:</b> {g.conditions}</div>
        <div style={{fontSize:9.5,color:'#8b7340',marginTop:3}}>R√©f: {g.ref}</div>
      </C>)}
    </div>},

    {id:"dispense",l:"üí∞ Dispenses PP",c:()=><div>
      <div style={{padding:14,background:"rgba(198,163,78,.06)",borderRadius:10,border:'1px solid rgba(198,163,78,.15)',marginBottom:16}}>
        <div style={{fontWeight:700,fontSize:14,color:'#c6a34e'}}>Dispenses de versement du pr√©compte professionnel</div>
        <div style={{fontSize:11.5,color:'#9e9b93',marginTop:6,lineHeight:1.6}}>L'employeur retient le PP normalement sur le salaire du travailleur mais ne verse qu'une partie au SPF Finances. La diff√©rence est un avantage net pour l'employeur. D√©claration via 274.XX au SPF Finances.</div>
      </div>
      <C style={{padding:0,overflow:'hidden'}}>
        <table style={{width:'100%',borderCollapse:'collapse',fontSize:12}}>
          <thead><tr style={{background:"rgba(198,163,78,.06)"}}>
            {['Dispense',"% non vers√©","Conditions","R√©f. l√©gale"].map(h=><th key={h} style={{padding:'10px 14px',textAlign:'left',fontWeight:600,fontSize:11,color:'#c6a34e',borderBottom:'1px solid rgba(198,163,78,.1)'}}>{h}</th>)}
          </tr></thead>
          <tbody>{DISPENSES_PP.map((dp,i)=><tr key={i} style={{borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <td style={{padding:'10px 14px',fontWeight:600,color:'#e8e6e0'}}>{dp.nom}</td>
            <td style={{padding:'10px 14px',fontWeight:700,color:'#4ade80'}}>{dp.pct}</td>
            <td style={{padding:'10px 14px',fontSize:11,color:'#9e9b93'}}>{dp.conditions}</td>
            <td style={{padding:'10px 14px',fontSize:10.5,color:'#8b7340'}}>{dp.ref}</td>
          </tr>)}</tbody>
        </table>
      </C>
    </div>},

    {id:"sim",l:"üßÆ Simulateur",c:()=><div>
      <div style={{padding:14,background:"rgba(74,222,128,.06)",borderRadius:10,border:'1px solid rgba(74,222,128,.15)',marginBottom:16}}>
        <div style={{fontWeight:700,fontSize:14,color:'#4ade80'}}>Simulateur d'√©ligibilit√© aux aides</div>
        <div style={{fontSize:11.5,color:'#9e9b93',marginTop:6}}>S√©lectionnez un employ√© pour v√©rifier les aides auxquelles il pourrait donner droit.</div>
      </div>
      {ae.length===0?<C><div style={{textAlign:'center',color:'#5e5c56',padding:30}}>Ajoutez des employ√©s pour utiliser le simulateur</div></C>:
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14}}>
        <C><ST>S√©lectionner un employ√©</ST>
          {ae.map(e=><div key={e.id} onClick={()=>{setSimEmp(e);runSim(e);}} style={{padding:'10px 14px',cursor:'pointer',borderRadius:8,marginBottom:4,border:'1px solid '+(simEmp?.id===e.id?'rgba(198,163,78,.3)':'rgba(198,163,78,.06)'),background:simEmp?.id===e.id?'rgba(198,163,78,.08)':'transparent'}}
            onMouseEnter={ev=>ev.currentTarget.style.background='rgba(198,163,78,.06)'} onMouseLeave={ev=>{if(simEmp?.id!==e.id)ev.currentTarget.style.background='transparent';}}>
            <div style={{fontWeight:600,fontSize:12.5,color:'#e8e6e0'}}>{e.first} {e.last}</div>
            <div style={{fontSize:10.5,color:'#5e5c56'}}>{e.fn} ¬∑ {e.statut==='ouvrier'?'Ouvrier':'Employ√©'} ¬∑ Brut {fmt(e.monthlySalary)}</div>
          </div>)}
        </C>
        {simRes?<C><ST>R√©sultat ‚Äî {simRes.emp.first} {simRes.emp.last}</ST>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginBottom:14}}>
            <div style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}><div style={{fontSize:9.5,color:'#5e5c56',textTransform:'uppercase'}}>ONSS patronale/trim</div><div style={{fontSize:15,fontWeight:700,color:'#f87171',marginTop:4}}>{fmt(simRes.onssPatBase)}</div></div>
            <div style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}><div style={{fontSize:9.5,color:'#5e5c56',textTransform:'uppercase'}}>R√©d. structurelle/trim</div><div style={{fontSize:15,fontWeight:700,color:'#60a5fa',marginTop:4}}>-{fmt(simRes.redStruct)}</div></div>
          </div>
          <ST>Aides √©ligibles</ST>
          {simRes.elig.length===0?<div style={{padding:14,textAlign:'center',color:'#5e5c56',fontSize:12}}>Aucune aide sp√©cifique d√©tect√©e (r√©duction structurelle toujours applicable)</div>:
          simRes.elig.map((el,i)=><div key={i} style={{padding:'10px 14px',background:"rgba(74,222,128,.06)",borderRadius:8,border:'1px solid rgba(74,222,128,.15)',marginBottom:6}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
              <div style={{fontWeight:600,fontSize:12.5,color:'#4ade80'}}>{el.nom}</div>
              <div style={{fontWeight:700,fontSize:13,color:'#4ade80'}}>-{fmt(el.eco)}/trim</div>
            </div>
            <div style={{fontSize:10.5,color:'#5e5c56',marginTop:3}}>Dur√©e: {el.dur}</div>
          </div>)}
          <div style={{marginTop:12,padding:10,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}>
            <div style={{fontSize:9.5,color:'#5e5c56',textTransform:'uppercase'}}>√âconomie totale estim√©e / trimestre</div>
            <div style={{fontSize:18,fontWeight:800,color:'#4ade80',marginTop:4}}>{fmt(simRes.elig.reduce((a,e)=>a+e.eco,0)+simRes.redStruct)}</div>
          </div>
        </C>:<C><div style={{padding:40,textAlign:'center',color:'#5e5c56',fontSize:12}}>‚Üê S√©lectionnez un employ√©</div></C>}
      </div>}
    </div>},

    {id:"procedure",l:"üìã Proc√©dure",c:()=><div>
      {[
        {t:"1. Avant l'embauche",steps:['V√©rifier le nombre de travailleurs actuels (1er engagement?)',"Consulter le profil du candidat : √¢ge, dur√©e inoccupation, dipl√¥me, domicile","V√©rifier la r√©gion de r√©sidence du candidat (d√©termine les aides r√©gionales)","Demander carte Activa / attestation FOREM / attestation VDAB si n√©cessaire","V√©rifier si l'entreprise est dans une zone d'aide (dispense PP 25%)"]},
        {t:"2. √Ä l'embauche",steps:['Dimona IN avec les bons codes DmfA (code r√©duction groupe-cible)',"Conserver l'attestation du travailleur (carte Activa, attestation FOREM, etc.)","Introduire la demande d'aide r√©gionale (SESAM: avant embauche!)","D√©clarer le travailleur dans la cat√©gorie correcte en DmfA"]},
        {t:'3. Trimestriellement',steps:['V√©rifier le plafond salarial trimestriel (‚Ç¨9.000 jeunes FL, ‚Ç¨16.000 55+ FL, etc.)',"Encoder les codes r√©duction en DmfA (zone 00829 ‚Äî code travailleur groupe-cible)","Calculer la r√©duction structurelle + r√©duction groupe-cible","V√©rifier le cumul : structurelle + 1 groupe-cible (pas 2 groupes-cibles entre eux)"]},
        {t:'4. Dispenses PP (formulaires 274)',steps:['274.XX ‚Äî D√©claration trimestrielle au SPF Finances',"274.31 ‚Äî Travail de nuit et en √©quipes (22,8%)","274.32 ‚Äî Heures suppl√©mentaires (41,25% ou 32,19%)","274.33 ‚Äî Recherche scientifique (80%)","274.75 ‚Äî Zone d'aide (25%)","274.XX ‚Äî Starters PME (10% ou 20%)","Attention: la dispense PP se calcule sur le PP retenu, pas sur le salaire brut"]},
        {t:'5. Annuellement',steps:['Bilan social BNB : d√©clarer les aides per√ßues',"Belcotax 281.10 : aucun impact (PP retenu int√©gralement sur fiche)","V√©rifier le renouvellement des aides r√©gionales (APE, SESAM, etc.)","Mettre √† jour les attestations des travailleurs"]},
      ].map((s,si)=><C key={si} style={{marginBottom:10}}>
        <div style={{fontWeight:700,fontSize:13,color:'#c6a34e',marginBottom:10}}>{s.t}</div>
        {s.steps.map((st,sti)=><div key={sti} style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.02)',fontSize:12,color:'#d4d0c8',display:'flex',gap:8}}>
          <span style={{color:'#c6a34e',fontWeight:600}}>{sti+1}.</span>{st}
        </div>)}
      </C>)}
    </div>},
  ];

  return <div>
    <C style={{padding:'18px 20px',marginBottom:16}}><div style={{display:'flex',alignItems:'center',gap:10}}><span style={{fontSize:24}}>üéØ</span><div><div style={{fontWeight:700,fontSize:16,color:'#e8e6e0'}}>Aides √† l'emploi ‚Äî R√©ductions & Activations</div><div style={{fontSize:11.5,color:'#5e5c56'}}>1er engagement ¬∑ Activa ¬∑ Groupes-cibles ¬∑ Dispenses PP ¬∑ Simulateur</div></div></div></C>
    <div style={{display:'flex',gap:6,marginBottom:16,flexWrap:'wrap'}}>
      {tabs.map(t=><button key={t.id} onClick={()=>setTab(t.id)} style={{padding:'8px 16px',border:'none',borderRadius:8,cursor:'pointer',fontSize:12,fontWeight:tab===t.id?600:400,color:tab===t.id?'#c6a34e':'#9e9b93',background:tab===t.id?'rgba(198,163,78,.1)':'rgba(198,163,78,.03)',fontFamily:'inherit',borderBottom:tab===t.id?'2px solid #c6a34e':'2px solid transparent'}}>{t.l}</button>)}
    </div>
    {tabs.find(t=>t.id===tab)?.c()}
  </div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AUREUS SUITE ‚Äî Nos logiciels
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function AureusSuitePage({s,d}){
  const sub=s.sub||'aureus_pointage';
  // Sprint 5 IA modules
  if(sub==='ia_turnover')return <PredictionTurnoverMod s={s} d={d}/>;
  if(sub==='ia_salaire')return <RecoSalaireMod s={s} d={d}/>;
  if(sub==='ia_prevision')return <PrevisionMasseMod s={s} d={d}/>;
  if(sub==='ia_anomalies')return <DetectionAnomaliesMod s={s} d={d}/>;
  if(sub==='ia_sante')return <ScoreSanteMod s={s} d={d}/>;
  if(sub==='api_doc')return <APIDocMod s={s} d={d}/>;
  if(sub==='multi_currency')return <MultiCurrencyMod s={s} d={d}/>;
  if(sub==='marketplace')return <MarketplaceMod s={s} d={d}/>;
  if(sub==='integrations')return <IntegrationsMod s={s} d={d}/>;
  if(sub==='webhooks')return <WebhookManagerMod s={s} d={d}/>;
  if(sub==='budget_auto')return <BudgetAutoMod s={s} d={d}/>;
  if(sub==='what_if')return <SimulateurWhatIfMod s={s} d={d}/>;
  if(sub==='kpi_dashboard')return <KPIDashboardMod s={s} d={d}/>;
  if(sub==='automations')return <AutomationsMod s={s} d={d}/>;
  if(sub==='scheduler')return <SchedulerMod s={s} d={d}/>;
  if(sub==='absences')return <AbsencesMod s={s} d={d}/>;
  if(sub==='templates')return <TemplatesMod s={s} d={d}/>;
  const products=[
    {id:"aureus_pointage",ic:'‚è±',name:'Aureus Pointage',
      short:"Enregistrement des entr√©es et sorties",
      desc:"Collectez les informations de pointage de vos travailleurs, avec ou sans horloge pointeuse. Compatible ateliers, bureaux, chantiers, travailleurs itin√©rants.",
      features:['Pointage entr√©e/sortie (matin, midi, soir)',"Calendriers individuels et collectifs","Gestion des absences et cong√©s","Heures suppl√©mentaires automatiques","Heures de nuit, dimanche et jours f√©ri√©s","Export vers Aureus Paie ou secr√©tariat social","Rapports d√©taill√©s et statistiques","Connexion horloge pointeuse, smartphone, tablette","D√©tection anomalies (d√©passement l√©gal, pause manquante)","Archivage conforme CJUE C-55/18 et Loi 5/03/2024"],
      color:'#4ade80'},
    {id:"aureus_paie",ic:'üí∞',name:'Aureus Paie',
      short:"Calcul complet des salaires belges",
      desc:"Logiciel de paie complet pour toutes les commissions paritaires belges. Agr√©√© ONSS (Dimona, DMFA), FINPROF, Belcotax-on-web, Bilan Social et ONEm.",
      features:['Fiches de paie conformes (loi 12/04/1965)',"Pr√©compte professionnel ‚Äî formule-cl√© SPF Finances","ONSS : 13,07% travailleur, 25% patronal marchand, 32,40% non-marchand","Ouvriers : base √ó 108%","Dimona IN/OUT automatique","DMFA trimestrielle","Belcotax 281.10, 281.20, 281.30","Documents sociaux (C4, C131, attestations)","Net au brut","Saisies-cessions et rentes","35 commissions paritaires avec bar√®mes exacts","Ch√®ques-repas, √©co-ch√®ques, plan caf√©t√©ria"],
      color:'#c6a34e'},
    {id:"aureus_titres_services",ic:'üè†',name:'Aureus Titres-Services',
      short:"Gestion compl√®te des soci√©t√©s de titres-services",
      desc:"Couvrez l'ensemble du syst√®me d'information de votre soci√©t√© de titres-services : signal√©tiques, agendas, prestations, feuilles de route et lien avec le secr√©tariat social.",
      features:['Signal√©tiques prestataires et clients',"Gestion des agendas et plannings","Feuilles de route automatiques","Suivi des prestations par aide m√©nag√®re","Export vers Aureus Paie ou secr√©tariat social","Communication par mail/courrier","Int√©gration Pluxee (ex-Sodexo)","Conformit√© eGov 3.0","Flexi-salaires et d√©clarations","Rapports de gestion et statistiques"],
      color:'#60a5fa'},
    {id:"aureus_aide_domicile",ic:'üè•',name:'Aureus Aide √† Domicile',
      short:"Gestion des services d'aide et de soins √† domicile",
      desc:"Planifiez et suivez les prestations de vos aides m√©nag√®res et soignants √† domicile. Gestion des kilom√®tres, frais de d√©placement et facturation.",
      features:['Plannings par b√©n√©ficiaire et par prestataire',"Suivi des prestations journali√®res","Calcul automatique des kilom√®tres","Frais de d√©placement","Facturation aux mutuelles et CPAS","Export vers Aureus Paie","Rapports d'activit√©","Gestion des remplacements","Suivi des qualifications et formations","Conformit√© r√©glementaire r√©gionale (AViQ, Iriscare, VAPH)"],
      color:'#a78bfa'},
    {id:"aureus_portail",ic:'üåê',name:'Aureus Portail',
      short:"Espace en ligne pour employeurs et travailleurs",
      desc:"Portail web s√©curis√© o√π vos clients encodent leurs prestations, consultent leurs fiches de paie et communiquent avec votre bureau social. Chaque client ne voit que ses propres donn√©es.",
      features:['Acc√®s s√©curis√© par client (login + mot de passe)',"Encodage des prestations mensuelles","Demandes de cong√©s et absences","Consultation des fiches de paie","Messagerie avec le bureau social","Documents en ligne (contrats, attestations)","Donn√©es isol√©es par client (RGPD)","Tableau de suivi bureau social (qui a encod√©, en retard)","Notifications et rappels automatiques","Compatible ordinateur, tablette et smartphone"],
      color:'#fb923c'},
    {id:"aureus_mobile",ic:'üì±',name:'Aureus Mobile',
      short:"Application smartphone pour travailleurs itin√©rants",
      desc:"Vos travailleurs pointent directement depuis leur t√©l√©phone avec localisation GPS. Id√©al pour les commerciaux, techniciens, aides m√©nag√®res et travailleurs de terrain.",
      features:['Pointage entr√©e/sortie avec GPS',"Photo et signature","D√©claration d'absences","Consultation fiche de paie","Demande de cong√©s","Frais de d√©placement","Notification des plannings","Fonctionne hors connexion","Synchronisation automatique","Compatible Android et iOS"],
      color:'#f87171'},
    {id:"aureus_chantier",ic:'üèó',name:'Aureus Chantier',
      short:"Borne de pointage sur chantier",
      desc:"G√©rez les entr√©es et sorties de tous les travailleurs et visiteurs pr√©sents sur vos chantiers. Reporting en temps r√©el au si√®ge central.",
      features:['Borne tactile sur chantier',"Badge, QR code ou reconnaissance","Suivi en temps r√©el des pr√©sences","Alerte si travailleur non d√©clar√© (Dimona)","Registre de pr√©sence l√©gal","Reporting au si√®ge central","Gestion multi-chantiers","Visiteurs et sous-traitants","Export vers Aureus Pointage","Conforme r√©glementation chantiers temporaires"],
      color:'#e8c547'},
    {id:"aureus_tableau_bord",ic:'üìä',name:'Aureus Tableau de Bord',
      short:"Chiffres cl√©s de votre entreprise en un coup d'≈ìil",
      desc:"Visualisez les indicateurs essentiels de vos dossiers : masse salariale, absent√©isme, co√ªts, effectifs. Graphiques interactifs connect√©s √† tous les modules Aureus.",
      features:['KPI en temps r√©el',"Masse salariale par mois, trimestre, ann√©e","Taux d'absent√©isme et Bradford Factor","Co√ªt moyen par travailleur","√âvolution des effectifs","R√©partition par CP, contrat, d√©partement","Graphiques interactifs","Export PDF et Excel","Multi-dossiers (tous vos clients)","Comparaison avec benchmarks sectoriels"],
      color:'#c6a34e'},
  ];

  const sel=products.find(p=>p.id===sub)||products[0];

  return <div>
    <PH title="Aureus Suite" sub="L'ensemble des logiciels Aureus IA pour la gestion sociale"/>

    {/* Product cards grid */}
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:20}}>
      {products.map(p=><div key={p.id} onClick={()=>d({type:"NAV",page:'aureussuite',sub:p.id})}
        style={{padding:'16px 14px',borderRadius:10,cursor:'pointer',textAlign:'center',
          background:sub===p.id?`${p.color}12`:'rgba(255,255,255,.02)',
          border:sub===p.id?`1px solid ${p.color}40`:'1px solid rgba(255,255,255,.04)',
          transition:'all .2s'}}>
        <div style={{fontSize:28,marginBottom:6}}>{p.ic}</div>
        <div style={{fontSize:12,fontWeight:600,color:sub===p.id?p.color:'#e8e6e0'}}>{p.name}</div>
        <div style={{fontSize:10,color:'#5e5c56',marginTop:3,lineHeight:1.4}}>{p.short}</div>
      </div>)}
    </div>

    {/* Selected product detail */}
    <C style={{padding:0,overflow:'hidden'}}>
      <div style={{padding:'18px 22px',background:`${sel.color}08`,borderBottom:`1px solid ${sel.color}20`,display:'flex',alignItems:'center',gap:14}}>
        <span style={{fontSize:36}}>{sel.ic}</span>
        <div>
          <div style={{fontSize:18,fontWeight:700,color:sel.color}}>{sel.name}</div>
          <div style={{fontSize:12,color:'#9e9b93',marginTop:2}}>{sel.short}</div>
        </div>
      </div>
      <div style={{padding:22}}>
        <div style={{fontSize:13,color:'#d4d0c8',lineHeight:1.7,marginBottom:18}}>{sel.desc}</div>
        <div style={{fontSize:11,fontWeight:600,color:sel.color,marginBottom:10,textTransform:'uppercase',letterSpacing:'1px'}}>Fonctionnalit√©s</div>
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:6}}>
          {sel.features.map((f,i)=><div key={i} style={{display:'flex',gap:8,alignItems:'flex-start',padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.02)'}}>
            <span style={{color:sel.color,fontSize:11,marginTop:1}}>‚úì</span>
            <span style={{fontSize:12,color:'#d4d0c8',lineHeight:1.4}}>{f}</span>
          </div>)}
        </div>

        <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:12,marginTop:20}}>
          <div style={{padding:14,background:"rgba(255,255,255,.02)",borderRadius:8,textAlign:'center',border:'1px solid rgba(255,255,255,.04)'}}>
            <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>Statut</div>
            <div style={{fontSize:14,fontWeight:700,color:'#4ade80',marginTop:4}}>‚úÖ Int√©gr√©</div>
          </div>
          <div style={{padding:14,background:"rgba(255,255,255,.02)",borderRadius:8,textAlign:'center',border:'1px solid rgba(255,255,255,.04)'}}>
            <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>D√©veloppeur</div>
            <div style={{fontSize:14,fontWeight:700,color:'#c6a34e',marginTop:4}}>Aureus IA SPRL</div>
          </div>
          <div style={{padding:14,background:"rgba(255,255,255,.02)",borderRadius:8,textAlign:'center',border:'1px solid rgba(255,255,255,.04)'}}>
            <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase'}}>Compatible</div>
            <div style={{fontSize:14,fontWeight:700,color:'#60a5fa',marginTop:4}}>Tous modules</div>
          </div>
        </div>
      </div>
    </C>

    {/* Integration schema */}
    <C style={{marginTop:14,padding:'16px 20px'}}>
      <div style={{fontSize:12,fontWeight:600,color:'#c6a34e',marginBottom:12}}>Comment les logiciels Aureus fonctionnent ensemble</div>
      <div style={{display:'grid',gridTemplateColumns:'1fr auto 1fr auto 1fr',gap:8,alignItems:'center',textAlign:'center'}}>
        <div style={{padding:12,background:"rgba(74,222,128,.06)",borderRadius:8,border:'1px solid rgba(74,222,128,.15)'}}>
          <div style={{fontSize:16}}>‚è±üì±üèó</div>
          <div style={{fontSize:11,fontWeight:600,color:'#4ade80',marginTop:4}}>Collecte</div>
          <div style={{fontSize:10,color:'#9e9b93'}}>Pointage, Mobile, Chantier</div>
        </div>
        <div style={{fontSize:18,color:'#5e5c56'}}>‚Üí</div>
        <div style={{padding:12,background:"rgba(198,163,78,.06)",borderRadius:8,border:'1px solid rgba(198,163,78,.15)'}}>
          <div style={{fontSize:16}}>üí∞</div>
          <div style={{fontSize:11,fontWeight:600,color:'#c6a34e',marginTop:4}}>Calcul</div>
          <div style={{fontSize:10,color:'#9e9b93'}}>Aureus Paie</div>
        </div>
        <div style={{fontSize:18,color:'#5e5c56'}}>‚Üí</div>
        <div style={{padding:12,background:"rgba(96,165,250,.06)",borderRadius:8,border:'1px solid rgba(96,165,250,.15)'}}>
          <div style={{fontSize:16}}>üåêüìä</div>
          <div style={{fontSize:11,fontWeight:600,color:'#60a5fa',marginTop:4}}>Distribution</div>
          <div style={{fontSize:10,color:'#9e9b93'}}>Portail, Tableau de Bord</div>
        </div>
      </div>
      <div style={{marginTop:12,fontSize:10.5,color:'#5e5c56',textAlign:'center',lineHeight:1.5}}>
        Les donn√©es circulent automatiquement entre les modules. Aucune ressaisie n√©cessaire.
      </div>
    </C>
  </div>;
}

function BienetrePage({s,d}){
  const [sub,setSub]=useState('dashboard');
  const mods={dashboard:"Dashboard",planglobal:"Plan Global",paa:'Plan Annuel',risques:'Risques Psychosociaux',alcool:"Politique Alcool/Drogues",organes:'Organes de concertation'};
  return <div>
    <div style={{display:'flex',gap:6,marginBottom:16,flexWrap:'wrap'}}>
      {Object.entries(mods).map(([k,l])=>
        <button key={k} onClick={()=>setSub(k)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:sub===k?600:400,fontFamily:'inherit',
          background:sub===k?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:sub===k?'#c6a34e':'#9e9b93'}}>{l}</button>
      )}
    </div>
    {sub==='dashboard'&&<BienEtreDash s={s}/>}
    {sub==='planglobal'&&<PlanGlobalMod s={s} d={d}/>}
    {sub==='paa'&&<PAAMod s={s} d={d}/>}
    {sub==='risques'&&<RisquesPsychoMod s={s} d={d}/>}
    {sub==='alcool'&&<AlcoolMod s={s} d={d}/>}
    {sub==='organes'&&<OrganesMod s={s} d={d}/>}
  </div>;
}

function BienEtreDash({s}){
  const n=(s.emps||[]).length;
  return <div>
    <PH title="Bien-√™tre au Travail" sub="Code du bien-√™tre ‚Äî Loi du 4/8/1996"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Effectif",v:n,c:'#60a5fa',s:'travailleurs'},{l:"Conseiller pr√©vention",v:n<20?'Employeur':'Interne',c:'#c6a34e',s:n<20?'< 20 trav.':'‚â• 20 trav.'},{l:"SEPPT",v:"Obligatoire",c:'#4ade80',s:'Service externe'},{l:"SIPPT",v:n>=20?'Obligatoire':'Facultatif',c:n>=20?'#fb923c':'#9e9b93',s:'Service interne'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:20,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
          <div style={{fontSize:10,color:'#5e5c56',marginTop:2}}>{k.s}</div>
        </div>
      )}
    </div>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>7 domaines du bien-√™tre</ST>
        {[{d:"S√©curit√© au travail",ic:'ü¶∫',c:'#f87171'},{d:"Protection de la sant√©",ic:'üè•',c:'#60a5fa'},{d:"Risques psychosociaux",ic:'üß†',c:'#a78bfa'},{d:"Ergonomie",ic:'ü™ë',c:'#fb923c'},{d:"Hygi√®ne du travail",ic:'üßπ',c:'#4ade80'},{d:"Embellissement des lieux",ic:'üåø',c:'#c6a34e'},{d:"Environnement (impact)",ic:'üåç',c:'#60a5fa'}].map((r,i)=>
          <div key={i} style={{display:'flex',gap:10,alignItems:'center',padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <span style={{fontSize:18}}>{r.ic}</span>
            <span style={{fontSize:12,color:r.c,fontWeight:500}}>{r.d}</span>
          </div>
        )}
      </C>
      <C><ST>Obligations employeur</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {['Plan global de pr√©vention (5 ans)',"Plan annuel d'action (PAA)","Analyse des risques (tous postes)","D√©signer conseiller(s) en pr√©vention","Affilier √† un SEPPT (service externe)","Constituer CPPT si ‚â• 50 travailleurs","Politique alcool et drogues (CCT 100)","Proc√©dure risques psychosociaux","Registre de faits de tiers"].map((o,i)=>
            <div key={i} style={{padding:'3px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>{o}</div>
          )}
        </div>
      </C>
    </div>
  </div>;
}

function PlanGlobalMod({s,d}){
  return <div>
    <PH title="Plan Global de Pr√©vention" sub="Obligatoire ‚Äî Dur√©e 5 ans ‚Äî Code bien-√™tre Livre I Titre 2"/>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Structure du Plan Global</ST>
        {[{s:'1. R√©sultats analyse des risques',d:"Identification de tous les dangers et risques par poste/activit√©"},{s:'2. Mesures de pr√©vention prioritaires',d:"Hi√©rarchie: √©limination > protection collective > protection individuelle"},{s:'3. Objectifs prioritaires',d:"Par domaine du bien-√™tre ‚Äî indicateurs mesurables"},{s:'4. Moyens et ressources',d:"Budget pr√©vention, formation, √©quipements"},{s:'5. Missions et obligations',d:"Ligne hi√©rarchique, conseillers, travailleurs"},{s:"6. Crit√®res d'√©valuation",d:"Indicateurs de suivi annuel"}].map((r,i)=>
          <div key={i} style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
            <b style={{color:'#c6a34e',fontSize:12}}>{r.s}</b>
            <div style={{fontSize:10.5,color:'#9e9b93',marginTop:1}}>{r.d}</div>
          </div>
        )}
      </C>
      <C><ST>Calendrier</ST>
        {[{p:'Ann√©e 1 (2025)',a:'Analyse compl√®te des risques + r√©daction plan'},{p:'Ann√©e 2',a:'Mise en oeuvre priorit√©s 1 + √©valuation'},{p:'Ann√©e 3',a:'Mise en oeuvre priorit√©s 2 + r√©vision'},{p:'Ann√©e 4',a:'√âvaluation interm√©diaire'},{p:'Ann√©e 5 (2029)',a:'√âvaluation finale + nouveau plan'}].map((r,i)=>
          <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
            <b style={{color:'#e8e6e0'}}>{r.p}</b><span style={{color:'#9e9b93'}}>{r.a}</span>
          </div>
        )}
        <div style={{marginTop:10,padding:8,background:"rgba(248,113,113,.06)",borderRadius:6,fontSize:10.5,color:'#f87171'}}>
          <b>Avis CPPT:</b> Le plan doit √™tre soumis au CPPT (ou √† la DS, ou aux travailleurs).
        </div>
      </C>
    </div>
  </div>;
}

function PAAMod({s,d}){
  return <div>
    <PH title="Plan Annuel d'Action" sub="Concr√©tisation du Plan Global ‚Äî Objectifs de l'ann√©e"/>
    <C><ST>Contenu obligatoire du PAA</ST>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18,fontSize:11,color:'#9e9b93'}}>
        <div>
          {[{t:"Objectifs prioritaires de l'ann√©e",d:"Actions concr√®tes par domaine"},{t:'Moyens et d√©lais',d:"Budget, calendrier, responsables"},{t:"Modifications d'installations",d:"Nouvelles machines, am√©nagements, produits"},{t:'Formations planifi√©es',d:"Secouristes, incendie, ergonomie, risques psycho"}].map((r,i)=>
            <div key={i} style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <b style={{color:'#c6a34e'}}>{r.t}</b><div style={{marginTop:1}}>{r.d}</div>
            </div>
          )}
        </div>
        <div>
          {[{t:"Mesures d'urgence",d:"Plan d'√©vacuation, premiers secours"},{t:'EPI ‚Äî √âquipements protection',d:"Inventaire, renouvellement, formations"},{t:'Surveillance sant√©',d:"Planning examens m√©dicaux, postes √† risque"},{t:'√âvaluation N-1',d:"Bilan des actions r√©alis√©es l'ann√©e pr√©c√©dente"}].map((r,i)=>
            <div key={i} style={{padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <b style={{color:'#c6a34e'}}>{r.t}</b><div style={{marginTop:1}}>{r.d}</div>
            </div>
          )}
        </div>
      </div>
    </C>
  </div>;
}

function RisquesPsychoMod({s,d}){
  return <div>
    <PH title="Risques Psychosociaux" sub="Loi du 28/2/2014 ‚Äî Stress, harc√®lement, violence, burnout"/>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>Proc√©dure interne obligatoire</ST>
        {[{e:'Proc√©dure informelle',d:"Demande d'intervention aupr√®s de la personne de confiance ou du conseiller en pr√©vention psychosocial. Entretien, m√©diation, conciliation.",c:'#60a5fa'},
          {e:'Proc√©dure formelle',d:"Demande √©crite motiv√©e. Analyse par le conseiller en pr√©vention. Rapport avec propositions. L'employeur doit agir.",c:'#fb923c'},
          {e:'Proc√©dure externe',d:"Si proc√©dure interne √©chou√©e: Contr√¥le du bien-√™tre au travail (CBE) ou tribunal du travail.",c:'#f87171'},
        ].map((r,i)=><div key={i} style={{padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
          <div style={{fontWeight:600,color:r.c}}>{r.e}</div>
          <div style={{fontSize:10.5,color:'#9e9b93',marginTop:2}}>{r.d}</div>
        </div>)}
      </C>
      <div>
        <C><ST>Facteurs de risque (5A)</ST>
          {[{f:'Organisation du travail',ex:'Charge, horaires, autonomie'},{f:'Contenu du travail',ex:'Complexit√©, monotonie, responsabilit√©'},{f:'Conditions de travail',ex:'Contrat, r√©mun√©ration, √©valuation'},{f:'Conditions de vie au travail',ex:'Bruit, espace, √©quipement'},{f:'Relations interpersonnelles',ex:'Hi√©rarchie, coll√®gues, tiers'}].map((r,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
              <b style={{color:'#e8e6e0'}}>{r.f}</b><span style={{color:'#9e9b93',fontSize:10.5}}>{r.ex}</span>
            </div>
          )}
        </C>
        <C style={{marginTop:12}}><ST>Personnes de confiance</ST>
          <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
            <div>D√©signation: <b style={{color:'#e8e6e0'}}>Accord pr√©alable des travailleurs</b></div>
            <div>Formation: <b style={{color:'#e8e6e0'}}>Min. 5 jours + supervision annuelle</b></div>
            <div>R√¥le: <b style={{color:'#e8e6e0'}}>√âcoute, m√©diation, pas de pouvoir disciplinaire</b></div>
            <div>Protection: <b style={{color:'#e8e6e0'}}>Contre le licenciement</b></div>
          </div>
        </C>
      </div>
    </div>
  </div>;
}

function AlcoolMod({s,d}){
  return <div>
    <PH title="Politique Alcool & Drogues" sub="CCT n¬∞ 100 du 1/4/2009 ‚Äî Obligation pour tout employeur"/>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:18}}>
      <C><ST>4 phases obligatoires</ST>
        {[{p:"Phase 1 ‚Äî D√©claration d'intention",d:"L'employeur fixe les principes: pr√©vention, pas de tol√©rance z√©ro, approche sant√©.",c:'#4ade80'},
          {p:'Phase 2 ‚Äî Cadre r√®glementaire',d:"Int√©grer dans le r√®glement de travail. Proc√©dures en cas de dysfonctionnement.",c:'#60a5fa'},
          {p:'Phase 3 ‚Äî Information et formation',d:"Sensibiliser les travailleurs et la ligne hi√©rarchique.",c:'#a78bfa'},
          {p:'Phase 4 ‚Äî Tests (facultatif)',d:"Tests de d√©pistage possibles UNIQUEMENT si pr√©vus dans r√®glement et si fonctions de s√©curit√©.",c:'#fb923c'},
        ].map((r,i)=><div key={i} style={{padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
          <b style={{color:r.c}}>{r.p}</b>
          <div style={{fontSize:10.5,color:'#9e9b93',marginTop:2}}>{r.d}</div>
        </div>)}
      </C>
      <C><ST>Points cl√©s</ST>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          {[{l:"Base l√©gale",v:"CCT 100 (CNT) ‚Äî √©tendue par AR"},{l:"Champ",v:"Tous les employeurs du secteur priv√©"},{l:"Objectif",v:"Pr√©vention, pas r√©pression"},{l:"Tests",v:"Facultatifs ‚Äî uniquement fonctions s√©curit√©"},{l:"Sanctions",v:"Proportionn√©es, apr√®s entretien"},{l:"CPPT",v:"Doit √™tre consult√© sur la politique"},{l:"Confidentialit√©",v:"Donn√©es m√©dicales = strictement confidentielles"}].map((r,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'4px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <span>{r.l}</span><span style={{fontWeight:600,color:'#e8e6e0'}}>{r.v}</span>
            </div>
          )}
        </div>
      </C>
    </div>
  </div>;
}

function OrganesMod({s,d}){
  const n=(s.emps||[]).length;
  return <div>
    <PH title="Organes de Concertation Sociale" sub="CPPT, CE, DS ‚Äî Seuils et obligations"/>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:14}}>
      {[{o:"CPPT",full:"Comit√© pour la Pr√©vention et la Protection au Travail",seuil:50,freq:'Min. 1√ó/mois',comp:"Paritaire: employeur + repr√©sentants travailleurs",miss:"Bien-√™tre, s√©curit√©, sant√©, plan global, analyse risques",active:n>=50},
        {o:"CE",full:"Conseil d\'Entreprise",seuil:100,freq:'Min. 1√ó/mois',comp:"Chef d'entreprise + d√©l√©gu√©s √©lus",miss:"Info √©conomique/financi√®re, r√®glement travail, emploi",active:n>=100},
        {o:"DS",full:"D√©l√©gation Syndicale",seuil:0,freq:'Selon n√©cessit√©',comp:"D√©l√©gu√©s syndicaux d√©sign√©s",miss:"R√©clamations, n√©gociation conditions travail, CCT",active:true},
      ].map((r,i)=><C key={i}>
        <div style={{textAlign:'center',marginBottom:10}}>
          <div style={{fontSize:18,fontWeight:700,color:r.active?'#c6a34e':'#5e5c56'}}>{r.o}</div>
          <div style={{fontSize:10,color:'#5e5c56'}}>{r.full}</div>
          {r.seuil>0&&<div style={{fontSize:10,marginTop:4,padding:'2px 8px',borderRadius:4,display:'inline-block',background:n>=r.seuil?'rgba(74,222,128,.1)':'rgba(158,155,147,.1)',color:n>=r.seuil?'#4ade80':'#5e5c56'}}>Seuil: {r.seuil} trav. {n>=r.seuil?'‚úì Atteint':'‚úó Non atteint'}</div>}
        </div>
        <div style={{fontSize:11,color:'#9e9b93',lineHeight:1.8}}>
          <div>Fr√©quence: <b style={{color:'#e8e6e0'}}>{r.freq}</b></div>
          <div>Composition: <b style={{color:'#e8e6e0'}}>{r.comp}</b></div>
          <div>Missions: <b style={{color:'#e8e6e0'}}>{r.miss}</b></div>
        </div>
      </C>)}
    </div>
  </div>;
}
function SelfServiceMod({s,d}){
  const ae=s.emps||[];const [sel,setSel]=useState(ae[0]?.id||'');const [tab,setTab]=useState('fiches');
  const emp=ae.find(e=>e.id===sel)||ae[0]||{};
  const p=emp.id?calc(emp,DPER,s.co):{gross:0,net:0,tax:0};
  const tabs=[{v:"fiches",l:"Fiches de paie",ic:'üìÑ'},{v:"conges",l:"Cong√©s",ic:'üìÖ'},{v:"docs",l:"Documents",ic:'üìã'},{v:"perso",l:"Donn√©es perso",ic:'üë§'},{v:"contact",l:"Contact RH",ic:'üí¨'}];
  return <div>
    <PH title="Portail Self-Service Travailleur" sub="Acc√®s autonome ‚Äî Fiches, cong√©s, documents, donn√©es personnelles"/>
    <div style={{display:'grid',gridTemplateColumns:'260px 1fr',gap:18}}>
      <div>
        <C><ST>Travailleur</ST>
          <I label="Simulation pour" value={sel} onChange={setSel} options={ae.map(e=>({v:e.id,l:`${e.first||e.fn||'Emp'} ${e.last||''}`}))}/>
          <div style={{marginTop:14,textAlign:'center'}}>
            <div style={{width:50,height:50,borderRadius:'50%',background:"linear-gradient(135deg,#c6a34e,#a08030)",display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto',fontSize:18,fontWeight:700,color:'#fff'}}>{(emp.first||'?')[0]}{(emp.last||'?')[0]}</div>
            <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginTop:6}}>{emp.first} {emp.last}</div>
            <div style={{fontSize:10.5,color:'#5e5c56'}}>{emp.fn||''} ¬∑ {emp.statut||'employ√©'}</div>
          </div>
        </C>
        <C style={{marginTop:12,padding:0}}>
          {tabs.map(t=><div key={t.v} onClick={()=>setTab(t.v)} style={{padding:'10px 16px',cursor:'pointer',display:'flex',gap:8,alignItems:'center',
            background:tab===t.v?'rgba(198,163,78,.1)':'transparent',borderLeft:tab===t.v?'3px solid #c6a34e':'3px solid transparent',
            color:tab===t.v?'#c6a34e':'#9e9b93',fontSize:12,fontWeight:tab===t.v?600:400}}>
            <span>{t.ic}</span>{t.l}
          </div>)}
        </C>
        <C style={{marginTop:12,padding:'12px 16px',fontSize:10.5,color:'#60a5fa',background:"rgba(96,165,250,.03)",border:'1px solid rgba(96,165,250,.1)'}}>
          <b>R√©duction appels:</b> ~40% de contacts en moins gr√¢ce au self-service.
        </C>
      </div>
      
      <div>
        {tab==='fiches'&&<C>
          <ST>Fiches de paie</ST>
          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:10,marginBottom:14}}>
            {[{l:"Dernier brut",v:fmt(p.gross),c:'#e8e6e0'},{l:"Dernier net",v:fmt(p.net),c:'#4ade80'},{l:"PP retenu",v:fmt(p.tax),c:'#f87171'}].map((k,i)=>
              <div key={i} style={{padding:'12px',background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}>
                <div style={{fontSize:10,color:'#5e5c56'}}>{k.l}</div>
                <div style={{fontSize:18,fontWeight:700,color:k.c,marginTop:2}}>{k.v}</div>
              </div>
            )}
          </div>
          <div style={{fontSize:11,color:'#9e9b93'}}>
            {MN.slice(0,new Date().getMonth()+1).reverse().map((m,i)=>
              <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
                <span>{m} {new Date().getFullYear()}</span>
                <div style={{display:'flex',gap:12}}>
                  <span style={{color:'#4ade80',fontWeight:600}}>{fmt(p.net)}</span>
                  <span style={{color:'#60a5fa',cursor:'pointer',fontSize:10}}>üìÑ PDF</span>
                </div>
              </div>
            )}
          </div>
        </C>}
        
        {tab==='conges'&&<C>
          <ST>Solde cong√©s</ST>
          <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:14}}>
            {[{l:"L√©gaux",v:20,u:20,c:'#4ade80'},{l:"Extra-l√©gaux",v:2,u:5,c:'#60a5fa'},{l:"R√©cup√©ration",v:0,u:3,c:'#a78bfa'},{l:"Anciennet√©",v:1,u:1,c:'#c6a34e'}].map((k,i)=>
              <div key={i} style={{padding:'12px',background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:'center'}}>
                <div style={{fontSize:10,color:'#5e5c56'}}>{k.l}</div>
                <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:2}}>{k.v}</div>
                <div style={{fontSize:10,color:'#5e5c56'}}>sur {k.u} jours</div>
                <div style={{height:4,background:"rgba(255,255,255,.05)",borderRadius:2,marginTop:6}}>
                  <div style={{height:4,background:k.c,borderRadius:2,width:(k.v/k.u*100)+'%'}}/>
                </div>
              </div>
            )}
          </div>
          <div style={{padding:12,background:"rgba(96,165,250,.05)",borderRadius:8,fontSize:11,color:'#60a5fa'}}>
            Total restant: <b>23 jours</b> sur 29. Demande de cong√© via formulaire en ligne.
          </div>
        </C>}
        
        {tab==='docs'&&<C>
          <ST>Documents disponibles</ST>
          {[{t:'Fiches fiscales 281.10',y:'2025',ic:'üìä'},{t:'Attestation de travail',y:'2026',ic:'üìã'},{t:'Contrat de travail',y:'2024',ic:'üìÑ'},{t:'R√®glement de travail',y:'2026',ic:'üìï'},{t:'Attestation p√©cule vacances',y:'2025',ic:'üèñ'},{t:'Fiche accident travail',y:'‚Äî',ic:'üè•'}].map((doc,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'10px 0',borderBottom:'1px solid rgba(255,255,255,.03)'}}>
              <div style={{display:'flex',gap:8,alignItems:'center'}}>
                <span>{doc.ic}</span>
                <div><div style={{fontSize:12,color:'#e8e6e0'}}>{doc.t}</div><div style={{fontSize:10,color:'#5e5c56'}}>{doc.y}</div></div>
              </div>
              <span style={{fontSize:10,color:'#60a5fa',cursor:'pointer'}}>T√©l√©charger</span>
            </div>
          )}
        </C>}
        
        {tab==='perso'&&<C>
          <ST>Donn√©es personnelles</ST>
          {[{l:"Nom",v:`${emp.first} ${emp.last}`},{l:"NISS",v:emp.niss||'‚Äî'},{l:"Date naissance",v:emp.birth||'‚Äî'},{l:"Adresse",v:`${emp.addr||''} ${emp.zip||''} ${emp.city||''}`},{l:"IBAN",v:emp.iban||'‚Äî'},{l:"Email",v:emp.email||'‚Äî'},{l:"T√©l√©phone",v:emp.phone||'‚Äî'},{l:"Situation familiale",v:emp.civil||'‚Äî'},{l:"Personnes √† charge",v:emp.children||0}].map((f2,i)=>
            <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
              <span style={{color:'#9e9b93'}}>{f2.l}</span>
              <span style={{fontWeight:500,color:'#e8e6e0'}}>{f2.v}</span>
            </div>
          )}
          <div style={{marginTop:12,padding:8,background:"rgba(245,158,11,.06)",borderRadius:6,fontSize:10.5,color:'#f59e0b'}}>
            Modifications via demande au gestionnaire RH.
          </div>
        </C>}
        
        {tab==='contact'&&<C>
          <ST>Contact gestionnaire RH</ST>
          <div style={{padding:20,textAlign:'center'}}>
            <div style={{fontSize:40,marginBottom:10}}>üí¨</div>
            <div style={{fontSize:14,fontWeight:600,color:'#e8e6e0'}}>Aureus IA SPRL</div>
            <div style={{fontSize:12,color:'#9e9b93',marginTop:4}}>Votre secr√©tariat social</div>
            <div style={{marginTop:16,display:'grid',gap:8}}>
              <div style={{padding:10,background:"rgba(198,163,78,.05)",borderRadius:8,fontSize:12,color:'#9e9b93'}}>
                üìß <b style={{color:'#e8e6e0'}}>info@aureus-ia.com</b>
              </div>
              <div style={{padding:10,background:"rgba(198,163,78,.05)",borderRadius:8,fontSize:12,color:'#9e9b93'}}>
                üìû <b style={{color:'#e8e6e0'}}>+32 2 xxx xx xx</b>
              </div>
              <div style={{padding:10,background:"rgba(198,163,78,.05)",borderRadius:8,fontSize:12,color:'#9e9b93'}}>
                üìç <b style={{color:'#e8e6e0'}}>Saint-Gilles, 1060 Bruxelles</b>
              </div>
            </div>
          </div>
        </C>}
      </div>
    </div>
  </div>;
}


function GEDMod({s,d}){
  const ae=s.emps||[];const [tab,setTab]=useState('arbo');const [search,setSearch]=useState('');
  const cats=[{t:'Contrats',ic:'üìÑ',n:ae.length,docs:ae.map(e=>`Contrat_${e.last}_${e.first}.pdf`)},
    {t:'Certificats m√©dicaux',ic:'üè•',n:Math.floor(ae.length*0.3),docs:[]},
    {t:'Avenants',ic:'üìã',n:Math.floor(ae.length*0.2),docs:[]},
    {t:'Fiches de paie',ic:'üí∞',n:ae.length*12,docs:[]},
    {t:'Documents fiscaux',ic:'üìä',n:ae.length*2,docs:[]},
    {t:'Courriers',ic:'üì¨',n:Math.floor(ae.length*0.5),docs:[]},
    {t:'R√®glements',ic:'üìï',n:2,docs:['Reglement_travail.pdf',"CCT_interne.pdf"]},
    {t:'Juridique',ic:'‚öñ',n:Math.floor(ae.length*0.1),docs:[]}];
  const totDocs=cats.reduce((a,c)=>a+c.n,0);
  
  return <div>
    <PH title="GED ‚Äî Gestion √âlectronique des Documents" sub="Archivage par client et travailleur ‚Äî Conservation l√©gale"/>
    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginBottom:18}}>
      {[{l:"Documents total",v:totDocs,c:'#60a5fa'},{l:"Cat√©gories",v:cats.length,c:'#a78bfa'},{l:"Travailleurs",v:ae.length,c:'#c6a34e'},{l:"Stockage",v:Math.round(totDocs*0.2)+'MB',c:'#4ade80'}].map((k,i)=>
        <div key={i} style={{padding:'14px 16px',background:"rgba(198,163,78,.04)",borderRadius:10,border:'1px solid rgba(198,163,78,.08)'}}>
          <div style={{fontSize:10,color:'#5e5c56',textTransform:'uppercase',letterSpacing:'.5px'}}>{k.l}</div>
          <div style={{fontSize:22,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div>
        </div>
      )}
    </div>
    <div style={{display:'flex',gap:6,marginBottom:16}}>
      {[{v:"arbo",l:"Arborescence"},{v:"retention",l:"Conservation l√©gale"},{v:"search",l:"Recherche"}].map(t=>
        <button key={t.v} onClick={()=>setTab(t.v)} style={{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:'inherit',
          background:tab===t.v?'rgba(198,163,78,.15)':'rgba(255,255,255,.03)',color:tab===t.v?'#c6a34e':'#9e9b93'}}>{t.l}</button>
      )}
    </div>
    {tab==='arbo'&&<div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12}}>
      {cats.map((c,ci)=><C key={ci} style={{padding:'16px',textAlign:'center',cursor:'pointer'}}>
        <div style={{fontSize:28}}>{c.ic}</div>
        <div style={{fontSize:13,fontWeight:600,color:'#e8e6e0',marginTop:6}}>{c.t}</div>
        <div style={{fontSize:22,fontWeight:700,color:'#c6a34e',marginTop:4}}>{c.n}</div>
        <div style={{fontSize:10,color:'#5e5c56'}}>documents</div>
      </C>)}
    </div>}
    {tab==='retention'&&<C><ST>Dur√©es de conservation l√©gales</ST>
      {[{t:'Contrats de travail',d:"5 ans apr√®s fin",b:'Art. 15 Loi 3/7/1978'},{t:'Fiches de paie',d:"5 ans",b:'Art. 58 AR 8/8/1980'},{t:'Compte individuel',d:"5 ans",b:'AR 8/8/1980'},{t:'Documents ONSS',d:"7 ans",b:'Loi ONSS'},{t:'Documents fiscaux (281.xx)',d:"7 ans",b:'CIR Art. 315'},{t:'Registre du personnel',d:"5 ans apr√®s derni√®re mention",b:'AR 9/12/1992'},{t:'Certificats m√©dicaux',d:"5 ans",b:'Code bien-√™tre'},{t:'Accidents du travail',d:"10 ans",b:'Loi 10/4/1971'},{t:'RGPD ‚Äî Donn√©es personnelles',d:"Dur√©e n√©cessaire + suppression",b:'RGPD Art. 5'}].map((r,i)=>
        <div key={i} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,.03)',fontSize:12}}>
          <div><b style={{color:'#e8e6e0'}}>{r.t}</b><div style={{fontSize:10,color:'#5e5c56'}}>{r.b}</div></div>
          <span style={{fontWeight:600,color:'#c6a34e',whiteSpace:'nowrap'}}>{r.d}</span>
        </div>
      )}
    </C>}
    {tab==='search'&&<C>
      <ST>Recherche documents</ST>
      <I label="Rechercher (nom, NISS, type, date)" value={search} onChange={setSearch}/>
      <div style={{marginTop:14,padding:20,textAlign:'center',color:'#5e5c56',fontSize:12}}>
        {search?`Recherche de "${search}" dans ${totDocs} documents...`:'Tapez un terme de recherche'}
      </div>
    </C>}
  </div>;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AGENT IA JURIDIQUE ‚Äî BOUTON FLOTTANT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const LEGAL_KB=`
# AGENT IA JURIDIQUE ‚Äî DROIT SOCIAL BELGE (EXPERT)
# Version: Aureus Social Pro v28 ‚Äî Base de connaissances exhaustive

Tu es l'Agent IA Juridique d'Aureus Social Pro, le logiciel de paie et de secretariat social d'Aureus IA SPRL (BE 1028.230.781), fiduciaire sociale basee a Bruxelles.
Tu es un EXPERT de classe mondiale en droit social belge, droit du travail, securite sociale, fiscalite salariale et droit des affaires belge.

## REGLES ABSOLUES
1. Reponds TOUJOURS avec precision juridique. Cite TOUJOURS la base legale (loi, arrete royal, CCT, article).
2. Structure tes reponses avec des titres clairs, des listes et des exemples chiffres.
3. Si un sujet est complexe ou litigieux, recommande de consulter un juriste specialise.
4. Adapte la langue (FR/NL/EN) selon la question posee.
5. Donne des exemples concrets et chiffres quand possible.
6. Mentionne les sanctions en cas de non-respect.
7. Precise les delais legaux quand applicables.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 1. CONTRATS DE TRAVAIL
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Base legale: Loi du 3 juillet 1978 relative aux contrats de travail

### Types de contrats:
- CDI (Contrat a Duree Indeterminee): Forme libre (ecrit non obligatoire mais fortement recommande). Constitue la presomption legale.
- CDD (Contrat a Duree Determinee): ECRIT OBLIGATOIRE avant le debut des prestations, sinon requalifie en CDI (art. 9). Max 4 CDD successifs de min 3 mois chacun, duree totale max 2 ans (sauf exception AR). Ou max 6 CDD de min 6 mois, max 3 ans avec autorisation Controle Lois Sociales.
- Travail clairement defini: Ecrit obligatoire. Fin a l'achevement du travail.
- Remplacement: Ecrit obligatoire. Duree max 2 ans.
- Temps partiel: Ecrit obligatoire AVANT debut. Mention du regime (nb heures/sem) et horaire. Min 1/3 temps plein OU 3h consecutives min par prestation. Derogation via RT.
- Etudiant: Ecrit obligatoire. Convention d'occupation etudiant (COE). Max 650h/an a cotisations reduites (2,71% etudiant + 5,43% employeur). Dimona STU. 3 jours d'essai obligatoires.
- Flexi-job: Contrat-cadre + contrat de travail flexi-job. 4/5 temps min chez autre employeur (T-3). Cotis patronale 28%. Pas d'ONSS travailleur, pas de precompte. Min 12,05 EUR/h (2026). Secteurs autorises: horeca, commerce, etc.
- Interim: Loi 24/7/1987. Contrat via agence interim. Motifs: remplacement, surcroit temporaire, travail exceptionnel. Max 2 ans pour meme poste.

### Clauses essentielles:
- Clause d'essai: SUPPRIMEE depuis 01/01/2014. Exception: etudiants (3 jours), interim (3 jours).
- Clause de non-concurrence: Remuneration annuelle > 39.422 EUR (2026). Indemnite = min 50% du salaire brut correspondant a la duree de la clause (max 12 mois). Non applicable si licenciement par employeur sans motif grave ou si preavis non preste.
- Clause d'ecolage: Formation > 80h ou valeur > seuil. Remuneration > 41.969 EUR (2026). Duree max 3 ans. Remboursement degressif: 100% annee 1, 66% annee 2, 33% annee 3.
- Clause d'exclusivite: Valide si proportionnee. Art. 17bis loi 3/7/1978.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 2. PREAVIS ET LICENCIEMENT
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Base legale: Loi du 26 decembre 2013 (Loi Peeters ‚Äî Statut unique)

### Delais de preavis (depuis 01/01/2014 ‚Äî regime unifie ouvriers/employes):
Par l'employeur / Par le travailleur:
0-3 mois: 1 sem / 1 sem
3-6 mois: 3 sem / 2 sem
6-9 mois: 4 sem / 2 sem
9-12 mois: 5 sem / 2 sem
12-15 mois: 6 sem / 3 sem
15-18 mois: 7 sem / 3 sem
18-21 mois: 8 sem / 3 sem
21-24 mois: 9 sem / 3 sem
2-3 ans: 12 sem / 4 sem
3-4 ans: 13 sem / 5 sem
4-5 ans: 15 sem / 6 sem
5-6 ans: 18 sem / 7 sem
6-7 ans: 21 sem / 9 sem
7-8 ans: 24 sem / 10 sem
8-9 ans: 27 sem / 12 sem
9-10 ans: 30 sem / 13 sem
10-11 ans: 33 sem / 13 sem
11-12 ans: 36 sem / 13 sem
12-13 ans: 39 sem / 13 sem
13+ ans: +3 sem/an / 13 sem MAX

### Regles transitoires (anciennete avant 01/01/2014):
Double calcul pour employes > 32.254 EUR (seuil 2013):
- Etape 1: Preavis selon anciennes regles (1 mois/annee commencee, min 3 mois)
- Etape 2: Preavis selon nouvelles regles a partir du 01/01/2014
- Total = Etape 1 + Etape 2

### Motif grave (art. 35 Loi 3/7/1978):
- Rupture immediate sans preavis ni indemnite.
- Delai: 3 JOURS OUVRABLES apres connaissance des faits pour notifier.
- Motivation ecrite envoyee dans les 3 jours ouvrables suivant la notification.
- Charge de la preuve: employeur.
- Exemples: vol, violence, insubordination grave, concurrence deloyale.

### Motivation du licenciement (CCT 109 du CNT):
- Depuis 01/04/2014: motivation obligatoire a la demande du travailleur.
- Licenciement manifestement deraisonnable = indemnite de 3 a 17 semaines de remuneration.
- Critere: employeur normal et raisonnable n'aurait pas licencie.
- Exclusions: 6 premiers mois, interim, etudiant, pension, RCC.

### Indemnite de rupture:
- = Remuneration brute x duree du preavis non preste.
- Inclut: salaire de base, avantages (cheques-repas, voiture, assurance groupe...).
- Soumise a ONSS + precompte professionnel.

### Outplacement obligatoire:
- Travailleurs >= 45 ans licencies (sauf motif grave): 60h sur 12 mois.
- Valeur min: 1.800 EUR.
- Offre dans les 15 jours suivant la fin du preavis.
- Sanction: 4 semaines de remuneration si pas d'offre.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 3. ONSS ‚Äî SECURITE SOCIALE
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Base legale: Loi du 27 juin 1969 (securite sociale des travailleurs salaries)

### Cotisations:
- Travailleur: 13,07% du brut (ouvriers: brut x 108%).
- Patronal marchand (Cat. 1): ~25% (inclut: pension 8,86%, maladie 3,80%, chomage 1,46%, AT 0,02%, alloc fam 7,00%, vacances annuelles 0%, fermeture 0,23%, etc.)
- Patronal non-marchand (Cat. 2): ~32,40%.
- Moderation salariale: +5,67% sur cotis patronales.
- Cotisation speciale securite sociale: progressive selon revenu menage (max 60,94 EUR/mois pour hauts revenus).

### Reduction premier engagement (2026):
Depuis 01/04/2016, reformee au 01/04/2026:
- 1er travailleur: max 2.000 EUR/trim (au lieu de 4.000) ‚Äî DUREE ILLIMITEE.
- 2eme: 1.500 EUR/trim pendant 13 trim.
- 3eme: 1.500 EUR/trim pendant 13 trim.
- 4eme a 6eme: 1.000 EUR/trim pendant 9 trim.
Base de calcul: cotisations patronales de base (sans moderation salariale).

### Dimona (Declaration Immediate / Onmiddellijke Aangifte):
- Obligatoire AVANT le debut des prestations.
- Types: IN, OUT, UPDATE, STU (etudiant), FLX (flexi), EXT (extra horeca).
- Canal: batch ou portail securite sociale (www.socialsecurity.be).
- Sanction: 2.500 a 12.500 EUR par infraction.

### DmfA (Declaration Multifonctionnelle / Multifunctionele Aangifte):
- Trimestrielle: T1 -> 30/04, T2 -> 31/07, T3 -> 31/10, T4 -> 31/01 N+1.
- Contenu: donnees employeur, travailleurs, remunerations, prestations.
- Format XML via batch ou portail.
- Provisions mensuelles: le 5 du mois suivant.

### DRS (Declarations Risques Sociaux):
- Chomage: scenarios 1 (complet), 2 (temporaire), 3 (RCC), 5 (mensuel CT), 6 (CT eco).
- INAMI: incapacite, maternite, paternite, adoption.
- Pension: carriere, droits.
- Delai: 5 jours ouvrables.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 4. PRECOMPTE PROFESSIONNEL
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Base legale: AR fixant les regles d'application du precompte professionnel (annuel)

### Methode: Formule-cle SPF Finances 2026 (exercice d'imposition 2027).
- Base: remuneration brute - ONSS 13,07% = imposable.
- Bareme progressif:
  0 ‚Äî 10.580 EUR: 25%
  10.580 ‚Äî 15.200 EUR: 40%
  15.200 ‚Äî 26.830 EUR: 45%
  26.830+: 50%
- Quotite exemptee d'impot 2026: 10.570 EUR (isolee).
- Reductions: enfants a charge (+1.870/enfant), isolee avec enfants (+1.870), handicap (+1.870), conjoint a charge (+3.740).

### Scales:
- Scale I: isole ou menage a 2 revenus.
- Scale II: conjoint a charge (1 revenu).
- Scale III: pensionnes.

### Bonus a l'emploi:
- Volet social: reduction ONSS pour bas salaires (brut < ~2.800 EUR/mois).
- Volet fiscal: reduction PP correspondante.
- Montant max 2026: ~230 EUR/mois (social) + ~96 EUR/mois (fiscal).

### Dispenses PP employeur (formulaires 274):
- 274.31: Travail de nuit et en equipes (22,8%).
- 274.32: Heures supplementaires (41,25% ou 32,19%).
- 274.33: Recherche scientifique (80%).
- 274.75: Zone d'aide (25%).
- Starters PME: 10% (micro) ou 20% (petite).
ATTENTION: la dispense se calcule sur le PP retenu, PAS sur le salaire brut.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 5. REMUNERATION
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Salaire minimum (RMMMG 2026):
- 18 ans+: 2.029,88 EUR/mois.
- 19 ans + 6 mois anciennete: 2.080,63 EUR/mois.
- 20 ans + 12 mois anciennete: 2.131,38 EUR/mois.

### Pecule de vacances:
EMPLOYES (paye par l'employeur):
- Simple: salaire normal du mois de vacances.
- Double: 92% du salaire mensuel brut.
- 20 jours de conge/an (regime 5j/sem).

OUVRIERS (paye par l'ONVA/Caisse sectorielle):
- 15,38% de la remuneration brute a 108%.
- Cotisation patronale: 10,27% trimestrielle a l'ONSS.

### Prime de fin d'annee (13eme mois):
- PAS une obligation legale generale.
- Depend de la CP: CCT sectorielle, usage, contrat individuel.
- CP 200: environ 1 mois de salaire brut.
- CP 124 (construction): via la Caisse de construction.

### Indexation:
- Mecanisme: indice sante lisse (hors tabac, alcool, carburant).
- Pivot: declenchement quand indice depasse le pivot.
- Taux: 2% a chaque depassement.
- Moment: varie selon CP (mensuel ou fixe en janvier).
- CP 200: indexation en janvier.

### ATN (Avantages de Toute Nature):
- Voiture de societe: ((CO2 x coefficient) x prix catalogue x 6/7 x vetuste) / 12. Min: 1.600 EUR/an.
- Coefficient CO2 2026: essence 5,5% + (CO2-91)x0,1% / diesel 5,5% + (CO2-91)x0,1%.
- GSM: 3 EUR/mois (appels) + 5 EUR/mois (internet).
- Logement: RC x coefficient x 100/60 x 2.
- Velo de societe: exonere depuis 01/01/2024.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 6. TEMPS DE TRAVAIL
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Base legale: Loi du 16 mars 1971 sur le travail

### Duree:
- Max legal: 38h/semaine (effectif ou en moyenne).
- Max journalier: 8h (derogations possibles via CCT).
- Max absolu: 11h/jour, 50h/semaine.
- Heures supplementaires: sursalaire +50% (jours ouvrables), +100% (dimanche/ferie).
- Recuperation obligatoire dans la periode de reference.

### Travail de nuit:
- Definition: prestations entre 20h et 6h (au moins 1h dans cette plage).
- Interdit sauf exceptions legales (horeca, sante, industrie continue, e-commerce depuis 2018).
- Sursalaire selon CCT sectorielle.

### Petit chomage (Conge de circonstances):
- AR du 28/08/1963. Mariage: 2 jours. Deces conjoint/enfant: 3 jours. Demenagement: 1 jour.
- Payee par l'employeur a 100%.

### Credit-temps (CCT 103 du CNT):
- Sans motif: droit flexible selon anciennete et CP.
- Avec motif: soins enfant < 8 ans, soins palliatifs, formation.
- Allocation ONEM: si avec motif valable.
- Formes: temps plein, mi-temps, 1/5.

### Conge parental:
- 4 mois par enfant (< 12 ans). Temps plein, mi-temps ou 1/5.
- Allocation ONEM forfaitaire.
- Protection contre licenciement: debut demande jusqu'a 3 mois apres reprise.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 7. BIEN-ETRE AU TRAVAIL
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Base legale: Loi du 4 aout 1996 relative au bien-etre des travailleurs

### 7 domaines:
1. Securite du travail
2. Protection de la sante
3. Risques psychosociaux (stress, harcelement, violence, burnout)
4. Ergonomie
5. Hygiene du travail
6. Embellissement des lieux de travail
7. Environnement (impact sur 1-6)

### Obligations:
- Plan Global de Prevention: 5 ans. Analyse des risques, mesures, objectifs.
- PAA (Plan Annuel d'Action): concretisation annuelle du PGP.
- Conseiller en prevention: employeur si < 20 travailleurs, interne si >= 20.
- SIPPT obligatoire si >= 20 travailleurs.
- SEPPT (Service Externe) obligatoire pour tous.
- CPPT (Comite PPT) si >= 50 travailleurs.

### Risques psychosociaux (Loi 28/02/2014):
- Definition: stress, harcelement moral/sexuel, violence au travail, burnout.
- 3 procedures: informelle (personne de confiance), formelle (conseiller prevention), externe (tribunal).
- 5 facteurs de risque (5A): organisation travail, contenu, conditions, conditions de vie, relations.
- Personne de confiance: formation 5 jours + supervision annuelle.

### Politique alcool/drogues (CCT 100 du 01/04/2009):
- 4 phases obligatoires: 1) declaration intention, 2) reglement travail, 3) info/formation, 4) tests (facultatif).
- Tests: uniquement fonctions a risque securite.
- CPPT consulte obligatoirement.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 8. CHOMAGE TEMPORAIRE
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Base legale: AR du 25/11/1991 + Loi 3/7/1978 art. 49-51

### Types:
- Economique employes: CCT ou plan d'entreprise. Max 16 sem/an (complet) ou 26 sem (partiel).
- Economique ouvriers: notification ONEM + bureau chomage. Pas de max legal (mais controle).
- Force majeure: evenement imprevisible et irresistible. Notification ONEM immediate.
- Intemperies: secteur construction principalement (CP 124).
- Technique: panne machine, manque matiere premiere.

### Complement employeur:
- Ouvriers: min 2 EUR/jour de chomage temporaire.
- Employes CT eco: supplement fixe par CCT/plan.

### Allocation ONEM:
- 65% de la remuneration plafonnee (plafond A: 3.199,26 EUR/mois 2026).
- Precompte: 26,75%.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 9. RCC (REGIME DE CHOMAGE AVEC COMPLEMENT D'ENTREPRISE)
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Base legale: CCT 17 + AR 03/05/2007 + lois-programmes successives

### Conditions generales 2026:
- Age: min 62 ans (regime general).
- Anciennete: 40 ans (H) / 38 ans (F) avec convergence progressive.
- Regimes speciaux: travail de nuit/equipes, construction, metiers lourds (a partir de 60 ans).

### DECAVA (cotisation speciale):
- Patronale par tranche d'age: < 52: 10%, 52-54: 8,33%, 55-57: 5,83%, 58-59: 4,17%, >= 60: 3,25%.
- Travailleur: supprimee depuis 2023.
- Duree: jusqu'a la pension legale (66 ans en 2025-2030, 67 ans des 2030).

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 10. AIDES A L'EMPLOI
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Federales:
- Reduction premiers engagements (voir section ONSS).
- Reduction restructuration.
- SINE (economie sociale d'insertion).
- Convention Premier Emploi (CPE/Rosetta): < 26 ans.

### Bruxelles (Actiris):
- Activa.brussels: DE >= 12 mois. 15.900 EUR sur 30 mois.
- Stage First: < 30 ans, diplome recen. 200 EUR/mois stage.
- Prime de transition: licencie en restructuration.

### Wallonie (FOREM):
- Impulsion < 25 ans: max 750 EUR/mois x 36 mois.
- Impulsion 25-54 ans longue duree: max 750 EUR/mois x 24 mois.
- Impulsion 55+: max 1.000 EUR/mois x 36 mois.
- SESAM: PME <= 50 trav., 2.500 EUR/trim x 12 trim.
- APE: non-marchand, points APE = subvention salariale.

### Flandre (VDAB):
- Depuis 01/01/2023: RSZ-doelgroepvermindering.
- Jeunes < 25 ans: max 1.000 EUR/trim x 8 trim.
- 55+: max 1.150 EUR/trim.

### Dispenses PP:
- Travail de nuit/equipes: 22,8% (274.31).
- Heures sup: 41,25% ou 32,19% (274.32).
- Recherche scientifique: 80% (274.33).
- Zone d'aide: 25% (274.75).
- Starters PME: 10% ou 20%.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 11. COMMISSIONS PARITAIRES PRINCIPALES
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

CP 100: Auxiliaire ouvriers | CP 111: Metal/mecanique | CP 112: Garage/auto
CP 116: Chimie | CP 118: Alimentaire ouvriers | CP 119: Commerce alim.
CP 121: Nettoyage | CP 124: Construction | CP 140: Transport
CP 144: Agriculture | CP 145: Horticulture | CP 149: Electriciens
CP 200: CPNAE (la plus grande, ~450.000 travailleurs)
CP 201: Commerce detail | CP 202: Commerce alim. employes
CP 216: Notariat | CP 218: Alim. employes | CP 302: Horeca
CP 306: Assurances | CP 310: Banques | CP 314: Coiffure
CP 317: Gardiennage | CP 322: Interim | CP 330: Sante
CP 332: Aide sociale FR | CP 336: Professions liberales

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 12. ELECTIONS SOCIALES
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Seuils:
- CPPT: >= 50 travailleurs.
- CE (Conseil d'Entreprise): >= 100 travailleurs.
- Elections tous les 4 ans (prochaines: 2028).

### Calendrier: X-60 a X+2 (X = jour du vote).
### Protection des candidats: 4 ans contre licenciement (sauf motif grave + tribunal du travail).

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 13. SAISIES ET CESSIONS
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Base legale: Code judiciaire art. 1409-1412

### Quotites insaisissables 2026:
0 ‚Äî 1.310 EUR: 100% protege (insaisissable)
1.310 ‚Äî 1.408 EUR: 20% saisissable
1.408 ‚Äî 1.554 EUR: 30% saisissable
1.554 ‚Äî 1.700 EUR: 40% saisissable
> 1.700 EUR: 100% saisissable
Majoration: +79 EUR par enfant a charge.

### Types:
- Saisie-arret execution: titre executoire (jugement). Huissier.
- Cession de remuneration: convention volontaire. Max = quotite cessible.
- Delegation de sommes: ordonnance du tribunal. Pension alimentaire.
- Reglement collectif de dettes: admissibilite tribunal travail.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 14. JOURS FERIES 2026
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1/1 (Nouvel An), 6/4 (Paques), 7/4 (Lundi Paques), 1/5 (Fete travail),
14/5 (Ascension), 25/5 (Pentecote), 21/7 (Fete nationale),
15/8 (Assomption), 1/11 (Toussaint), 11/11 (Armistice), 25/12 (Noel).
Si ferie tombe un dimanche/jour habituel de repos: remplacement obligatoire.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 15. RGPD ET DONNEES SOCIALES
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Bases legales traitement donnees RH:
- Execution contrat (art. 6.1.b RGPD).
- Obligation legale (art. 6.1.c): ONSS, fiscal, Dimona.
- Interet legitime (art. 6.1.f): gestion interne, securite.
- Consentement (art. 6.1.a): photo, usage marketing.

### Conservation:
- Contrats: 5 ans apres fin.
- Fiches de paie: 5 ans.
- Documents ONSS: 7 ans.
- Documents fiscaux: 7 ans.
- Accidents du travail: 10 ans.
- RGPD: duree necessaire au traitement.

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 16. CALCUL DU COUT EMPLOYEUR COMPLET
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Brut mensuel
+ ONSS patronal ~25% (marchand)
+ Moderation salariale 5,67% sur patronal
+ Pecule vacances patronal (ouvriers: 10,27% via ONSS)
+ Prime de fin d'annee (selon CP)
+ Assurance accident travail (~1-3% selon secteur)
+ Fonds de securite d'existence (selon CP)
+ Cheques-repas part patronale
+ Assurance groupe / pension complementaire
+ Frais de secretariat social
= COUT EMPLOYEUR TOTAL (generalement 135-165% du brut)

## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
## 17. FORMULES DE CALCUL
## ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

### Net = Brut - ONSS 13,07% - Precompte Pro - CSS + Bonus emploi
### Imposable = Brut - ONSS 13,07%
### ONSS ouvrier = Brut x 108% x 13,07%
### ATN voiture = (CO2% x Prix catalogue x 6/7 x Vetuste%) / 12
### Bradford Factor = S x S x D (S = nb absences, D = jours totaux)

`;

const AGENT_SYS_FR=LEGAL_KB+`\nR√©ponds en FRAN√áAIS. Sois pr√©cis, professionnel, cite tes sources l√©gales.

Tu es aussi un AGENT D'EX√âCUTION. Quand l'utilisateur te demande de FAIRE une action (cr√©er, modifier, supprimer, calculer), tu dois r√©pondre avec un bloc JSON d'action encadr√© par |||ACTION||| et |||END|||.

Actions disponibles:
- CREATE_CLIENT: cr√©er un dossier client
- CREATE_WORKER: cr√©er un travailleur
- UPDATE_WORKER: modifier un travailleur (salaire, fonction, etc.)
- DELETE_WORKER: mettre un travailleur en sortie
- CALC_PAY: calculer une fiche de paie
- CALC_COST: calculer le co√ªt employeur

Exemple - l'utilisateur dit "Cr√©e un dossier Boulangerie Dupont TVA BE0123456789 CP 118":
Tu r√©ponds:
‚úÖ Je cr√©e le dossier Boulangerie Dupont.
|||ACTION|||
{"action":"CREATE_CLIENT","data":{"name":"Boulangerie Dupont","vat":"BE0123456789","cp":"118","forme":"SRL"}}
|||END|||

Exemple - "Ajoute Jean Dupont CDI 2800‚Ç¨ brut boulanger":
‚úÖ J'ajoute Jean Dupont comme boulanger en CDI √† 2.800‚Ç¨ brut.
|||ACTION|||
{"action":"CREATE_WORKER","data":{"nom":"Dupont","prenom":"Jean","contrat":"cdi","salaireBrut":2800,"fonction":"Boulanger","statut":"employe"}}
|||END|||

Exemple - "Augmente le salaire de Jean de 200‚Ç¨":
‚úÖ J'augmente le salaire de Jean Dupont de 200‚Ç¨.
|||ACTION|||
{"action":"UPDATE_WORKER","data":{"search":"Jean","field":"salaireBrut","operation":"add","value":200}}
|||END|||

Exemple - "Combien me co√ªte un employ√© √† 3500‚Ç¨ brut?":
R√©ponds normalement avec le calcul d√©taill√©, PAS d'action.

Si l'utilisateur pose une question juridique, r√©ponds normalement SANS action.
Si l'utilisateur demande une action, confirme ce que tu fais + le bloc ACTION.`;
const AGENT_SYS_NL=LEGAL_KB+`\nAntwoord in het NEDERLANDS. Wees nauwkeurig, uitgebreid en professioneel. Structureer je antwoord met titels. Vermeld ALTIJD de wettelijke basis (wet, artikel, CAO, KB). Geef cijfermatige voorbeelden. Vermeld sancties en termijnen.`;
const AGENT_SYS_EN=LEGAL_KB+`\nRespond in ENGLISH. Be precise, exhaustive and professional. Structure your answer with headings. ALWAYS cite legal basis (law, article, CBA, Royal Decree). Give numerical examples. Mention penalties and deadlines.`;

const AGENT_QUICK={
  fr:[
    {i:'üè¢',l:"Cr√©er un dossier",p:'Cr√©e un dossier pour '},
    {i:'üë§',l:"Ajouter travailleur",p:'Ajoute un travailleur '},
    {i:'üí∞',l:"Simulation salaire",p:'Calcule le salaire net pour un brut de '},
    {i:'üìä',l:"Co√ªt employeur",p:"Combien me co√ªte un employ√© √† "},
    {i:'‚è±Ô∏è',l:"Calcul pr√©avis",p:'Calcule le pr√©avis pour une anciennet√© de '},
    {i:'üìã',l:"Info CP",p:'Quelles sont les r√®gles de la CP '},
    {i:'üìÑ',l:"Proc√©dure C4",p:'Comment √©tablir un C4 correctement?'},
    {i:'üí∂',l:"Calculer la paie",p:'Calcule la paie de f√©vrier pour '},
  ],
  nl:[
    {i:'üè¢',l:"Dossier aanmaken",p:'Maak een dossier aan voor '},
    {i:'üë§',l:"Werknemer toevoegen",p:'Voeg een werknemer toe '},
    {i:'üí∞',l:"Loonsimulatie",p:'Bereken het nettoloon voor een bruto van '},
    {i:'üìä',l:"Werkgeverskost",p:'Hoeveel kost een werknemer aan '},
    {i:'‚è±Ô∏è',l:"Opzeg berekenen",p:'Bereken de opzegtermijn voor een anci√´nniteit van '},
    {i:'üìã',l:"Info PC",p:'Wat zijn de regels van PC '},
  ],
  en:[
    {i:'üè¢',l:"Create company",p:'Create a file for '},
    {i:'üë§',l:"Add worker",p:'Add a worker '},
    {i:'üí∞',l:"Salary sim",p:'Calculate net salary for gross of '},
    {i:'üìä',l:"Employer cost",p:'How much does an employee cost at '},
    {i:'‚è±Ô∏è',l:"Notice period",p:'Calculate notice period for '},
    {i:'üìã',l:"JC info",p:'What are the rules of Joint Committee '},
  ],
};

function detectAgentLang(t){
  const nl=/\b(de|het|een|van|voor|met|werknemer|loon|opzeg|contract|paritair|verlof|ontslag)\b/gi;
  const fr=/\b(le|la|les|des|une|pour|avec|salaire|pr√©avis|contrat|commission|cong√©|licenciement|travailleur)\b/gi;
  const nc=(t.match(nl)||[]).length, fc=(t.match(fr)||[]).length;
  if(nc>fc+2)return'nl';if(fc>nc+2)return'fr';
  if(/[√†√¢√©√®√™√´√Ø√Æ√¥√π√ª√º√ß]/.test(t))return'fr';
  if(/\b(the|is|are|employee|salary|notice|contract)\b/i.test(t))return'en';
  return'fr';
}

function FloatingLegalAgent({onAction}){
  const[open,setOpen]=useState(false);
  const[msgs,setMsgs]=useState([]);
  const[inp,setInp]=useState('');
  const[loading,setLoading]=useState(false);
  const[lang,setLang]=useState('fr');
  const[unread,setUnread]=useState(0);
  const[actionLog,setActionLog]=useState([]);
  const endRef=useRef(null);
  const inpRef=useRef(null);

  useEffect(()=>{endRef.current?.scrollIntoView({behavior:'smooth'});},[msgs,loading]);
  useEffect(()=>{if(open){setUnread(0);setTimeout(()=>inpRef.current?.focus(),100);}},[open]);

  const getSys=(l)=>l==='nl'?AGENT_SYS_NL:l==='en'?AGENT_SYS_EN:AGENT_SYS_FR;
  const quick=AGENT_QUICK[lang]||AGENT_QUICK.fr;

  // Parse and execute actions from AI response
  const parseAndExecute=(text)=>{
    const actionMatch=text.match(/\|\|\|ACTION\|\|\|([\s\S]*?)\|\|\|END\|\|\|/);
    if(actionMatch){
      try{
        const actionData=JSON.parse(actionMatch[1].trim());
        if(onAction){
          onAction(actionData);
          setActionLog(prev=>[...prev,{time:new Date().toISOString(),action:actionData.action,data:actionData.data}]);
        }
        // Return text without the action block
        return text.replace(/\|\|\|ACTION\|\|\|[\s\S]*?\|\|\|END\|\|\|/,'').trim();
      }catch(e){console.warn('Action parse error:',e);}
    }
    return text;
  };

  // Log to audit_log in Supabase
  const logAudit=async(action,details)=>{
    try{
      const{supabase}=await import('./lib/supabase');
      if(!supabase)return;
      await supabase.from('audit_log').insert({action,table_name:'agent_ia',details:{...details,timestamp:new Date().toISOString()}});
    }catch(e){}
  };

  // ‚îÄ‚îÄ LOCAL KB SEARCH (no API needed) ‚îÄ‚îÄ
  const localKB=[
    {q:['pr√©avis','preavis','opzeg','notice','licenciement','ontslag','rupture'],a:{fr:'**Pr√©avis ‚Äî Loi du 26/12/2013 (Statut unique)**\n\nPar l\'employeur:\n‚Ä¢ 0-3 mois: 1 sem\n‚Ä¢ 3-6 mois: 3 sem\n‚Ä¢ 6-12 mois: 4-5 sem\n‚Ä¢ 1-2 ans: 6-9 sem\n‚Ä¢ 2-3 ans: 12 sem\n‚Ä¢ 3-5 ans: 13-15 sem\n‚Ä¢ 5-8 ans: 18-24 sem\n‚Ä¢ 8-10 ans: 27-30 sem\n‚Ä¢ 10-15 ans: 33-42 sem\n‚Ä¢ 15-20 ans: 45-57 sem\n‚Ä¢ 20-25 ans: 62-72 sem\n\nPar le travailleur: environ la moiti√©.\n\n**Indemnit√© de rupture** = r√©mun√©ration √ó dur√©e du pr√©avis non prest√©.\n**Motif grave (art. 35):** Pas de pr√©avis, notification dans les 3 jours ouvrables + lettre recommand√©e 3j.\n**Outplacement**: Obligatoire si pr√©avis ‚â• 30 semaines (60h, valeur min 1.800‚Ç¨).\n\nüìã Loi 26/12/2013, art. 37/2 √† 37/11'}},
    {q:['dimona','d√©claration imm√©diate','aangifte','embauche'],a:{fr:'**Dimona ‚Äî D√©claration Imm√©diate de l\'Emploi**\n\n‚Ä¢ **Dimona IN**: AVANT le premier jour de travail\n‚Ä¢ **Dimona OUT**: Le dernier jour de travail\n‚Ä¢ **Dimona UPDATE**: Modification en cours de contrat\n‚Ä¢ **Dimona STU**: Sp√©cifique √©tudiants\n‚Ä¢ **Dimona FLX**: Sp√©cifique flexi-jobs\n\n**Donn√©es obligatoires:** NISS, matricule ONSS, dates, type travailleur, CP.\n\n**Sanction**: 400‚Ç¨ √† 4.000‚Ç¨ par travailleur non d√©clar√©.\n**Sanction p√©nale**: 600‚Ç¨ √† 6.000‚Ç¨ (r√©cidive).\n\nüìã AR 5/11/2002, Code p√©nal social art. 181'}},
    {q:['onss','rsz','cotisation','patronal','s√©curit√© sociale'],a:{fr:'**Cotisations ONSS 2026**\n\n**Travailleur**: 13,07% du brut\n**Employeur marchand**: ~25%\n**Employeur non-marchand**: ~32,40%\n**Ouvriers**: brut √ó 108%\n\n**Ventilation patronale:** Base 19,88% + Mod√©ration 5,67% + Fonds fermeture 0,02-0,18% + Ch√¥mage temp 0,10% + Amiante 0,01%\n\n**R√©ductions:** Bas salaires, premiers engagements (1er-6√®me), travailleurs √¢g√©s 55+.\n**Paiement**: Provisions le 5 du mois + solde trimestriel.\n\nüìã Loi 27/06/1969, AR 28/11/1969'}},
    {q:['ch√®ques-repas','maaltijdcheque','meal voucher','repas','titre-repas'],a:{fr:'**Ch√®ques-repas 2026**\n\n‚Ä¢ Valeur max: **8,00‚Ç¨**/jour prest√©\n‚Ä¢ Part employeur max: **6,91‚Ç¨**\n‚Ä¢ Part travailleur min: **1,09‚Ç¨**\n‚Ä¢ Exon√©ration ONSS + fiscale\n\n**Conditions:** CCT/accord √©crit, 1/jour prest√©, au nom du travailleur, validit√© 12 mois, format √©lectronique.\n**√âmetteurs**: Pluxee, Edenred, Monizze.\n\nüìã AR 28/11/1969, art. 19bis ¬ß2'}},
    {q:['√©tudiant','student','jobiste','650','job √©tudiant'],a:{fr:'**Travail √©tudiant 2026**\n\n‚Ä¢ **650 heures/an** √† cotisations r√©duites\n‚Ä¢ ONSS: 2,71% √©tudiant + 5,43% employeur = **8,14%**\n‚Ä¢ Au-del√†: cotisations normales\n‚Ä¢ **Dimona STU** obligatoire\n‚Ä¢ **3 jours d\'essai** automatiques\n‚Ä¢ **COE** obligatoire avant d√©but\n‚Ä¢ Min 15 ans, max 20h/sem en p√©riode scolaire\n‚Ä¢ V√©rification: student@work.be\n\nüìã Loi 3/7/1978, Titre VII'}},
    {q:['pr√©compte','bedrijfsvoorheffing','pp 274','fiscal','imp√¥t'],a:{fr:'**Pr√©compte professionnel 2026**\n\n**Bar√®mes** SPF Finances (Annexe III AR/CIR 92).\n\n**R√©ductions:** Enfants √† charge, bonus emploi, heures sup (-66,81%), nuit/√©quipes (dispense 22,8%), sportifs (80%).\n\n**D√©claration PP 274** via FinProf:\n‚Ä¢ Mensuel (>50 trav): 15 du mois suivant\n‚Ä¢ Trimestriel (‚â§50): 15 du mois suivant le trimestre\n\nüìã CIR 92, art. 270-275'}},
    {q:['maladie','ziekte','sick','incapacit√©','garanti','certificat'],a:{fr:'**Maladie ‚Äî Salaire garanti**\n\n**Employ√©:** 30 jours √† 100% employeur, puis mutuelle 60%.\n**Ouvrier:** J1-7: 100%, J8-14: 85,88%, J15-30: 25,88%+60% mutuelle, apr√®s: mutuelle.\n\n**Obligations:** Certificat 48h, disponible pour contr√¥le, informer J1.\n**Rechute <14j** = continuation m√™me salaire garanti.\n**Contr√¥le m√©dical** d√®s J1 possible.\n\nüìã Loi 3/7/1978, art. 52-75'}},
    {q:['vacances','cong√©','verlof','holiday','p√©cule','vakantie'],a:{fr:'**Vacances annuelles 2026**\n\n**Employ√©s:** 20j/an, simple p√©cule (salaire normal) + double p√©cule (92% brut mensuel), pay√© par employeur.\n**Ouvriers:** 20j/an, p√©cule = 15,38% des r√©mun√©rations brutes ann√©e pr√©c√©dente, pay√© par Caisse vacances (ONVA).\n\n**10 jours f√©ri√©s l√©gaux:** 1/1, P√¢ques lundi, 1/5, Ascension, Pentec√¥te lundi, 21/7, 15/8, 1/11, 11/11, 25/12.\n\nüìã Lois coordonn√©es 28/06/1971'}},
    {q:['flexijob','flexi','mini-job'],a:{fr:'**Flexi-job 2026**\n\n**Conditions:** 4/5 temps chez autre employeur (T-3) OU pensionn√©.\n**Avantages:** Pas d\'ONSS travailleur, pas de PP. Patronal: 28%. Min 12,05‚Ç¨/h.\n**Max**: 12.000‚Ç¨/an exon√©r√© (non-pensionn√©s).\n**Secteurs**: Horeca, commerce, boulangerie, sport, culture, agriculture, √©v√©nementiel, immobilier...\n\nüìã Loi 16/11/2015, √©largi 01/01/2024'}},
    {q:['cr√©dit-temps','tijdskrediet','4/5','cong√© parental'],a:{fr:'**Cr√©dit-temps 2026**\n\n**Sans motif**: SUPPRIM√â (01/01/2023).\n**Avec motif (max 51 mois):** Soins enfant <8 ans, palliatifs, maladie grave, handicap, formation.\n**Fin carri√®re (55 ans+):** Mi-temps ou 4/5, allocation ONEM, 25 ans carri√®re.\n**Cong√© parental:** 4m temps plein / 8m mi-temps / 20m 1/5, par enfant <12 ans.\n**Cong√© th√©matique:** Palliatif 1-3m, assistance m√©dicale 1-3m.\n\nüìã CCT n¬∞103, AR 12/12/2001'}},
    {q:['index','indexation','indexering','bar√®me','rmmmg'],a:{fr:'**Indexation salariale 2026**\n\nSyst√®me automatique li√© √† l\'indice sant√© liss√©.\n\n**CP 200**: Janvier, ~2%. **CP 124**: Janvier. **CP 302**: Janvier. **CP 330**: Selon protocole.\n\n**RMMMG 2026:**\n‚Ä¢ 18 ans: 2.029,88‚Ç¨/mois\n‚Ä¢ +6 mois: 2.090,83‚Ç¨\n‚Ä¢ +12 mois: 2.154,76‚Ç¨\n\nüìã Loi 2/8/1971'}},
    {q:['contrat','contract','cdi','cdd','temps partiel'],a:{fr:'**Contrats de travail**\n\n**CDI**: Forme libre (pr√©somption l√©gale).\n**CDD**: √âcrit AVANT d√©but, sinon ‚Üí CDI. Max 4√ó3mois/2ans ou 6√ó6mois/3ans.\n**Temps partiel**: √âcrit avant d√©but, min 1/3 temps plein ou 3h/prestation.\n**Remplacement**: √âcrit, max 2 ans.\n**Int√©rim**: Via agence, max 2 ans m√™me poste.\n**Clause d\'essai**: SUPPRIM√âE (sauf √©tudiants/int√©rim 3j).\n\nüìã Loi 3/7/1978'}},
    {q:['motif grave','faute grave','dringende reden'],a:{fr:'**Motif grave ‚Äî Art. 35**\n\nFaute rendant imm√©diatement impossible la poursuite du contrat.\n\n**Proc√©dure:** Constatation ‚Üí 3j ouvrables notification ‚Üí 3j motivation par recommand√©.\n**Exemples:** Vol, fraude, violence, harc√®lement, absences r√©p√©t√©es, concurrence d√©loyale.\n**Cons√©quences:** Pas de pr√©avis, pas d\'indemnit√©, pas de ch√¥mage (temporaire).\n**Preuve:** √Ä charge de l\'employeur.\n\nüìã Art. 35 Loi 3/7/1978'}},
    {q:['dmfa','trimestrielle','kwartaal'],a:{fr:'**DmfA ‚Äî D√©claration trimestrielle ONSS**\n\nT1: avant 30/04, T2: avant 31/07, T3: avant 31/10, T4: avant 31/01.\n\n**Contenu/travailleur:** R√©mun√©rations brutes, cotisations, jours prest√©s, r√©ductions.\n**Format**: XML via batch ou portail.\n**Flux**: Envoi ‚Üí ACRF ‚Üí Notification ‚Üí PID.\n\nüìã Loi 27/06/1969'}},
    {q:['c4','ch√¥mage','werkloosheid','document sortie'],a:{fr:'**Documents de sortie**\n\n**C4**: Certificat ch√¥mage (obligatoire, dernier jour). Sanction: 80-800‚Ç¨.\n**C131A**: Attestation vacances employ√©.\n**D√©compte final**: Toutes sommes dues.\n**Attestation d\'occupation**: Historique emploi.\n**Fiche 281.10**: Si fin en cours d\'ann√©e.\n**Dimona OUT**: Le dernier jour.\n\nüìã AR 25/11/1991'}},
    {q:['r√®glement','travail','arbeidsreglement'],a:{fr:'**R√®glement de travail ‚Äî Obligatoire d√®s le 1er travailleur**\n\n**Mentions:** Horaires, contr√¥le temps, paiement, pr√©avis, sanctions, CPPT, premiers secours, adresse CLS, CCT applicables.\n**Modification:** Affichage 15j + registre remarques + copie CLS.\n\nüìã Loi 8/4/1965'}},
    {q:['harc√®lement','bien-√™tre','welzijn','psychosociaux','burnout'],a:{fr:'**Bien-√™tre ‚Äî Risques psychosociaux**\n\nEmployeur = responsable pr√©vention. Analyse risques obligatoire. Conseiller pr√©vention obligatoire.\n\n**Proc√©dure interne:** Personne de confiance + CPAP. Demande formelle ‚Üí 3 mois mesures.\n**Protection:** Plaignant prot√©g√© contre licenciement.\n**CPPT:** Obligatoire d√®s 50 travailleurs.\n\nüìã Loi 4/8/1996, AR 10/4/2014'}},
    {q:['heures sup','overtime','suppl√©mentaire','temps de travail','38h'],a:{fr:'**Temps de travail**\n\n**L√©gal:** 38h/sem. Max: 11h/jour, 50h/sem.\n**Repos:** 11h/jour, 35h/semaine.\n**Heures sup:** Sursalaire +50% (ouvrable), +100% (dimanche/f√©ri√©). R√©cup√©ration obligatoire (sauf 91h relax). Max 120h/an (360h via CCT). Avantage fiscal -66,81%.\n\nüìã Loi 16/3/1971'}},
    {q:['commission paritaire','cp','paritair comit√©','secteur'],a:{fr:'**Commissions paritaires**\n\nOrgane paritaire par secteur: CP 100 (ouvriers), CP 200 (employ√©s), CP 111 (m√©tal), CP 124 (construction), CP 140 (transport), CP 302 (horeca), CP 310 (banques), CP 330 (sant√©), CP 336 (professions lib√©rales).\n\n**Cons√©quences:** Bar√®mes, indexation, primes, cong√©s extra, ch√®ques-repas, √©co-ch√®ques.\n\nüìã Loi 5/12/1968'}},
    {q:['eco-ch√®que','√©coch√®que','√©cologique'],a:{fr:'**√âco-ch√®ques 2026**\n\nMax **250‚Ç¨/an** (temps plein). Exon√©r√© ONSS + fiscal. Format √©lectronique. Validit√© 24 mois.\n**Achats:** Appareils √©conomes, solaire, v√©lo, bio, plantes.\n\nüìã CCT n¬∞98, AR 28/11/1969'}},
    {q:['voiture','soci√©t√©','company car','atn','mobilit√©'],a:{fr:'**Voiture de soci√©t√© ‚Äî ATN 2026**\n\nFormule: Valeur catalogue √ó % √ó 6/7 √ó correction CO2.\n**CO2 r√©f:** Essence 78g/km, Diesel 65g/km. Base 5,5% ¬±0,1%/g. Min 4%.\n**ATN min:** 1.600‚Ç¨/an. D√©gressivit√© -6%/an (min 70%).\n\n**Budget mobilit√©:** Pilier 1 (voiture √©co), Pilier 2 (mobilit√© durable/loyer), Pilier 3 (cash -38,07%).\n\nüìã Art. 36 CIR 92, Loi 17/3/2019'}},
    {q:['rgpd','gdpr','donn√©es','privacy','protection'],a:{fr:'**RGPD en droit social**\n\nEmployeur = Responsable traitement. 6 cat√©gories donn√©es: identification, pro, financi√®res, fiscales, SS, sant√©.\n\n**Obligations:** Registre art. 30, DPA art. 28, politique confidentialit√©, notification fuite 72h, DPO si >250 trav.\n**Sanctions:** 20M‚Ç¨ ou 4% CA.\n\nüìã RGPD 2016/679, Loi belge 30/7/2018'}},
    {q:['saisie','cession','pension alimentaire','retenue'],a:{fr:'**Saisie sur salaire 2026**\n\n**Quotit√©s:** ‚â§1.260‚Ç¨: insaisissable. 1.260-1.353‚Ç¨: 20%. 1.353-1.493‚Ç¨: 30%. 1.493-1.634‚Ç¨: 40%. >1.634‚Ç¨: illimit√©.\n+78‚Ç¨/enfant √† charge.\n**Pension alimentaire:** Pas de quotit√© insaisissable.\n\nüìã Code judiciaire art. 1409-1412'}},
    {q:['int√©rim','uitzendarbeid','temporaire','agence'],a:{fr:'**Int√©rim ‚Äî Loi 24/7/1987**\n\nMotifs: Remplacement, surcro√Æt, exceptionnel, insertion.\nMax 2 ans m√™me poste. 3j essai. Principe d\'√©galit√© salariale.\n**CP 322** (travail int√©rimaire).\n\nüìã Loi 24/7/1987'}},
    {q:['accident','travail','arbeidsongeval','at'],a:{fr:'**Accident du travail**\n\n√âv√©nement soudain + l√©sion + cours du contrat. Trajet domicile-travail = couvert.\n**Employeur:** Assurance AT obligatoire, d√©claration 8j.\n**Indemnisation:** IT totale 90%, IP rente viag√®re, d√©c√®s rente ayants droit.\n**Fedris**: Agence f√©d√©rale risques pro.\n\nüìã Loi 10/4/1971'}},
    {q:['pension','retraite','pensioen','√¢ge'],a:{fr:'**Pension 2026**\n\n√Çge l√©gal: 66 ans (67 d√®s 2030).\n**Anticip√©e:** 63+42ans, 61+44ans, 60+44ans.\nCalcul: 60% (isol√©)/75% (m√©nage) √ó salaire moyen √ó ann√©es/45.\n2√®me pilier: Assurance groupe. 3√®me pilier: √âpargne-pension (30% sur 1.020‚Ç¨).\n\nüìã Loi 21/5/2015'}},
    {q:['bonus','prime','cct 90','non r√©current'],a:{fr:'**Bonus CCT n¬∞90**\n\nPlafond 2026: **4.020‚Ç¨** brut (3.496‚Ç¨ net apr√®s 13,07%). ONSS employeur 33%. Pas de PP.\nConditions: Plan bonus par CCT/acte adh√©sion, objectifs collectifs mesurables, min 3 mois, d√©p√¥t SPF.\n\nüìã CCT n¬∞90, Loi 21/12/2007'}},
    {q:['t√©l√©travail','thuiswerk','remote','homeworking'],a:{fr:'**T√©l√©travail**\n\n**Structurel (CCT 85):** Avenant obligatoire. **Occasionnel (Loi 5/3/2017):** Pas d\'avenant.\n\n**Indemnit√©s exon√©r√©es 2026:** Bureau 148,73‚Ç¨/m + Internet 20‚Ç¨ + PC 20‚Ç¨ + √âcran 20‚Ç¨ = **~208,73‚Ç¨/mois**.\n\nüìã CCT n¬∞85, Loi 5/3/2017'}},
    {q:['belcotax','281','fiche fiscale'],a:{fr:'**Belcotax ‚Äî Fiches 281**\n\n281.10: Salari√©s. 281.20: Dirigeants. Contenu: brut, PP, ONSS, ATN, frais d√©placement.\n**D√©lai:** 28/02. Via Belcotax on web (XML). Sanction: 50-1.250‚Ç¨/fiche.\n\nüìã Art. 57 CIR 92'}},
    {q:['transport','d√©placement','v√©lo','domicile'],a:{fr:'**Transport domicile-travail**\n\nTransport en commun: remboursement obligatoire (80% SNCB ou CCT).\n**V√©lo:** 0,35‚Ç¨/km exon√©r√©.\nVoiture priv√©e: selon CCT.\nCumul v√©lo+train possible.\n\nüìã CCT n¬∞19/9'}},
    {q:['premier','engagement','eerste','r√©duction starter'],a:{fr:'**Premiers engagements ‚Äî R√©ductions ONSS**\n\n1er: exon√©ration quasi-totale (illimit√©e). 2√®me: -1.550‚Ç¨/trim (5 trim). 3√®me: -1.050‚Ç¨/trim (9 trim). 4√®me-6√®me: -1.000‚Ç¨/trim (13 trim).\nCompteur li√© √† l\'unit√© technique d\'exploitation.\n\nüìã AR 16/5/2003'}},
    {q:['inspection','contr√¥le','amende','sanction','code p√©nal'],a:{fr:'**Inspection & Sanctions**\n\nServices: CLS (SPF), ONSS, ONEM, Fedris.\n**Code p√©nal social:** Niveau 1: 10-100‚Ç¨, Niveau 2: 50-500‚Ç¨, Niveau 3: 100-1.000‚Ç¨, Niveau 4: prison 6m-3ans + 600-6.000‚Ç¨.\nMultipli√©s par nb travailleurs. D√©cimes √ó8.\n\nüìã Code p√©nal social (Loi 6/6/2010)'}},
    {q:['non-concurrence','√©colage','clause'],a:{fr:'**Clauses sp√©ciales**\n\n**Non-concurrence:** R√©mun√©ration >39.422‚Ç¨/an. Indemnit√© min 50% salaire. Max 12 mois.\n**√âcolage:** Formation >80h ou valeur >seuil. R√©mun√©ration >41.969‚Ç¨. Max 3 ans (d√©gressif 100/66/33%).\n**Exclusivit√©:** Proportionn√©e (art. 17bis).\n\nüìã Loi 3/7/1978'}},
    {q:['registre','personnel','document','obligation'],a:{fr:'**Documents sociaux obligatoires**\n\n1. R√®glement de travail\n2. Registre du personnel\n3. Compte individuel (par travailleur/mois)\n4. D√©compte de r√©mun√©ration (fiche de paie)\n5. Convention Dimona\n6. Contrats √©crits (CDD, temps partiel, √©tudiant)\n7. Bilan social (> 20 travailleurs)\n\n**Conservation:** 5 ans minimum apr√®s fin du contrat.\n\nüìã AR 8/8/1980'}},
  ];
  const searchKB=(query)=>{
    const q=query.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
    for(const entry of localKB){
      for(const keyword of entry.q){
        if(q.includes(keyword.toLowerCase()))return entry.a[lang]||entry.a.fr;
      }
    }
    return lang==='nl'?'Ik heb geen specifiek antwoord op deze vraag. Probeer trefwoorden zoals: pr√©avis, dimona, ONSS, ch√®ques-repas, √©tudiant, maladie, vacances, index, flexijob, cr√©dit-temps.':lang==='en'?'I don\'t have a specific answer. Try keywords like: notice period, dimona, ONSS, meal vouchers, student, sick leave, holidays, indexation, flexijob.':'Je n\'ai pas de r√©ponse sp√©cifique √† cette question. Essayez des mots-cl√©s comme: **pr√©avis, dimona, ONSS, ch√®ques-repas, √©tudiant, maladie, vacances, index, flexijob, cr√©dit-temps, pr√©compte**.\n\nOu posez une question plus pr√©cise sur le droit social belge.';
  };

  const send=async(text)=>{
    if(!text.trim()||loading)return;
    const dl=detectAgentLang(text);setLang(dl);
    const um={role:'user',content:text.trim()};
    const nm=[...msgs,um];setMsgs(nm);setInp('');setLoading(true);
    
    logAudit('agent_ia_query',{query:text.trim(),lang:dl});
    
    try{
      // Use server-side API route (secure, with API key)
      const res=await fetch('/api/agent',{
        method:"POST",headers:{'Content-Type':'application/json'},
        body:JSON.stringify({messages:nm.map(m=>({role:m.role,content:m.content})),lang:dl})
      });
      const data=await res.json();
      if(data.error)throw new Error(data.error);
      const cleanTxt=parseAndExecute(data.text||'Erreur.');
      setMsgs([...nm,{role:'assistant',content:cleanTxt}]);
    }catch(e){
      // Fallback: local KB search
      const kbAnswer=searchKB(text);
      setMsgs([...nm,{role:'assistant',content:kbAnswer}]);
    }
    finally{setLoading(false);}
    if(!open)setUnread(u=>u+1);
  };

  const labels={fr:{title:'Agent Juridique IA',placeholder:'Votre question en droit social...',disclaimer:'Info juridique indicative. Cas complexes ‚Üí juriste.',clear:'Effacer'},
    nl:{title:'Juridische AI-Agent',placeholder:'Uw vraag over sociaal recht...',disclaimer:'Indicatieve juridische info. Complexe gevallen ‚Üí jurist.',clear:'Wissen'},
    en:{title:'Legal AI Agent',placeholder:'Your social law question...',disclaimer:'Indicative legal info. Complex cases ‚Üí jurist.',clear:'Clear'}};
  const lb=labels[lang]||labels.fr;

  return <>
    {/* Floating Button */}
    <button onClick={()=>setOpen(!open)} style={{
      position:'fixed',bottom:24,right:24,width:60,height:60,borderRadius:'50%',
      background:"linear-gradient(135deg,#c6a34e,#8b6914)",border:'none',cursor:'pointer',
      boxShadow:'0 6px 24px rgba(198,163,78,.4)',zIndex:9999,display:'flex',alignItems:'center',justifyContent:'center',
      transition:'all .3s',transform:open?'scale(0.9) rotate(45deg)':'scale(1) rotate(0deg)',
    }}>
      <span style={{fontSize:open?26:28,color:'#0d0d0d',fontWeight:700}}>{open?'‚úï':'‚öñÔ∏è'}</span>
      {unread>0&&!open&&<span style={{position:'absolute',top:-4,right:-4,width:22,height:22,borderRadius:'50%',
        background:"#ef4444",color:'#fff',fontSize:11,fontWeight:700,display:'flex',alignItems:'center',justifyContent:'center',
        border:'2px solid #060810'}}>{unread}</span>}
    </button>

    {/* Chat Window */}
    {open&&<div style={{
      position:'fixed',bottom:96,right:24,width:400,height:560,
      background:"#0c0f1a",border:'1px solid rgba(198,163,78,.2)',borderRadius:20,
      boxShadow:'0 20px 60px rgba(0,0,0,.7)',zIndex:9998,display:'flex',flexDirection:'column',
      overflow:'hidden',animation:'agentSlideIn .3s ease-out',
    }}>
      <style>{`@keyframes agentSlideIn{from{opacity:0;transform:translateY(20px) scale(.95);}to{opacity:1;transform:translateY(0) scale(1);}}`}</style>

      {/* Header */}
      <div style={{padding:'14px 18px',borderBottom:'1px solid rgba(198,163,78,.12)',
        background:"linear-gradient(135deg,rgba(198,163,78,.08),rgba(198,163,78,.02))",
        display:'flex',alignItems:'center',justifyContent:'space-between',flexShrink:0}}>
        <div style={{display:'flex',alignItems:'center',gap:10}}>
          <div style={{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg,#c6a34e,#8b6914)",
            display:'flex',alignItems:'center',justifyContent:'center',fontSize:16,fontWeight:800,color:'#0d0d0d'}}>‚öñÔ∏è</div>
          <div>
            <div style={{fontSize:14,fontWeight:700,color:'#c6a34e'}}>{lb.title}</div>
            <div style={{fontSize:10,color:'rgba(198,163,78,.5)'}}>Aureus Social Pro</div>
          </div>
        </div>
        <div style={{display:'flex',gap:6,alignItems:'center'}}>
          {['fr',"nl","en"].map(l=><button key={l} onClick={()=>setLang(l)} style={{
            padding:'3px 8px',borderRadius:6,border:'none',fontSize:10,fontWeight:600,cursor:'pointer',
            textTransform:'uppercase',letterSpacing:.5,fontFamily:'inherit',
            background:lang===l?'rgba(198,163,78,.2)':'transparent',color:lang===l?'#c6a34e':'rgba(198,163,78,.3)',
          }}>{l}</button>)}
          <button onClick={()=>{setMsgs([]);}} style={{padding:'3px 8px',borderRadius:6,border:'1px solid rgba(198,163,78,.15)',
            background:"transparent",color:'rgba(198,163,78,.4)',fontSize:10,cursor:'pointer',fontFamily:'inherit',marginLeft:4}}>{lb.clear}</button>
        </div>
      </div>

      {/* Messages */}
      <div style={{flex:1,overflowY:'auto',padding:'16px 14px',display:'flex',flexDirection:'column',gap:12}}>
        {msgs.length===0&&<div style={{textAlign:'center',padding:'20px 10px'}}>
          <div style={{fontSize:36,marginBottom:12}}>‚öñÔ∏è</div>
          <div style={{fontSize:13,color:'rgba(198,163,78,.6)',marginBottom:16,lineHeight:1.5}}>
            {lang==='nl'?'Stel uw vraag over Belgisch sociaal recht':lang==='en'?'Ask your Belgian social law question':'Posez votre question en droit social belge'}
          </div>
          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:6}}>
            {quick.map((q,qi)=><button key={qi} onClick={()=>{setInp(q.p);inpRef.current?.focus();}} style={{
              display:'flex',alignItems:'center',gap:6,padding:'9px 10px',
              background:"rgba(198,163,78,.04)",border:'1px solid rgba(198,163,78,.1)',borderRadius:10,
              color:'rgba(232,228,220,.7)',fontSize:11.5,cursor:'pointer',fontFamily:'inherit',textAlign:'left',
            }}><span style={{fontSize:15}}>{q.i}</span><span>{q.l}</span></button>)}
          </div>
        </div>}

        {msgs.map((m,i)=><div key={i} style={{display:'flex',justifyContent:m.role==='user'?'flex-end':'flex-start'}}>
          <div style={{
            maxWidth:'85%',padding:m.role==='user'?'10px 14px':'12px 16px',
            borderRadius:m.role==='user'?'16px 16px 4px 16px':'16px 16px 16px 4px',
            background:m.role==='user'?'linear-gradient(135deg,#c6a34e,#a07d3e)':'rgba(255,255,255,.05)',
            color:m.role==='user'?'#0d0d0d':'#e8e4dc',fontSize:12.5,lineHeight:1.6,fontFamily:'inherit',
            border:m.role==='user'?'none':'1px solid rgba(198,163,78,.1)',whiteSpace:'pre-wrap',wordBreak:'break-word',
          }}>
            {m.role==='assistant'&&<div style={{display:'flex',alignItems:'center',gap:6,marginBottom:8,paddingBottom:8,
              borderBottom:'1px solid rgba(198,163,78,.1)'}}>
              <span style={{fontSize:10,color:'#c6a34e',fontWeight:600,letterSpacing:.5,textTransform:'uppercase'}}>Aureus {m.executed?'‚ö° Ex√©cut√©':'Legal'}</span>
              {m.executed&&<span style={{fontSize:9,padding:'1px 6px',borderRadius:8,background:'rgba(74,222,128,.15)',color:'#4ade80',fontWeight:600}}>‚úÖ Action effectu√©e</span>}
            </div>}
            {m.content}
          </div>
        </div>)}

        {loading&&<div style={{display:'flex',alignItems:'center',gap:8,padding:'8px 12px'}}>
          {[0,1,2].map(i=><div key={i} style={{width:6,height:6,borderRadius:'50%',background:"#c6a34e",
            animation:`pulse 1.2s ease-in-out ${i*.2}s infinite`}}/>)}
          <span style={{fontSize:11,color:'rgba(198,163,78,.4)',fontStyle:'italic'}}>
            {lang==='nl'?'Analyse bezig...':lang==='en'?'Analyzing...':'Analyse en cours...'}
          </span>
        </div>}
        <div ref={endRef}/>
      </div>

      {/* Input */}
      <div style={{padding:'10px 14px 14px',borderTop:'1px solid rgba(198,163,78,.1)',
        background:"rgba(12,15,26,.95)",flexShrink:0}}>
        <div style={{display:'flex',gap:8,alignItems:'flex-end',background:"rgba(198,163,78,.03)",
          border:'1px solid rgba(198,163,78,.12)',borderRadius:14,padding:'6px 6px 6px 14px'}}>
          <textarea ref={inpRef} value={inp} onChange={e=>setInp(e.target.value)}
            onKeyDown={e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send(inp);}}}
            placeholder={lb.placeholder} rows={1}
            style={{flex:1,background:"transparent",border:'none',color:'#e8e4dc',fontSize:13,
              fontFamily:'inherit',resize:'none',minHeight:22,maxHeight:80,lineHeight:1.4,padding:'4px 0',outline:'none'}}
            onInput={e=>{e.target.style.height='22px';e.target.style.height=Math.min(e.target.scrollHeight,80)+'px';}}/>
          <button onClick={()=>send(inp)} disabled={!inp.trim()||loading} style={{
            width:36,height:36,borderRadius:10,border:'none',flexShrink:0,cursor:inp.trim()&&!loading?'pointer':'not-allowed',
            background:inp.trim()&&!loading?'linear-gradient(135deg,#c6a34e,#a07d3e)':'rgba(198,163,78,.1)',
            color:inp.trim()&&!loading?'#0d0d0d':'rgba(198,163,78,.3)',fontSize:16,display:'flex',alignItems:'center',justifyContent:'center',
          }}>‚û§</button>
        </div>
        <div style={{textAlign:'center',marginTop:6,fontSize:9.5,color:'rgba(198,163,78,.2)'}}>{lb.disclaimer}</div>
      </div>
    </div>}
  </>;
}

export default function AureusSocialPro({ supabase, user, onLogout }) {
  return <LangProvider><AppInner supabase={supabase} user={user} onLogout={onLogout}/></LangProvider>;
}

