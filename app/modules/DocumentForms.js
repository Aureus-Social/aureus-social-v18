// ═══ AUREUS SOCIAL PRO — Formulaires Officiels Belges ═══
// Extraits du monolithe pour lazy-loading
// CompteIndividuelAnnuel, FormulaireC4, FormulaireC131,
// FormulaireAccidentTravail, AnnexeReglementTravail, Belcotax281Mod
"use client";
import { useState } from "react";
import { aureuspdf } from "@/app/lib/pdf-aureus";
import { PH, C, ST } from "@/app/lib/shared-ui";

const RMMMG = 2070.48;
const TX_ONSS_E = 0.2507;

export function CompteIndividuelAnnuel({s,d}){const f2=v=>new Intl.NumberFormat('fr-BE',{minimumFractionDigits:2}).format(v);const ae=(s.emps||[]).filter(e=>e.status==='active'||!e.status);const [selYear,setSelYear]=useState(new Date().getFullYear());const [selEmp,setSelEmp]=useState(null);const generate=(emp)=>{const brut=+(emp.monthlySalary||emp.gross||emp.brut||0);const onss=brut*0.1307;const pp=Math.max(0,(brut-onss-945)*0.2867);const net=brut-onss-pp;aureuspdf('Compte Individuel '+selYear+' — '+(emp.first||'')+' '+(emp.last||''),[{type:'title',text:'COMPTE INDIVIDUEL ANNUEL'},{type:'text',text:'AR du 27/09/1966 — Art. 4 — Obligation employeur',size:8,color:[158,155,147]},{type:'line'},{type:'space',h:4},{type:'subtitle',text:'IDENTIFICATION EMPLOYEUR'},{type:'kv',k:'Entreprise',v:s.co?.name||'[Nom]'},{type:'kv',k:'BCE',v:s.co?.vat||'[BCE]'},{type:'kv',k:'ONSS',v:s.co?.onss||'[N° ONSS]'},{type:'kv',k:'CP',v:s.co?.cp||'200'},{type:'space',h:4},{type:'subtitle',text:'IDENTIFICATION TRAVAILLEUR'},{type:'kv',k:'Nom',v:(emp.first||'')+' '+(emp.last||'')},{type:'kv',k:'NISS',v:emp.niss||'[NISS]'},{type:'kv',k:'Fonction',v:emp.function||emp.role||'[Fonction]'},{type:'kv',k:'Entree service',v:emp.startDate||emp.start||'[Date]'},{type:'kv',k:'Type contrat',v:emp.contractType||'CDI'},{type:'kv',k:'Regime',v:(emp.regime||100)+'%'},{type:'space',h:4},{type:'line'},{type:'subtitle',text:'RECAPITULATIF ANNUEL '+selYear},{type:'table',cols:['Element','Mensuel','Annuel (x12)','13e mois','Total'],rows:[['Brut',f2(brut),f2(brut*12),f2(brut),f2(brut*13)],['ONSS 13,07%','-'+f2(onss),'-'+f2(onss*12),'-'+f2(brut*0.1307),'-'+f2(onss*12+brut*0.1307)],['PP','-'+f2(pp),'-'+f2(pp*12),'-'+f2(pp),'-'+f2(pp*13)],['Net',f2(net),f2(net*12),f2(net),f2(net*13)]]},{type:'space',h:4},{type:'subtitle',text:'AVANTAGES EXTRA-LEGAUX'},{type:'kv',k:'Cheques-repas',v:emp.mealVouchers?f2(emp.mealVoucherValue||8)+' EUR x '+(emp.workDays||220)+' jours':'Non applicable'},{type:'kv',k:'Eco-cheques',v:emp.ecoVouchers?f2(emp.ecoVoucherValue||250)+' EUR/an':'Non applicable'},{type:'kv',k:'Assurance groupe',v:emp.groupInsurance||'Non applicable'},{type:'kv',k:'Voiture societe',v:emp.companyCar||'Non applicable'},{type:'space',h:4},{type:'subtitle',text:'COTISATIONS PATRONALES'},{type:'kv',k:'ONSS patronal 25,07%',v:f2(brut*0.2507*13)+' EUR/an'},{type:'kv',k:'Assurance AT',v:'Selon contrat'},{type:'kv',k:'Fermeture entreprise',v:f2(brut*0.0010*12)+' EUR/an'},{type:'space',h:4},{type:'text',text:'Ce document doit etre remis au travailleur avant le 1er mars de l\'annee suivante (AR 27/09/1966, Art. 4).',size:8,color:[198,163,78]},{type:'text',text:'A conserver par le travailleur pour sa declaration fiscale.',size:8,color:[158,155,147]}],{filename:'compte_individuel_'+selYear+'_'+(emp.last||''),enterprise:s.co?.name||''})};return <div><PH title="Compte Individuel Annuel" sub={"AR 27/09/1966 — Obligation remise avant le 1er mars — "+ae.length+" travailleurs"}/><div style={{display:"flex",gap:10,marginBottom:16,alignItems:"center"}}><select value={selYear} onChange={e=>setSelYear(+e.target.value)} style={{padding:"8px 12px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit"}}>{[2024,2025,2026].map(y=><option key={y} value={y}>{y}</option>)}</select><button onClick={()=>{ae.forEach(emp=>generate(emp))}} style={{padding:"10px 20px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#c6a34e,#a68a3c)",color:"#0c0b09",fontWeight:700,fontSize:12,cursor:"pointer",fontFamily:"inherit"}}>Generer tous les comptes ({ae.length})</button></div><C><ST>Travailleurs — Annee {selYear}</ST>{ae.map((emp,i)=>{const brut=+(emp.monthlySalary||emp.gross||emp.brut||0);return <div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,.03)"}}><div><div style={{fontSize:12,fontWeight:600,color:"#e8e6e0"}}>{emp.first||''} {emp.last||''}</div><div style={{fontSize:10,color:"#5e5c56"}}>NISS: {emp.niss||'—'} | {emp.function||emp.role||'—'}</div></div><div style={{display:"flex",gap:8,alignItems:"center"}}><span style={{fontSize:12,fontWeight:600,color:"#c6a34e"}}>{f2(brut*13)} EUR/an</span><button onClick={()=>generate(emp)} style={{padding:"6px 14px",borderRadius:6,border:"none",background:"rgba(198,163,78,.12)",color:"#c6a34e",fontSize:11,cursor:"pointer",fontFamily:"inherit"}}>PDF</button></div></div>})}</C></div>;}

export function FormulaireC4({s,d}){const f2=v=>new Intl.NumberFormat('fr-BE',{minimumFractionDigits:2}).format(v);const ae=(s.emps||[]).filter(e=>e.status==='active'||!e.status);const [form,setForm]=useState({emp:0,motif:'preavis',dateNotif:'',dateFin:'',motifDetail:''});const u=(k,v)=>setForm({...form,[k]:v});const emp=ae[form.emp]||{};const brut=+(emp.monthlySalary||emp.gross||emp.brut||0);const anc=emp.startDate?((Date.now()-new Date(emp.startDate))/(365.25*86400000)):1;const weeks=Math.max(1,Math.floor(anc<1?2:anc<5?anc*3+1:anc<20?anc*3:anc*2.67+5));const generate=()=>{aureuspdf('Formulaire C4 — Certificat de Chomage',[{type:'title',text:'FORMULAIRE C4'},{type:'subtitle',text:'CERTIFICAT DE CHOMAGE — ONEM'},{type:'text',text:'A remettre au travailleur le dernier jour de travail',size:8,color:[198,163,78]},{type:'line'},{type:'space',h:4},{type:'subtitle',text:'CADRE I — EMPLOYEUR'},{type:'kv',k:'Denomination',v:s.co?.name||'[Entreprise]'},{type:'kv',k:'N° ONSS',v:s.co?.onss||'[ONSS]'},{type:'kv',k:'BCE',v:s.co?.vat||'[BCE]'},{type:'kv',k:'CP',v:s.co?.cp||'200'},{type:'space',h:4},{type:'subtitle',text:'CADRE II — TRAVAILLEUR'},{type:'kv',k:'Nom',v:(emp.first||'')+' '+(emp.last||'')},{type:'kv',k:'NISS',v:emp.niss||'[NISS]'},{type:'kv',k:'Adresse',v:emp.address||'[Adresse]'},{type:'kv',k:'Fonction',v:emp.function||emp.role||'[Fonction]'},{type:'space',h:4},{type:'subtitle',text:'CADRE III — OCCUPATION'},{type:'kv',k:'Date debut',v:emp.startDate||emp.start||'[Date]'},{type:'kv',k:'Date fin',v:form.dateFin||'[Date]'},{type:'kv',k:'Regime',v:(emp.regime||100)+'% ('+(emp.regime===100?'38h/semaine':Math.round(38*(emp.regime||100)/100)+'h/semaine')+')'},{type:'kv',k:'Anciennete',v:Math.floor(anc)+' ans '+Math.floor((anc%1)*12)+' mois'},{type:'space',h:4},{type:'subtitle',text:'CADRE IV — FIN DE CONTRAT'},{type:'kv',k:'Mode de rupture',v:form.motif==='preavis'?'Preavis preste (Art. 37)':form.motif==='indemnite'?'Indemnite compensatoire (Art. 39)':form.motif==='grave'?'Motif grave (Art. 35)':'Commun accord'},{type:'kv',k:'Notification',v:form.dateNotif||'[Date]'},{type:'kv',k:'Preavis',v:weeks+' semaines (Loi 26/12/2013)'},{type:'kv',k:'Motif CCT 109',v:form.motifDetail||'[A completer]'},{type:'space',h:4},{type:'subtitle',text:'CADRE V — REMUNERATION'},{type:'kv',k:'Dernier brut mensuel',v:f2(brut)+' EUR'},{type:'kv',k:'Brut journalier',v:f2(brut/21.67)+' EUR'},{type:'kv',k:'Pecule vacances solde',v:'A calculer'},{type:'kv',k:'13e mois prorata',v:f2(brut*(new Date().getMonth()+1)/12)+' EUR'},{type:'space',h:4},{type:'text',text:'Je certifie que les renseignements ci-dessus sont exacts.',size:9},{type:'space',h:8},{type:'signature'}],{filename:'C4_'+(emp.last||''),enterprise:s.co?.name||''})};return <div><PH title="Formulaire C4 — Certificat de Chomage" sub="ONEM — Obligatoire a la sortie du travailleur"/><C><ST>Donnees du travailleur</ST>{ae.length>0?<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}><div><label style={{fontSize:10,color:"#888",display:"block",marginBottom:3}}>Travailleur</label><select value={form.emp} onChange={e=>u('emp',+e.target.value)} style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit"}}>{ae.map((e,i)=><option key={i} value={i}>{e.first} {e.last}</option>)}</select></div><div><label style={{fontSize:10,color:"#888",display:"block",marginBottom:3}}>Mode de rupture</label><select value={form.motif} onChange={e=>u('motif',e.target.value)} style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit"}}><option value="preavis">Preavis preste (Art. 37)</option><option value="indemnite">Indemnite compensatoire (Art. 39)</option><option value="grave">Motif grave (Art. 35)</option><option value="accord">Commun accord</option></select></div><div><label style={{fontSize:10,color:"#888",display:"block",marginBottom:3}}>Date notification</label><input type="date" value={form.dateNotif} onChange={e=>u('dateNotif',e.target.value)} style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit"}}/></div><div><label style={{fontSize:10,color:"#888",display:"block",marginBottom:3}}>Date fin contrat</label><input type="date" value={form.dateFin} onChange={e=>u('dateFin',e.target.value)} style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit"}}/></div><div style={{gridColumn:"1/3"}}><label style={{fontSize:10,color:"#888",display:"block",marginBottom:3}}>Motif (CCT 109)</label><input value={form.motifDetail} onChange={e=>u('motifDetail',e.target.value)} placeholder="Motif du licenciement" style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit"}}/></div></div>:<div style={{textAlign:"center",color:"#5e5c56",padding:20}}>Aucun travailleur enregistre</div>}</C>{ae.length>0&&<C><ST>Apercu — {emp.first} {emp.last}</ST><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10}}>{[{l:"Brut mensuel",v:f2(brut)+" EUR"},{l:"Anciennete",v:Math.floor(anc)+" ans"},{l:"Preavis",v:weeks+" semaines"},{l:"Brut journalier",v:f2(brut/21.67)+" EUR"},{l:"13e prorata",v:f2(brut*(new Date().getMonth()+1)/12)+" EUR"},{l:"Mode",v:form.motif}].map((k,i)=><div key={i} style={{padding:10,background:"rgba(198,163,78,.04)",borderRadius:8}}><div style={{fontSize:9,color:"#5e5c56"}}>{k.l}</div><div style={{fontSize:13,fontWeight:700,color:"#c6a34e",marginTop:2}}>{k.v}</div></div>)}</div></C>}<div style={{textAlign:"center",marginTop:16}}><button onClick={generate} style={{padding:"14px 40px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#c6a34e,#a68a3c)",color:"#0c0b09",fontWeight:700,fontSize:14,cursor:"pointer",fontFamily:"inherit"}}>Generer le C4 PDF</button></div></div>;}

export function FormulaireC131({s,d}){const f2=v=>new Intl.NumberFormat('fr-BE',{minimumFractionDigits:2}).format(v);const ae=(s.emps||[]).filter(e=>e.status==='active'||!e.status);const [selEmp,setSelEmp]=useState(0);const emp=ae[selEmp]||{};const brut=+(emp.monthlySalary||emp.gross||emp.brut||0);const generate=()=>{const joursConge=20;const joursPris=+(emp.vacationUsed||0);const solde=joursConge-joursPris;const peculeSimple=brut*0.0769;const peculeDouble=brut*0.0769;aureuspdf('Formulaire C131 — Certificat de Vacances',[{type:'title',text:'FORMULAIRE C131'},{type:'subtitle',text:'CERTIFICAT DE VACANCES ANNUELLES'},{type:'text',text:'CNT — Remis a la fin du contrat',size:8,color:[198,163,78]},{type:'line'},{type:'space',h:4},{type:'subtitle',text:'EMPLOYEUR'},{type:'kv',k:'Denomination',v:s.co?.name||'[Entreprise]'},{type:'kv',k:'N° ONSS',v:s.co?.onss||'[ONSS]'},{type:'space',h:4},{type:'subtitle',text:'TRAVAILLEUR'},{type:'kv',k:'Nom',v:(emp.first||'')+' '+(emp.last||'')},{type:'kv',k:'NISS',v:emp.niss||'[NISS]'},{type:'space',h:4},{type:'subtitle',text:'VACANCES — EXERCICE '+new Date().getFullYear()},{type:'kv',k:'Jours de conge acquis',v:joursConge+' jours'},{type:'kv',k:'Jours pris',v:joursPris+' jours'},{type:'kv',k:'Solde restant',v:solde+' jours'},{type:'kv',k:'Pecule simple du',v:f2(peculeSimple*solde)+' EUR'},{type:'kv',k:'Pecule double du',v:f2(peculeDouble*solde)+' EUR'},{type:'kv',k:'Total pecule du',v:f2((peculeSimple+peculeDouble)*solde)+' EUR'},{type:'space',h:4},{type:'text',text:'Ce certificat doit etre remis au nouvel employeur pour eviter un double paiement du pecule de vacances.',size:8,color:[198,163,78]},{type:'space',h:8},{type:'signature'}],{filename:'C131_'+(emp.last||''),enterprise:s.co?.name||''})};return <div><PH title="Formulaire C131 — Certificat de Vacances" sub="CNT — Obligatoire a la sortie pour transfert pecule"/><C><ST>Travailleur</ST><select value={selEmp} onChange={e=>setSelEmp(+e.target.value)} style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit",marginBottom:12}}>{ae.map((e,i)=><option key={i} value={i}>{e.first} {e.last} — Brut: {f2(+(e.monthlySalary||e.gross||e.brut||0))} EUR</option>)}</select>{ae.length>0&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10}}>{[{l:"Jours acquis",v:"20",c:"#c6a34e"},{l:"Jours pris",v:String(emp.vacationUsed||0),c:"#60a5fa"},{l:"Solde",v:String(20-(emp.vacationUsed||0)),c:"#22c55e"}].map((k,i)=><div key={i} style={{padding:12,background:"rgba(198,163,78,.04)",borderRadius:8,textAlign:"center"}}><div style={{fontSize:9,color:"#5e5c56"}}>{k.l}</div><div style={{fontSize:20,fontWeight:800,color:k.c,marginTop:4}}>{k.v}</div></div>)}</div>}</C><div style={{textAlign:"center",marginTop:16}}><button onClick={generate} style={{padding:"14px 40px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#c6a34e,#a68a3c)",color:"#0c0b09",fontWeight:700,fontSize:14,cursor:"pointer",fontFamily:"inherit"}}>Generer le C131 PDF</button></div></div>;}

export function FormulaireAccidentTravail({s,d}){const ae=(s.emps||[]).filter(e=>e.status==='active'||!e.status);const [form,setForm]=useState({emp:0,dateAcc:'',heureAcc:'',lieu:'',description:'',temoinNom:'',temoinTel:'',lesion:'',arretJours:0,hopital:''});const u=(k,v)=>setForm({...form,[k]:v});const emp=ae[form.emp]||{};const generate=()=>{aureuspdf('Declaration Accident du Travail',[{type:'title',text:'DECLARATION ACCIDENT DU TRAVAIL'},{type:'text',text:'Loi du 10/04/1971 — Declaration dans les 8 jours calendrier',size:8,color:[198,163,78]},{type:'line'},{type:'space',h:4},{type:'subtitle',text:'EMPLOYEUR'},{type:'kv',k:'Denomination',v:s.co?.name||'[Entreprise]'},{type:'kv',k:'BCE',v:s.co?.vat||'[BCE]'},{type:'kv',k:'Assureur AT',v:s.co?.atInsurer||'[Nom assureur]'},{type:'kv',k:'N° police AT',v:s.co?.atPolicy||'[N° police]'},{type:'space',h:4},{type:'subtitle',text:'VICTIME'},{type:'kv',k:'Nom',v:(emp.first||'')+' '+(emp.last||'')},{type:'kv',k:'NISS',v:emp.niss||'[NISS]'},{type:'kv',k:'Fonction',v:emp.function||emp.role||'[Fonction]'},{type:'space',h:4},{type:'subtitle',text:'CIRCONSTANCES DE L\'ACCIDENT'},{type:'kv',k:'Date',v:form.dateAcc||'[Date]'},{type:'kv',k:'Heure',v:form.heureAcc||'[Heure]'},{type:'kv',k:'Lieu',v:form.lieu||'[Lieu]'},{type:'article',num:'Description',text:form.description||'[Description detaillee des faits]'},{type:'kv',k:'Temoin',v:(form.temoinNom||'[Nom]')+' — '+(form.temoinTel||'[Tel]')},{type:'space',h:4},{type:'subtitle',text:'LESION ET CONSEQUENCES'},{type:'kv',k:'Nature lesion',v:form.lesion||'[Description]'},{type:'kv',k:'Hopital/Medecin',v:form.hopital||'[Nom]'},{type:'kv',k:'Arret prevu',v:(form.arretJours||0)+' jours'},{type:'space',h:4},{type:'text',text:'Je declare que les renseignements ci-dessus sont sinceres et veritables.',size:9},{type:'text',text:'Rappel: l\'employeur doit declarer tout accident du travail dans les 8 jours calendrier (Art. 62 Loi 10/04/1971).',size:8,color:[198,163,78]},{type:'space',h:8},{type:'signature'}],{filename:'accident_travail_'+(emp.last||''),enterprise:s.co?.name||''})};const inp=(label,key,type)=><div><label style={{fontSize:10,color:"#888",display:"block",marginBottom:3}}>{label}</label><input type={type||"text"} value={form[key]} onChange={e=>u(key,type==="number"?+e.target.value:e.target.value)} style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit"}}/></div>;return <div><PH title="Declaration Accident du Travail" sub="Loi 10/04/1971 — Delai: 8 jours calendrier"/><C><ST>Victime</ST><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}><div><label style={{fontSize:10,color:"#888",display:"block",marginBottom:3}}>Travailleur</label><select value={form.emp} onChange={e=>u('emp',+e.target.value)} style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit"}}>{ae.map((e,i)=><option key={i} value={i}>{e.first} {e.last}</option>)}</select></div>{inp("Date accident","dateAcc","date")}{inp("Heure","heureAcc","time")}{inp("Lieu","lieu")}</div></C><C><ST>Circonstances</ST><div style={{marginBottom:10}}><label style={{fontSize:10,color:"#888",display:"block",marginBottom:3}}>Description detaillee</label><textarea value={form.description} onChange={e=>u('description',e.target.value)} rows={4} style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit",resize:"vertical"}}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>{inp("Temoin — Nom","temoinNom")}{inp("Temoin — Tel","temoinTel")}</div></C><C><ST>Lesion et consequences</ST><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>{inp("Nature de la lesion","lesion")}{inp("Hopital/Medecin","hopital")}{inp("Jours d'arret prevus","arretJours","number")}</div></C><div style={{textAlign:"center",marginTop:16}}><button onClick={generate} style={{padding:"14px 40px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#c6a34e,#a68a3c)",color:"#0c0b09",fontWeight:700,fontSize:14,cursor:"pointer",fontFamily:"inherit"}}>Generer la declaration PDF</button></div></div>;}

export function AnnexeReglementTravail({s,d}){const [form,setForm]=useState({type:'horaires',dateEffet:'',description:''});const u=(k,v)=>setForm({...form,[k]:v});const types=[{id:'horaires',n:'Modification des horaires de travail'},{id:'baremes',n:'Modification des baremes salariaux'},{id:'teletravail',n:'Introduction du teletravail structurel'},{id:'flexijob',n:'Ajout regime flexi-job'},{id:'dress_code',n:'Code vestimentaire'},{id:'camera',n:'Installation cameras de surveillance (CCT 68)'},{id:'alcool',n:'Politique alcool et drogues (CCT 100)'},{id:'autre',n:'Autre modification'}];const generate=()=>{const selType=types.find(t=>t.id===form.type);aureuspdf('Annexe au Reglement de Travail',[{type:'title',text:'ANNEXE AU REGLEMENT DE TRAVAIL'},{type:'text',text:'Loi du 08/04/1965 relative aux reglements de travail',size:8,color:[158,155,147]},{type:'line'},{type:'space',h:4},{type:'kv',k:'Entreprise',v:s.co?.name||'[Entreprise]'},{type:'kv',k:'BCE',v:s.co?.vat||'[BCE]'},{type:'kv',k:'Date d\'effet',v:form.dateEffet||new Date().toLocaleDateString('fr-BE')},{type:'space',h:4},{type:'article',num:'Objet',text:'La presente annexe modifie le reglement de travail en vigueur concernant: '+selType.n+'.'},{type:'article',num:'Description de la modification',text:form.description||'[A completer — description detaillee de la modification]'},{type:'article',num:'Procedure de modification',text:'Conformement aux articles 11 a 14 de la Loi du 08/04/1965, cette modification a ete portee a la connaissance des travailleurs par affichage pendant 15 jours. Un registre de remarques a ete tenu a disposition. A defaut de remarques, la modification entre en vigueur 15 jours apres l\'affichage.'},{type:'article',num:'Entree en vigueur',text:'La presente annexe entre en vigueur le '+(form.dateEffet||'[Date]')+'. Elle fait partie integrante du reglement de travail.'},{type:'article',num:'Depot',text:'Un exemplaire de cette annexe a ete depose au bureau regional du SPF Emploi, Travail et Concertation Sociale (Art. 15 Loi 08/04/1965).'},{type:'space',h:8},{type:'signature'}],{filename:'annexe_reglement_travail',enterprise:s.co?.name||''})};return <div><PH title="Annexe au Reglement de Travail" sub="Loi 08/04/1965 — Procedure de modification obligatoire"/><C><ST>Type de modification</ST><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:12}}>{types.map(t=><button key={t.id} onClick={()=>u('type',t.id)} style={{padding:"10px 14px",borderRadius:8,border:"none",cursor:"pointer",fontSize:11,textAlign:"left",fontFamily:"inherit",fontWeight:form.type===t.id?600:400,background:form.type===t.id?"rgba(198,163,78,.15)":"rgba(255,255,255,.03)",color:form.type===t.id?"#c6a34e":"#9e9b93"}}>{t.n}</button>)}</div><div style={{marginBottom:10}}><label style={{fontSize:10,color:"#888",display:"block",marginBottom:3}}>Date d'effet</label><input type="date" value={form.dateEffet} onChange={e=>u('dateEffet',e.target.value)} style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit"}}/></div><div><label style={{fontSize:10,color:"#888",display:"block",marginBottom:3}}>Description detaillee de la modification</label><textarea value={form.description} onChange={e=>u('description',e.target.value)} rows={5} placeholder="Decrivez la modification apportee au reglement de travail..." style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit",resize:"vertical"}}/></div></C><C><ST>Procedure legale (Art. 11-14)</ST>{["Affichage de la modification pendant 15 jours ouvrables","Tenue d'un registre de remarques","Envoi a l'Inspection sociale si remarques","A defaut de remarques: entree en vigueur automatique","Depot obligatoire au SPF Emploi (Art. 15)"].map((step,i)=><div key={i} style={{display:"flex",gap:8,alignItems:"center",padding:"6px 0"}}><span style={{width:22,height:22,borderRadius:"50%",background:"rgba(198,163,78,.1)",color:"#c6a34e",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700,flexShrink:0}}>{i+1}</span><span style={{fontSize:12,color:"#e8e6e0"}}>{step}</span></div>)}</C><div style={{textAlign:"center",marginTop:16}}><button onClick={generate} style={{padding:"14px 40px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#c6a34e,#a68a3c)",color:"#0c0b09",fontWeight:700,fontSize:14,cursor:"pointer",fontFamily:"inherit"}}>Generer l'annexe PDF</button></div></div>;}

export function Belcotax281Mod({s,d}){const f2=v=>new Intl.NumberFormat('fr-BE',{minimumFractionDigits:2}).format(v);const ae=(s.emps||[]).filter(e=>e.status==='active'||!e.status);const [year,setYear]=useState(new Date().getFullYear()-1);const generateXML=()=>{let xml='<?xml version="1.0" encoding="UTF-8"?>\\n';xml+='<Belcotax xmlns="urn:belcotax:281" version="2.0">\\n';xml+='  <Declarant>\\n';xml+='    <Name>'+(s.co?.name||'ENTREPRISE')+'</Name>\\n';xml+='    <NationalNumber>'+(s.co?.vat||'0000000000').replace(/[^0-9]/g,'')+'</NationalNumber>\\n';xml+='    <Address>'+(s.co?.address||'')+'</Address>\\n';xml+='    <Year>'+year+'</Year>\\n';xml+='  </Declarant>\\n';xml+='  <Fiches>\\n';ae.forEach(emp=>{const brut=+(emp.monthlySalary||emp.gross||emp.brut||0)*12;const onss=brut*0.1307;const pp=Math.max(0,(brut/12-onss/12-945)*0.2867)*12;xml+='    <Fiche281_10>\\n';xml+='      <Beneficiary>\\n';xml+='        <Name>'+(emp.last||'')+'</Name>\\n';xml+='        <FirstName>'+(emp.first||'')+'</FirstName>\\n';xml+='        <NationalNumber>'+(emp.niss||'').replace(/[^0-9]/g,'')+'</NationalNumber>\\n';xml+='        <Address>'+(emp.address||'')+'</Address>\\n';xml+='      </Beneficiary>\\n';xml+='      <Income>\\n';xml+='        <GrossRemuneration>'+brut.toFixed(2)+'</GrossRemuneration>\\n';xml+='        <SocialContributions>'+onss.toFixed(2)+'</SocialContributions>\\n';xml+='        <WithholdingTax>'+pp.toFixed(2)+'</WithholdingTax>\\n';xml+='        <NetRemuneration>'+(brut-onss-pp).toFixed(2)+'</NetRemuneration>\\n';xml+='        <MealVouchers>'+(emp.mealVouchers?(emp.mealVoucherValue||8)*(emp.workDays||220):0).toFixed(2)+'</MealVouchers>\\n';xml+='        <CompanyCar>'+(emp.companyCar?'1':'0')+'</CompanyCar>\\n';xml+='      </Income>\\n';xml+='    </Fiche281_10>\\n'});xml+='  </Fiches>\\n';xml+='  <Summary>\\n';xml+='    <TotalFiches>'+ae.length+'</TotalFiches>\\n';xml+='    <TotalGross>'+ae.reduce((a,e)=>a+(+(e.monthlySalary||e.gross||e.brut||0))*12,0).toFixed(2)+'</TotalGross>\\n';xml+='  </Summary>\\n';xml+='</Belcotax>\\n';const b=new Blob([xml],{type:'application/xml;charset=utf-8'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='Belcotax_281_10_'+year+'.xml';a.click()};const generatePDF=()=>{aureuspdf('Fiches 281.10 — Recapitulatif '+year,[{type:'title',text:'FICHES 281.10 — BELCOTAX'},{type:'text',text:'SPF Finances — Exercice '+year,size:8,color:[158,155,147]},{type:'line'},{type:'space',h:4},{type:'kv',k:'Declarant',v:s.co?.name||'[Entreprise]'},{type:'kv',k:'BCE',v:s.co?.vat||'[BCE]'},{type:'kv',k:'Nb fiches',v:String(ae.length)},{type:'space',h:4},{type:'table',cols:['Travailleur','NISS','Brut annuel','ONSS','PP','Net'],rows:ae.map(e=>{const b2=+(e.monthlySalary||e.gross||e.brut||0)*12;const o=b2*0.1307;const p=Math.max(0,(b2/12-o/12-945)*0.2867)*12;return [(e.first||'')+' '+(e.last||''),e.niss||'—',f2(b2),f2(o),f2(p),f2(b2-o-p)]})}],{filename:'Belcotax_281_10_recap_'+year,enterprise:s.co?.name||''})};return <div><PH title="Fiches 281.10 — Belcotax-on-web" sub={"SPF Finances — "+ae.length+" fiches — Exercice "+year}/><div style={{display:"flex",gap:10,marginBottom:16,alignItems:"center"}}><select value={year} onChange={e=>setYear(+e.target.value)} style={{padding:"8px 12px",borderRadius:8,border:"1px solid rgba(198,163,78,.15)",background:"rgba(0,0,0,.2)",color:"#e8e6e0",fontSize:12,fontFamily:"inherit"}}>{[2023,2024,2025].map(y=><option key={y} value={y}>{y}</option>)}</select><button onClick={generateXML} style={{padding:"10px 20px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#22c55e,#16a34a)",color:"white",fontWeight:700,fontSize:12,cursor:"pointer",fontFamily:"inherit"}}>Exporter XML Belcotax</button><button onClick={generatePDF} style={{padding:"10px 20px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#c6a34e,#a68a3c)",color:"#0c0b09",fontWeight:700,fontSize:12,cursor:"pointer",fontFamily:"inherit"}}>Recapitulatif PDF</button></div><C><ST>Apercu des fiches {year}</ST><div style={{overflowX:"auto"}}><table style={{width:"100%",borderCollapse:"collapse",fontSize:11}}><thead><tr style={{borderBottom:"1px solid rgba(198,163,78,.2)"}}>{["Travailleur","NISS","Brut annuel","ONSS 13,07%","PP","Net annuel"].map((h,i)=><th key={i} style={{textAlign:"left",padding:"8px 6px",color:"#c6a34e",fontWeight:600,fontSize:10}}>{h}</th>)}</tr></thead><tbody>{ae.map((e,i)=>{const b2=+(e.monthlySalary||e.gross||e.brut||0)*12;const o=b2*0.1307;const p=Math.max(0,(b2/12-o/12-945)*0.2867)*12;return <tr key={i} style={{borderBottom:"1px solid rgba(255,255,255,.03)"}}><td style={{padding:"8px 6px",color:"#e8e6e0"}}>{e.first} {e.last}</td><td style={{padding:"8px 6px",color:"#888",fontSize:10}}>{e.niss||'—'}</td><td style={{padding:"8px 6px",color:"#c6a34e",fontWeight:600}}>{f2(b2)}</td><td style={{padding:"8px 6px",color:"#ef4444"}}>{f2(o)}</td><td style={{padding:"8px 6px",color:"#ef4444"}}>{f2(p)}</td><td style={{padding:"8px 6px",color:"#22c55e",fontWeight:600}}>{f2(b2-o-p)}</td></tr>})}</tbody></table></div></C></div>;}

// Default export pour dynamic() import
export default { CompteIndividuelAnnuel, FormulaireC4, FormulaireC131, FormulaireAccidentTravail, AnnexeReglementTravail, Belcotax281Mod };
