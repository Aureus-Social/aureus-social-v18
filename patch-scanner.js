const fs=require('fs');let c=fs.readFileSync('app/AureusSocialPro.js','utf8');const old1="const [selEmp,setSelEmp]=useState('');const ae=s.emps||[];";const new1=old1+"\n  const [scanning,setScanning]=useState(false);const [scanResult,setScanResult]=useState(null);const [scanFiles,setScanFiles]=useState([]);const [scanLog,setScanLog]=useState([]);\n  const handleFileUpload=(e)=>{const files=Array.from(e.target.files||[]);if(!files.length)return;setScanFiles(files);setScanLog(l=>[...l,files.length+' fichier(s)']);};\n  const doScan=async()=>{if(!scanFiles.length)return;setScanning(true);setScanResult(null);setScanLog(l=>[...l,'Analyse IA...']);const allR=[];for(const file of scanFiles){try{setScanLog(l=>[...l,'Analyse: '+file.name]);const b64=await new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result.split(',')[1]);r.onerror=rej;r.readAsDataURL(file);});const mt=file.name.toLowerCase().endsWith('.pdf')?'application/pdf':file.type;const resp=await fetch('/api/scan-paie',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({documents:[{base64:b64,filename:file.name,mediaType:mt}]})});const data=await resp.json();if(data.results&&data.results[0]){const x=data.results[0].extracted;allR.push(x);setScanLog(l=>[...l,'OK '+file.name]);}else{setScanLog(l=>[...l,'Pas de donnees: '+file.name]);}}catch(err){setScanLog(l=>[..,l,'Erreur: '+file.name]);}}if(allR.length>0){let tB=0,tO=0,tP=0,tC=0,tN=0,m=0;for(const r of allR){const re=r.remuneration||{};const rt=r.retenues||{};const n=r.net||{};tB+=+(re.brut_total||0);tO+=+(rt.onss_travailleur||0);tP+=+(rt.precompte_professionnel||0);tC+=+(rt.cotisation_speciale_ss||0);tN+=+(n.net_a_payer||0);m++;}setCumuls(p=>({...p,brutTotal:+tB.toFixed(2),brutONSS:+tB.toFixed(2),onssPerso:+tO.toFixed(2),ppRetenu:+tP.toFixed(2),csss:+tC.toFixed(2),netTotal:+tN.toFixed(2),moisPrestes:m}));setScanResult({count:m});setScanLog(l=>[...l,m+' fiches - cumuls pre-remplis']);}setScanning(false);};";c=c.replace(old1,new1);const old2="{tab==='cumuls'&&<div>\n      <div style={{display:'flex',gap:10,marginBottom:16}}>";const new2="{tab==='cumuls'&&<div>\n      <div style={{padding:16,background:'rgba(198,163,78,.04)',border:'2px dashed rgba(198,163,78,.25)',borderRadius:14,marginBottom:20}}><div style={{fontSize:14,fontWeight:700,color:'#c6a34e',marginBottom:8}}>Scanner IA - Analyse automatique</div><div style={{fontSize:11,color:'#888',marginBottom:12}}>Uploadez les fiches de paie PDF ou photo.</div><div style={{display:'flex',gap:10,marginBottom:10}}><label style={{flex:1,padding:12,borderRadius:10,border:'1px solid rgba(198,163,78,.2)',background:'#090c16',cursor:'pointer',textAlign:'center',fontSize:12,color:'#c6a34e'}}><input type='file' multiple accept='.pdf,.jpg,.jpeg,.png' onChange={handleFileUpload} style={{display:'none'}}/>{scanFiles.length?scanFiles.length+' fichier(s)':'Cliquez pour selectionner'}</label><button onClick={doScan} disabled={scanning||!scanFiles.length} style={{padding:'12px 24px',borderRadius:10,border:'none',background:scanFiles.length?'linear-gradient(135deg,#c6a34e,#a07d3e)':'rgba(198,163,78,.1)',color:scanFiles.length?'#060810':'#555',fontWeight:700,cursor:scanFiles.length?'pointer':'not-allowed'}}>{scanning?'Analyse...':'Analyser avec IA'}</button></div>{scanLog.length>0&&<div style={{maxHeight:150,overflow:'auto',padding:8,background:'#060810',borderRadius:8}}>{scanLog.map((l,i)=><div key={i} style={{fontSize:10,color:l.includes('OK')?'#22c55e':l.includes('Erreur')?'#ef4444':'#888',fontFamily:'monospace'}}>{l}</div>)}</div>}{scanResult&&<div style={{marginTop:8,padding:8,background:'rgba(34,197,94,.05)',borderRadius:8}}><span style={{fontSize:11,color:'#22c55e'}}>OK {scanResult.count} fiche(s) - Cumuls pre-remplis</span></div>}</div>\n      <div style={{display:'flex',gap:10,marginBottom:16}}>";c=c.replace(old2,new2);fs.writeFileSync('app/AureusSocialPro.js',c,'utf8');console.log('SCANNER INJECTE OKI');