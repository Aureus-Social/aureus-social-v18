function KPIDashboardMod({s,d}){const ae=s.emps||[];const n=ae.length;const mb=ae.reduce((a,e)=>a+(+e.gross||0),0);const coutTotal=mb*1.2507;const netTotal=mb*0.5645;const moyBrut=n>0?mb/n:0;const femmes=ae.filter(e=>(e.gender||"").toLowerCase()==="f").length;const hommes=n-femmes;const cdi=ae.filter(e=>(e.contractType||"CDI")==="CDI").length;const cdd=ae.filter(e=>(e.contractType||"")==="CDD").length;const tp=ae.filter(e=>(+e.regime||100)<100).length;const ages=ae.map(e=>{if(!e.birthDate)return 35;const bd=new Date(e.birthDate);return Math.floor((Date.now()-bd)/(365.25*24*3600*1000));});const moyAge=ages.length>0?(ages.reduce((a,c)=>a+c,0)/ages.length).toFixed(1):0;const moins25=ages.filter(a=>a<25).length;const a2534=ages.filter(a=>a>=25&&a<35).length;const a3544=ages.filter(a=>a>=35&&a<45).length;const a4554=ages.filter(a=>a>=45&&a<55).length;const plus55=ages.filter(a=>a>=55).length;const ancs=ae.map(e=>{if(!e.startDate)return 1;return Math.max(0.5,((Date.now()-new Date(e.startDate))/(365.25*24*3600*1000)));});const moyAnc=ancs.length>0?(ancs.reduce((a,c)=>a+c,0)/ancs.length).toFixed(1):0;const [tab,setTab]=useState("overview");
return <div><PH title="Dashboard RH" sub={"Vue globale - "+n+" travailleurs - Masse salariale "+fmt(mb)+"/mois"}/><div style={{display:"grid",gridTemplateColumns:"repeat(6,1fr)",gap:10,marginBottom:18}}>{[{l:"Effectif",v:n,c:"#c6a34e"},{l:"Masse brute",v:fmt(mb),c:"#c6a34e"},{l:"Cout employeur",v:fmt(coutTotal),c:"#f87171"},{l:"Net total",v:fmt(netTotal),c:"#4ade80"},{l:"Age moyen",v:moyAge+" ans",c:"#60a5fa"},{l:"Anciennete moy.",v:moyAnc+" ans",c:"#a78bfa"}].map((k,i)=><div key={i} style={{padding:"12px 14px",background:"rgba(198,163,78,.04)",borderRadius:10,border:"1px solid rgba(198,163,78,.08)"}}><div style={{fontSize:9,color:"#5e5c56",textTransform:"uppercase",letterSpacing:".5px"}}>{k.l}</div><div style={{fontSize:17,fontWeight:700,color:k.c,marginTop:4}}>{k.v}</div></div>)}</div><div style={{display:"flex",gap:6,marginBottom:16}}>{[{v:"overview",l:"Vue globale"},{v:"masse",l:"Masse salariale"},{v:"demog",l:"Demographie"},{v:"contrats",l:"Contrats"},{v:"salaries",l:"Par travailleur"},{v:"alerts",l:"Alertes RH"}].map(t=><button key={t.v} onClick={()=>setTab(t.v)} style={{padding:"8px 16px",borderRadius:8,border:"none",cursor:"pointer",fontSize:12,fontWeight:tab===t.v?600:400,fontFamily:"inherit",background:tab===t.v?"rgba(198,163,78,.15)":"rgba(255,255,255,.03)",color:tab===t.v?"#c6a34e":"#9e9b93"}}>{t.l}</button>)}</div>{tab==="overview"&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:14}}><C><ST>Repartition H/F</ST><div style={{display:"flex",alignItems:"center",gap:16,justifyContent:"center",padding:"20px 0"}}><div style={{textAlign:"center"}}><div style={{width:56,height:56,borderRadius:"50%",background:"rgba(96,165,250,.15)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,color:"#60a5fa"}}>{hommes}</div><div style={{fontSize:10,color:"#9e9b93",marginTop:4}}>Hommes</div></div><div style={{textAlign:"center"}}><div style={{width:56,height:56,borderRadius:"50%",background:"rgba(248,113,113,.15)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,color:"#f87171"}}>{femmes}</div><div style={{fontSize:10,color:"#9e9b93",marginTop:4}}>Femmes</div></div></div><div style={{height:8,display:"flex",borderRadius:4,overflow:"hidden"}}>{hommes>0&&<div style={{width:(hommes/Math.max(n,1)*100)+"%",background:"#60a5fa"}}/>}{femmes>0&&<div style={{width:(femmes/Math.max(n,1)*100)+"%",background:"#f87171"}}/>}</div></C><C><ST>Pyramide des ages</ST>{[{l:"-25 ans",v:moins25,c:"#4ade80"},{l:"25-34",v:a2534,c:"#60a5fa"},{l:"35-44",v:a3544,c:"#a78bfa"},{l:"45-54",v:a4554,c:"#fb923c"},{l:"55+",v:plus55,c:"#f87171"}].map((r,i)=><div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"4px 0"}}><span style={{width:40,fontSize:10,color:"#9e9b93"}}>{r.l}</span><div style={{flex:1,height:12,background:"rgba(198,163,78,.06)",borderRadius:3,overflow:"hidden"}}><div style={{height:"100%",width:Math.max(2,(r.v/Math.max(n,1)*100))+"%",background:r.c,borderRadius:3}}/></div><span style={{width:20,fontSize:11,fontWeight:700,color:r.c,textAlign:"right"}}>{r.v}</span></div>)}</C><C><ST>Types de contrats</ST><div style={{display:"flex",flexDirection:"column",gap:8,padding:"10px 0"}}>{[{l:"CDI",v:cdi,c:"#4ade80"},{l:"CDD",v:cdd,c:"#fb923c"},{l:"Temps partiel",v:tp,c:"#60a5fa"},{l:"Temps plein",v:n-tp,c:"#a78bfa"}].map((r,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{color:"#9e9b93",fontSize:12}}>{r.l}</span><div style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:60,height:6,background:"rgba(198,163,78,.06)",borderRadius:3,overflow:"hidden"}}><div style={{height:"100%",width:Math.max(5,(r.v/Math.max(n,1)*100))+"%",background:r.c,borderRadius:3}}/></div><span style={{fontSize:13,fontWeight:700,color:r.c,width:24,textAlign:"right"}}>{r.v}</span></div></div>)}</div></C></div>}
{tab==="masse"&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:18}}><C><ST>Decomposition masse salariale mensuelle</ST>{[{l:"Salaires bruts",v:mb,c:"#c6a34e"},{l:"ONSS patronal (25.07%)",v:mb*0.2507,c:"#f87171"},{l:"Assurance AT (~1%)",v:mb*0.01,c:"#f87171"},{l:"Medecine travail",v:n*7.63,c:"#f87171"},{l:"Cheques-repas patronal",v:n*5.91*22,c:"#f87171"},{l:"COUT TOTAL EMPLOYEUR",v:coutTotal+mb*0.01+n*7.63+n*5.91*22,c:"#f87171"}].map((r,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:i===5?"2px solid rgba(248,113,113,.3)":"1px solid rgba(255,255,255,.03)"}}><span style={{color:"#9e9b93"}}>{r.l}</span><span style={{fontWeight:i===5?700:600,color:r.c,fontSize:i===5?16:13}}>{fmt(r.v)}</span></div>)}</C><C><ST>Projection annuelle</ST>{[{l:"Masse brute x 12",v:mb*12,c:"#c6a34e"},{l:"13eme mois",v:mb,c:"#c6a34e"},{l:"Pecule vacances",v:mb*0.92,c:"#c6a34e"},{l:"Masse brute totale",v:mb*13.92,c:"#c6a34e"},{l:"ONSS patronal annuel",v:mb*13.92*0.2507,c:"#f87171"},{l:"Cout annuel total",v:mb*13.92*1.2507,c:"#f87171"},{l:"Cout moyen/trav./mois",v:n>0?coutTotal/n:0,c:"#fb923c"},{l:"Cout moyen/trav./an",v:n>0?mb*13.92*1.2507/n:0,c:"#fb923c"}].map((r,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,.03)"}}><span style={{color:"#9e9b93"}}>{r.l}</span><span style={{fontWeight:600,color:r.c}}>{fmt(r.v)}</span></div>)}</C></div>}{tab==="demog"&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:18}}><C><ST>Pyramide des ages detaillee</ST>{[{l:"Moins de 25 ans",v:moins25,p:n>0?((moins25/n)*100).toFixed(0):0,c:"#4ade80"},{l:"25 - 34 ans",v:a2534,p:n>0?((a2534/n)*100).toFixed(0):0,c:"#60a5fa"},{l:"35 - 44 ans",v:a3544,p:n>0?((a3544/n)*100).toFixed(0):0,c:"#a78bfa"},{l:"45 - 54 ans",v:a4554,p:n>0?((a4554/n)*100).toFixed(0):0,c:"#fb923c"},{l:"55 ans et plus",v:plus55,p:n>0?((plus55/n)*100).toFixed(0):0,c:"#f87171"}].map((r,i)=><div key={i} style={{padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,.03)"}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><span style={{color:"#e8e6e0",fontSize:12}}>{r.l}</span><span style={{color:r.c,fontWeight:700}}>{r.v} ({r.p}%)</span></div><div style={{height:10,background:"rgba(198,163,78,.06)",borderRadius:4,overflow:"hidden"}}><div style={{height:"100%",width:Math.max(3,+r.p)+"%",background:r.c,borderRadius:4}}/></div></div>)}</C><C><ST>Indicateurs demographiques</ST>{[{l:"Age moyen",v:moyAge+" ans",c:"#60a5fa"},{l:"Anciennete moyenne",v:moyAnc+" ans",c:"#a78bfa"},{l:"Ratio H/F",v:hommes+"/"+femmes,c:"#c6a34e"},{l:"Taux feminisation",v:n>0?((femmes/n)*100).toFixed(0)+"%":"0%",c:"#f87171"},{l:"Taux temps partiel",v:n>0?((tp/n)*100).toFixed(0)+"%":"0%",c:"#fb923c"},{l:"Taux CDI",v:n>0?((cdi/n)*100).toFixed(0)+"%":"0%",c:"#4ade80"},{l:"Brut moyen",v:fmt(moyBrut),c:"#c6a34e"},{l:"Brut median",v:fmt(ae.length>0?[...ae].sort((a2,b2)=>(+a2.gross||0)-(+b2.gross||0))[Math.floor(ae.length/2)]?.gross||0:0),c:"#c6a34e"}].map((r,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,.03)"}}><span style={{color:"#9e9b93"}}>{r.l}</span><span style={{fontWeight:600,color:r.c}}>{r.v}</span></div>)}</C></div>}
{tab==="contrats"&&<C><ST>Detail contrats de travail</ST><Tbl cols={[{k:"n",l:"Travailleur",b:1,r:r=>(r.fn||"")+" "+(r.ln||"")},{k:"t",l:"Type",r:r=><span style={{fontSize:10,padding:"2px 6px",borderRadius:4,background:(r.contractType||"CDI")==="CDI"?"rgba(74,222,128,.1)":"rgba(251,146,56,.1)",color:(r.contractType||"CDI")==="CDI"?"#4ade80":"#fb923c"}}>{r.contractType||"CDI"}</span>},{k:"d",l:"Debut",r:r=><span style={{color:"#9e9b93"}}>{r.startDate||"-"}</span>},{k:"r",l:"Regime",a:"right",r:r=><span style={{color:"#60a5fa"}}>{(+r.regime||100)+"%"}</span>},{k:"g",l:"Brut",a:"right",r:r=><span style={{color:"#c6a34e",fontWeight:600}}>{fmt(+r.gross||0)}</span>},{k:"c",l:"Cout empl.",a:"right",r:r=><span style={{color:"#f87171"}}>{fmt((+r.gross||0)*1.2507)}</span>},{k:"ne",l:"Net est.",a:"right",r:r=><span style={{color:"#4ade80"}}>{fmt((+r.gross||0)*0.5645)}</span>}]} data={ae}/><div style={{display:"flex",justifyContent:"space-between",padding:"12px 0",borderTop:"2px solid rgba(198,163,78,.3)",marginTop:8}}><b style={{color:"#c6a34e"}}>TOTAUX</b><div style={{display:"flex",gap:24}}><span style={{color:"#c6a34e",fontWeight:700}}>Brut: {fmt(mb)}</span><span style={{color:"#f87171",fontWeight:700}}>Cout: {fmt(coutTotal)}</span><span style={{color:"#4ade80",fontWeight:700}}>Net: {fmt(netTotal)}</span></div></div></C>}{tab==="salaries"&&<C><ST>Fiche individuelle par travailleur</ST>{ae.length===0?<div style={{color:"#5e5c56",textAlign:"center",padding:40}}>Aucun travailleur</div>:ae.map((e,i)=>{const g=+e.gross||0;const oT=g*0.1307;const pT=g*0.22;const nT=g-oT-pT;return <div key={i} style={{padding:"12px 0",borderBottom:"1px solid rgba(255,255,255,.05)"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}><div><b style={{color:"#e8e6e0",fontSize:13}}>{(e.fn||"")+" "+(e.ln||"")}</b><span style={{color:"#5e5c56",fontSize:10,marginLeft:8}}>{e.statut||"Employe"} - {e.contractType||"CDI"} - {(+e.regime||100)+"%"}</span></div><span style={{color:"#c6a34e",fontWeight:700,fontSize:15}}>{fmt(g)}</span></div><div style={{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:8}}>{[{l:"ONSS",v:"-"+fmt(oT),c:"#f87171"},{l:"PP est.",v:"-"+fmt(pT),c:"#f87171"},{l:"Net est.",v:fmt(nT),c:"#4ade80"},{l:"Cout empl.",v:fmt(g*1.2507),c:"#fb923c"},{l:"Annuel",v:fmt(g*13.92),c:"#60a5fa"}].map((k,j)=><div key={j} style={{padding:"6px 8px",background:"rgba(198,163,78,.03)",borderRadius:6,textAlign:"center"}}><div style={{fontSize:9,color:"#5e5c56"}}>{k.l}</div><div style={{fontSize:12,fontWeight:600,color:k.c}}>{k.v}</div></div>)}</div></div>})}</C>}{tab==="alerts"&&<C><ST>Alertes RH</ST>{[].concat(ae.filter(e=>!e.niss).map(e=>({t:"NISS manquant",d:(e.fn||"")+" "+(e.ln||"")+" - Numero national requis pour declarations",c:"#f87171"}))).concat(ae.filter(e=>!e.startDate).map(e=>({t:"Date entree manquante",d:(e.fn||"")+" "+(e.ln||"")+" - Requis pour anciennete et preavis",c:"#fb923c"}))).concat(ae.filter(e=>!e.birthDate).map(e=>({t:"Date naissance manquante",d:(e.fn||"")+" "+(e.ln||"")+" - Requis pour pyramide ages",c:"#fb923c"}))).concat(ae.filter(e=>(+e.gross||0)<1958.88).map(e=>({t:"Salaire sous RMMMG",d:(e.fn||"")+" "+(e.ln||"")+" - Brut "+fmt(+e.gross||0)+" < 1.958,88 EUR (RMMMG 2026)",c:"#f87171"}))).concat(ae.filter(e=>{if(!e.startDate)return false;const m=((Date.now()-new Date(e.startDate))/(365.25*24*3600*1000));return (e.contractType||"")==="CDD"&&m>2;}).map(e=>({t:"CDD > 2 ans",d:(e.fn||"")+" "+(e.ln||"")+" - Risque requalification CDI (max 4 CDD / 2 ans)",c:"#f87171"}))).concat(n>=20?[{t:"Plan formation obligatoire",d:"Effectif >= 20: obligation plan formation 4j/ETP/an",c:"#60a5fa"}]:[]).concat(n>=50?[{t:"CPPT obligatoire",d:"Effectif >= 50: Comite PPT obligatoire + elections sociales",c:"#60a5fa"},{t:"CE obligatoire",d:"Effectif >= 100: Conseil entreprise obligatoire",c:"#60a5fa"}]:[]).concat(femmes>0&&hommes>0?[{t:"Ecart salarial H/F",d:"Rapport ecart salarial bisannuel obligatoire (Loi 22/04/2012)",c:"#a78bfa"}]:[]).map((r,i)=><div key={i} style={{display:"flex",gap:12,padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,.03)"}}><div style={{width:8,height:8,borderRadius:"50%",background:r.c,marginTop:4,flexShrink:0}}/><div><b style={{color:r.c,fontSize:12}}>{r.t}</b><div style={{fontSize:10.5,color:"#9e9b93",marginTop:2}}>{r.d}</div></div></div>)}{ae.length>0&&ae.every(e=>e.niss&&e.startDate&&e.birthDate&&(+e.gross||0)>=1958.88)&&<div style={{textAlign:"center",padding:20,color:"#4ade80"}}>Aucune alerte - Donnees completes</div>}</C>}</div>;}
